
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.0" theme-name="Stellar" theme-version="1.33.0">
  
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>OpenGLå›¾å½¢å­¦ç¼–ç¨‹åŸºç¡€å­¦ä¹ è®°å½• - Fingsinz</title>

  
  <meta name="description" content="å…³é”®è¯ï¼šC++ã€OpenGL">
  
  <meta name="keywords" content="CPP,OpenGL">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.0">


  

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Fingsinz","sameAs":[],"image":"/images/avatar.jpg"},"dateCreated":"2024-01-09T15:00:00+08:00","dateModified":"2024-08-07T14:15:06+08:00","datePublished":"2024-01-09T15:00:00+08:00","description":"å…³é”®è¯ï¼šC++ã€OpenGL","headline":"OpenGLå›¾å½¢å­¦ç¼–ç¨‹åŸºç¡€å­¦ä¹ è®°å½•","mainEntityOfPage":{"@type":"WebPage","@id":"https://fingsinz.space/2024/basicOpenGL/"},"publisher":{"@type":"Organization","name":"Fingsinz","sameAs":[],"image":"/images/avatar.jpg","logo":{"@type":"ImageObject","url":"/images/avatar.jpg"}},"url":"https://fingsinz.space/2024/basicOpenGL/","keywords":"CPP, OpenGL","image":[]}</script>
  
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>
<body>

<div class="l_body content" id="start" layout="post" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/images/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main">Fingsinz</div><div class="sub cap">Fingsinz's space</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item active" title="åšå®¢" href="/" style="color:#c7c6b6"><span>åšå®¢</span></a><a class="nav-item" title="æ–‡æ¡£" href="/docs/" style="color:#a72126"><span>æ–‡æ¡£</span></a><a class="nav-item" title="æ¢ç´¢" href="/explore/" style="color:#12264f"><span>æ¢ç´¢</span></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="ç«™å†…æœç´¢"></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div>

<widget class="widget-wrapper markdown"><div class="widget-body fs14"><p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢<br>
åšå®¢ğŸ“„ï¼šä¸€äº›å°æ–‡ç« <br>
ç¬”è®°ğŸ“”ï¼šä¸ªäººå­¦ä¹ è®°å½•<br>
æ–‡æ¡£ğŸ—‚ï¸ï¼šä¸€äº›é¡¹ç›®çš„æ–‡æ¡£<br>
æ¢ç´¢ğŸ’¡ï¼šä¸€äº›å‘ç°</p>

<div class="linklist center" style="grid-template-columns:repeat(1,1fr);">
<a class="link" title="Github" target="_blank" rel="noopener" href="https://github.com/Fingsinz"><div class="flex"><img src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/08a41b181ce68.svg"/><span>Github</span></div></a></div></div></widget>


</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a></div>
<div class="flex-row" id="post-meta"><span class="text created">å‘å¸ƒäºï¼š<time datetime="2024-01-09T07:00:00.000Z">2024-01-09</time></span><span class="sep updated"></span><span class="text updated">æ›´æ–°äºï¼š<time datetime="2024-08-07T06:15:06.816Z">2024-08-07</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>OpenGLå›¾å½¢å­¦ç¼–ç¨‹åŸºç¡€å­¦ä¹ è®°å½•</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p>å…³é”®è¯ï¼šC++ã€OpenGL</p>
<span id="more"></span>
<hr>
<p><em>æœªå®Œå¾…æ–½å·¥â€¦</em></p>
<h2 id="ä¸€-openglå®‰è£…ä¸ä½¿ç”¨">ä¸€ã€OpenGLå®‰è£…ä¸ä½¿ç”¨</h2>
<p><em>Referenceï¼šè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆä½¿ç”¨OpenGLå’ŒC++ï¼‰ï¼ˆç¬¬2ç‰ˆï¼‰</em></p>
<h3 id="1-1-è®¤è¯†opengl">1.1 è®¤è¯†OpenGL</h3>
<p>åœ¨ C++ä¸­ä½¿ç”¨ OpenGL éœ€è¦é…ç½®å¤šä¸ªåº“ã€‚æ­¤å¤„ï¼Œä½¿ç”¨åˆ°ï¼š</p>
<ul>
<li>
<p>C++å¼€å‘ç¯å¢ƒï¼›</p>
</li>
<li>
<p>OpenGL / GLSLï¼š2004 å¹´ï¼Œ2.0 ç‰ˆæœ¬ä¸­å¼•å…¥äº† OpenGL ç€è‰²è¯­è¨€ GLSLï¼Œä½¿å¾—â€œç€è‰²å™¨ç¨‹åºâ€å¯ä»¥è¢«ç›´æ¥å®‰è£…åˆ°å›¾å½¢ç®¡çº¿çš„å„ä¸ªé˜¶æ®µå¹¶æ‰§è¡Œï¼›</p>
</li>
<li>
<p>çª—å£ç®¡ç†åº“ï¼šOpenGLä¼šå°†å›¾åƒæ¸²æŸ“åˆ°ä¸€ä¸ªå¸§ç¼“å†²åŒºï¼Œç„¶åç”±è®¡ç®—æœºå°†å¸§ç¼“å†²åŒºçš„å†…å®¹ç»˜åˆ¶åˆ°å±å¹•çš„çª—å£ä¸­ï¼ŒGLFW åº“æ˜¯æœ€æµè¡Œçš„é€‰æ‹©ä¹‹ä¸€ã€‚</p>
</li>
<li>
<p>æ‰©å±•åº“ï¼šå¸¸ç”¨å¦‚ GLEW åº“ï¼›</p>
</li>
<li>
<p>æ•°å­¦åº“ï¼š3D å›¾å½¢ç¼–ç¨‹ä¼šå¤§é‡ä½¿ç”¨å‘é‡å’ŒçŸ©é˜µä»£æ•°ï¼Œå¯ä½¿ç”¨ OpenGL Mathematicsï¼ˆGLMï¼‰åº“ã€ Eigen åº“æˆ– vmath åº“ï¼›</p>
</li>
<li>
<p>çº¹ç†å›¾åƒåŠ è½½åº“ï¼šæ¯”å¦‚ FreeImageã€DevILã€GLIã€Glraw å’Œ SOILã€‚</p>
</li>
</ul>
<h3 id="1-2-å®‰è£…å’Œé…ç½®opengl">1.2 å®‰è£…å’Œé…ç½®OpenGL</h3>
<p><em>åŸºäºVisual Studio 2022è¿›è¡Œ</em></p>
<h4 id="1-2-1-å‡†å¤‡opengl-glsl">1.2.1 å‡†å¤‡OpenGL/GLSL</h4>
<ul>
<li>äº†è§£è®¡ç®—æœºæ”¯æŒä»€ä¹ˆç‰ˆæœ¬çš„OpenGLï¼Œå¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.realtech-vr.com/home/?page_id=1402">GLView</a> æŸ¥çœ‹ã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_OpenGLversion.jpg" alt="OpenGLç‰ˆæœ¬"></p>
<h4 id="1-2-2-å‡†å¤‡glfw">1.2.2 å‡†å¤‡GLFW</h4>
<ol>
<li>ä¸‹è½½ GLFW æºä»£ç ï¼Œ<a target="_blank" rel="noopener" href="https://www.glfw.org/">ä¸‹è½½åœ°å€</a></li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwfiles.jpg" alt="GLFWæ–‡ä»¶"></p>
<ol start="2">
<li>ä½¿ç”¨ CMake è¿›è¡Œç¼–è¯‘æºç </li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwbuild.jpg" alt="ç¼–è¯‘GLFW"></p>
<p>æ¥ç€æ‰¾åˆ° GLFW.slnï¼Œä½¿ç”¨VSæ‰“å¼€å¹¶ç¼–è¯‘ä¸º64ä½åº”ç”¨ç¨‹åºã€‚</p>
<ol start="3">
<li>æ„å»ºå®Œæˆåå¾—åˆ°ä¸‹é¢ä¸¤ä¸ªå†…å®¹ï¼šlibé™æ€åº“æ–‡ä»¶å’Œincludeæ–‡ä»¶å¤¹</li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwlib.jpg" alt="é™æ€åº“"></p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwinclude.jpg" alt="include"></p>
<h4 id="1-2-3-å‡†å¤‡glew">1.2.3 å‡†å¤‡GLEW</h4>
<p>ä¸‹è½½ GLEW çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ<a target="_blank" rel="noopener" href="https://glew.sourceforge.net/">ä¸‹è½½åœ°å€</a>ã€‚è§£å‹åå†…æœ‰åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶ç­‰ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glew.jpg" alt="GLEWæ–‡ä»¶å¤¹"></p>
<h4 id="1-2-4-å‡†å¤‡glm">1.2.4 å‡†å¤‡GLM</h4>
<p>ä¸‹è½½ GLM å‹ç¼©åŒ…ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/g-truc/glm/releases">ä¸‹è½½åœ°å€</a>ï¼Œè§£å‹åå³å¯ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glm.jpg" alt="GLM"></p>
<h4 id="1-2-5-å‡†å¤‡soil2">1.2.5 å‡†å¤‡SOIL2</h4>
<ol>
<li>
<p>ä¸‹è½½å¹¶è§£å‹ <a target="_blank" rel="noopener" href="https://premake.github.io/">premake</a>ï¼ŒåŒ…å« premake5.exeã€‚</p>
</li>
<li>
<p>ä¸‹è½½ SOIL2 çš„æºç ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/SpartanJ/SOIL2/tags">ä¸‹è½½åœ°å€</a>ï¼Œè§£å‹ã€‚</p>
</li>
<li>
<p>å°† premake5.exe å¤åˆ¶åˆ° soil2 ç›®å½•ä¸‹ã€‚</p>
</li>
<li>
<p>åœ¨ soil2 ç›®å½•ä¸‹ä½¿ç”¨cmdï¼Œè¿è¡Œå‘½ä»¤ï¼š</p>
</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">premake5 vs2022</span><br></pre></td></tr></table></figure>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_premake.jpg" alt="è¿è¡Œå‘½ä»¤"></p>
<ol start="5">
<li>æ‰“å¼€ make/windows æ–‡ä»¶å¤¹çš„ SOIL2.sln æ–‡ä»¶ï¼Œå³é”® soil2-static-lib åœ¨ x64 ä¸‹é€‰æ‹©è¿›è¡Œç”Ÿæˆã€‚</li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_soil2.jpg" alt="ç”Ÿæˆæ–‡ä»¶"></p>
<h4 id="1-2-6-å‡†å¤‡å…±äº«çš„libå’Œinclude">1.2.6 å‡†å¤‡å…±äº«çš„libå’Œinclude</h4>
<p>é€‰æ‹©åˆé€‚çš„ä½ç½®åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¹¶è®¾ç½® lib å’Œ include å­æ–‡ä»¶å¤¹ã€‚</p>
<ul>
<li>
<p>åœ¨ lib æ–‡ä»¶å¤¹ä¸­æ”¾å…¥ glew32.libã€glfw3.lib å’Œ soil2-debug.libã€‚</p>
</li>
<li>
<p>åœ¨ include æ–‡ä»¶å¤¹ä¸­æ”¾å…¥ GLEW çš„ GL æ–‡ä»¶å¤¹ã€GLFW æ–‡ä»¶å¤¹ã€glm æ–‡ä»¶å¤¹ å’Œ SOIL2-1.3.0/src çš„ SOIL2 æ–‡ä»¶å¤¹ã€‚</p>
</li>
<li>
<p>åœ¨å½“å‰æ–‡ä»¶å¤¹æ”¾å…¥ glew32.dll</p>
</li>
</ul>
<p>æ–‡ä»¶ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_openglstructure.jpg" alt="å…±äº«æ–‡ä»¶å¤¹ç»“æ„"></p>
<h3 id="1-3-åœ¨vsä¸­é…ç½®openglé¡¹ç›®">1.3 åœ¨VSä¸­é…ç½®OpenGLé¡¹ç›®</h3>
<p><em>åˆ›å»º VS è‡ªå®šä¹‰é¡¹ç›®æ¨¡æ¿</em></p>
<ol>
<li>
<p>å¯åŠ¨ VSï¼Œ åˆ›å»ºç©ºç™½é¡¹ç›®ï¼Œé€‰æ‹© x64ã€‚</p>
</li>
<li>
<p>åœ¨ Debug æ¨¡å¼ä¸‹ï¼Œè¿›å…¥â€œé¡¹ç›®å±æ€§â€ï¼Œåœ¨â€œVC++â€ç›®å½•ä¸‹çš„åŒ…å«ç›®å½•æ·»åŠ ä¸Šå…±äº«æ–‡ä»¶å¤¹çš„ include æ–‡ä»¶å¤¹ï¼›åœ¨â€œé“¾æ¥å™¨â€ä¸‹ï¼Œâ€œå¸¸è§„-&gt;é™„åŠ åº“ç›®å½•â€ï¼ˆæˆ–â€œVC+Â±&gt;åº“ç›®å½•â€ï¼‰æ·»åŠ ä¸Šå…±äº«æ–‡ä»¶å¤¹çš„ lib æ–‡ä»¶å¤¹ï¼Œâ€œè¾“å…¥-&gt;é™„åŠ ä¾èµ–é¡¹â€æ·»åŠ ä»¥ä¸‹æ–‡ä»¶åï¼š <code>glfw3.lib</code>ã€<code>glew32.lib</code>ã€<code>soil2-debug.lib</code> å’Œ <code>opengl32.lib</code>ã€‚</p>
</li>
<li>
<p>åœ¨ Release æ¨¡å¼ä¸‹ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚</p>
</li>
<li>
<p>â€œé¡¹ç›®-&gt;å¯¼å‡ºæ¨¡æ¿â€ï¼Œé€‰æ‹©é¡¹ç›®æ¨¡æ¿ï¼Œå‘½åè‡ªå®šä¹‰ï¼Œæ­¤å¤„ä¸ºâ€œOpenGL projectâ€ã€‚</p>
</li>
</ol>
<p>åˆ›å»º OpenGL C++ é¡¹ç›®æ—¶ï¼Œå¯åŠ¨ VS æ—¶ï¼Œç‚¹å‡»â€œæ–°å»ºé¡¹ç›®â€ï¼Œåœ¨å·¦ä¸Šæ–¹é€‰æ‹© OpenGL æ¨¡æ¿å³å¯ä½¿ç”¨ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_template.jpg" alt="ä½¿ç”¨æ¨¡æ¿åˆ›å»ºé¡¹ç›®"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ–°å»ºOpenGL C++é¡¹ç›®æ—¶ï¼Œéœ€è¦æŠŠ <code>glew32.dll</code> æ”¾åˆ°é¡¹ç›®ç›®å½•ä¸‹ã€‚</p>
<h3 id="1-4-åˆ›å»ºä¸€ä¸ªçª—å£">1.4 åˆ›å»ºä¸€ä¸ªçª—å£</h3>
<p>è¿™éƒ¨åˆ†å¯ä»¥ç”¨æ¥æµ‹è¯•ä¸Šé¢çš„é…ç½®æ˜¯å¦æˆåŠŸã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ª OpenGL C++ åˆ›å»ºçª—å£çš„ä»£ç ï¼š</p>
<details><summary>å±•å¼€ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLFWwindow *window;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_SAMPLES, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); <span class="comment">// MacOS ä¸éœ€è¦</span></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åˆ›å»ºå®ƒçš„OpenGLä¸Šä¸‹æ–‡</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è“è‰²èƒŒæ™¯</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ¸…é™¤å±å¹•</span></span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// äº¤æ¢ç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†ESCé”®æˆ–çª—å£å·²å…³é—­</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­OpenGLçª—å£å¹¶ç»ˆæ­¢GLFW</span></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_newwindow.jpg" alt="è¿è¡Œç»“æœ"></p>
<h2 id="äºŒ-openglå›¾åƒç®¡çº¿">äºŒã€OpenGLå›¾åƒç®¡çº¿</h2>
<p>C++/OpenGL åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªé‡è¦ä»»åŠ¡æ˜¯è®©ç¨‹åºå‘˜çš„ GLSL ä»£ç è¿è¡Œäº GPU ä¸Šã€‚</p>
<p>OpenGL æä¾›äº†ä¸€ä¸ªå¤šçº§å›¾å½¢ç®¡çº¿ï¼Œå¯ä»¥ä½¿ç”¨ GLSL è¯­è¨€è¿›è¡Œéƒ¨åˆ†ç¼–ç¨‹ã€‚GLSL æ˜¯ä¸€ç§ç€è‰²å™¨è¯­è¨€ã€‚ç€è‰²å™¨è¯­è¨€ä¸»è¦è¿è¡Œäº GPU ä¸Šï¼Œåœ¨å›¾å½¢ç®¡çº¿ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<h3 id="2-1-ç®¡çº¿">2.1 ç®¡çº¿</h3>
<p>OpenGL å›¾åƒç®¡çº¿æ˜¯ OpenGL çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªå›¾åƒå¤„ç†çš„ç®¡çº¿ã€‚å›¾åƒç®¡çº¿çš„å·¥ä½œåŸç†æ˜¯å°†å›¾åƒæ•°æ®ä»åŸå§‹çš„çº¹ç†ä¸­æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚</p>
<p>3D å›¾å½¢ç¼–ç¨‹ä¼šä½¿ç”¨ç®¡çº¿çš„æ¦‚å¿µï¼Œåœ¨ç®¡çº¿ä¸­ï¼Œå°† 3D åœºæ™¯è½¬æ¢æˆ  2D å›¾å½¢çš„è¿‡ç¨‹è¢«åˆ†å‰²æˆè®¸å¤šæ­¥éª¤ã€‚</p>
<p>C++/OpenGL åº”ç”¨ç¨‹åºå‘é€å›¾å½¢æ•°æ®åˆ°é¡¶ç‚¹ç€è‰²å™¨ï¼Œéšç€ç®¡çº¿å¤„ç†ï¼Œæœ€ç»ˆç”Ÿæˆåœ¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºçš„åƒç´ ç‚¹ã€‚</p>
<h4 id="2-1-1-ç¬¬ä¸€ä¸ªc-openglåº”ç”¨ç¨‹åº">2.1.1 ç¬¬ä¸€ä¸ªC++/OpenGLåº”ç”¨ç¨‹åº</h4>
<p><em>å³è¯¦ç»†è§£é‡Šä¹‹å‰çš„åˆ›å»ºçª—å£ä»£ç </em></p>
<p>è¯¥ç¨‹åºå°†ä¼šä½¿ç”¨ä¸€äº›æ‰©å±•åº“ï¼šGLEWã€GLMã€SOIL2 å’Œ GLFWã€‚</p>
<ul>
<li>GLFW åº“æä¾›äº† GLFWwindow ç±»ï¼Œå¯åœ¨å…¶ä¸Šè¿›è¡Œ3Dåœºæ™¯ç»˜åˆ¶ã€‚</li>
</ul>
<p>è¯¥ç¨‹åºçš„å¤§æ¦‚æ“ä½œæœ‰ï¼š</p>
<ol>
<li>åˆå§‹åŒ– GLFW</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åˆ›å»ºçª—å£çš„è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"><span class="comment">// WindowHint æŒ‡å®šäº†è®¡ç®—æœºå¿…é¡»ä¸ OpenGL ç‰ˆæœ¬ 4.6 å…¼å®¹ï¼ˆä¸»ç‰ˆæœ¬å·ä¸º 4ï¼Œæ¬¡ç‰ˆæœ¬å·ä¸º 6ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>åˆ›å»ºä¸€ä¸ª GLFWwindow å®ä¾‹å¹¶åˆ›å»ºçª—å£</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// glfwCreateWindow å‘½ä»¤çš„å‚æ•°æŒ‡å®šäº†çª—å£çš„å®½ã€é«˜ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ä»¥åŠçª—å£é¡¶éƒ¨çš„æ ‡é¢˜ï¼Œåä¸¤ä¸ªNULLåˆ†åˆ«ç”¨æ¥æ§åˆ¶å…¨å±æ˜¾ç¤ºå’Œèµ„æºå…±äº«ï¼‰</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çª—å£ï¼Œå¤§å°ä¸º1024Ã—768ï¼Œçª—å£åä¸ºâ€œNew Windowâ€</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"><span class="comment">// åˆ›å»º GLFW çª—å£å¹¶ä¸ä¼šè‡ªåŠ¨å°†å®ƒä¸å½“å‰ OpenGL ä¸Šä¸‹æ–‡å…³è”èµ·æ¥ï¼Œå› æ­¤éœ€è¦è°ƒç”¨ glfwMakeContextCurrent()ã€‚</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>è®¾ç½®çª—å£å±æ€§</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line"><span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç»¿è‰²èƒŒæ™¯ï¼Œå››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºRGBAã€‚</span></span><br><span class="line"><span class="comment">// glClearColor()èƒ½å¤ŸæŒ‡å®šé¢œè‰²ç¼“å†²åŒºæ¸…é™¤åå¡«å……çš„å€¼</span></span><br><span class="line"><span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>åˆå§‹åŒ– GLEW åº“</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>å¾ªç¯æ˜¾ç¤ºçª—å£</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ¸…é™¤å±å¹•ï¼Œé‡ç½®ç¼“å†²åŒºæ—¶å¡«å……çš„é¢œè‰²</span></span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢ç¼“å†²åŒºï¼Œç»˜åˆ¶å±å¹•</span></span><br><span class="line">    <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">    <span class="comment">// å¤„ç†çª—å£ç›¸å…³äº‹ä»¶ï¼ˆå¦‚æŒ‰é”®äº‹ä»¶ï¼‰</span></span><br><span class="line">    <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†ESCé”®æˆ–çª—å£å·²å…³é—­</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>é€€å‡ºç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…³é—­OpenGLçª—å£å¹¶ç»ˆæ­¢GLFW</span></span><br><span class="line"><span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line"><span class="built_in">glfwTerminate</span>();</span><br></pre></td></tr></table></figure>
<details><summary>å®Œæ•´ç¨‹åº</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åˆ›å»ºå®ƒçš„OpenGLä¸Šä¸‹æ–‡</span></span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»¿è‰²èƒŒæ™¯</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ¸…é™¤å±å¹•</span></span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// äº¤æ¢ç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// æ£€æŸ¥æ˜¯å¦æŒ‰ä¸‹äº†ESCé”®æˆ–çª—å£å·²å…³é—­</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­OpenGLçª—å£å¹¶ç»ˆæ­¢GLFW</span></span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="2-2-é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨">2.2 é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</h3>
<p>å¤šæ•° 3D æ¨¡å‹é€šå¸¸ç”±å¤šä¸ªä¸‰è§’å½¢å›¾å…ƒæ„æˆã€‚å¦‚ç‚¹ã€çº¿ã€ä¸‰è§’å½¢è¿™äº›ç®€å•çš„å›¾å½¢ç§°ä½œå›¾å…ƒã€‚</p>
<p>å›¾å…ƒç”±é¡¶ç‚¹ç»„æˆã€‚</p>
<p>åœ¨åŠ è½½é¡¶ç‚¹ä¹‹å‰ï¼ŒC++/OpenGL åº”ç”¨ç¨‹åºå¿…é¡»ç¼–è¯‘å¹¶é“¾æ¥åˆé€‚çš„ GLSL é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨ç¨‹åºï¼Œä¹‹åå°†å®ƒä»¬è½½å…¥ç®¡çº¿ã€‚</p>
<p>æ¯”å¦‚ç»˜ç”»ä¸‰è§’å½¢æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‡½æ•°å®ç°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glDrawArrays</span>(GLenum mode, Glint first, Glsizei count);</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>modeï¼šè¡¨ç¤ºå›¾å…ƒçš„ç±»å‹ï¼›</p>
</li>
<li>
<p>firstï¼šè¡¨ç¤ºä»å“ªä¸ªé¡¶ç‚¹å¼€å§‹ç»˜åˆ¶ï¼›</p>
</li>
<li>
<p>countï¼šè¡¨ç¤ºç»˜åˆ¶çš„é¡¶ç‚¹æ•°ã€‚</p>
</li>
</ul>
<p>ä»¥ç»˜ç”»ä¸‰è§’å½¢ä¸ºä¾‹å­ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><em>æ³¨ï¼š <code>GLuint</code> æ˜¯ OpenGL æä¾›çš„ <code>unsigned int</code></em></p>
<ol>
<li>
<p>åˆå§‹åŒ–é˜¶æ®µï¼Œå¯¹ GLFW å’Œ GLEW åº“è¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒæ—¶åˆ›å»ºçª—å£ï¼›</p>
</li>
<li>
<p>åˆ›å»ºé¡¶ç‚¹æ•°ç»„å¯¹è±¡VAOå’Œç¼“å­˜åŒºï¼›</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶å°†å®ƒè®¾ä¸ºå½“å‰å¯¹è±¡</span></span><br><span class="line">GLuint VertexArrayID;</span><br><span class="line"><span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"><span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼š(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">    <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">     <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">     <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç¼“å­˜åŒº</span></span><br><span class="line">GLuint vertexbuffer; <span class="comment">// é¡¶ç‚¹ç¼“å†²åŒºæ ‡è¯†</span></span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// ç”Ÿæˆ1ä¸ªç¼“å†²åŒºï¼Œå°†ç”Ÿæˆçš„æ ‡è¯†ç¬¦æ”¾å…¥é¡¶ç‚¹ç¼“å†²</span></span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// æŠŠè¿™ä¸ªä¸‰è§’å½¢ä¼ ç»™OpenGL</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>å¾ªç¯ä¸­ç»˜ç”»ä¸‰è§’å½¢</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// å¯ç”¨é¡¶ç‚¹æ•°ç»„</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);    <span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// ç¦ç”¨é¡¶ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSwapBuffers</span>(window);    <span class="comment">// äº¤æ¢ç¼“å†²åŒºï¼Œæ›´æ–°å±å¹•</span></span><br><span class="line">    <span class="built_in">glfwPollEvents</span>();            <span class="comment">// ç›‘å¬äº‹ä»¶</span></span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>åå¤„ç†ï¼Œåˆ é™¤ç”³è¯·çš„èµ„æº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åå¤„ç†ï¼Œåˆ é™¤èµ„æº</span></span><br><span class="line"><span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line"><span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"><span class="built_in">glfwTerminate</span>();</span><br></pre></td></tr></table></figure>
<details><summary>å®Œæ•´ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åˆ›å»ºå®ƒçš„OpenGLä¸Šä¸‹æ–‡</span></span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»¿è‰²èƒŒæ™¯</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶å°†å®ƒè®¾ä¸ºå½“å‰å¯¹è±¡</span></span><br><span class="line">    GLuint VertexArrayID; <span class="comment">// é¡¶ç‚¹æ•°ç»„æ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼š(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å­˜åŒº</span></span><br><span class="line">    GLuint vertexbuffer; <span class="comment">// é¡¶ç‚¹ç¼“å†²åŒºæ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// ç”Ÿæˆ1ä¸ªç¼“å†²åŒºï¼Œå°†ç”Ÿæˆçš„æ ‡è¯†ç¬¦æ”¾å…¥é¡¶ç‚¹ç¼“å†²</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// æŠŠè¿™ä¸ªä¸‰è§’å½¢ä¼ ç»™OpenGL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// å¯ç”¨é¡¶ç‚¹æ•°ç»„å±æ€§</span></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);    <span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// ç¦ç”¨é¡¶ç‚¹æ•°ç»„å±æ€§</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);    <span class="comment">// äº¤æ¢ç¼“å†²åŒºï¼Œæ›´æ–°å±å¹•</span></span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();            <span class="comment">// ç›‘å¬äº‹ä»¶</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åå¤„ç†ï¼Œåˆ é™¤èµ„æº</span></span><br><span class="line">    <span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">    <span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle.jpg" alt="ç»˜ç”»ä¸‰è§’å½¢"></p>
<p>è¿™ä¸ªä¸‰è§’å½¢æ˜¯ç™½è‰²çš„ï¼Œå› ä¸ºå…¶å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•ç€è‰²ã€‚</p>
<p>ä½¿ç”¨é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨å¯ä»¥è¿›è¡Œç€è‰²ã€‚</p>
<details><summary>å®Œæ•´ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">GLuint <span class="title">createShadeProgram</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *vshaderSource =</span><br><span class="line">        <span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line">        <span class="string">&quot;layout(location = 0) in vec3 vertexPosition_modelspace;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#123; gl_Position.xyz = vertexPosition_modelspace; gl_Position.w = 1.0; &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *fshaderSource =</span><br><span class="line">        <span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line">        <span class="string">&quot;out vec3 color;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#123; color = vec3(0, 0, 0.3); &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OpenGL åˆ›å»ºæ¯ä¸ªç€è‰²å™¨å¯¹è±¡ï¼ˆåˆå§‹å€¼ä¸ºç©ºï¼‰çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° ID ä½œä¸ºåé¢å¼•ç”¨å®ƒçš„åºå·</span></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å­˜å…¥ vShader å’Œ fShader å˜é‡</span></span><br><span class="line">    GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER); <span class="comment">// åˆ›å»ºäº†ç±»å‹ä¸ºGL_VERTEX_SHADER çš„ç€è‰²å™¨ï¼Œå³é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER); <span class="comment">// åˆ›å»ºäº†ç±»å‹ä¸ºGL_FRAGMENT_SHADER çš„ç€è‰²å™¨ï¼Œå³ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† GLSL ä»£ç ä»å­—ç¬¦ä¸²è½½å…¥ç©ºç€è‰²å™¨å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">    <span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªå«ä½œ vfProgram çš„ç¨‹åºå¯¹è±¡å¹¶è®°å½•å…¶ID</span></span><br><span class="line">    GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="comment">// å°†ç€è‰²å™¨åŠ å…¥ç¨‹åºå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">    <span class="comment">// è¯·æ±‚ GLSL ç¼–è¯‘å™¨ï¼Œä»¥ç¡®ä¿å®ƒä»¬çš„å…¼å®¹æ€§</span></span><br><span class="line">    <span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vProgram; <span class="comment">// è¿”å›ç€è‰²å™¨ç¨‹åºID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åˆ›å»ºå®ƒçš„OpenGLä¸Šä¸‹æ–‡</span></span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»¿è‰²èƒŒæ™¯</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶å°†å®ƒè®¾ä¸ºå½“å‰å¯¹è±¡</span></span><br><span class="line">    GLuint VertexArrayID; <span class="comment">// é¡¶ç‚¹æ•°ç»„æ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼š(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å­˜åŒº</span></span><br><span class="line">    GLuint vertexbuffer; <span class="comment">// é¡¶ç‚¹ç¼“å†²åŒºæ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// ç”Ÿæˆ1ä¸ªç¼“å†²åŒºï¼Œå°†ç”Ÿæˆçš„æ ‡è¯†ç¬¦æ”¾å…¥é¡¶ç‚¹ç¼“å†²</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// æŠŠè¿™ä¸ªä¸‰è§’å½¢ä¼ ç»™OpenGL</span></span><br><span class="line"></span><br><span class="line">    GLuint programID = <span class="built_in">createShadeProgram</span>(); <span class="comment">// åˆ›å»ºç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glUseProgram</span>(programID);    <span class="comment">// ä½¿ç”¨ç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// å¯ç”¨é¡¶ç‚¹æ•°ç»„å±æ€§</span></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);    <span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// ç¦ç”¨é¡¶ç‚¹æ•°ç»„å±æ€§</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);    <span class="comment">// äº¤æ¢ç¼“å†²åŒºï¼Œæ›´æ–°å±å¹•</span></span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();            <span class="comment">// ç›‘å¬äº‹ä»¶</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åå¤„ç†ï¼Œåˆ é™¤èµ„æº</span></span><br><span class="line">    <span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">    <span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">    <span class="built_in">glDeleteProgram</span>(programID);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle1.jpg" alt="ç€è‰²åçš„ä¸‰è§’å½¢"></p>
<p>è§‚å¯Ÿç€è‰²å™¨éƒ¨åˆ†çš„ä»£ç ï¼š</p>
<p>é¡¶ç‚¹ç€è‰²å™¨ï¼šæ‰€æœ‰é¡¶ç‚¹ç€è‰²å™¨çš„ä¸»è¦ç›®æ ‡éƒ½æ˜¯å°†é¡¶ç‚¹å‘é€ç»™ç®¡çº¿ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line"><span class="string">&quot;layout(location = 0) in vec3 vertexPosition_modelspace;\n&quot;</span></span><br><span class="line"><span class="string">&quot;void main()\n&quot;</span></span><br><span class="line"><span class="string">&quot;&#123; gl_Position.xyz = vertexPosition_modelspace; gl_Position.w = 1.0; &#125;&quot;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>ç¬¬ä¸€è¡Œè¡¨ç¤ºOpenGLç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨è¯¥ç‰ˆæœ¬çš„è¯­æ³•ï¼Œæˆ‘è¿™é‡Œæ˜¯4.6.0ï¼›</p>
</li>
<li>
<p>ç¬¬äºŒè¡Œ</p>
<ul>
<li><code>layout(location = 0)</code> æŒ‡ç”¨æ¥èµ‹ç»™ <code>vertexPosition_modelspace</code> è¿™ä¸ªå±æ€§çš„ç¼“å†²åŒºã€‚æ¯ä¸ªé¡¶ç‚¹èƒ½æœ‰å¤šç§å±æ€§ï¼šä½ç½®ï¼Œä¸€ç§æˆ–å¤šç§é¢œè‰²ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¹ç†åæ ‡ï¼Œç­‰ç­‰ï¼›é€šè¿‡å°† <code>glvertexAttribPointer</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼èµ‹ç»™layoutï¼Œå°±å®Œæˆäº†è¿™ä¸€ç‚¹ã€‚å‚æ•°å€¼â€œ0â€å¹¶ä¸é‡è¦ï¼Œå®ƒå¯ä»¥æ˜¯12ï¼ˆä½†æ˜¯ä¸å¤§äº <code>glGetIntegerv(GL_MAX_VERTEX_ATTRIBS, &amp;v)</code> ï¼‰ï¼›é‡è¦çš„æ˜¯ä¸¤è¾¹å‚æ•°å€¼ä¿æŒä¸€è‡´</li>
<li><code>in</code> è¡¨ç¤ºè¡¨æ˜å˜é‡æ˜¯è¾“å…¥å˜é‡ï¼›</li>
<li><code>vec3</code> åœ¨GLSLä¸­æ˜¯ä¸€ä¸ªä¸‰ç»´å‘é‡ï¼›</li>
<li><code>vertexPosition_modelspace</code> æ˜¯å˜é‡åï¼Œå°†åŒ…å«æ¯ä¸ªé¡¶ç‚¹ç€è‰²å™¨è¿è¡Œæ‰€éœ€çš„é¡¶ç‚¹ä½ç½®å€¼ã€‚</li>
</ul>
</li>
<li>
<p>ç¬¬ä¸‰è¡Œè¡¨ç¤ºä¸»å‡½æ•°ï¼Œä¸C++è¯­æ³•ç›¸ä¼¼ï¼›</p>
</li>
<li>
<p>ç¬¬å››è¡Œå†…ç½®å˜é‡ gl_Position ç”¨æ¥è®¾ç½®é¡¶ç‚¹åœ¨ 3D ç©ºé—´ä¸­çš„åæ ‡ä½ç½®ï¼Œå¹¶å°†å…¶å‘é€è‡³ä¸‹ä¸€ä¸ªç®¡çº¿é˜¶æ®µã€‚</p>
</li>
</ol>
<p>ç‰‡æ®µç€è‰²å™¨ï¼šæ‰€æœ‰ç‰‡æ®µç€è‰²å™¨çš„ç›®çš„éƒ½æ˜¯ç»™ä¸ºè¦å±•ç¤ºçš„åƒç´ èµ‹äºˆé¢œè‰²ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;#version 460 core\n&quot;</span> </span><br><span class="line"><span class="string">&quot;out vec3 color;\n&quot;</span></span><br><span class="line"><span class="string">&quot;void main()\n&quot;</span></span><br><span class="line"><span class="string">&quot;&#123; color = vec3(0, 0, 0.3); &#125;&quot;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>ç¬¬ä¸€è¡Œè¡¨ç¤ºOpenGLç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨è¯¥ç‰ˆæœ¬çš„è¯­æ³•ï¼Œæˆ‘è¿™é‡Œæ˜¯4.6.0ï¼›</p>
</li>
<li>
<p>ç¬¬äºŒè¡Œ out æ ‡ç­¾è¡¨æ˜ color å˜é‡æ˜¯è¾“å‡ºå˜é‡ï¼›</p>
</li>
<li>
<p>ç¬¬ä¸‰è¡Œè¡¨ç¤ºä¸»å‡½æ•°ï¼Œä¸C++è¯­æ³•ç›¸ä¼¼ï¼›</p>
</li>
<li>
<p>ç¬¬å››è¡Œè¡¨ç¤ºè®¾ç½®é¢œè‰²RGBå€¼ã€‚</p>
</li>
</ol>
<p>è§£é‡Š <code>glvertexAttribPointer</code> å‡½æ•°ï¼Œå‡½æ•°ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>ç¬¬ä¸€å‚æ•°ï¼šæŒ‡å®šè¦é…ç½®çš„é¡¶ç‚¹å±æ€§ã€‚åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨ <code>layout(location = 0)</code> å®šä¹‰äº†é¡¶ç‚¹å±æ€§çš„ä½ç½®å€¼ï¼Œå®ƒå¯ä»¥æŠŠé¡¶ç‚¹å±æ€§çš„ä½ç½®å€¼è®¾ç½®ä¸º0ï¼Œæ‰€ä»¥è¿™é‡Œä¼ å…¥0ï¼›</p>
</li>
<li>
<p>ç¬¬äºŒå‚æ•°ï¼šæŒ‡å®šé¡¶ç‚¹å±æ€§çš„å¤§å°ï¼›</p>
</li>
<li>
<p>ç¬¬ä¸‰å‚æ•°ï¼šæŒ‡å®šæ•°æ®çš„ç±»å‹ï¼›</p>
</li>
<li>
<p>ç¬¬å››å‚æ•°ï¼šæ˜¯å¦å¸Œæœ›æ•°æ®è¢«æ ‡å‡†åŒ–ï¼ˆNormalizeï¼‰ï¼›</p>
</li>
<li>
<p>ç¬¬äº”å‚æ•°ï¼šæ­¥é•¿ï¼Œå‘Šè¯‰åœ¨è¿ç»­çš„é¡¶ç‚¹å±æ€§ç»„ä¹‹é—´çš„é—´éš”ï¼›</p>
</li>
<li>
<p>ç¬¬å…­å‚æ•°ï¼šæ•°ç»„ç¼“å†²åŒºåç§»é‡ã€‚</p>
</li>
</ol>
<p>æ­¤ç¤ºä¾‹ä¸­ç€è‰²å™¨ä»£ç è¾ƒçŸ­ï¼Œå¯ä»¥ç›´æ¥ç¼–å†™åˆ°ç¨‹åºä¸­ã€‚ä½†å½“ç€è‰²å™¨ä»£ç è¾ƒä¸ºå¤æ‚æ—¶ï¼Œå¸Œæœ›èƒ½æ–‡ä»¶åˆ†å¼€ï¼Œä»æ–‡ä»¶ä¸­è¯»å…¥ç€è‰²å™¨ä»£ç ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»ä»£ç å‡½æ•°</span></span><br><span class="line"><span class="function">std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(filePath, std::ios::in)</span></span>;</span><br><span class="line">    std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">        content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fileStream.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸åº”åœ° <code>createShadeProgram()</code> æ”¹æˆï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::string vs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;vertex.glsl&quot;</span>);</span><br><span class="line">std::string fs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br></pre></td></tr></table></figure>
<h3 id="2-3-glslä»£ç æ£€æŸ¥">2.3 GLSLä»£ç æ£€æŸ¥</h3>
<p>ç¼–è¯‘å’Œè¿è¡Œ GLSL ä»£ç çš„è¿‡ç¨‹ä¸æ™®é€šä»£ç çš„ä¸åŒï¼ŒGLSL çš„ç¼–è¯‘å‘ç”Ÿåœ¨ C++è¿è¡Œæ—¶ã€‚å¦å¤–ä¸€ä¸ªå¤æ‚çš„ç‚¹æ˜¯ GLSL ä»£ç å¹¶æ²¡æœ‰è¿è¡Œåœ¨ CPU ä¸­ï¼ˆå®ƒè¿è¡Œåœ¨ GPU ä¸­ï¼‰ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿå¹¶ä¸æ€»èƒ½æ•è· OpenGL è¿è¡Œæ—¶çš„é”™è¯¯ã€‚ç€è‰²å™¨è¿è¡Œæ—¶é”™è¯¯çš„å¸¸è§ç»“æœæ˜¯è¾“å‡ºå±å¹•ä¸Šå®Œå…¨ç©ºç™½ï¼Œæ ¹æœ¬æ²¡æœ‰è¾“å‡ºã€‚</p>
<p>ä½†æ˜¯ GLSL å‡½æ•° <code>glGetShaderiv()</code> å’Œ <code>glGetProgramiv()</code> å¯æä¾›æœ‰å…³ç¼–è¯‘è¿‡çš„ GLSL ç€è‰²å™¨å’Œç¨‹åºçš„ä¿¡æ¯ã€‚</p>
<p>è®¾è®¡ä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li>
<p><code>checkOpenGLError()</code>ï¼šæ—¢ç”¨äºæ£€æµ‹ GLSL ä»£ç ç¼–è¯‘é”™è¯¯ï¼Œåˆç”¨äºæ£€æµ‹ OpenGL è¿è¡Œæ—¶çš„é”™è¯¯ã€‚</p>
</li>
<li>
<p><code>printShaderLog()</code>ï¼šå½“ GLSL ä»£ç ç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹ã€‚</p>
</li>
<li>
<p><code>printProgramLog()</code>ï¼šå½“ GLSL é“¾æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹ã€‚</p>
</li>
</ul>
<details><summary>è¯¦ç»†ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL ä»£ç ç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param shader ç€è‰²å™¨æ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL é“¾æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param program ç€è‰²å™¨ç¨‹åºæ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ£€æŸ¥ OpenGL é”™è¯¯æ ‡å¿—ï¼Œå³æ˜¯å¦å‘ç”Ÿ OpenGL é”™è¯¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    <span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        err = <span class="literal">true</span>;</span><br><span class="line">        glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>åŠ å…¥é”™è¯¯æ£€æŸ¥ï¼Œåˆ›å»ºç€è‰²å™¨ç¨‹åºä»£ç æ›´æ”¹ä¸ºï¼š</p>
<details><summary>å±•å¼€ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLuint <span class="title">createShadeProgram</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    std::string vs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;vertex.glsl&quot;</span>);</span><br><span class="line">    <span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    std::string fs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OpenGL åˆ›å»ºæ¯ä¸ªç€è‰²å™¨å¯¹è±¡ï¼ˆåˆå§‹å€¼ä¸ºç©ºï¼‰çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ªæ•´æ•° ID ä½œä¸ºåé¢å¼•ç”¨å®ƒçš„åºå·</span></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å­˜å…¥ vShader å’Œ fShader å˜é‡</span></span><br><span class="line">    GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER); <span class="comment">// åˆ›å»ºäº†ç±»å‹ä¸ºGL_VERTEX_SHADER çš„ç€è‰²å™¨ï¼Œå³é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER); <span class="comment">// åˆ›å»ºäº†ç±»å‹ä¸ºGL_FRAGMENT_SHADER çš„ç€è‰²å™¨ï¼Œå³ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† GLSL ä»£ç ä»å­—ç¬¦ä¸²è½½å…¥ç©ºç€è‰²å™¨å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">    <span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">    <span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªå«ä½œ vfProgram çš„ç¨‹åºå¯¹è±¡å¹¶è®°å½•å…¶ID</span></span><br><span class="line">    GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="comment">// å°†ç€è‰²å™¨åŠ å…¥ç¨‹åºå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">    <span class="comment">// è¯·æ±‚ GLSL ç¼–è¯‘å™¨ï¼Œä»¥ç¡®ä¿å®ƒä»¬çš„å…¼å®¹æ€§</span></span><br><span class="line">    <span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">    <span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vProgram; <span class="comment">// è¿”å›ç€è‰²å™¨ç¨‹åºID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="2-4-è®©å›¾åƒåŠ¨èµ·æ¥">2.4 è®©å›¾åƒåŠ¨èµ·æ¥</h3>
<p>å®é™…ä¸Šï¼Œåœ¨ä¸»å‡½æ•°çš„å¾ªç¯ä¸­ï¼Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½ä¼šåˆ·æ–°ä¸€æ¬¡æ˜¾ç¤ºã€‚ä½†ç”±äºæ˜¾ç¤ºå†…å®¹ç›¸åŒï¼Œæ•…çœ‹èµ·æ¥æ˜¯é™æ€çš„ã€‚</p>
<p>å¯¹äºä¸Šé¢çš„ä¸‰è§’å½¢ï¼Œæ·»åŠ ä¸Šäº›è®¸åç§»é‡ï¼Œåˆ™ä¼šè‡ªç”±ç§»åŠ¨ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movingtriangle.gif" alt="ç§»åŠ¨çš„ä¸‰è§’å½¢"></p>
<details><summary>ä¸»å‡½æ•°ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLFW</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åˆ›å»ºå®ƒçš„OpenGLä¸Šä¸‹æ–‡</span></span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æˆ‘ä»¬å¯ä»¥æ•æ‰åˆ°ä¸‹é¢æŒ‰ä¸‹çš„è½¬ä¹‰é”®</span></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»¿è‰²èƒŒæ™¯</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– GLEW</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå¹¶å°†å®ƒè®¾ä¸ºå½“å‰å¯¹è±¡</span></span><br><span class="line">    GLuint VertexArrayID; <span class="comment">// é¡¶ç‚¹æ•°ç»„æ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼š(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å­˜åŒº</span></span><br><span class="line">    GLuint vertexbuffer; <span class="comment">// é¡¶ç‚¹ç¼“å†²åŒºæ ‡è¯†</span></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// ç”Ÿæˆ1ä¸ªç¼“å†²åŒºï¼Œå°†ç”Ÿæˆçš„æ ‡è¯†ç¬¦æ”¾å…¥é¡¶ç‚¹ç¼“å†²</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// æŠŠè¿™ä¸ªä¸‰è§’å½¢ä¼ ç»™OpenGL</span></span><br><span class="line"></span><br><span class="line">    GLuint programID = <span class="built_in">createShadeProgram</span>(); <span class="comment">// åˆ›å»ºç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> x = <span class="number">0.0f</span>, inc = <span class="number">0.001f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glUseProgram</span>(programID);    <span class="comment">// ä½¿ç”¨ç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">        x += inc;    <span class="comment">// ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">1.0f</span>) inc = <span class="number">-0.001f</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">-1.0f</span>) inc = <span class="number">0.001f</span>;</span><br><span class="line">        <span class="comment">// è·å–æŒ‡å‘ offset å˜é‡çš„æŒ‡é’ˆ</span></span><br><span class="line">        GLuint offsetLoc = <span class="built_in">glGetUniformLocation</span>(programID, <span class="string">&quot;offset&quot;</span>);</span><br><span class="line">        <span class="comment">// å°† x çš„å€¼å¤åˆ¶ç»™ offset</span></span><br><span class="line">        <span class="built_in">glProgramUniform1f</span>(programID, offsetLoc, x);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// å¯ç”¨é¡¶ç‚¹æ•°ç»„</span></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);    <span class="comment">// ç»˜åˆ¶ä¸‰è§’å½¢</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);    <span class="comment">// ç¦ç”¨é¡¶ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);    <span class="comment">// äº¤æ¢ç¼“å†²åŒºï¼Œæ›´æ–°å±å¹•</span></span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();            <span class="comment">// ç›‘å¬äº‹ä»¶</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åå¤„ç†ï¼Œåˆ é™¤èµ„æº</span></span><br><span class="line">    <span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">    <span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">    <span class="built_in">glDeleteProgram</span>(programID);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>è€Œé¡¶ç‚¹ç€è‰²å™¨ä¹Ÿéœ€è¦æ ¹æ®åç§»é‡ä½œä¿®æ”¹ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> <span class="keyword">offset</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertexPosition_modelspace;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(vertexPosition_modelspace.x + <span class="keyword">offset</span>, vertexPosition_modelspace.y, vertexPosition_modelspace.z, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>uniform</code> è¡¨ç¤ºç»Ÿä¸€å˜é‡ã€‚</p>
<h2 id="ä¸‰-openglæ•°å­¦åŸºç¡€">ä¸‰ã€OpenGLæ•°å­¦åŸºç¡€</h2>
<h3 id="3-1-åæ ‡ç³»">3.1 åæ ‡ç³»</h3>
<p>3D ç©ºé—´ä¸­å¸¸å¸¸ä½¿ç”¨ä¸‰ä¸ªåæ ‡è½´ç»„æˆçš„åæ ‡ç³»ï¼Œå¦‚å·¦æ‰‹åæ ‡ç³»å’Œå³æ‰‹åæ ‡ç³»ã€‚</p>
<ul>
<li>
<p>å·¦æ‰‹åæ ‡ç³»ï¼šä¼¸å‡ºå·¦æ‰‹ï¼Œä½¿å¾—æ‹‡æŒ‡ã€é£ŸæŒ‡å’Œä¸­æŒ‡ä¸¤ä¸¤å‚ç›´ï¼Œåˆ™æ‹‡æŒ‡æŒ‡å‘ä¸º x æ–¹å‘ï¼Œä¸­æŒ‡æŒ‡å‘ä¸º z æ–¹å‘ï¼Œé£ŸæŒ‡æŒ‡å‘ä¸º y æ–¹å‘ã€‚</p>
</li>
<li>
<p>å³æ‰‹åæ ‡ç³»ï¼šä¼¸å‡ºå³æ‰‹ï¼Œä½¿å¾—æ‹‡æŒ‡ã€é£ŸæŒ‡å’Œä¸­æŒ‡ä¸¤ä¸¤å‚ç›´ï¼Œåˆ™æ‹‡æŒ‡æŒ‡å‘ä¸º x æ–¹å‘ï¼Œä¸­æŒ‡æŒ‡å‘ä¸º z æ–¹å‘ï¼Œé£ŸæŒ‡æŒ‡å‘ä¸º y æ–¹å‘ã€‚</p>
</li>
</ul>
<p><em>æ­¤å­¦ä¹ è®°å½•ä½¿ç”¨å³æ‰‹åæ ‡ç³»</em></p>
<h3 id="3-2-ç‚¹">3.2 ç‚¹</h3>
<p>é½æ¬¡åæ ‡ï¼šå…·æœ‰å››ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯ x åæ ‡ã€y åæ ‡ã€z åæ ‡ã€w åæ ‡ã€‚å…¶ä¸­ w æ€»æ˜¯éé›¶å€¼ã€‚</p>
<p>OpenGL ä¸­å¯ç”¨ <code>vec3</code> æˆ– <code>vec4</code> ç±»è¡¨ç¤ºç‚¹æ•°æ®ã€‚</p>
<h3 id="3-3-å‘é‡">3.3 å‘é‡</h3>
<p>å‘é‡è¡¨ç¤ºå¤§å°å’Œæ–¹å‘ã€‚å®ƒä»¬æ²¡æœ‰ç‰¹å®šä½ç½®ã€‚åœ¨ 3D å›¾å½¢å­¦ä¸­ï¼Œå‘é‡ä¸€èˆ¬ç”¨ç©ºé—´ä¸­çš„å•ä¸ªç‚¹è¡¨ç¤ºï¼Œå‘é‡çš„å¤§å°æ˜¯åŸç‚¹åˆ°è¯¥ç‚¹çš„è·ç¦»ï¼Œæ–¹å‘åˆ™æ˜¯åŸç‚¹åˆ°è¯¥ç‚¹çš„æ–¹å‘ã€‚</p>
<p>GLSL å’Œ GLM æ‰€æä¾›çš„ <code>vec3</code> å’Œ <code>vec4</code> ç±»å‹æ—¢èƒ½ç”¨æ¥å­˜å‚¨ç‚¹ï¼Œåˆèƒ½ç”¨æ¥å­˜å‚¨å‘é‡ã€‚</p>
<p>è®¾æœ‰å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A=(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> å’Œ å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B=(u,v,w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>ï¼š</p>
<ul>
<li>
<p>å‘é‡çš„åŠ æ³•ï¼šå¯¹åº”ä½ç½®ç›¸åŠ </p>
</li>
<li>
<p>å‘é‡å½’ä¸€åŒ–ï¼šå°†é•¿åº¦å˜ä¸º1ã€‚GLM åº“æä¾›äº†å‡½æ•° <code>glm::normalize(vec3)</code></p>
</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>^</mo></mover><mo>=</mo><mfrac><mi>A</mi><mrow><mi mathvariant="normal">âˆ£</mi><mi>A</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac><mo>=</mo><mfrac><mi>A</mi><msqrt><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\hat{A}=\frac A{\vert A\vert}=\frac A{\sqrt{x^2+y^2+z^2}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9467699999999999em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.11110999999999999em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathdefault">A</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">A</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.49033em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.1521660000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9578340000000001em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.917834em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2821659999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">A</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>
<p>å‘é‡ç‚¹ç§¯ï¼š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>â‹…</mo><mi>B</mi><mo>=</mo><mi>x</mi><mi>u</mi><mo>+</mo><mi>y</mi><mi>v</mi><mo>+</mo><mi>z</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">A\cdot B = xu+yv+zw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>ã€‚GLM åº“æä¾›äº†å‡½æ•° <code>glm::dot(vec3,vec3)</code></p>
</li>
<li>
<p>å‘é‡å‰ç§¯ï¼š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>Ã—</mo><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mi>y</mi><mi>w</mi><mo>âˆ’</mo><mi>v</mi><mi>z</mi><mo separator="true">,</mo><mi>u</mi><mi>z</mi><mo>âˆ’</mo><mi>x</mi><mi>w</mi><mo separator="true">,</mo><mi>x</mi><mi>v</mi><mo>âˆ’</mo><mi>u</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A\times B=(yw-vz, uz-xw, xv-uy)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>ã€‚GLM åº“æä¾›äº†å‡½æ•° <code>glm::cross(vec3,vec3)</code></p>
</li>
</ul>
<h4 id="3-3-1-ç‚¹ç§¯çš„åº”ç”¨">3.3.1 ç‚¹ç§¯çš„åº”ç”¨</h4>
<ol>
<li>ç‚¹ç§¯çš„åŸºæœ¬åº”ç”¨æ˜¯æ±‚ä¸¤å‘é‡å¤¹è§’ã€‚</li>
</ol>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi><mo>=</mo><mfrac><mrow><mi>V</mi><mo>â‹…</mo><mi>W</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>V</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>W</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\cos\theta=\frac{V\cdot W}{\vert V\vert\vert W\vert}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ol start="2">
<li>
<p>æ±‚å‘é‡çš„å¤§å°ï¼š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mi>V</mi><mo>â‹…</mo><mi>V</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{V\cdot V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.11333499999999996em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9266650000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span><span style="top:-2.886665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.11333499999999996em;"><span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>åˆ¤æ–­å‘é‡æ˜¯å¦æ­£äº¤ï¼Œè‹¥æ­£äº¤ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>â‹…</mo><mi>W</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">V\cdot W=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p>
</li>
<li>
<p>åˆ¤æ–­å‘é‡æ˜¯å¦å¹³è¡Œï¼Œè‹¥å¹³è¡Œï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>â‹…</mo><mi>W</mi><mo>=</mo><mi mathvariant="normal">âˆ£</mi><mi>V</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>W</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">V\cdot W=\vert V\vert\vert W\vert</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">âˆ£</span></span></span></span></p>
</li>
</ol>
<h4 id="3-3-2-å‰ç§¯çš„åº”ç”¨">3.3.2 å‰ç§¯çš„åº”ç”¨</h4>
<ul>
<li>
<p>ä¸¤å‘é‡å‰ç§¯çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å‘é‡ï¼ˆæ³•å‘é‡ï¼‰ï¼Œæ–°çš„å‘é‡æ­£äº¤ï¼ˆå‚ç›´ï¼‰äºä¹‹å‰ä¸¤ä¸ªå‘é‡æ‰€å®šä¹‰çš„å¹³é¢ã€‚æ‰€å¾—æ³•å‘é‡çš„æ–¹å‘éµå¾ªå³æ‰‹å®šåˆ™ï¼Œå³å°†å³æ‰‹æ‰‹æŒ‡ä» V å‘ W å·æ›²ä¼šä½¿å¾—å¤§æ‹‡æŒ‡æŒ‡å‘æ³•å‘é‡ R çš„æ–¹å‘ã€‚</p>
</li>
<li>
<p>å‰ç§¯çš„è®¡ç®—ä¸å‘é‡é¡ºåºæœ‰å…³ã€‚</p>
</li>
</ul>
<h3 id="3-4-çŸ©é˜µ">3.4 çŸ©é˜µ</h3>
<p>çŸ©é˜µå¼çŸ©å½¢çš„å€¼çš„é˜µåˆ—ï¼Œè·Ÿå¾ˆå¤šé¢†åŸŸä¸Šçš„çŸ©é˜µæ¦‚å¿µç›¸ä¼¼ã€‚</p>
<p>GLSLä¸­çš„ <code>mat4</code> æ•°æ®ç±»å‹ä¾¿æ˜¯ç”¨æ¥å­˜å‚¨ 4 x 4 çŸ©é˜µã€‚åŒæ · GLM ä¸­çš„ <code>mat4</code> ç±»ä¹Ÿæ˜¯ç”¨æ¥å®ä¾‹åŒ–å¹¶è¡¨ç¤º 4 x 4 çŸ©é˜µã€‚</p>
<p>æ¯”å¦‚å•ä½çŸ©é˜µæ˜¯å¯¹è§’çº¿å€¼å…¨ä¸º1ï¼Œå…¶ä½™å€¼éƒ½ä¸º0çš„çŸ©é˜µã€‚åœ¨ GLM ä¸­ï¼Œè°ƒç”¨æ„é€ å‡½æ•° <code>glm::mat4 m(1.0f)</code> å¯ä»¥åœ¨å˜é‡ m ä¸­ç”Ÿæˆå•ä½çŸ©é˜µã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(å•ä½çŸ©é˜µ)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\tag{å•ä½çŸ©é˜µ}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">å•</span><span class="mord cjk_fallback">ä½</span><span class="mord cjk_fallback">çŸ©</span><span class="mord cjk_fallback">é˜µ</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>çŸ©é˜µè½¬ç½®ï¼šçŸ©é˜µçš„åˆ—ä¸è¡Œäº¤æ¢ã€‚GLM åº“å’Œ GLSL åº“éƒ½æœ‰è½¬ç½®å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ <code>glm::transpose(mat4)</code> å’Œ <code>transpose(mat4)</code>ã€‚</p>
<p>çŸ©é˜µåŠ æ³•ï¼šä¸¤ä¸ªçŸ©é˜µå¯¹åº”å€¼ç›¸åŠ ã€‚åœ¨GLSLä¸­ï¼Œ<code>+</code> ä½œäº†é‡è½½ï¼Œæ”¯æŒçŸ©é˜µåŠ æ³•ã€‚</p>
<p>çŸ©é˜µä¹˜æ³•ï¼šä¸çº¿æ€§ä»£æ•°ä¸­çš„çŸ©é˜µä¹˜æ³•ä¸€è‡´ã€‚</p>
<ul>
<li>åœ¨ 3D å›¾å½¢å­¦ä¸­ï¼Œç‚¹ä¸çŸ©é˜µç›¸ä¹˜é€šå¸¸å°†ç‚¹è§†ä½œåˆ—å‘é‡ï¼Œå¹¶ä»å³å‘å·¦è®¡ç®—ï¼Œå¾—åˆ°ç‚¹ã€‚</li>
<li>çŸ©é˜µç›¸ä¹˜ä¹Ÿå«ä½œåˆå¹¶ã€‚
<ul>
<li>çŸ©é˜µä¹˜æ³•ç»“åˆå¾‹</li>
</ul>
</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>e</mi><mi>w</mi><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mo>=</mo><msub><mi>M</mi><mn>1</mn></msub><mo>Ã—</mo><mo stretchy="false">[</mo><msub><mi>M</mi><mn>2</mn></msub><mo>Ã—</mo><mo stretchy="false">(</mo><msub><mi>M</mi><mn>3</mn></msub><mo>Ã—</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>M</mi><mn>1</mn></msub><mo>Ã—</mo><msub><mi>M</mi><mn>2</mn></msub><mo>Ã—</mo><msub><mi>M</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>Ã—</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">NewPoint = M_1\times[M_2\times(M_3\times Point)]=(M_1\times M_2\times M_3)\times Point
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span></span></span></span></span></p>
<ul>
<li>GLSL å’Œ GLM éƒ½æ”¯æŒ vec4 ä¸çŸ©é˜µç›¸ä¹˜ï¼Œå¹¶ä½¿ç”¨ <code>*</code> æ“ä½œç¬¦è¡¨ç¤ºã€‚</li>
</ul>
<p>é€†çŸ©é˜µï¼š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><msup><mi>M</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi>M</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mi>M</mi><mo>=</mo><mtext>å•ä½çŸ©é˜µ</mtext></mrow><annotation encoding="application/x-tex">MM^{-1}=M^{-1}M=å•ä½çŸ©é˜µ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">å•</span><span class="mord cjk_fallback">ä½</span><span class="mord cjk_fallback">çŸ©</span><span class="mord cjk_fallback">é˜µ</span></span></span></span>ï¼ŒGLSL å’Œ GLM éƒ½æä¾›äº† <code>mat4.inverse()</code> å‡½æ•°ã€‚</p>
<h3 id="3-5-å˜æ¢çŸ©é˜µ">3.5 å˜æ¢çŸ©é˜µ</h3>
<p>å˜æ¢çŸ©é˜µåŸºäº 4x4 çŸ©é˜µï¼Œä½¿ç”¨é½æ¬¡åæ ‡ç³»ï¼ŒåŒ…æ‹¬å¹³ç§»çŸ©é˜µã€ç¼©æ”¾çŸ©é˜µã€æ—‹è½¬çŸ©é˜µã€æŠ•å½±çŸ©é˜µå’Œ LookAt çŸ©é˜µã€‚</p>
<h4 id="3-5-1-å¹³ç§»çŸ©é˜µ">3.5.1 å¹³ç§»çŸ©é˜µ</h4>
<p>å¹³ç§»çŸ©é˜µ A ç”¨äºå°†ç‰©ä½“ä»ä¸€ä¸ªä½ç½®ç§»è‡³å¦ä¸€ä½ç½®ã€‚</p>
<p>åœ¨å•ä½çŸ©é˜µçš„åŸºç¡€ä¸Šï¼Œå°† xã€yã€z çš„ç§»åŠ¨é‡è®°å½•åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>03</mn></msub></mrow><annotation encoding="application/x-tex">A_{03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>13</mn></msub></mrow><annotation encoding="application/x-tex">A_{13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>23</mn></msub></mrow><annotation encoding="application/x-tex">A_{23}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä½ç½®ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>+</mo><msub><mi>T</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mo>+</mo><msub><mi>T</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>z</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(
\begin{matrix}
X+T_x\\
Y+T_y\\
Z+T_z\\
1
\end{matrix}
\right)
=
\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; T_x\\
0 &amp; 1 &amp; 0 &amp; T_y\\
0 &amp; 0 &amp; 1 &amp; T_z\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\left(
\begin{matrix}
X\\
Y\\
Z\\
1
\end{matrix}
\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>ç»“æœå°±æ˜¯ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><mo separator="true">,</mo><mi>Z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X,Y,Z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span></span></span></span> å¹³ç§»åˆ°ä½ç½® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>+</mo><msub><mi>T</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>Y</mi><mo>+</mo><msub><mi>T</mi><mi>y</mi></msub><mo separator="true">,</mo><mi>Z</mi><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X+T_x,Y+T_y,Z+T_z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>å¹³ç§»çŸ©é˜µçš„æ„å»ºå¯ä»¥ä½¿ç”¨ GLM ä¸­ <code>glm::translate(x,y,z)</code> å‡½æ•°ã€‚æ¥ç€çŸ©é˜µä¸ç‚¹ç›¸ä¹˜ã€‚</p>
<h4 id="3-5-2-ç¼©æ”¾çŸ©é˜µ">3.5.2 ç¼©æ”¾çŸ©é˜µ</h4>
<p>ç¼©æ”¾çŸ©é˜µç”¨äºæ”¹å˜ç‰©ä½“çš„å¤§å°æˆ–è€…å°†ç‚¹æ²¿æœå‘æˆ–è¿œç¦»åŸç‚¹çš„æ–¹å‘ç§»åŠ¨ã€‚</p>
<p>ç¼©æ”¾çŸ©é˜µ A åœ¨å•ä½çŸ©é˜µçš„åŸºç¡€ä¸Šï¼Œå°†ä½äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>00</mn></msub></mrow><annotation encoding="application/x-tex">A_{00}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>11</mn></msub></mrow><annotation encoding="application/x-tex">A_{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>22</mn></msub></mrow><annotation encoding="application/x-tex">A_{22}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„å€¼æ›¿æ¢ä¸º xã€yã€z ç¼©æ”¾å› å­ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mtext>Â </mtext><msub><mi>S</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mtext>Â </mtext><msub><mi>S</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mtext>Â </mtext><msub><mi>S</mi><mi>z</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(
\begin{matrix}
X\ S_x\\
Y\ S_y\\
Z\ S_z\\
1
\end{matrix}
\right)
=
\left[
\begin{matrix}
S_x &amp; 0 &amp; 0 &amp; 0\\
0 &amp; S_y &amp; 0 &amp; 0\\
0 &amp; 0 &amp; S_z &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\left(
\begin{matrix}
X\\
Y\\
Z\\
1
\end{matrix}
\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>GLM çš„ <code>glm::scale(x,y,z)</code> å‡½æ•°ç”¨äºæ„å»ºä¾ç…§ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> ç¼©æ”¾çš„çŸ©é˜µï¼Œæ¥ç€çŸ©é˜µä¸ç‚¹ç›¸ä¹˜ã€‚</p>
<p>ç¼©æ”¾è¿˜å¯ä»¥ç”¨æ¥åˆ‡æ¢åæ ‡ç³»ï¼Œæ¯”å¦‚åœ¨å³æ‰‹åæ ‡ç³»ä¸‹ç¡®å®šå·¦æ‰‹åæ ‡ç³»çš„åæ ‡ï¼Œåªéœ€æŠŠ z åæ ‡åè½¬å³å¯ã€‚åˆ‡æ¢åæ ‡ç³»çš„ç¼©æ”¾çŸ©é˜µï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; -1&amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<h4 id="3-5-3-æ—‹è½¬çŸ©é˜µ">3.5.3 æ—‹è½¬çŸ©é˜µ</h4>
<p>3D ç©ºé—´ä¸­æ—‹è½¬ç‰©ä½“éœ€è¦æŒ‡å®šæ—‹è½¬è½´å’Œæ—‹è½¬è§’ï¼ˆä»¥åº¦æˆ–å¼§åº¦ä¸ºå•ä½ï¼‰ã€‚</p>
<p>æ•°å­¦ä¸Šå¯è¯æ˜ï¼šå›´ç»•ä»»ä½•è½´çš„æ—‹è½¬éƒ½å¯ä»¥è¡¨ç¤ºä¸ºç»• x è½´ã€y<br>
è½´ã€z è½´æ—‹è½¬çš„ç»„åˆã€‚å›´ç»•è¿™ 3 ä¸ªè½´çš„æ—‹è½¬è§’åº¦è¢«ç§°ä¸ºæ¬§æ‹‰è§’ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(ç»•xè½´æ—‹è½¬)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X \\ Y&#x27;\\ Z&#x27;\\ 1\end{matrix}\right)=\left[\begin{matrix}1 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \cos\theta &amp; -\sin\theta &amp; 0\\ 0 &amp; \sin\theta &amp; \cos\theta &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{ç»•xè½´æ—‹è½¬}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">ç»•</span><span class="mord">x</span><span class="mord cjk_fallback">è½´</span><span class="mord cjk_fallback">æ—‹</span><span class="mord cjk_fallback">è½¬</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(ç»•yè½´æ—‹è½¬)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X&#x27; \\ Y\\ Z&#x27;\\ 1\end{matrix}\right)=\left[\begin{matrix}\cos\theta &amp; 0 &amp; \sin\theta &amp; 0\\ 0 &amp; 1 &amp; 0 &amp; 0\\ -\sin\theta &amp; 0 &amp; \cos\theta &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{ç»•yè½´æ—‹è½¬}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">ç»•</span><span class="mord">y</span><span class="mord cjk_fallback">è½´</span><span class="mord cjk_fallback">æ—‹</span><span class="mord cjk_fallback">è½¬</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mi>Î¸</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(ç»•zè½´æ—‹è½¬)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X&#x27; \\ Y&#x27;\\ Z\\ 1\end{matrix}\right)=\left[\begin{matrix}\cos\theta &amp; -\sin\theta &amp; 0 &amp; 0\\ \sin\theta &amp; \cos\theta &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 1 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{ç»•zè½´æ—‹è½¬}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">ç»•</span><span class="mord">z</span><span class="mord cjk_fallback">è½´</span><span class="mord cjk_fallback">æ—‹</span><span class="mord cjk_fallback">è½¬</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>æ—‹è½¬å˜æ¢æœ‰ 3 ç§ï¼Œåˆ†åˆ«æ˜¯ç»• x è½´ã€y è½´ã€z è½´æ—‹è½¬ã€‚GLM æä¾›äº†å‡½æ•° <code>glm::rotate(mat4,Î¸,x,y,z)</code> æ„å»ºç»• <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> æ—‹è½¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span></span> åº¦çš„çŸ©é˜µï¼Œæ¥ç€çŸ©é˜µä¸ç‚¹ç›¸ä¹˜ã€‚</p>
<p>é€šè¿‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>âˆ’</mtext><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mi>cos</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos(âˆ’Î¸) = \cos(Î¸)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>âˆ’</mtext><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>âˆ’</mtext><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sin(âˆ’Î¸) = âˆ’\sin(Î¸)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span> å³å¯éªŒè¯åå‘æ—‹è½¬çš„çŸ©é˜µæ°ç­‰äºå…¶è½¬ç½®çŸ©é˜µã€‚</p>
<p>å½“åœ¨ 3D ç©ºé—´ä¸­æ—‹è½¬è½´ä¸ç©¿è¿‡åŸç‚¹æ—¶ï¼Œç‰©ä½“ä½¿ç”¨æ¬§æ‹‰è§’è¿›è¡Œæ—‹è½¬éœ€è¦å‡ ä¸ªé¢å¤–çš„æ­¥éª¤ã€‚ä¸€èˆ¬æœ‰ï¼š</p>
<ol>
<li>å¹³ç§»æ—‹è½¬è½´ä»¥ä½¿å®ƒç»è¿‡åŸç‚¹ï¼›</li>
<li>ç»• x è½´ã€y è½´ã€z è½´æ—‹è½¬é€‚å½“çš„æ¬§æ‹‰è§’ï¼›</li>
<li>å¤åŸæ­¥éª¤ 1 ä¸­çš„å¹³ç§»ã€‚</li>
</ol>
<h3 id="3-6-è§†è§‰ç©ºé—´å’Œåˆæˆç›¸æœº">3.6 è§†è§‰ç©ºé—´å’Œåˆæˆç›¸æœº</h3>
<p>3D ç©ºé—´ä¸­ï¼Œéœ€è¦æ‰¾åˆ°ä¸€ç‚¹å¹¶ç¡®ç«‹è§‚å¯Ÿæ–¹å‘ï¼Œè¿™ä¸ªç‚¹å«ä½œè§†å›¾æˆ–è§†è§‰ç©ºé—´æˆ–åˆæˆç›¸æœºã€‚</p>
<p>è§‚å¯Ÿ 3D ä¸–ç•Œéœ€è¦ä»¥ä¸‹æ­¥éª¤</p>
<ol>
<li>ç¡®å®šç›¸æœºçš„ä½ç½®ï¼›</li>
<li>è°ƒæ•´ç›¸æœºçš„è§’åº¦ï¼Œé€šå¸¸éœ€è¦ä¸€å¥—å®ƒè‡ªå·±çš„ç›´è§’åæ ‡è½´uã€vã€nï¼›</li>
<li>å®šä¹‰ä¸€ä¸ªè§†ä½“ã€‚è§†ä½“æ˜¯ä»ç›¸æœºçš„ä½ç½®å‡ºå‘ï¼Œæ²¿ç€ç›¸æœºçš„è§†çº¿æœå‘çš„å¯è§†èŒƒå›´ã€‚</li>
<li>å°†è§†ä½“å†…çš„å¯¹è±¡æŠ•å½±åˆ°æŠ•å½±å¹³é¢ä¸Šã€‚</li>
</ol>
<p>OpenGL å…·æœ‰ä¸€ä¸ªå›ºå®šåœ¨åŸç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0,0,0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> ä¸”æœå‘ z è½´è´Ÿæ–¹å‘çš„ç›¸æœºã€‚æ‰€ä»¥å½“ä½¿ç”¨è¿™ä¸ªç›¸æœºæ—¶ï¼Œç”±äºç›¸æœºè‡ªèº«ä¸èƒ½ç§»åŠ¨ï¼Œæ‰€ä»¥éœ€è¦å°†å¯¹è±¡ç§»åŠ¨åˆ°é€‚åˆçš„ä½ç½®å¹¶è°ƒæ•´åˆé€‚çš„æ–¹å‘ã€‚</p>
<p>å‡è®¾æœ‰ä¸–ç•Œç©ºé—´ï¼ˆç±»ä¼¼äºå…¨å±€çš„ç©ºé—´ï¼‰ä¸­æŸç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>W</mi></msub></mrow><annotation encoding="application/x-tex">P_W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œéœ€è¦å¯¹è¯¥ç‚¹è¿›è¡Œå˜æ¢è½¬æ¢æˆç›¸æœºç©ºé—´ä¸­é€‚åˆçš„ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">P_C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚æ„å»ºä¸€ä¸ªå•ä¸€å˜æ¢çŸ©é˜µä»¥å®Œæˆæ—‹è½¬å’Œå¹³ç§»ï¼Œè¿™ä¸ªçŸ©é˜µå«ä½œè§†å›¾å˜æ¢çŸ©é˜µï¼Œè®°ä½œ Vï¼ˆVåˆå¹¶äº†å¹³ç§»çŸ©é˜µå’Œæ—‹è½¬çŸ©é˜µï¼‰ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub><mo>=</mo><mi>V</mi><mo>Ã—</mo><msub><mi>P</mi><mi>W</mi></msub></mrow><annotation encoding="application/x-tex">P_C=V\times P_W
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>å°† V çŸ©é˜µä¸æ¨¡å‹çŸ©é˜µ M çš„ç§¯å®šä¹‰ä¸º <strong>æ¨¡å‹-è§†å›¾(Model-View, MV)</strong> çŸ©é˜µï¼Œè®°ä½œMVï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>V</mi><mo>=</mo><mi>V</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">MV=VM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>ã€‚</p>
<ul>
<li><em>æ¨¡å‹çŸ©é˜µ M æ˜¯ä¸–ç•Œç©ºé—´ä¸­å¯¹è±¡å®šä½åŠå®šå‘çš„çŸ©é˜µ</em></li>
</ul>
<p>ä¹‹åï¼Œå¯¹äºæŸç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>M</mi></msub></mrow><annotation encoding="application/x-tex">P_M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å°±å¯ä»¥ä»è‡ªå·±çš„æ¨¡å‹ç©ºé—´ç›´æ¥è½¬æ¢åˆ°ç›¸æœºç©ºé—´ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub><mo>=</mo><mi>M</mi><mi>V</mi><msub><mi>P</mi><mi>M</mi></msub></mrow><annotation encoding="application/x-tex">P_C=MVP_M
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h3 id="3-7-æŠ•å½±çŸ©é˜µ">3.7 æŠ•å½±çŸ©é˜µ</h3>
<p>é€è§†æŠ•å½±çŸ©é˜µå’Œæ­£å°„æŠ•å½±çŸ©é˜µ</p>
<h4 id="3-7-1-é€è§†æŠ•å½±çŸ©é˜µ">3.7.1 é€è§†æŠ•å½±çŸ©é˜µ</h4>
<p>é€è§†æŠ•å½±é€šè¿‡ä½¿ç”¨é€è§†æ¦‚å¿µæ¨¡ä»¿æˆ‘ä»¬çœ‹çœŸå®ä¸–ç•Œçš„æ–¹<br>
å¼ï¼Œå°è¯•è®© 2D å›¾åƒçœ‹èµ·æ¥åƒæ˜¯ 3D çš„ã€‚</p>
<p>ä½¿ç”¨å«ä½œ <strong>é€è§†çŸ©é˜µ</strong> æˆ–è€… <strong>é€è§†å˜æ¢</strong> çš„å˜æ¢çŸ©é˜µå°†å¹³è¡Œçº¿å˜ä¸ºæ°å½“çš„ä¸å¹³è¡Œçº¿æ¥å®ç°è¿™ä¸ªæ•ˆæœã€‚å®šä¹‰ 4 ä¸ªå‚æ•°æ¥æ„å»ºè§†ä½“ï¼š</p>
<ul>
<li>çºµæ¨ªæ¯”ï¼šè¿œè¿‘å‰ªè£å¹³é¢çš„å®½åº¦ä¸é«˜åº¦ä¹‹æ¯”ï¼›</li>
<li>è§†åœºï¼šå¯è§†ç©ºé—´çš„çºµå‘è§’åº¦ï¼›</li>
<li>è¿‘å‰ªè£å¹³é¢ï¼ˆä¹Ÿç§°æŠ•å½±å¹³é¢ï¼‰</li>
<li>è¿œå‰ªè£å¹³é¢ã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_View.jpg" alt="é€è§†è§†ä½“æˆ–è§†é”¥ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬2ç‰ˆï¼‰"></p>
<p>é€è§†çŸ©é˜µï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>A</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>q</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>B</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>C</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(é€è§†çŸ©é˜µ)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
A &amp; 0 &amp; 0 &amp; 0\\
0 &amp; q &amp; 0 &amp; 0\\
0 &amp; 0 &amp; B &amp; C\\
0 &amp; 0 &amp;-1 &amp; 0
\end{matrix}
\right]
\tag{é€è§†çŸ©é˜µ}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">é€</span><span class="mord cjk_fallback">è§†</span><span class="mord cjk_fallback">çŸ©</span><span class="mord cjk_fallback">é˜µ</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å…¶ä¸­ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>tan</mi><mo>â¡</mo><mrow><mo stretchy="false">(</mo><mfrac><mtext>è§†åœº</mtext><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">q = \frac{1}{\tan{(\frac{è§†åœº}{2})}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.428771em;vertical-align:-1.1073309999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2376690000000004em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">tan</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">è§†</span><span class="mord cjk_fallback mtight">åœº</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1073309999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mfrac><mi>q</mi><mtext>çºµæ¨ªæ¯”</mtext></mfrac></mrow><annotation encoding="application/x-tex">A = \frac{q}{çºµæ¨ªæ¯”}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.7935599999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">çºµ</span><span class="mord cjk_fallback">æ¨ª</span><span class="mord cjk_fallback">æ¯”</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mfrac><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub><mo>âˆ’</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">B = \frac{Z_{near}+Z_{far}}{Z_{nead}-Z_{far}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.332438em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mfrac><mrow><mn>2</mn><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>âˆ’</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac><mrow></mrow></mrow><annotation encoding="application/x-tex">C = \frac{2Z_{near}Z_{far}}{Z_{near}-Z_{far}}{}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.332438em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"></span></span></span></span></span></p>
<p>GLM åº“æä¾›äº†æ„å»ºé€è§†çŸ©é˜µå‡½æ•° <code>glm::perspective()</code>ã€‚</p>
<h4 id="3-7-2-æ­£å°„æŠ•å½±çŸ©é˜µ">3.7.2 æ­£å°„æŠ•å½±çŸ©é˜µ</h4>
<p>åœ¨æ­£å°„æŠ•å½±ä¸­ï¼Œå¹³è¡Œçº¿ä»ç„¶æ˜¯å¹³è¡Œçš„ã€‚</p>
<p>æ„å»ºæ­£å°„çŸ©é˜µéœ€è¦ä»¥ä¸‹å‚æ•°ï¼š</p>
<ol>
<li>ä»ç›¸æœºåˆ°æŠ•å½±å¹³é¢çš„è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{near}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>ä»ç›¸æœºåˆ°è¿œå‰ªè£å¹³é¢çš„è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{far}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>æŠ•å½±å¹³é¢å·¦è¾¹ç•Œ x åæ ‡ Lï¼Œ æŠ•å½±å¹³é¢å³è¾¹ç•Œ x åæ ‡ Rï¼ŒæŠ•å½±å¹³é¢ä¸Šè¾¹ç•Œ y åæ ‡ Tï¼Œ æŠ•å½±å¹³é¢ä¸‹è¾¹ç•Œ y åæ ‡ B</li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zhengshe.jpg" alt="æ­£å°„æŠ•å½±ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬2ç‰ˆï¼‰"></p>
<p>æ­£å°„çŸ©é˜µï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>2</mn><mrow><mi>R</mi><mo>âˆ’</mo><mi>L</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mfrac><mrow><mi>R</mi><mo>+</mo><mi>L</mi></mrow><mrow><mi>R</mi><mo>âˆ’</mo><mi>L</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>2</mn><mrow><mi>T</mi><mo>âˆ’</mo><mi>B</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mfrac><mrow><mi>T</mi><mo>+</mo><mi>B</mi></mrow><mrow><mi>T</mi><mo>âˆ’</mo><mi>B</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mo>âˆ’</mo><mn>2</mn></mrow><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>âˆ’</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mfrac><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>âˆ’</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(æ­£å°„çŸ©é˜µ)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
\frac{2}{R-L} &amp; 0 &amp; 0 &amp; -\frac{R+L}{R-L}\\
0 &amp; \frac{2}{T-B} &amp; 0 &amp; -\frac{T+B}{T-B}\\
0 &amp; 0 &amp; \frac{-2}{z_{far}-z_{near}} &amp; -\frac{z_{far}+z_{near}}{z_{far}-z_{near}}\\
0 &amp; 0 &amp;0 &amp; 1
\end{matrix}
\right]
\tag{æ­£å°„çŸ©é˜µ}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.220815em;vertical-align:-2.3604075em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">L</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5480799999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">L</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.921411em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.51308em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5480799999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:5.220815em;vertical-align:-2.3604075em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">æ­£</span><span class="mord cjk_fallback">å°„</span><span class="mord cjk_fallback">çŸ©</span><span class="mord cjk_fallback">é˜µ</span></span><span class="mord">)</span></span></span></span></span></span></p>
<h3 id="3-8-lookatçŸ©é˜µ">3.8 LookAtçŸ©é˜µ</h3>
<p>å½“æŠŠç›¸æœºæ”¾åœ¨æŸå¤„å¹¶çœ‹å‘ä¸€ä¸ªç‰¹å®šçš„ä½ç½®æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ° LookAt çŸ©é˜µã€‚LookAt å˜æ¢ä¾ç„¶ç”±ç›¸æœºæ—‹è½¬å†³å®šã€‚</p>
<p>é€šè¿‡æŒ‡å®šå¤§è‡´æ—‹è½¬æœå‘çš„å‘é‡ï¼ˆå¦‚ä¸–ç•Œç©ºé—´ y è½´ï¼‰ã€‚å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—å‰ç§¯è·å¾—ä¸€ç»„å‘é‡ï¼Œä»£è¡¨ç›¸æœºçš„æ­£é¢ï¼ˆå‘é‡ fwdï¼‰ã€ä¾§é¢ï¼ˆå‘é‡ sideï¼‰ï¼Œä»¥åŠä¸Šé¢ï¼ˆå‘é‡ upï¼‰ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_lookat.jpg" alt="LookAtå…ƒç´ ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬2ç‰ˆï¼‰"></p>
<p>ç”±ç›¸æœºä½ç½®ï¼ˆç‚¹eyeï¼‰ã€ç›®æ ‡ä½ç½®ï¼ˆç‚¹targetï¼‰ã€åˆå§‹å‘ä¸Šå‘é‡ Y æ„å»º LookAt çŸ©é˜µï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>d</mi><msub><mi>e</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>d</mi><msub><mi>e</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>â‹…</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>u</mi><mi>p</mi><mo>â‹…</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo>â‹…</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(LookAtçŸ©é˜µ)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
side_x &amp; side_y &amp; size_z &amp; -(side\cdot eye)\\
up_x &amp; up_y &amp; up_z &amp; -(up\cdot eye)\\
-fwd_x &amp; -fwd_y &amp; -fwd_z &amp; -(-fwd\cdot eye)\\
0 &amp; 0 &amp;0 &amp; 1
\end{matrix}
\right]
\tag{LookAtçŸ©é˜µ}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">L</span><span class="mord">o</span><span class="mord">o</span><span class="mord">k</span><span class="mord">A</span><span class="mord">t</span><span class="mord cjk_fallback">çŸ©</span><span class="mord cjk_fallback">é˜µ</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å…¶ä¸­ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>w</mi><mi>d</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo>âˆ’</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fwd = normalize(eye-target)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo>Ã—</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">side = normalize(-fwd \times Y)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>Ã—</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">up = normalize(side \times (-fwd))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<h2 id="å››-openglç®¡ç†3då›¾å½¢æ•°æ®">å››ã€OpenGLç®¡ç†3Då›¾å½¢æ•°æ®</h2>
<p>ä½¿ç”¨ OpenGL æ¸²æŸ“ä¸€ä¸ª 3D å›¾å½¢ éœ€è¦å°†è‹¥å¹²æ•°æ®å‘é€ç»™ OpenGL ç€è‰²å™¨ç®¡çº¿ã€‚</p>
<p>æ¯”å¦‚ä¸€ä¸ªç«‹æ–¹ä½“ï¼Œéœ€è¦å‘é€ï¼š</p>
<ul>
<li>ç«‹æ–¹ä½“æ¨¡å‹çš„é¡¶ç‚¹ï¼›</li>
<li>æ§åˆ¶ç«‹æ–¹ä½“åœ¨3Dç©ºé—´ä¸­æœå‘çš„å˜æ¢çŸ©é˜µã€‚</li>
</ul>
<p>ç„¶è€Œï¼Œå‘é€æ•°æ®åˆ° OpenGL ç®¡çº¿çš„æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>é€šè¿‡é¡¶ç‚¹å±æ€§çš„ <strong>ç¼“å†²åŒº</strong>ï¼›</li>
<li>ç›´æ¥å‘é€ç»™ <strong>ç»Ÿä¸€å˜é‡</strong>ã€‚</li>
</ul>
<h3 id="4-1-ç¼“å†²åŒºå’Œé¡¶ç‚¹å±æ€§">4.1 ç¼“å†²åŒºå’Œé¡¶ç‚¹å±æ€§</h3>
<p>ç»˜åˆ¶å¯¹è±¡æ—¶ï¼Œå®ƒçš„é¡¶ç‚¹æ•°æ®éœ€è¦å‘é€ç»™é¡¶ç‚¹ç€è‰²å™¨ã€‚é€šå¸¸ï¼š</p>
<ol>
<li>é¡¶ç‚¹æ•°æ®è¢«å‘é€åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼›</li>
<li>æŠŠç¼“å†²åŒºå’Œç€è‰²å™¨ä¸­å£°æ˜çš„é¡¶ç‚¹å±æ€§ç›¸å…³è”ã€‚</li>
</ol>
<p>å®Œæˆè¿™ä»¶äº‹ï¼Œæœ‰ä¸€ç³»åˆ—çš„æ­¥éª¤ï¼Œæœ‰çš„æ­¥éª¤åªéœ€è¦åšä¸€æ¬¡ï¼Œæœ‰çš„æ­¥éª¤æ¯å¸§éƒ½éœ€åšä¸€æ¬¡ï¼š</p>
<ul>
<li>åªåšä¸€æ¬¡çš„æ­¥éª¤ï¼š
<ol>
<li>åˆ›å»ºç¼“å†²åŒº</li>
<li>å°†é¡¶ç‚¹æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒº</li>
</ol>
</li>
<li>æ¯å¸§åˆ·æ–°éœ€è¦çš„æ­¥éª¤ï¼š
<ol>
<li>å¯ç”¨åŒ…å«é¡¶ç‚¹æ•°æ®çš„ç¼“å†²åŒº</li>
<li>å°†ç¼“å†²åŒºå’Œä¸€ä¸ªé¡¶ç‚¹å±æ€§ç›¸å…³è”</li>
<li>å¯ç”¨è¿™ä¸ªé¡¶ç‚¹å±æ€§</li>
<li>ä½¿ç”¨ <code>glDrawArrays()</code> ç»˜åˆ¶å¯¹è±¡</li>
</ol>
</li>
</ul>
<p>åœ¨ OpenGL ä¸­ï¼Œç¼“å†²åŒºè¢«åŒ…å«åœ¨é¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼ˆVertex Buffer Objectï¼ŒVBOï¼‰ä¸­ï¼ŒVBO åœ¨ C++/OpenGL åº”ç”¨ç¨‹åºä¸­è¢«å£°æ˜å’Œå®ä¾‹åŒ–ã€‚ä¸€ä¸ªåœºæ™¯å¯èƒ½éœ€è¦å¾ˆå¤š VBOï¼Œæ‰€ä»¥å¸¸å¸¸ä¼šåœ¨ä¸€ä¸ªåœ°æ–¹ä¸­ç”Ÿæˆå¹¶å¡«å……è‹¥å¹²ä¸ª VBOï¼Œä»¥å¤‡ç¨‹åºéœ€è¦æ—¶ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>ç¼“å†²åŒºä½¿ç”¨ç‰¹å®šçš„æ–¹å¼å’Œé¡¶ç‚¹å±æ€§äº¤äº’ã€‚å½“ <code>glDrawArrays()</code> æ‰§è¡Œæ—¶ï¼Œç¼“å†²åŒºä¸­çš„æ•°æ®å¼€å§‹æµåŠ¨ï¼Œä»ç¼“å†²åŒºçš„å¼€å¤´å¼€å§‹ï¼ŒæŒ‰é¡ºåºæµè¿‡é¡¶ç‚¹ç€è‰²å™¨ï¼Œé¡¶ç‚¹ç€è‰²å™¨å¯¹æ¯ä¸ªé¡¶ç‚¹æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>OpenGL ä¸­è¿˜æœ‰ä¸€ç§ç›¸å…³çš„ç»“æ„ï¼Œå«ä½œé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼ˆVertex Array Objectï¼ŒVAOï¼‰ã€‚OpenGLçš„ 3.0 ç‰ˆæœ¬å¼•å…¥äº† VAOï¼Œä½œä¸ºä¸€ç§ç»„ç»‡ç¼“å†²åŒºçš„æ–¹æ³•ï¼Œè®©ç¼“å†²åŒºåœ¨å¤æ‚åœºæ™¯ä¸­æ›´å®¹æ˜“æ“æ§ã€‚OpenGL è¦æ±‚è‡³å°‘åˆ›å»ºä¸€ä¸ª VAOã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æƒ³æ˜¾ç¤ºä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå£°æ˜ä¸€ä¸ª VAO å’Œä¸¤ä¸ªç›¸å…³çš„ VBOï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GLuint vao[<span class="number">1</span>];</span><br><span class="line">GLuint vbo[<span class="number">2</span>];</span><br><span class="line"><span class="comment">// â€¦â€¦</span></span><br><span class="line"><span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, vao);</span><br><span class="line"><span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">2</span>, vbo);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>glGenVertexArrays()</code>ï¼šç”Ÿæˆä¸€ä¸ª VAOï¼Œè¿”å› VAO çš„æ•´å‹ ID å¹¶å°†å­˜åˆ°vao
<ul>
<li>ç¬¬ä¸€å‚æ•°è¡¨ç¤ºåˆ›å»º ID ä¸ªæ•°</li>
<li>ç¬¬äºŒå‚æ•°è¡¨ç¤ºä¿å­˜è¿”å› ID çš„æ•°ç»„</li>
</ul>
</li>
<li><code>glBindVertexArray()</code>ï¼šå°† vao[0] è®¾ä¸ºå½“å‰å¯¹è±¡ï¼Œè¿™æ ·ç”Ÿæˆçš„ç¼“å†²åŒºå°±ä¼šå’Œè¿™ä¸ª VAO ç›¸å…³è”</li>
<li><code>glGenBuffers()</code>ï¼šç”Ÿæˆä¸¤ä¸ª VBOï¼Œè¿”å› VBO çš„æ•´å‹ ID å¹¶å°†å®ƒä»¬å­˜åˆ°vbo
<ul>
<li>ç¬¬ä¸€å‚æ•°è¡¨ç¤ºåˆ›å»º ID ä¸ªæ•°</li>
<li>ç¬¬äºŒå‚æ•°è¡¨ç¤ºä¿å­˜è¿”å› ID çš„æ•°ç»„</li>
</ul>
</li>
</ul>
<p>ç¼“å†²åŒºå¤§æ¦‚å®Œæˆä¹‹åï¼Œé¡¶ç‚¹ç€è‰²å™¨éœ€è¦æœ‰ç›¸åº”åœ°é¡¶ç‚¹å±æ€§å˜é‡ã€‚å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">layout</span> (location = <span class="number">0</span>) in vec3 position;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>layout (location = 0)</code>ï¼šlayoutä¿®é¥°ç¬¦ï¼Œé¡¶ç‚¹å±æ€§å’Œç‰¹å®šç¼“å†²åŒºå…³è”çš„æ–¹æ³•ï¼Œè¿™é‡Œè¡¨ç¤ºé¡¶ç‚¹å±æ€§çš„è¯†åˆ«å·æ˜¯0</li>
<li><code>in</code>ï¼šè¡¨ç¤ºé¡¶ç‚¹å±æ€§å°†ä¼šä»ç¼“å†²åŒºä¸­æ¥æ”¶æ•°å€¼</li>
<li><code>vec3</code>ï¼šè¡¨ç¤ºé¡¶ç‚¹å±æ€§çš„ç±»å‹æ˜¯ä¸‰ç»´å‘é‡</li>
<li><code>position</code>ï¼šé¡¶ç‚¹å±æ€§çš„åå­—</li>
</ul>
<p>ç»§ç»­å‡è®¾ç»˜åˆ¶ä¸€ä¸ªç«‹æ–¹ä½“ï¼Œå‡å®šç«‹æ–¹ä½“çš„é¡¶ç‚¹æ•°æ®åœ¨ä»£ç ä¸­ç”¨æ•°ç»„ç›´æ¥æŒ‡å®šï¼Œè¿˜éœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>å°†é¡¶ç‚¹æ•°æ®å€¼å¤åˆ¶åˆ°ä¹‹å‰ç”Ÿæˆçš„ä¸¤ä¸ªç¼“å†²åŒºä¹‹ä¸€ã€‚ä½¿ç”¨ OpenGL çš„å‡½æ•° <code>glBindBuffer()</code> å°†ç¼“å†²åŒºæ ‡ä¸ºæ´»è·ƒï¼ˆä½¿ç”¨ï¼‰</li>
<li>ä½¿ç”¨ <code>glBufferData()</code> å‡½æ•°å°†åŒ…å«é¡¶ç‚¹æ•°æ®çš„æ•°ç»„å¤åˆ¶è¿›æ´»è·ƒç¼“å†²åŒº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ˜¯åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡çš„æ­¥éª¤ï¼Œæ¥ä¸‹æ¥å¯¹äºæ¯ä¸€å¸§åˆ·æ–°ï¼Œéœ€è¦è¿›è¡Œï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>glBindBuffer()</code> å‡½æ•°æ ‡è®°ç¼“å†²åŒºä¸ºæ´»è·ƒ</li>
<li>å°†æ´»è·ƒç¼“å†²åŒºä¸ç€è‰²å™¨ä¸­çš„é¡¶ç‚¹å±æ€§ç›¸å…³è”</li>
<li>å¯ç”¨é¡¶ç‚¹å±æ€§</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ‡è®°ç¬¬0ä¸ªç¼“å†²åŒºä¸ºæ´»è·ƒ</span></span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// å°†ç¬¬0ä¸ªå±æ€§å…³è”åˆ°ç¼“å†²åŒº</span></span><br><span class="line"><span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"><span class="comment">// å¯ç”¨ç¬¬0ä¸ªé¡¶ç‚¹å±æ€§</span></span><br><span class="line"><span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="4-2-ç»Ÿä¸€å˜é‡">4.2 ç»Ÿä¸€å˜é‡</h3>
<p>ä½¿ç”¨å…³é”®å­— <code>uniform</code> åœ¨ç€è‰²å™¨ä¸­å£°æ˜ç»Ÿä¸€å˜é‡ã€‚</p>
<p>å°†æ•°æ®ä» C++/OpenGL åº”ç”¨ç¨‹åºå‘é€åˆ°ç»Ÿä¸€å˜é‡éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>è·å–ç»Ÿä¸€å˜é‡çš„å¼•ç”¨</li>
<li>å°†æŒ‡å‘æ‰€éœ€æ•°å€¼çš„æŒ‡é’ˆä¸è·å–çš„ç»Ÿä¸€å˜é‡å¼•ç”¨ç›¸å…³è”</li>
</ol>
<p>æ¯”å¦‚åœ¨ä¸Šé¢ç»˜åˆ¶ç«‹æ–¹ä½“çš„ä¾‹å­ï¼Œå‡è®¾é“¾æ¥çš„æ¸²æŸ“ç¨‹åºä¿å­˜åœ¨åä¸º <code>rendering</code> çš„å˜é‡ä¸­ï¼Œåˆ™ä»¥ä¸‹ä»£ç ä¼šæŠŠ MV å’ŒæŠ•å½±çŸ©é˜µå‘é€åˆ°ä¸¤ä¸ªç»Ÿä¸€å˜é‡ä¸­ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ç€è‰²å™¨ç¨‹åºä¸­çš„ç»Ÿä¸€å˜é‡ä½ç½®</span></span><br><span class="line">mvLoc = <span class="built_in">glGetUniformLocation</span>(rendering, <span class="string">&quot;mv_m&quot;</span>);</span><br><span class="line">projLoc = <span class="built_in">glGetUniformLocation</span>(rendering, <span class="string">&quot;proj_m&quot;</span>);</span><br><span class="line"><span class="comment">// å°†çŸ©é˜µæ•°æ®å‘é€åˆ°ç»Ÿä¸€å˜é‡ä¸­</span></span><br><span class="line"><span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mv));</span><br><span class="line"><span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(proj));</span><br><span class="line"><span class="comment">// mv æ˜¯æ¨¡å‹è§†å›¾çŸ©é˜µï¼Œproj æ˜¯æŠ•å½±çŸ©é˜µ</span></span><br></pre></td></tr></table></figure>
<p><em><code>value_ptr()</code> è¿”å›å¯¹çŸ©é˜µæ•°æ®çš„å¼•ç”¨ï¼Œ <code>glUniformMatrix4fv()</code> å°†çŸ©é˜µæ•°æ®ä¼ é€’ç»™ç»Ÿä¸€å˜é‡</em></p>
<h3 id="4-3-é¡¶ç‚¹å±æ€§æ’å€¼">4.3 é¡¶ç‚¹å±æ€§æ’å€¼</h3>
<p>åœ¨ç‰‡æ®µç€è‰²å™¨æ …æ ¼åŒ–ä¹‹å‰ï¼Œç”±é¡¶ç‚¹å®šä¹‰çš„å›¾å…ƒè¢«è½¬æ¢ä¸ºç‰‡æ®µã€‚</p>
<ul>
<li>æ …æ ¼åŒ–ï¼šå°† 3D ç©ºé—´ä¿¡æ¯è¡¨è¾¾åœ¨ 2D å±å¹•çš„æ …æ ¼ï¼ˆåƒç´ é˜µåˆ—ï¼‰ä¸­ã€‚</li>
<li>æ …æ ¼åŒ–è¿‡ç¨‹ä¼šçº¿æ€§æ’å€¼é¡¶ç‚¹å±æ€§å€¼ï¼Œä»¥ä¾¿æ˜¾ç¤ºçš„åƒç´ èƒ½æ— ç¼è¿æ¥å»ºæ¨¡åçš„æ›²é¢ã€‚</li>
<li>æ¯”å¦‚æ …æ ¼åŒ–ä¸€ä¸ªä¸‰è§’å½¢æ—¶ï¼Œå°†ä¸‰è§’å½¢é¡¶ç‚¹ä¼ å…¥ï¼Œé¦–å…ˆæ²¿ç€è¿æ¥é¡¶ç‚¹çš„çº¿å¼€å§‹æ’å€¼ï¼Œå…¶ç²¾åº¦çº§åˆ«å’Œåƒç´ æ˜¾ç¤ºå¯†åº¦ç›¸å…³ã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_rasterized.png" alt="ä¸‰è§’å½¢æ …æ ¼åŒ–"></p>
<p>è€Œç»Ÿä¸€å˜é‡åœ¨æ¯æ¬¡é¡¶ç‚¹ç€è‰²å™¨è°ƒç”¨æ—¶ä¿æŒä¸å˜ï¼Œæœ¬èº«ä¸æ˜¯æ’å€¼çš„ï¼Œæ— è®ºé¡¶ç‚¹æ•°é‡æœ‰å¤šå°‘ï¼Œå˜é‡éƒ½åŒ…å«ç›¸åŒçš„å€¼ã€‚</p>
<p>é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œé¡¶ç‚¹å±æ€§è¢«å£°æ˜ä¸º <code>in</code>ï¼Œè¡¨ç¤ºä»ç¼“å†²åŒºæ¥æ”¶ï¼Œä¹Ÿå¯ä»¥è¢«å£°æ˜ä¸º <code>out</code>ï¼Œè¡¨ç¤ºå€¼å‘é€åˆ°ç®¡çº¿çš„ä¸‹ä¸€é˜¶æ®µã€‚</p>
<p>OpenGL å†…ç½®ä¸€ä¸ª <code>vec4</code> å˜é‡ <code>gl_Position</code>ï¼Œåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œå°†çŸ©é˜µå˜æ¢åçš„é¡¶ç‚¹èµ‹å€¼ç»™å®ƒï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gl_Position = proj_matrix * mv_matrix * position;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-mv-çŸ©é˜µå’Œé€è§†çŸ©é˜µ">4.4 MV çŸ©é˜µå’Œé€è§†çŸ©é˜µ</h3>
<p>æ¸²æŸ“ 3D å¯¹è±¡çš„ä¸€ä¸ªåŸºç¡€æ­¥éª¤æ˜¯åˆ›å»ºé€‚å½“çš„å˜æ¢çŸ©é˜µå¹¶å°†å®ƒä»¬å‘é€åˆ°ç»Ÿä¸€å˜é‡ã€‚</p>
<ul>
<li>æ¨¡å‹çŸ©é˜µï¼šåœ¨ä¸–ç•Œç©ºé—´ä¸­è¡¨ç¤ºå¯¹è±¡çš„ä½ç½®å’Œæœå‘ã€‚</li>
<li>è§†å›¾çŸ©é˜µï¼šç§»åŠ¨å¹¶æ—‹è½¬ä¸–ç•Œä¸­çš„æ¨¡å‹ï¼Œä»¥æ¨¡æ‹Ÿç›¸æœºçœ‹åˆ°çš„æ•ˆæœã€‚</li>
<li>é€è§†çŸ©é˜µï¼šæ ¹æ®æ‰€éœ€çš„è§†é”¥æä¾› 3D æ•ˆæœã€‚</li>
</ul>
<p>å‡è®¾æ¨¡å‹æ˜¯å˜åŠ¨çš„ï¼Œç›¸æœºæ˜¯å¯ç§»åŠ¨çš„ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>éœ€è¦æ¯å¸§ä¸ºæ¯ä¸ªæ¨¡å‹åˆ›å»ºæ¨¡å‹çŸ©é˜µï¼›</li>
<li>éœ€è¦æ¯å¸§åˆ›å»ºè§†å›¾çŸ©é˜µï¼Œå¯¹äºè¿™ä¸€å¸§æ‰€æ¸²æŸ“çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ä¸€è‡´çš„ï¼›</li>
<li>éœ€è¦åˆ›å»ºä¸€æ¬¡é€è§†çŸ©é˜µï¼Œç¡®å®šè§†é”¥ã€‚</li>
</ul>
<h3 id="4-5-æ„å»ºä¸€ä¸ª-3d-ç«‹æ–¹ä½“">4.5 æ„å»ºä¸€ä¸ª 3D ç«‹æ–¹ä½“</h3>
<p>ç”±äº OpenGL ä»£ç ç¹å¤šï¼Œéœ€è¦å¤„ç†å¤šæ–‡ä»¶ï¼Œç»™å‡ºæ–‡ä»¶ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OpenGLé¡¹ç›®</span><br><span class="line">â”œâ”€ main.cpp        // ä¸»ç¨‹åº</span><br><span class="line">â”œâ”€ fragment.glsl   // ç‰‡æ®µç€è‰²å™¨</span><br><span class="line">â”œâ”€ vertex.glsl     // é¡¶ç‚¹ç€è‰²å™¨</span><br><span class="line">â”œâ”€ Util.h          // å¸¸ç”¨å‡½æ•°çš„å£°æ˜</span><br><span class="line">â””â”€ Util.cpp        // å¸¸ç”¨å‡½æ•°çš„å®ç°</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_greenCube.jpg" alt="ç»¿è‰²çš„ç«‹æ–¹ä½“"></p>
<details><summary>æºä»£ç main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">1</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">double</span> cubeLocX, cubeLocY, cubeLocZ;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// ç”Ÿæˆçš„ç¼“å†²åŒºå’Œ VAO ç›¸å…³è”</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]); <span class="comment">// å°†ç¼“å†²åŒºæ ‡ä¸ºæ´»è·ƒï¼ˆä½¿ç”¨ï¼‰</span></span><br><span class="line">    <span class="comment">// å°†åŒ…å«é¡¶ç‚¹æ•°æ®çš„æ•°ç»„å¤åˆ¶è¿›æ´»è·ƒç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">8.0f</span>;</span><br><span class="line">    cubeLocX = <span class="number">0.0f</span>, cubeLocY = <span class="number">-2.0f</span>, cubeLocZ = <span class="number">0.0f</span>;    <span class="comment">// æ²¿ y è½´ä¸‹ç§»å±•ç¤ºé€è§†</span></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– MV çŸ©é˜µ å’ŒæŠ•å½±çŸ©é˜µçš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºé€è§†çŸ©é˜µ</span></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    <span class="comment">// å‚æ•°ä¸ºï¼šè§†è§’ï¼Œå®½é«˜æ¯”ï¼Œè¿‘è£å‰ªé¢ï¼Œè¿œè£å‰ªé¢</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºè§†å›¾çŸ©é˜µã€æ¨¡å‹çŸ©é˜µå’Œ MV çŸ©é˜µ</span></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(cubeLocX, cubeLocY, cubeLocZ));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†çŸ©é˜µå¤åˆ¶ç»™ç›¸åº”çš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† VBO å…³è”ç»™é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›¸åº”çš„é¡¶ç‚¹å±æ€§</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒæ•´ OpenGL è®¾ç½®ï¼Œç»˜åˆ¶æ¨¡å‹</span></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Š <code>main.cpp</code>ï¼š</p>
<ul>
<li>å‡½æ•° <code>makeVertexArray()</code>
<ul>
<li>åˆ›å»ºé¡¶ç‚¹æ•°ç»„ï¼Œä½¿ç”¨ä¸‰è§’å½¢ç»˜åˆ¶ç«‹æ–¹ä½“ï¼Œæ¯ä¸ªé¢éœ€è¦ä¸¤ä¸ªä¸‰è§’å½¢ï¼Œå…±éœ€è¦12ä¸ªä¸‰è§’å½¢ï¼Œæœ‰36ä¸ªé¡¶ç‚¹ï¼Œåˆ36Ã—3=108ä¸ªåæ ‡ï¼ˆå€¼ï¼‰ã€‚</li>
<li>ç«‹æ–¹ä½“å®šä¹‰åœ¨è‡ªå·±çš„åæ ‡ç³»ä¸Šï¼Œä¸­å¿ƒä¸º(0,0,0)ã€‚</li>
<li>å»ºç«‹ä¸€ä¸ª VAO å’Œ VBOï¼Œå¹¶æŠŠç«‹æ–¹ä½“é¡¶ç‚¹åŠ è½½åˆ°VBOä¸­ã€‚</li>
</ul>
</li>
<li>å‡½æ•° <code>init()</code>
<ul>
<li>è¯»å–ç€è‰²å™¨ä»£ç å¹¶æ„å»ºæ¸²æŸ“ç¨‹åºã€‚</li>
<li>å°†ç«‹æ–¹ä½“é€šè¿‡å‡½æ•° <code>makeVertexArray()</code> åŠ è½½åˆ° VBO ä¸­ã€‚</li>
<li>å®šä¹‰ç«‹æ–¹ä½“å’Œç›¸æœºåœ¨ä¸–ç•Œä¸­çš„ä½ç½®ï¼š(0,0,8)å’Œ(0,-2,0)ã€‚</li>
</ul>
</li>
<li>å‡½æ•° <code>display()</code>
<ul>
<li>ä¸æ–­é‡ç»˜å¸§ã€‚</li>
<li>è°ƒç”¨ <code>glClear(GL_DEPTH_BUFFER_BIT)</code> æ¸…é™¤æ·±åº¦ç¼“å†²åŒºã€‚</li>
<li>è°ƒç”¨ <code>glUseProgram()</code> å¯ç”¨ç€è‰²å™¨ï¼Œåœ¨ GPU ä¸ŠåŠ è½½ GLSL ä»£ç ï¼Œä½†ä¸ä¼šè¿è¡Œç€è‰²å™¨ç¨‹åºã€‚</li>
<li>è·å–ç»Ÿä¸€å˜é‡ä½ç½®ï¼Œæ„å»ºé€è§†ã€è§†å›¾çŸ©é˜µå’Œæ¨¡å‹çŸ©é˜µï¼Œå¹¶åˆæˆ MV çŸ©é˜µã€‚
<ul>
<li>ä½¿ç”¨ <code>glm::translate(glm::mat4(1.0f), glm::vec3(-cameraX, -cameraY, -cameraZ));</code> æ„å»ºè§†å›¾çŸ©é˜µã€‚ä¸ºäº†æ¨¡æ‹Ÿä»¥æŸç§æ–¹å¼ç§»åŠ¨çš„ç›¸æœºçš„è¡¨ç°ï¼Œéœ€è¦å‘ç›¸åçš„æ–¹å‘ç§»åŠ¨ç‰©ä½“æœ¬èº«ã€‚</li>
<li>ä½¿ç”¨ <code>glm::translate(glm::mat4(1.0f), glm::vec3(cubeLocX, cubeLocY, cubeLocZ));</code> æ„å»ºæ¨¡å‹çŸ©é˜µã€‚</li>
</ul>
</li>
<li>å°†é€è§†çŸ©é˜µå’Œ MV çŸ©é˜µèµ‹ç»™ç›¸åº”çš„ç»Ÿä¸€å˜é‡ã€‚</li>
<li>å¯ç”¨ç«‹æ–¹ä½“é¡¶ç‚¹æ•°æ®çš„ç¼“å†²åŒºï¼Œå¹¶å°†å…¶é™„åŠ åˆ°ç¬¬0ä¸ªé¡¶ç‚¹å±æ€§ã€‚</li>
<li>è°ƒç”¨ <code>glDrawArrays()</code> ç»˜åˆ¶æ¨¡å‹ã€‚</li>
</ul>
</li>
</ul>
</details>
<details><summary>Util.h</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>Util.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä»æ–‡ä»¶ä¸­è¯»å– GLSL ä»£ç </span></span><br><span class="line"><span class="comment">* @param path æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">    std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">        content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fileStream.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL ä»£ç ç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param shader ç€è‰²å™¨æ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL é“¾æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param program ç€è‰²å™¨ç¨‹åºæ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ£€æŸ¥ OpenGL é”™è¯¯æ ‡å¿—ï¼Œå³æ˜¯å¦å‘ç”Ÿ OpenGL é”™è¯¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    <span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        err = <span class="literal">true</span>;</span><br><span class="line">        glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* åˆ›å»ºç€è‰²å™¨ç¨‹åº</span></span><br><span class="line"><span class="comment">* @param vpath é¡¶ç‚¹ç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">* @param fpath ç‰‡æ®µç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">    <span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å­˜å…¥ vShader å’Œ fShader å˜é‡</span></span><br><span class="line">    GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">    GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† GLSL ä»£ç ä»å­—ç¬¦ä¸²è½½å…¥ç©ºç€è‰²å™¨å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">    <span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">    <span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">    <span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">    <span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vProgram; <span class="comment">// è¿”å›ç€è‰²å™¨ç¨‹åºID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>vertex.glsl å’Œ fragment.glsl</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = <span class="built_in">vec4</span>(<span class="number">0</span>, <span class="number">0.6</span>, <span class="number">0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºç€è‰²å™¨æ–¹é¢</p>
<ul>
<li>ç€è‰²å™¨ä¸­ä¼ å…¥çš„é¡¶ç‚¹å±æ€§çš„ <code>position</code> å˜é‡ä¸Šå­˜åœ¨ã€‚<code>layout</code> ä¿®é¥°ç¬¦ï¼Œä½ç½®æŒ‡å®šä¸ºâ€œ0â€ï¼Œå› æ­¤ <code>display()</code> å‡½æ•°å¯ä»¥ç®€å•åœ°é€šè¿‡åœ¨ <code>glVertexAttribPointer()</code> å‡½æ•°è°ƒç”¨ä¸­ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰å’Œåœ¨ <code>glEnableVertexAttribArray()</code> å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨ 0 æ¥å¼•ç”¨æ­¤å˜é‡ã€‚</li>
<li><code>position</code> é¡¶ç‚¹å±æ€§è¢«å£°æ˜ä¸º <code>vec3</code> ç±»å‹ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸º <code>vec4</code> ç±»å‹ï¼Œç”± <code>vec4(position,1.0)</code> å®Œæˆã€‚</li>
<li>é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„ä¹˜æ³•å°†çŸ©é˜µå˜æ¢åº”ç”¨äºé¡¶ç‚¹ï¼Œå°†å…¶è½¬æ¢ä¸ºç›¸æœºç©ºé—´ï¼Œæ¥ç€è¢«æ”¾å…¥å†…ç½®çš„ OpenGL è¾“å‡ºå˜é‡ <code>gl_Position</code> ä¸­ï¼Œç„¶åç»§ç»­é€šè¿‡ç®¡çº¿ï¼Œå¹¶ç”±å…‰æ …ç€è‰²å™¨è¿›è¡Œæ’å€¼ã€‚</li>
<li>æ’å€¼åçš„åƒç´ ä½ç½®ï¼ˆç§°ä¸ºç‰‡æ®µï¼‰è¢«å‘é€åˆ°ç‰‡æ®µç€è‰²å™¨ã€‚
<ul>
<li>ç‰‡æ®µç€è‰²å™¨ä¸­ä¹Ÿæœ‰ä¸¤ä¸ªç»Ÿä¸€å˜é‡ï¼Œä½†åœ¨è¯¥ç€è‰²å™¨ä¸­å°šæœªä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
</details>
<details><summary>é€šè¿‡ä¿®æ”¹ç€è‰²å™¨ï¼Œå®ç°å½©è‰²ç«‹æ–¹ä½“</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">    changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube.jpg" alt="å½©è‰²ç«‹æ–¹ä½“"></p>
<p>åŒæ ·åœ°ï¼Œä¹Ÿå¯ä»¥è®©ç«‹æ–¹ä½“åŠ¨èµ·æ¥ï¼Œåªéœ€è¦åœ¨åˆ·æ–°çš„æ¯ä¸€å¸§åŠ ä¸Šå¹³ç§»å˜æ¢å’Œæ—‹è½¬å˜æ¢ï¼š</p>
<details><summary>å±•å¼€ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// â€¦â€¦</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– MV çŸ©é˜µ å’ŒæŠ•å½±çŸ©é˜µçš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºé€è§†çŸ©é˜µ</span></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    <span class="comment">// å‚æ•°ä¸ºï¼šè§†è§’ï¼Œå®½é«˜æ¯”ï¼Œè¿‘è£å‰ªé¢ï¼Œè¿œè£å‰ªé¢</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ç³»åˆ—æ—‹è½¬å˜æ¢çŸ©é˜µ</span></span><br><span class="line">    glm::mat tMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="number">0.35f</span> * currentTime) * <span class="number">2.0f</span>, <span class="built_in">cos</span>(<span class="number">0.52f</span> * currentTime) * <span class="number">2.0f</span>, <span class="built_in">sin</span>(<span class="number">0.7f</span> * currentTime) * <span class="number">2.0f</span>));</span><br><span class="line">    glm::mat rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºè§†å›¾çŸ©é˜µã€æ¨¡å‹çŸ©é˜µå’Œ MV çŸ©é˜µ</span></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    <span class="comment">//mMat = glm::translate(glm::mat4(1.0f), glm::vec3(cubeLocX, cubeLocY, cubeLocZ));</span></span><br><span class="line">    mMat = rMat * tMat;</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†çŸ©é˜µå¤åˆ¶ç»™ç›¸åº”çš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† VBO å…³è”ç»™é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›¸åº”çš„é¡¶ç‚¹å±æ€§</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒæ•´ OpenGL è®¾ç½®ï¼Œç»˜åˆ¶æ¨¡å‹</span></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€¦â€¦</span></span><br></pre></td></tr></table></figure>
</details>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube1.gif" alt="æ—‹è½¬çš„ç«‹æ–¹ä½“"></p>
<h3 id="4-6-æ¸²æŸ“ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå‰¯æœ¬">4.6 æ¸²æŸ“ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå‰¯æœ¬</h3>
<p>ä¸Šé¢å®ç°äº†ä¸€ä¸ªç¿»æ»šçš„ç«‹æ–¹ä½“ï¼Œæ¥ç€å¯ä»¥è€ƒè™‘å®ç°å¤šä¸ªç¿»æ»šçš„ç«‹æ–¹ä½“ã€‚</p>
<p>å¯ä»¥å°† <code>display()</code> å‡½æ•°ä¸­ç”¨äºæ„å»º MV çŸ©é˜µå¹¶ç»˜åˆ¶ç«‹æ–¹ä½“çš„ä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªæ‰§è¡Œ 24 æ¬¡çš„å¾ªç¯ä¸­æ¥å®Œæˆæ­¤æ“ä½œã€‚</p>
<details><summary>å±•å¼€ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">32.0f</span>;</span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– MV çŸ©é˜µ å’ŒæŠ•å½±çŸ©é˜µçš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§†å›¾çŸ©é˜µ</span></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºé€è§†çŸ©é˜µ</span></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="comment">// å‚æ•°ä¸ºï¼šè§†è§’ï¼Œå®½é«˜æ¯”ï¼Œè¿‘è£å‰ªé¢ï¼Œè¿œè£å‰ªé¢</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> tf;</span><br><span class="line">    glm::mat4 tMat, rMat;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        tf = currentTime + i;</span><br><span class="line">        tMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="number">0.35f</span> * tf) * <span class="number">8.0f</span>, <span class="built_in">cos</span>(<span class="number">0.52f</span> * tf) * <span class="number">8.0f</span>, <span class="built_in">sin</span>(<span class="number">0.7f</span> * tf) * <span class="number">8.0f</span>));</span><br><span class="line">        rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">        <span class="comment">// æ„å»ºæ¨¡å‹çŸ©é˜µå’Œ MV çŸ©é˜µ</span></span><br><span class="line">        mMat = rMat * tMat;</span><br><span class="line">        mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†çŸ©é˜µå¤åˆ¶ç»™ç›¸åº”çš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">        <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† VBO å…³è”ç»™é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›¸åº”çš„é¡¶ç‚¹å±æ€§</span></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒæ•´ OpenGL è®¾ç½®ï¼Œç»˜åˆ¶æ¨¡å‹</span></span><br><span class="line">        <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">        <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_mcoloredCube.gif" alt="æ•ˆæœå±•ç¤º"></p>
<p>OpenGL çš„å®ä¾‹åŒ–æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥åªç”¨ä¸€ä¸ªè°ƒç”¨å°±æ¸²æŸ“ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå‰¯æœ¬ã€‚</p>
<ul>
<li>å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿</li>
</ul>
<p>æŠŠåŸæ¥è°ƒç”¨çš„ <code>glDrawArrays()</code> æ”¹ä¸º <code>glDrawArraysInstanced()</code>ã€‚</p>
<p>åŒæ—¶å®ä¾‹åŒ–æ—¶ï¼Œé¡¶ç‚¹ç€è‰²å™¨å¯ä»¥è®¿é—®å†…ç½®å˜é‡ <code>gl_InstanceID</code> æ¥è·å–å½“å‰æ­£åœ¨å¤„ç†å¯¹è±¡çš„å®ä¾‹åºå·ã€‚</p>
<p>å®ä¾‹åŒ–çš„ç¨‹åºï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">1</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">float</span> aspect, timeFactor;</span><br><span class="line"></span><br><span class="line">GLuint mLoc, vLoc, projLoc, tfLoc;</span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line">glm::mat4 pMat, vMat, mMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// ç”Ÿæˆçš„ç¼“å†²åŒºå’Œ VAO ç›¸å…³è”</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]); <span class="comment">// å°†ç¼“å†²åŒºæ ‡ä¸ºæ´»è·ƒï¼ˆä½¿ç”¨ï¼‰</span></span><br><span class="line">    <span class="comment">// å°†åŒ…å«é¡¶ç‚¹æ•°æ®çš„æ•°ç»„å¤åˆ¶è¿›æ´»è·ƒç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">32.0f</span>;</span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è§†å›¾çŸ©é˜µå’ŒæŠ•å½±çŸ©é˜µçš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    vLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;v_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(vLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(vMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ—¶é—´å› å­çš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    timeFactor = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime);</span><br><span class="line">    tfLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;tf&quot;</span>);</span><br><span class="line">    <span class="built_in">glUniform1f</span>(tfLoc, timeFactor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† VBO å…³è”ç»™é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›¸åº”çš„é¡¶ç‚¹å±æ€§</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="built_in">glDrawArraysInstanced</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>, <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¹‹å‰çš„å¾ªç¯å¤šä¸ªæ¨¡å‹çŸ©é˜µå±•ç¤º æ”¹ä¸ºäº† åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æ„å»ºæ¨¡å‹çŸ©é˜µã€‚</p>
<ul>
<li>å°†æ—¶é—´å› å­é€šè¿‡ç»Ÿä¸€å˜é‡ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨ï¼Œè¿˜éœ€è¦å°†è§†å›¾çŸ©é˜µä¼ é€’åˆ°å•ç‹¬çš„ç»Ÿä¸€å˜é‡ä¸­</li>
<li>æ—‹è½¬è®¡ç®—è¢«ç§»åŠ¨åˆ°äº†é¡¶ç‚¹ç€è‰²å™¨ä¸­</li>
</ul>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 v_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform <span class="type">float</span> tf;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateX</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mat4 xrot = <span class="built_in">mat4</span>(</span><br><span class="line">        <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="built_in">cos</span>(rad), -<span class="built_in">sin</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="built_in">sin</span>(rad), <span class="built_in">cos</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span> xrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateY</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mat4 yrot = <span class="built_in">mat4</span>(</span><br><span class="line">        <span class="built_in">cos</span>(rad), <span class="number">0.0</span>, <span class="built_in">sin</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        -<span class="built_in">sin</span>(rad), <span class="number">0.0</span>, <span class="built_in">cos</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span> yrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateZ</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mat4 zrot = <span class="built_in">mat4</span>(</span><br><span class="line">        <span class="built_in">cos</span>(rad), -<span class="built_in">sin</span>(rad), <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="built_in">sin</span>(rad), <span class="built_in">cos</span>(rad), <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span> zrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildTranslate</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mat4 trans = <span class="built_in">mat4</span>(</span><br><span class="line">        <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">        x, y, z, <span class="number">1.0</span>);</span><br><span class="line">    <span class="keyword">return</span> trans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> i = gl_InstanceID + tf;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> a = <span class="built_in">sin</span>(<span class="number">0.35</span> * i) * <span class="number">8.0</span>;</span><br><span class="line">    <span class="type">float</span> b = <span class="built_in">cos</span>(<span class="number">0.52</span> * i) * <span class="number">8.0</span>;</span><br><span class="line">    <span class="type">float</span> c = <span class="built_in">sin</span>(<span class="number">0.70</span> * i) * <span class="number">8.0</span>;</span><br><span class="line"></span><br><span class="line">    mat4 localRotx = <span class="built_in">buildRotateX</span>(<span class="number">1.75</span> * i);</span><br><span class="line">    mat4 localRoty = <span class="built_in">buildRotateY</span>(<span class="number">1.75</span> * i);</span><br><span class="line">    mat4 localRotz = <span class="built_in">buildRotateZ</span>(<span class="number">1.75</span> * i);</span><br><span class="line">    mat4 localTrans = <span class="built_in">buildTranslate</span>(a, b, c);</span><br><span class="line"></span><br><span class="line">    mat4 newM_matrix = localTrans * localRotx * localRoty * localRotz;</span><br><span class="line">    mat4 mv_matrix = v_matrix * newM_matrix;</span><br><span class="line"></span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">    changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºç€è‰²å™¨å†…éƒ¨æ— æ³•è°ƒç”¨ GLM çš„å‡½æ•°ï¼Œæ•…éœ€è¦ç¼–å†™çŸ©é˜µå˜æ¢çš„ç›¸å…³å‡½æ•°ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç‰‡æ®µç€è‰²å™¨æ— éœ€åšæ”¹å˜ã€‚</p>
</details>
<p>å¦‚æœæ¸²æŸ“çš„ç«‹æ–¹ä½“å¾ˆå¤šæ—¶ï¼Œå®ä¾‹åŒ–æå¤§çš„æ–¹ä¾¿äº†ç¨‹åºçš„ç¼–å†™ï¼Œåªéœ€è¦ä¿®æ”¹è§†é‡ç›¸å…³çš„å¸¸é‡ï¼š</p>
<p>æ¯”å¦‚æƒ³æ¸²æŸ“ 100000 ä¸ªå½©è‰²ç«‹æ–¹ä½“ï¼Œåªéœ€ä¿®æ”¹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">glDrawArraysInstanced</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>, <span class="number">100000</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="comment">// é•œå¤´ä½ç½®ï¼Œé•œå¤´æ‹‰è¿œ</span></span><br><span class="line">cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">402.0f</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="comment">// ä½ç§»å˜å¤§</span></span><br><span class="line"><span class="type">float</span> a = <span class="built_in">sin</span>(<span class="number">203.0</span> * i / <span class="number">8000.0</span>) * <span class="number">403.0</span>;</span><br><span class="line"><span class="type">float</span> b = <span class="built_in">cos</span>(<span class="number">301.0</span> * i / <span class="number">4001.0</span>) * <span class="number">401.0</span>;</span><br><span class="line"><span class="type">float</span> c = <span class="built_in">sin</span>(<span class="number">400.0</span> * i / <span class="number">6003.0</span>) * <span class="number">405.0</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_100kcubes.jpg" alt="æ•ˆæœæˆªå›¾(é™æ€å›¾)"></p>
<h3 id="4-7-åŒä¸€åœºæ™¯æ¸²æŸ“å¤šä¸ªå¯¹è±¡">4.7 åŒä¸€åœºæ™¯æ¸²æŸ“å¤šä¸ªå¯¹è±¡</h3>
<p>è¦åœ¨å•ä¸ªåœºæ™¯ä¸­æ¸²æŸ“å¤šä¸ªæ¨¡å‹ï¼Œç®€å•çš„åšæ³•ï¼š</p>
<ol>
<li>ä¸ºæ¯ä¸ªæ¨¡å‹ä½¿ç”¨å•ç‹¬çš„ç¼“å†²åŒºï¼›</li>
<li>æ¯ä¸ªæ¨¡å‹éƒ½éœ€è¦è‡ªå·±çš„æ¨¡å‹çŸ©é˜µï¼Œä¸ºæ¸²æŸ“çš„æ¯ä¸ªæ¨¡å‹ç”Ÿæˆä¸€ä¸ªæ–°çš„ MV çŸ©é˜µï¼›</li>
<li>ä¸ºæ¯ä¸ªæ¨¡å‹å•ç‹¬è°ƒç”¨ <code>glDrawArrays()</code>ã€‚</li>
</ol>
<p>å‡å¦‚åœ¨åœºæ™¯ä¸­æ¸²æŸ“ç«‹æ–¹ä½“å’Œå››æ£±é”¥ï¼Œä¸”ä¸è€ƒè™‘å¤æ‚çš„æƒ…å†µï¼Œå¤ç”¨ç€è‰²å™¨ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_2objects.gif" alt="æ¸²æŸ“ç«‹æ–¹ä½“å’Œå››æ£±é”¥"></p>
<p>ä»£ç å¦‚ä¸‹ï¼ˆè‡ªä¸»ç ”ç©¶ï¼Œä¸è¿‡å¤šè§£é‡Šï¼‰ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">float</span> cubeLocx, cubeLocy, cubeLocz;</span><br><span class="line"><span class="type">float</span> pyramidLocx, pyramidLocy, pyramidLocz;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> pyramids[<span class="number">54</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// ç”Ÿæˆçš„ç¼“å†²åŒºå’Œ VAO ç›¸å…³è”</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// ç«‹æ–¹ä½“ä¸ç¼“å†²åŒº0ç»‘å®š</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// å››æ£±é”¥ä¸ç¼“å†²åŒº1ç»‘å®š</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(pyramids), pyramids, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">8.0f</span>;</span><br><span class="line">    cubeLocx = <span class="number">0.0f</span>, cubeLocy = <span class="number">-2.0f</span>, cubeLocz = <span class="number">0.0f</span>;</span><br><span class="line">    pyramidLocx = <span class="number">0.0f</span>, pyramidLocy = <span class="number">1.0f</span>, pyramidLocz = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è§†å›¾çŸ©é˜µå’ŒæŠ•å½±çŸ©é˜µçš„ç»Ÿä¸€å˜é‡</span></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜ç”»ç«‹æ–¹ä½“</span></span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(cubeLocx, cubeLocy, cubeLocz));</span><br><span class="line">    mMat *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜ç”»å››æ£±é”¥</span></span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(pyramidLocx, pyramidLocy, pyramidLocz));</span><br><span class="line">    mMat *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">    changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="4-8-çŸ©é˜µæ ˆ">4.8 çŸ©é˜µæ ˆ</h3>
<p>å‰é¢æ¸²æŸ“çš„æ¨¡å‹éƒ½æ˜¯ç”±ä¸€ç»„é¡¶ç‚¹æ„æˆï¼Œè€Œå®é™…ä¸Šå¸Œæœ›é€šè¿‡ç»„è£…è®¸å¤šç®€å•åœ°æ¨¡å‹æ¥æ„å»ºå¤æ‚çš„æ¨¡å‹ã€‚ä»¥è¿™ç§æ–¹å¼æ„å»ºçš„å¯¹è±¡ç§°ä¸ºåˆ†å±‚æ¨¡å‹ã€‚</p>
<ul>
<li>æ„å»ºåˆ†å±‚æ¨¡å‹çš„æ£˜æ‰‹éƒ¨åˆ†æ˜¯è·Ÿè¸ªæ‰€æœ‰ MV çŸ©é˜µå¹¶ä¿è¯çŸ©é˜µå®Œç¾åè°ƒã€‚</li>
</ul>
<p>çŸ©é˜µæ ˆï¼šå˜æ¢çŸ©é˜µçš„æ ˆã€‚</p>
<ul>
<li>ä½¿å¾—åˆ›å»ºå’Œç®¡ç†å¤æ‚åˆ†å±‚å¯¹è±¡å’Œåœºæ™¯å˜å¾—å®¹æ˜“</li>
<li>ä½¿å¾—å˜æ¢å¯ä»¥æ„å»ºåœ¨å…¶ä»–å˜æ¢ä¹‹ä¸Š</li>
<li>é€šè¿‡ STL çš„ <code>stack</code> ç±»æ„å»º <code>mat4</code> çš„æ ˆã€‚</li>
</ul>
<p>å¯¹äº <code>std::stack&lt;glm::mat4&gt;</code> çš„å®ä¾‹ <code>s</code>ï¼š</p>
<ul>
<li><code>s.push(mat4)</code>ï¼šå°†æ ˆé¡¶çš„çŸ©é˜µå¤åˆ¶ä¸€ä»½ï¼Œå¹¶ä½œå˜æ¢åæŠŠæ–°çš„çŸ©é˜µå‹å…¥æ ˆã€‚</li>
<li><code>s.pop()</code>ï¼šå¼¹å‡ºæ ˆé¡¶çš„çŸ©é˜µã€‚</li>
<li><code>s.top()</code>ï¼šè¿”å›æ ˆé¡¶çš„çŸ©é˜µçš„å¼•ç”¨ã€‚</li>
<li><code>s.top() *= rotate(args)</code>ï¼šç›´æ¥å¯¹æ ˆé¡¶çŸ©é˜µä½œæ—‹è½¬å˜æ¢ã€‚</li>
<li><code>s.top() *= translate(args)</code>ï¼šç›´æ¥å¯¹æ ˆé¡¶çŸ©é˜µä½œå¹³ç§»å˜æ¢ã€‚</li>
<li><code>s.top() *= scale(args)</code>ï¼šç›´æ¥å¯¹æ ˆé¡¶çŸ©é˜µä½œç¼©æ”¾å˜æ¢ã€‚</li>
</ul>
<p>åœ¨æ­¤ä¹‹åï¼Œä¸å†é€šè¿‡åˆ›å»º <code>mat4</code> çš„å®ä¾‹æ¥æ„å»ºå˜æ¢ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>push()</code> å‘½ä»¤åœ¨æ ˆé¡¶éƒ¨åˆ›å»ºæ–°çš„çŸ©é˜µï¼Œç„¶åæ ¹æ®éœ€è¦å°†æœŸæœ›çš„å˜æ¢åº”ç”¨äºæ ˆé¡¶éƒ¨çš„æ–°åˆ›å»ºçš„çŸ©é˜µã€‚</p>
<ul>
<li>å‹å…¥æ ˆçš„ç¬¬ä¸€ä¸ªçŸ©é˜µé€šå¸¸æ˜¯è§†å›¾çŸ©é˜µã€‚å®ƒä¸Šé¢çš„çŸ©é˜µæ˜¯å¤æ‚ç¨‹åº¦è¶Šæ¥è¶Šé«˜çš„ MV çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åº”ç”¨äº†è¶Šæ¥è¶Šå¤šçš„æ¨¡å‹å˜æ¢ã€‚è¿™äº›å˜æ¢æ—¢å¯ä»¥ç›´æ¥åº”ç”¨ï¼Œä¹Ÿå¯ä»¥å…ˆç»“åˆå…¶ä»–çŸ©é˜µå†åº”ç”¨ã€‚</li>
</ul>
<p>å‡è®¾ä¸€ä¸ªä¾‹å­ï¼Œå®ç°ä¸€ä¸ªåœ°çƒå›´ç»•å¤ªé˜³æ—‹è½¬å’Œæœˆçƒå›´ç»•åœ°çƒæ—‹è½¬çš„åœºæ™¯ï¼š</p>
<ol>
<li>é¦–å…ˆå‹å…¥è§†å›¾çŸ©é˜µ Vï¼›</li>
<li>å‹å…¥å¤ªé˜³çš„ MV çŸ©é˜µï¼›</li>
<li>å‹å…¥åœ°çƒçš„ MV çŸ©é˜µï¼Œç”±å¤ªé˜³çš„ MV çŸ©é˜µçš„å‰¯æœ¬å’Œåº”ç”¨äºå…¶ä¹‹ä¸Šçš„åœ°çƒæ¨¡å‹çŸ©é˜µå˜æ¢ç»„æˆï¼›</li>
<li>å‹å…¥æœˆçƒçš„ MV çŸ©é˜µï¼Œç”±åœ°çƒçš„ MV çŸ©é˜µçš„å‰¯æœ¬å’Œåº”ç”¨äºå…¶ä¹‹ä¸Šçš„æœˆçƒæ¨¡å‹çŸ©é˜µå˜æ¢ç»„æˆã€‚</li>
</ol>
<p>æ¥ç€ï¼Œæ¸²æŸ“æœˆçƒå¹¶æŠŠæœˆçƒçŸ©é˜µå¼¹å‡ºï¼Œåé¢çš„åœ°çƒå’Œå¤ªé˜³åªéœ€è¦é‡å¤å³å¯ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å£°æ˜çŸ©é˜µæ ˆï¼›</li>
<li>å½“ç›¸å¯¹äºçˆ¶å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡æ—¶ï¼Œè°ƒç”¨ <code>s.push(s.top())</code>ï¼›</li>
<li>åº”ç”¨æ–°å¯¹è±¡æ‰€éœ€çš„å˜æ¢ï¼›</li>
<li>å®Œæˆå¯¹è±¡æˆ–å­å¯¹è±¡çš„ç»˜åˆ¶åï¼Œå¼¹å‡ºæ ˆé¡¶ï¼Œç§»é™¤å¯¹åº”çš„ MV çŸ©é˜µã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>å¤ªé˜³çš„è‡ªè½¬åœ¨å®ƒè‡ªå·±çš„å±€éƒ¨åæ ‡ç©ºé—´ä¸­è¿›è¡Œï¼Œä¸åº”å½±å“åœ°çƒå’Œæœˆçƒã€‚å› æ­¤ï¼Œå¤ªé˜³çš„æ—‹è½¬å˜æ¢çŸ©é˜µè¢«æ¨åˆ°æ ˆä¸Šï¼Œä½†æ˜¯åœ¨ç»˜åˆ¶å¤ªé˜³ä¹‹åï¼Œå®ƒå¿…é¡»è¢«ä»æ ˆä¸­å¼¹å‡ºã€‚</li>
<li>åœ°çƒçš„å…¬è½¬å°†å½±å“æœˆçƒçš„è¿åŠ¨ï¼Œå› æ­¤åœ°çƒçš„å¹³ç§»å˜æ¢çŸ©é˜µè¢«å‹å…¥æ ˆå¹¶ä¿æŒåˆ°ç»˜åˆ¶æœˆçƒã€‚</li>
<li>åœ°çƒçš„è‡ªè½¬æ˜¯å±€éƒ¨çš„ï¼Œä¸ä¼šå½±å“æœˆçƒï¼Œå› æ­¤åœ¨ç»˜åˆ¶æœˆçƒä¹‹å‰åœ°çƒçš„æ—‹è½¬å˜æ¢çŸ©é˜µéœ€è¦ä»æ ˆä¸­å¼¹å‡ºã€‚</li>
</ul>
<p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sunearthmoon.gif" alt="å¤ªé˜³-åœ°çƒ-æœˆçƒåœºæ™¯"></p>
<p>é¡¶ç‚¹ç€è‰²å™¨ä¸ç‰‡æ®µç€è‰²å™¨æ— éœ€æ”¹å˜ï¼ŒåŒä¸Šé¢æ¸²æŸ“ä¸¤ä¸ªç›®æ ‡çš„ç¨‹åºã€‚</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line">std::stack&lt;glm::mat4&gt; matrixStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// ç”Ÿæˆçš„ç¼“å†²åŒºå’Œ VAO ç›¸å…³è”</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">4.0f</span>, cameraZ = <span class="number">20.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    matrixStack.<span class="built_in">push</span>(vMat);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜åˆ¶å¤ªé˜³</span></span><br><span class="line">    matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// å¤ªé˜³ä½ç½®</span></span><br><span class="line">    matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// å¤ªé˜³è‡ªè½¬</span></span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    matrixStack.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜åˆ¶åœ°çƒ</span></span><br><span class="line">    matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">8.0</span>, <span class="number">0.0</span>, <span class="built_in">cos</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">8.0</span>)); <span class="comment">// å¹³ç§»çŸ©é˜µå˜æ¢</span></span><br><span class="line">    matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime) * <span class="number">2.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">2.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// æ—‹è½¬çŸ©é˜µå˜æ¢</span></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    matrixStack.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»˜åˆ¶æœˆçƒ</span></span><br><span class="line">    matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0</span>, <span class="built_in">sin</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">2.0</span>, <span class="built_in">cos</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">2.0</span>)); <span class="comment">// å¹³ç§»çŸ©é˜µå˜æ¢</span></span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>)); <span class="comment">// æ—‹è½¬çŸ©é˜µå˜æ¢</span></span><br><span class="line">    matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">0.25f</span>, <span class="number">0.25f</span>));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    matrixStack.<span class="built_in">pop</span>(); matrixStack.<span class="built_in">pop</span>(); matrixStack.<span class="built_in">pop</span>();</span><br><span class="line">    matrixStack.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;sun-earth-moon&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„çš„ç‚¹ï¼š</p>
<ul>
<li>åŠ å…¥ç¼©æ”¾çŸ©é˜µè°ƒèŠ‚å„ä¸ªæ¨¡å‹çš„å¤§å°</li>
<li>ä½¿ç”¨ä¸‰è§’å‡½æ•°å®ç°è‡ªè½¬å’Œå…¬è½¬</li>
<li>åœ¨ <code>glUniformMatrix4fv()</code> å‘½ä»¤ä¸­è°ƒç”¨çš„  <code>glm::value_ptr(mvStack.top())</code> å‡½æ•°ï¼Œè·å–æ ˆé¡¶éƒ¨çŸ©é˜µä¸­çš„å€¼</li>
</ul>
</details>
<h3 id="4-9-åº”å¯¹-zå†²çª-ä¼ªå½±">4.9 åº”å¯¹â€œZå†²çªâ€ä¼ªå½±</h3>
<p>åœ¨æ¸²æŸ“å¤šä¸ªå¯¹è±¡æ—¶ï¼ŒOpenGL ä½¿ç”¨ Z-buffer ç®—æ³•æ¥è¿›è¡Œéšè—é¢æ¶ˆé™¤ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡é€‰æ‹©æœ€æ¥è¿‘ç›¸æœºçš„ç›¸åº”ç‰‡æ®µçš„é¢œè‰²ä½œä¸ºåƒç´ çš„é¢œè‰²ï¼Œè¿™ç§æ–¹æ³•å¯å†³å®šå“ªäº›ç‰©ä½“çš„æ›²é¢å¯è§å¹¶å‘ˆç°åˆ°å±å¹•ï¼Œè€Œä½äºå…¶ä»–ç‰©ä½“åé¢çš„æ›²é¢ä¸åº”è¯¥è¢«æ¸²æŸ“ã€‚</p>
<p><em>Z-buffer ç®—æ³•æ€æƒ³ï¼šå…ˆå°† Z ç¼“å†²å™¨ä¸­å„å•å…ƒçš„åˆå§‹ç½®è®¾ç½®ä¸ºæœ€å°å€¼ã€‚å½“è¦æ”¹å˜æŸä¸ªåƒç´ çš„é¢œè‰²å€¼æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥å½“å‰å¤šè¾¹å½¢çš„æ·±åº¦å€¼æ˜¯å¦å¤§äºè¯¥åƒç´ åŸæ¥çš„æ·±åº¦å€¼ï¼ˆä¿å­˜åœ¨è¯¥åƒç´ æ‰€å¯¹åº”çš„Z ç¼“å†²å™¨çš„å•å…ƒä¸­ï¼‰ã€‚å¦‚æœå¤§äºåŸæ¥çš„ Z å€¼ï¼Œè¯´æ˜å½“å‰å¤šè¾¹å½¢æ›´é è¿‘è§‚å¯Ÿç‚¹ï¼Œç”¨å®ƒçš„é¢œè‰²æ›¿æ¢åƒç´ åŸæ¥çš„é¢œè‰²ã€‚</em></p>
<p>ç„¶è€Œï¼Œæœ‰æ—¶å€™åœºæ™¯ä¸­çš„ä¸¤ä¸ªç‰©ä½“è¡¨é¢é‡å å¹¶ä½äºé‡åˆçš„å¹³é¢ä¸­ï¼Œè¿™ä½¿å¾—æ·±åº¦ç¼“å†²åŒºç®—æ³•éš¾ä»¥ç¡®å®šåº”è¯¥æ¸²æŸ“ä¸¤ä¸ªè¡¨é¢ä¸­çš„å“ªä¸€ä¸ªã€‚</p>
<p>å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæµ®ç‚¹èˆå…¥è¯¯å·®å¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“è¡¨é¢çš„æŸäº›éƒ¨åˆ†ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„é¢œè‰²ï¼Œè€Œå…¶ä»–éƒ¨åˆ†åˆ™ä½¿ç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„é¢œè‰²ã€‚è¿™ç§ä¸è‡ªç„¶çš„ä¼ªå½±ç§°ä¸º Z å†²çªï¼ˆZ-fightingï¼‰æˆ–æ·±åº¦å†²çªï¼ˆdepth-fightingï¼‰ã€‚</p>
<ul>
<li>æ˜¯æ¸²æŸ“çš„ç‰‡æ®µåœ¨æ·±åº¦ç¼“å†²åŒºä¸­ç›¸äº’å¯¹åº”çš„åƒç´ æ¡ç›®ä¸Šâ€œæ–—äº‰â€çš„ç»“æœã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zfighting.jpg" alt="Zå†²çªä¾‹å­ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬2ç‰ˆï¼‰"></p>
<p>éƒ¨åˆ†åº”å¯¹æ–¹æ³•ï¼š</p>
<ul>
<li>å¯ä»¥é€‰æ‹©é€‚å½“çš„è¿‘ã€è¿œå‰ªè£å¹³é¢å€¼æ¥æœ€å°åŒ–ä¸¤ä¸ªå¹³é¢ä¹‹é—´çš„è·ç¦»ï¼ŒåŒæ—¶ä»ç„¶ç¡®ä¿åœºæ™¯å¿…éœ€çš„æ‰€æœ‰å¯¹è±¡éƒ½ä½äºè§†é”¥å†…</li>
<li>å»ºè®®é¿å…é€‰æ‹©å¤ªé è¿‘ç›¸æœºçš„è¿‘å‰ªè£å¹³é¢</li>
</ul>
<h3 id="4-10-å…¶ä»–å›¾å…ƒ">4.10 å…¶ä»–å›¾å…ƒ</h3>
<p>ç›®å‰ä¸€ç›´ä½¿ç”¨ä¸‰è§’å½¢è¿›è¡Œç»˜åˆ¶ï¼Œå…¶å® OpenGL è¿˜æœ‰å…¶ä»–é€‰æ‹©ã€‚</p>
<h4 id="4-10-1-ä¸‰è§’å½¢å›¾å…ƒ">4.10.1 ä¸‰è§’å½¢å›¾å…ƒ</h4>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">ä½œç”¨</th>
<th style="text-align:center">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_TRIANGLES</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­ä¼ é€’çš„æ¯3ä¸ªé¡¶ç‚¹æ•°æ®ç»„æˆä¸€ä¸ªä¸‰è§’å½¢</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltriangle.jpg"></img></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_STRIP</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­ä¼ é€’çš„æ¯ä¸ªé¡¶ç‚¹å’Œä¹‹å‰çš„ä¸¤ä¸ªé¡¶ç‚¹ç»„æˆä¸€ä¸ªä¸‰è§’å½¢</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglestrip.png"></img></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_FAN</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­ä¼ é€’çš„æ¯å¯¹é¡¶ç‚¹å’Œæœ€å¼€å§‹çš„é¡¶ç‚¹ç»„æˆä¸€ä¸ªä¸‰è§’å½¢</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglefan.png"></img></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLES_ADJACENCY</code></td>
<td style="text-align:center">ä»…ç”¨äºå‡ ä½•ç€è‰²å™¨ï¼Œå…è®¸ç€è‰²å™¨è®¿é—®å½“å‰ä¸‰è§’å½¢çš„é¡¶ç‚¹ï¼Œä»¥åŠé¢å¤–çš„ç›¸é‚»é¡¶ç‚¹</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_STRIP_ADJACENCY</code></td>
<td style="text-align:center">ä»…ç”¨äºå‡ ä½•ç€è‰²å™¨ï¼Œç±»ä¼¼äº <code>GL_TRIANGLES_ADJACENCY</code>ï¼Œä½†ä¸‰è§’å½¢é¡¶ç‚¹åƒåœ¨ <code>GL_TRIANGLE_STRIP</code> ä¸­ä¸€æ ·é‡å </td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="4-10-2-çº¿å›¾å…ƒ">4.10.2 çº¿å›¾å…ƒ</h4>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">ä½œç”¨</th>
<th style="text-align:center">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_LINES</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­ä¼ é€’çš„æ¯ä¸¤ä¸ªé¡¶ç‚¹ç»„æˆä¸€æ¡çº¿</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_glline.png"></img></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_STRIP</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­æ¯ä¸ªé¡¶ç‚¹å’Œå‰ä¸€ä¸ªé¡¶ç‚¹ç»„æˆä¸€æ¡çº¿</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gllinestrip.png"></img></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_LOOP</code></td>
<td style="text-align:center">ç±»ä¼¼äº <code>GL_LINE_STRIP</code>ï¼Œä½†æœ€åçš„é¡¶ç‚¹å’Œç¬¬ä¸€ä¸ªé¡¶ç‚¹ä¹‹é—´ä¼šå½¢æˆä¸€æ¡çº¿</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_ADJACENCY</code></td>
<td style="text-align:center">ä»…ç”¨äºå‡ ä½•ç€è‰²å™¨ï¼Œå…è®¸ç€è‰²å™¨è®¿é—®å½“å‰çº¿çš„é¡¶ç‚¹ï¼Œä»¥åŠé¢å¤–çš„ç›¸é‚»é¡¶ç‚¹</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_STRIP_ADJACENCY</code></td>
<td style="text-align:center">ä»…ç”¨äºå‡ ä½•ç€è‰²å™¨ï¼Œç±»ä¼¼äº <code>GL_LINE_ADJACENCY</code>ï¼Œä½†çº¿é¡¶ç‚¹åƒåœ¨ <code>GL_LINE_STRIP</code> ä¸­ä¸€æ ·é‡å </td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="4-10-3-ç‚¹å›¾å…ƒ">4.10.3 ç‚¹å›¾å…ƒ</h4>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_POINTS</code></td>
<td style="text-align:center">ç®¡çº¿ä¸­ä¼ é€’çš„æ¯ä¸ªé¡¶ç‚¹ç»„æˆä¸€ä¸ªç‚¹</td>
</tr>
</tbody>
</table>
<h4 id="è¡¥ä¸å›¾å…ƒ">è¡¥ä¸å›¾å…ƒ</h4>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_PATCHES</code></td>
<td style="text-align:center">ä»…ç”¨äºç»†åˆ†ç€è‰²å™¨ï¼ŒæŒ‡ç¤ºä¸€ç»„é¡¶ç‚¹ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ é€’åˆ°ç»†åˆ†æ§åˆ¶ç€è‰²å™¨ï¼Œåœ¨è¿™é‡Œå®ƒä»¬é€šå¸¸ç”¨äºå°†æ›²é¢ç»†åˆ†ç½‘æ ¼å¡‘é€ æˆæ›²é¢</td>
</tr>
</tbody>
</table>
<h3 id="4-11-æ€§èƒ½ä¼˜å…ˆç¼–ç¨‹">4.11 æ€§èƒ½ä¼˜å…ˆç¼–ç¨‹</h3>
<p>éšç€ 3D åœºæ™¯é€æ¸å¤æ‚ï¼Œæ€§èƒ½æ–¹é¢ä¸å¾—ä¸å…³å¿ƒã€‚</p>
<ol>
<li>å°½é‡å‡å°‘åŠ¨æ€å†…å­˜ç©ºé—´åˆ†é…
<ul>
<li>å…³é”®éƒ¨åˆ† <code>display()</code> å‡½æ•°ä¼šè¢«é‡å¤è°ƒç”¨
<ul>
<li>é¿å…é‡å¤å®ä¾‹åŒ–å¯¹è±¡</li>
<li>é¿å…é‡å¤å£°æ˜å˜é‡</li>
</ul>
</li>
<li>C++ æ ˆç±»ï¼Œæ¯æ¬¡å…¥æ ˆå¯èƒ½ä¼šå¯¼è‡´åŠ¨æ€å†…å­˜åˆ†é…</li>
<li>å°†æ•°æ®ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„å‡½æ•°è°ƒç”¨åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå®ä¾‹åŒ–å¹¶è¿”å›æ–°è½¬æ¢çš„æ•°æ®</li>
<li>GLM åº“å‡½æ•°ä¼˜åŒ–æœ‰é™ï¼Œå¯èƒ½å¼•èµ·åŠ¨æ€å†…å­˜åˆ†é…</li>
</ul>
</li>
<li>é¢„å…ˆè®¡ç®—é€è§†çŸ©é˜µ
<ul>
<li>å°†é€è§†çŸ©é˜µçš„è®¡ç®—ç§»åŠ¨åˆ° <code>init()</code> å‡½æ•°ä¸­</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦é‡æ–°è®¡ç®—é€è§†çŸ©é˜µï¼Œä½†çª—å£å¤§å°å˜åŒ–æ—¶éœ€è¦é‡æ–°è®¡ç®—ï¼Œå¯ä»¥å°†è®¡ç®—é€è§†çŸ©é˜µæ·»åŠ åˆ°å›è°ƒå‡½æ•°ä¸­ã€‚</li>
</ul>
</li>
<li>èƒŒé¢å‰”é™¤
<ul>
<li>åˆ©ç”¨ OpenGL çš„èƒŒé¢å‰”é™¤èƒ½åŠ›ï¼šå½“ 3D æ¨¡å‹å®Œå…¨é—­åˆæ—¶ï¼Œå…¶å†…éƒ¨æ°¸è¿œä¸å¯è§æ—¶ï¼Œé‚£ä¹ˆè¿™äº›éƒ¨åˆ†ä¸éœ€è¦è¢«æ …æ ¼åŒ–æˆ–æ¸²æŸ“ã€‚</li>
<li>é»˜è®¤èƒŒé¢å‰”é™¤æ—¶å…³é—­çš„</li>
<li>ä½¿ç”¨å‡½æ•° <code>glEnable(GL_CULL_FACE)</code> å¼€å¯</li>
<li>å¯ç”¨èƒŒé¢å‰”é™¤æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸‰è§’å½¢åªæœ‰æœå‰æ—¶æ‰ä¼šè¢«æ¸²æŸ“ã€‚æ­¤å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä» OpenGLç›¸æœºçš„è§’åº¦çœ‹ï¼Œå¦‚æœä¸‰è§’å½¢çš„ 3 ä¸ªé¡¶ç‚¹æ˜¯ä»¥é€†æ—¶é’ˆé¡ºåºæ’åˆ—çš„ï¼ˆåŸºäºå®ƒä»¬åœ¨ç¼“å†²åŒºä¸­å®šä¹‰çš„é¡ºåºï¼‰ï¼Œåˆ™ä¸‰è§’å½¢è¢«è§†ä¸ºæœå‰ï¼›é¡¶ç‚¹æ²¿é¡ºæ—¶é’ˆæ–¹å‘æ’åˆ—çš„ä¸‰è§’å½¢æ˜¯æœåçš„ï¼Œä¸ä¼šè¢«æ¸²æŸ“
<ul>
<li><strong>å®šä¹‰â€œå‰å‘â€çš„é¡¶ç‚¹é¡ºåºæœ‰æ—¶è¢«ç§°ä¸ºç¼ ç»•é¡ºåº</strong></li>
<li>ä½¿ç”¨ <code>glFrontFace(GL_CW)</code> è®¾ç½®é¡ºæ—¶é’ˆä¸ºæ­£å‘ï¼Œä½¿ç”¨ <code>glFrontFace(GL_CCW)</code> è®¾ç½®é€†æ—¶é’ˆä¸ºæ­£å‘</li>
<li>é»˜è®¤ä¸‹ï¼Œ<code>glCullFace(GL_BACK)</code> è®¾ç½®èƒŒå‘çš„ä¸‰è§’å½¢è¢«å‰”é™¤ï¼Œä½†å‚æ•°è¿˜æœ‰ <code>GL_FRONT</code> å’Œ <code>GL_FRONT_AND_BACK</code>ï¼Œåˆ†åˆ«è®¾ç½®å‰å‘æˆ–å…¨éƒ¨ä¸‰è§’å½¢è¢«å‰”é™¤</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="äº”-çº¹ç†è´´å›¾">äº”ã€çº¹ç†è´´å›¾</h2>
<p>çº¹ç†è´´å›¾æ˜¯åœ¨æ …æ ¼åŒ–çš„æ¨¡å‹è¡¨é¢ä¸Šè¦†ç›–å›¾åƒçš„æŠ€æœ¯ã€‚</p>
<p>çº¹ç†å›¾åƒå¯ä»¥æ˜¯ä»»ä½•å›¾åƒã€‚</p>
<h3 id="5-1-åŠ è½½çº¹ç†å›¾åƒæ–‡ä»¶">5.1 åŠ è½½çº¹ç†å›¾åƒæ–‡ä»¶</h3>
<p>OpenGL/GLSL ä¸­å®Œæˆçº¹ç†è´´å›¾éœ€è¦åè°ƒä¸åŒçš„æ•°æ®é›†å’Œæœºåˆ¶ï¼š</p>
<ul>
<li>ä¿å­˜çº¹ç†å›¾åƒçš„çº¹ç†å¯¹è±¡</li>
<li>ç‰¹æ®Šçš„ç»Ÿä¸€é‡‡æ ·å™¨å˜é‡ï¼Œç”¨äºé¡¶ç‚¹ç€è‰²å™¨è®¿é—®çº¹ç†</li>
<li>ä¿å­˜çº¹ç†åæ ‡çš„ç¼“å†²åŒº</li>
<li>å°†çº¹ç†åæ ‡ä¼ é€’ç»™ç®¡çº¿çš„é¡¶ç‚¹å±æ€§</li>
<li>æ˜¾å¡ä¸Šçš„çº¹ç†å•å…ƒ</li>
</ul>
<p>æ­¤å¤„å°†ç”¨ SOIL2 åº“è¿›è¡ŒåŠ è½½å›¾åƒæ–‡ä»¶ç”¨äºè´´å›¾ï¼š</p>
<ol>
<li>ä½¿ç”¨ SOIL2 å®ä¾‹åŒ– OpenGL çº¹ç†å¯¹è±¡å¹¶ä»å›¾åƒæ–‡ä»¶ä¸­è¯»å…¥æ•°æ®ï¼›</li>
<li>è°ƒç”¨ <code>glBindTexture()</code> ä½¿å¾—æ–°åˆ›å»ºçš„çº¹ç†å¯¹è±¡å¤„äºæ¿€æ´»çŠ¶æ€ï¼›</li>
<li>ä½¿ç”¨ <code>glTexParameteri()</code> è°ƒæ•´çº¹ç†è®¾ç½®ï¼›</li>
</ol>
<ul>
<li>æœ€ç»ˆå¾—åˆ°çš„ç»“æœæ˜¯å¯ç”¨çš„ OpenGL çº¹ç†å¯¹è±¡çš„æ•´å‹ IDã€‚</li>
</ul>
<p>åŠ è½½çº¹ç†çš„ä»£ç ï¼ˆåŠ å…¥åœ¨ Util ç±»ä¸­ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLuint textureID;</span><br><span class="line">    textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">    <span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç å…ˆå£°æ˜äº†ä¸€ä¸ª <code>GLuint</code> ç±»å‹çš„å˜é‡ç”¨äºè®°å½• OpenGL çº¹ç†å¯¹è±¡çš„ IDï¼Œæ¥ç€è°ƒç”¨ <code>SOIL_load_OGL_texture()</code> å‡½æ•°ç”Ÿæˆçº¹ç†å¯¹è±¡ã€‚</p>
<ul>
<li>å‡½æ•°å‚æ•°åŠè¿”å›å€¼
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶åï¼›</li>
<li>ç¬¬äºŒä¸ªè¯´æ˜ç¬¦ï¼Œ<code>SOIL_LOAD_AUTO</code> è¡¨ç¤ºä½¿ç”¨ç£ç›˜è½½å…¥çš„ï¼›</li>
<li>ç¬¬ä¸‰ä¸ªè¡¨ç¤ºè®©SOILä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªIDï¼›</li>
<li>ç¬¬å››ä¸ªå‚æ•° <code>SOIL_FLAG_INVERT_Y</code> å…è®¸åšæ˜¯ç¿»è½¬Yè½´</li>
<li>è¿”å›å€¼ï¼Œ0è¡¨ç¤ºå¤±è´¥ï¼Œå…¶ä»–è¡¨ç¤º OpenGL ä¸Šä¸‹æ–‡å¥æŸ„</li>
</ul>
</li>
</ul>
<h3 id="5-2-çº¹ç†åæ ‡">5.2 çº¹ç†åæ ‡</h3>
<p>é€šè¿‡ä¸ºæ¨¡å‹ä¸­çš„æ¯ä¸ªé¡¶ç‚¹æŒ‡å®šçº¹ç†åæ ‡æ¥å®Œæˆçº¹ç†è´´å›¾ã€‚</p>
<p>çº¹ç†åæ ‡æ˜¯å¯¹çº¹ç†å›¾åƒï¼ˆ2D å›¾åƒæ–‡ä»¶ï¼‰ä¸­åƒç´ çš„å¼•ç”¨ï¼Œç”¨äºå°† 3D æ¨¡å‹ä¸Šçš„ç‚¹æ˜ å°„åˆ°çº¹ç†ä¸­çš„ä½ç½®ã€‚</p>
<ul>
<li>æ¨¡å‹é™¤äº† 3D ç©ºé—´ä¸­çš„å®šä½åæ ‡ (x, y, z) å¤–ï¼Œè¡¨é¢ä¸Šæ¯ä¸ªç‚¹è¿˜å…·æœ‰çº¹ç†åæ ‡ (s, t)ï¼Œç”¨æ¥æŒ‡å®šçº¹ç†å›¾åƒä¸­å“ªä¸ªåƒç´ ä¸ºå®ƒæä¾›é¢œè‰²ã€‚</li>
</ul>
<p><strong>å¿…é¡»ä¸ºè¦æ·»åŠ çº¹ç†çš„å¯¹è±¡ä¸­æ¯ä¸ªé¡¶ç‚¹æä¾›çº¹ç†åæ ‡ã€‚</strong></p>
<p>è®¾ç½®ä¸¤ä¸ªç¼“å†²åŒºï¼Œä¸€ä¸ªç”¨äºé¡¶ç‚¹åæ ‡ï¼Œå¦ä¸€ä¸ªç”¨äºçº¹ç†åæ ‡ã€‚æ¯æ¬¡è°ƒç”¨é¡¶ç‚¹ç€è‰²å™¨ä¼šæ¥æ”¶åˆ°ä¸¤ç»„åæ ‡ã€‚</p>
<p>2D çº¹ç†å›¾åƒè¢«è®¾å®šä¸ºçŸ©å½¢ï¼Œå·¦ä¸‹è§’åæ ‡ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0,0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>ï¼Œå³ä¸Šè§’åæ ‡ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œæ•…çº¹ç†åæ ‡å–å€¼åŒºé—´ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ã€‚</p>
<p>ç”±äºä¹‹å‰æ¸²æŸ“çš„ç«‹æ–¹ä½“æ¨¡å‹éƒ½æ˜¯ç”±ä¸‰è§’å½¢æ„æˆï¼Œæ¯ä¸ªé¢éœ€è¦ä¸¤ä¸ªä¸‰è§’å½¢ã€‚</p>
<p><em>å¯¹äºç«‹æ–¹ä½“æˆ–å››æ£±é”¥è¿™æ ·çš„ç®€å•æ¨¡å‹ï¼Œé€‰æ‹©çº¹ç†åæ ‡ç›¸å¯¹å®¹æ˜“ã€‚ä½†å¯¹äºå…·æœ‰å¤§é‡ä¸‰è§’å½¢çš„æ›´å¤æ‚çš„å¼¯æ›²æ¨¡å‹ï¼Œæ‰‹åŠ¨ç¡®å®šå®ƒä»¬æ˜¯ä¸åˆ‡å®é™…çš„ã€‚åœ¨å¼¯æ›²çš„å‡ ä½•å½¢çŠ¶ï¼ˆä¾‹å¦‚çƒå½¢æˆ–ç¯é¢ï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ç®—æ³•æˆ–æ•°å­¦æ–¹å¼è®¡ç®—çº¹ç†åæ ‡ã€‚ä½¿ç”¨ Maya æˆ– Blender ç­‰å»ºæ¨¡å·¥å…·æ„å»ºæ¨¡å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œUV æ˜ å°„â€åŠŸèƒ½ï¼Œä½¿å¾—ç¡®å®šçº¹ç†åæ ‡çš„ä»»åŠ¡æ›´å®¹æ˜“å®Œæˆ</em></p>
<h3 id="5-3-æ„å»ºä¸€ä¸ªå¸¦çº¹ç†çš„å››æ£±é”¥">5.3 æ„å»ºä¸€ä¸ªå¸¦çº¹ç†çš„å››æ£±é”¥</h3>
<ol>
<li>é¦–å…ˆåˆ›å»ºçº¹ç†å¯¹è±¡ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLuint textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;texture.jpg&quot;</span>);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ¥ç€æ„å»ºçº¹ç†åæ ‡ï¼š
<ul>
<li>å››æ£±é”¥å…·æœ‰äº”ä¸ªé¢ï¼Œç”±6ä¸ªä¸‰è§’å½¢ç»„æˆï¼Œæ¯ä¸ªä¸‰è§’å½¢æœ‰3ä¸ªé¡¶ç‚¹ï¼Œå…±18ä¸ªé¡¶ç‚¹</li>
<li>ä½¿å›¾åƒçš„é¡¶éƒ¨ä¸­å¿ƒå¯¹åº”å››æ£±é”¥çš„é¡¶ï¼ˆç®€å•åœ°è´´ä¸Šå»ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_texture.jpg" alt="çº¹ç†è´´å›¾"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> textures[<span class="number">36</span>] = &#123;</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">    <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">    <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç„¶åå°†çº¹ç†è½½å…¥ç¼“å†²åŒºï¼šè½½å…¥ç¼“å†²åŒº1ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(textures), textures, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†ï¼šé‡‡æ ·å™¨å˜é‡å’Œçº¹ç†å•å…ƒã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œåœ¨ç¡¬ä»¶ä¸­æ‰§è¡Œçº¹ç†å¤„ç†ã€‚åˆ™éœ€è¦é€šè¿‡ç»Ÿä¸€é‡‡æ ·å™¨å˜é‡å®ç°ã€‚
<ul>
<li>ç»Ÿä¸€é‡‡æ ·å™¨å˜é‡ï¼šæŒ‡ç¤ºæ˜¾å¡ä¸Šçš„çº¹ç†å•å…ƒï¼Œä»åŠ è½½çš„çº¹ç†å¯¹è±¡ä¸­æå–æˆ–é‡‡æ ·çº¹ç†å›¾åƒä¸­çš„åƒç´ ã€‚</li>
</ul>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>layout(binding = 0)</code> è¡¨ç¤ºé‡‡æ ·å™¨å˜é‡ <code>samp</code> çš„ç»‘å®šç¬¬0ä¸ªçº¹ç†å•å…ƒã€‚</p>
</li>
<li>
<p>å¯ç”¨çº¹ç†å•å…ƒçš„æ•°é‡å–å†³äºæ˜¾å¡æä¾›çš„æ•°é‡ã€‚</p>
</li>
</ul>
<ol start="5">
<li>
<p>åœ¨ <code>display()</code> å‡½æ•°ä¸­ï¼Œè°ƒç”¨ <code>glActiveTexture()</code> å‡½æ•°æ¿€æ´»çº¹ç†å•å…ƒå¹¶è°ƒç”¨ <code>glBindTexture()</code> å‡½æ•°å°†çº¹ç†å•å…ƒç»‘å®šåˆ°ç‰¹å®šçš„çº¹ç†å¯¹è±¡ã€‚</p>
<ul>
<li>ä»£ç ä¸­ä½¿ç”¨ <code>GL_TEXTURE0</code> è®©ç¬¬0ä¸ªçº¹ç†å•å…ƒå¤„äºæ¿€æ´»çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>
<p>ç‰‡æ®µç€è‰²å™¨ä¸­ä½¿ç”¨é¡¶ç‚¹ç€è‰²å™¨æ¥æ”¶çš„æ’å€¼çº¹ç†åæ ‡æ¥å¯¹çº¹ç†å¯¹è±¡è¿›è¡Œé‡‡æ ·ï¼š</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in vec2 tc;</span><br><span class="line">â€¦â€¦</span><br><span class="line">color = <span class="built_in">texture</span>(samp, tc);</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_pyramidwithtexture.jpg" alt="å¸¦çº¹ç†çš„å››æ£±é”¥"></p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID[<span class="number">2</span>];</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line">std::stack&lt;glm::mat4&gt; matrixStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> pyramidVertexs[<span class="number">54</span>] = &#123;</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> textures[<span class="number">36</span>] = &#123;</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(pyramidVertexs), pyramidVertexs, GL_STATIC_DRAW);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(textures), textures, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">1.5f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">    textureID[<span class="number">0</span>] = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;brick1.jpg&quot;</span>);</span><br><span class="line">    textureID[<span class="number">1</span>] = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">        mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(i * <span class="number">3.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        <span class="comment">// æ—‹è½¬å±•ç¤ºå„ä¸ªé¢</span></span><br><span class="line">        mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">-0.45f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">0.61f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">0.00f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">        mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">        <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">        <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID[i]);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">        <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Pyramid with texture&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>Util.h</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> GLuint <span class="title">loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>Util.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä»æ–‡ä»¶ä¸­è¯»å– GLSL ä»£ç </span></span><br><span class="line"><span class="comment">* @param path æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">    std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">        content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fileStream.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL ä»£ç ç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param shader ç€è‰²å™¨æ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL é“¾æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param program ç€è‰²å™¨ç¨‹åºæ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ£€æŸ¥ OpenGL é”™è¯¯æ ‡å¿—ï¼Œå³æ˜¯å¦å‘ç”Ÿ OpenGL é”™è¯¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    <span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        err = <span class="literal">true</span>;</span><br><span class="line">        glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* åˆ›å»ºç€è‰²å™¨ç¨‹åº</span></span><br><span class="line"><span class="comment">* @param vpath é¡¶ç‚¹ç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">* @param fpath ç‰‡æ®µç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">    <span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å­˜å…¥ vShader å’Œ fShader å˜é‡</span></span><br><span class="line">    GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">    GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† GLSL ä»£ç ä»å­—ç¬¦ä¸²è½½å…¥ç©ºç€è‰²å™¨å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">    <span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">    <span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">    <span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">    <span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vProgram; <span class="comment">// è¿”å›ç€è‰²å™¨ç¨‹åºID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä»æ–‡ä»¶ä¸­è¯»å–çº¹ç†å›¾åƒå¹¶è¿”å›çº¹ç† ID</span></span><br><span class="line"><span class="comment">* @param imgPath å›¾åƒæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLuint textureID;</span><br><span class="line">    textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">    <span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>vertex.glsl</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">    tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>fragment.glsl</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="5-4-å¤šçº§æ¸è¿œçº¹ç†è´´å›¾">5.4 å¤šçº§æ¸è¿œçº¹ç†è´´å›¾</h3>
<p>çº¹ç†è´´å›¾ç»å¸¸ä¼šåœ¨æ¸²æŸ“å›¾åƒä¸­å¯¼è‡´å„ç§ä¸åˆ©çš„ä¼ªå½±ã€‚</p>
<ul>
<li>è¿™æ˜¯å› ä¸ºçº¹ç†å›¾åƒçš„åˆ†è¾¨ç‡æˆ–é•¿å®½æ¯”å¾ˆå°‘ä¸è¢«çº¹ç†è´´å›¾çš„åœºæ™¯ä¸­åŒºåŸŸçš„åˆ†è¾¨ç‡æˆ–é•¿å®½æ¯”åŒ¹é…ã€‚</li>
</ul>
<ol>
<li>
<p>å½“å›¾åƒåˆ†è¾¨ç‡å°äºæ‰€ç»˜åˆ¶åŒºåŸŸçš„åˆ†è¾¨ç‡æ—¶ï¼Œä¼šå‡ºç°ä¸€ç§å¾ˆå¸¸è§çš„ä¼ªå½±ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ‹‰ä¼¸å›¾åƒä»¥è¦†ç›–æ•´ä¸ªåŒºåŸŸï¼Œè¿™æ ·å›¾åƒå°±ä¼šå˜å¾—æ¨¡ç³Šï¼ˆå¹¶ä¸”å¯èƒ½å˜å½¢ï¼‰ã€‚</p>
<ul>
<li>æ ¹æ®çº¹ç†çš„æ€§è´¨ï¼Œæœ‰æ—¶å¯ä»¥é€šè¿‡æ”¹å˜çº¹ç†åæ ‡åˆ†é…æ–¹å¼æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Œä½¿å¾—çº¹ç†éœ€è¦è¾ƒå°‘çš„æ‹‰ä¼¸ã€‚</li>
<li>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ›´é«˜åˆ†è¾¨ç‡çš„çº¹ç†å›¾åƒã€‚</li>
</ul>
</li>
<li>
<p>ç›¸åçš„æƒ…å†µæ˜¯å›¾åƒçº¹ç†çš„åˆ†è¾¨ç‡å¤§äºè¢«ç»˜åˆ¶åŒºåŸŸçš„åˆ†è¾¨ç‡ã€‚</p>
<ul>
<li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°æ˜æ˜¾çš„å å½±ï¼Œä»è€Œäº§ç”Ÿå¥‡æ€ªçš„é”™è¯¯å›¾æ¡ˆï¼Œæˆ–ç§»åŠ¨ç‰©ä½“ä¸­çš„â€œé—ªçƒâ€æ•ˆæœã€‚</li>
<li>å å½±æ˜¯ç”±é‡‡æ ·é”™è¯¯å¼•èµ·çš„ã€‚</li>
</ul>
</li>
</ol>
<p>ä½¿ç”¨å¤šçº§æ¸è¿œçº¹ç†è´´å›¾å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸ŠçŸ«æ­£é‡‡æ ·è¯¯å·®ä¼ªå½±ã€‚</p>
<ul>
<li>ä½¿ç”¨å„ç§åˆ†è¾¨ç‡åˆ›å»ºçº¹ç†å›¾åƒçš„ä¸åŒç‰ˆæœ¬ã€‚</li>
<li>è¢«è´´å›¾çš„åŒºåŸŸä½¿ç”¨æœ€é€‚åˆçš„åˆ†è¾¨ç‡çš„çº¹ç†å›¾åƒã€‚</li>
</ul>
<p>å¤šçº§æ¸è¿œçº¹ç†è´´å›¾çš„æœºåˆ¶ï¼š</p>
<ul>
<li>å®ƒåœ¨çº¹ç†å›¾åƒä¸­å­˜å‚¨ç›¸åŒå›¾åƒçš„è¿ç»­çš„ä¸€ç³»åˆ—è¾ƒä½åˆ†è¾¨ç‡çš„å‰¯æœ¬ã€‚</li>
<li>æ‰€ç”¨çš„çº¹ç†å›¾åƒæ¯”åŸå§‹å›¾åƒå¤§ 1/3ï¼Œå…¶ä¸­å›¾åƒçš„ RGB å€¼åˆ†åˆ«å­˜å‚¨åœ¨çº¹ç†å›¾åƒç©ºé—´çš„ 3 ä¸ª 1/4 åŒºåŸŸä¸­æ¥å®ç°çš„ã€‚</li>
<li>å‰©ä½™çš„ 1/4 åŒºåŸŸä¸­è¿­ä»£åœ°å°†å›¾åƒåˆ†è¾¨ç‡è®¾ç½®ä¸ºåŸæ¥çš„ 1/4ï¼Œç›´åˆ°å‰©ä½™åŒºåŸŸå¤ªå°è€Œä¸åŒ…å«ä»»ä½•æœ‰ç”¨çš„å›¾åƒæ•°æ®ã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Multileveltexture.jpg" alt="å¤šçº§æ¸è¿œçº¹ç†è´´å›¾ç¤ºä¾‹ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"></p>
<p>ä½¿ç”¨ä»£ç è¿›è¡Œæ„å»ºå¤šçº§æ¸è¿œçº¹ç†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// â€¦â€¦</span></span><br><span class="line"><span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line"><span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line"><span class="comment">// â€¦â€¦</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºå‡½æ•° <code>glTexparameteri()</code> å…¶ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºæ‰€éœ€çš„ç¼©å°æ–¹æ³•æ¥é€‰æ‹©å¤šçº§æ¸è¿œçº¹ç†çš„é‡‡æ ·æ–¹æ³•ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>GL_NEAREST_MIPMAP_NEAREST</code>ï¼šé€‰æ‹©å…·æœ‰ä¸çº¹ç†åæ ‡å¯¹åº”çš„çº¹ç†å›¾åƒåƒç´ åŒºåŸŸæœ€ç›¸ä¼¼çš„åˆ†è¾¨ç‡çš„å¤šçº§æ¸è¿œçº¹ç†ï¼Œè·å–æ‰€éœ€çº¹ç†åæ ‡çš„æœ€è¿‘çš„çº¹ç†å›¾åƒåƒç´ ã€‚</li>
<li><code>GL_LINEAR_MIPMAP_NEAREST</code>ï¼šé€‰æ‹©å…·æœ‰ä¸çº¹ç†åæ ‡å¯¹åº”çš„çº¹ç†å›¾åƒåƒç´ åŒºåŸŸæœ€ç›¸ä¼¼çš„åˆ†è¾¨ç‡çš„å¤šçº§æ¸è¿œçº¹ç†ï¼Œè·å–æœ€æ¥è¿‘çº¹ç†åæ ‡çš„4ä¸ªçº¹ç†å›¾åƒåƒç´ çš„æ’å€¼ã€‚</li>
<li><code>GL_NEAREST_MIPMAP_LINEAR</code>ï¼šé€‰æ‹©å…·æœ‰ä¸çº¹ç†åæ ‡å¯¹åº”çš„çº¹ç†å›¾åƒåƒç´ åŒºåŸŸæœ€ç›¸ä¼¼çš„åˆ†è¾¨ç‡çš„2ä¸ªå¤šçº§æ¸è¿œçº¹ç†ï¼Œä»æ¯ä¸ªå¤šçº§æ¸è¿œçº¹ç†è·å–çº¹ç†åæ ‡çš„æœ€è¿‘çš„çº¹ç†å›¾åƒåƒç´ è¿›è¡Œæ’å€¼ã€‚</li>
<li><code>GL_LINEAR_MIPMAP_LINEAR</code>ï¼šé€‰æ‹©å…·æœ‰ä¸çº¹ç†åæ ‡å¯¹åº”çš„çº¹ç†å›¾åƒåƒç´ åŒºåŸŸæœ€ç›¸ä¼¼çš„åˆ†è¾¨ç‡çš„2å¤šä¸ªæ¸è¿œçº¹ç†ï¼Œä»æ¯å¤šä¸ªæ¸è¿œçº¹ç†è·å–æœ€æ¥è¿‘çº¹ç†åæ ‡çš„4ä¸ªçº¹ç†å›¾åƒåƒç´ è¿›è¡Œæ’å€¼ï¼Œåˆç§°ä¸ºâ€œä¸‰çº¿æ€§è¿‡æ»¤â€ã€‚</li>
</ul>
<p>é€šå¸¸é€‰æ‹©ä¸‰çº¿æ€§è¿‡æ»¤ã€‚</p>
<p><em>å¯¹äºç‰¹æ®Šçš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•å›¾åƒç¼–è¾‘è½¯ä»¶è‡ªè¡Œæ„å»ºå¤šçº§æ¸è¿œçº¹ç†ï¼Œç„¶åé€šè¿‡ä¸ºæ¯ä¸ªå¤šçº§æ¸è¿œçº¹ç†çº§åˆ«é‡å¤è°ƒç”¨ OpenGL çš„ <code>glTexImage2D()</code> å‡½æ•°æ¥åˆ›å»ºçº¹ç†å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ ä¸ºå¤šçº§æ¸è¿œçº¹ç†çº§åˆ«</em></p>
<h3 id="5-5-å„å‘å¼‚æ€§è¿‡æ»¤">5.5 å„å‘å¼‚æ€§è¿‡æ»¤</h3>
<p>å¤šçº§æ¸è¿œçº¹ç†è´´å›¾æœ‰æ—¶çœ‹èµ·æ¥æ¯”éå¤šçº§æ¸è¿œçº¹ç†è´´å›¾æ›´æ¨¡ç³Šã€‚</p>
<ul>
<li>è¿™ç§ç»†èŠ‚çš„ä¸¢å¤±æ˜¯å› ä¸ºå½“ç‰©ä½“å€¾æ–œæ—¶ï¼Œå…¶å›¾å…ƒçœ‹èµ·æ¥åœ¨ä¸€ä¸ªè½´ï¼ˆå³æ²¿å®½æˆ–é«˜ï¼‰ä¸Šçš„å°ºå¯¸æ¯”åœ¨å¦ä¸€ä¸ªè½´ä¸Šæ›´å°ã€‚</li>
<li>å½“ OpenGL ä¸ºå›¾å…ƒè´´å›¾æ—¶ï¼Œå®ƒé€‰æ‹©é€‚åˆä¸¤ä¸ªè½´ä¸­å°ºå¯¸è¾ƒå°çš„è½´çš„å¤šçº§æ¸è¿œçº¹ç†ï¼‰ã€‚</li>
</ul>
<p>å¯ä»¥é€šè¿‡å„å‘å¼‚æ€§è¿‡æ»¤æ¢å¤ä¸€äº›ä¸¢å¤±çš„ç»†èŠ‚ã€‚</p>
<ul>
<li>å„å‘å¼‚æ€§è¿‡æ»¤æ¯”æ ‡å‡†å¤šçº§æ¸è¿œçº¹ç†è´´å›¾çš„è®¡ç®—ä»£ä»·æ›´é«˜ï¼Œå¹¶ä¸”ä¸æ˜¯ OpenGL çš„å¿…éœ€éƒ¨åˆ†ã€‚</li>
</ul>
<p>åªéœ€æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">    <span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>if</code> åˆ¤æ–­æµ‹è¯•æ˜¾å¡æ˜¯å¦æ”¯æŒå„å‘å¼‚æ€§è¿‡æ»¤ã€‚å¦‚æœæ”¯æŒï¼Œåˆ™è®¾ç½®ä¸ºæ”¯æŒçš„æœ€å¤§é‡‡æ ·ç¨‹åº¦ï¼Œç”± <code>glGetFloatv()</code> å‡½æ•°è·å–ã€‚</li>
<li>ä½¿ç”¨ <code>glTexParameterf()</code> å‡½æ•°æ¿€æ´»å¹¶è®¾ç½®çº¹ç†çš„å„å‘å¼‚æ€§é‡‡æ ·å€¼ã€‚</li>
</ul>
<h3 id="5-6-ç¯ç»•å’Œå¹³é“º">5.6 ç¯ç»•å’Œå¹³é“º</h3>
<p>å½“çº¹ç†åæ ‡è¶…å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>glTexParameteri()</code> å‡½æ•°è®¾ç½®ï¼š</p>
<ul>
<li><code>GL_REPEAT</code>ï¼šé‡å¤çº¹ç†å›¾åƒï¼Œå¿½ç•¥çº¹ç†åæ ‡çš„æ•´æ•°éƒ¨åˆ†ï¼Œç”Ÿæˆé‡å¤æˆ–å¹³é“ºçš„å›¾æ¡ˆï¼Œè¿™æ˜¯é»˜è®¤é€‰é¡¹ã€‚</li>
<li><code>GL_MIRRORED_REPEAT</code>ï¼šé‡å¤çº¹ç†å›¾åƒï¼Œå¿½ç•¥çº¹ç†åæ ‡çš„æ•´æ•°éƒ¨åˆ†ï¼Œä½†æ˜¯å½“æ•´æ•°éƒ¨åˆ†ä¸ºå¥‡æ•°æ—¶åè½¬åæ ‡ï¼Œé‡å¤çš„å›¾æ¡ˆåœ¨åŸå›¾æ¡ˆå’Œå…¶é•œåƒå›¾æ¡ˆä¹‹é—´äº¤æ›¿ã€‚</li>
<li><code>GL_CLAMP_TO_EDGE</code>ï¼šå°†çº¹ç†åæ ‡é™åˆ¶åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> ä¹‹é—´ï¼Œå°äº0çš„åæ ‡è®¾ç½®ä¸º0ï¼Œå¤§äº1çš„åæ ‡è®¾ç½®ä¸º1ã€‚</li>
<li><code>GL_CLAMP_TO_BORDER</code>ï¼šå°†çº¹ç†åæ ‡é™åˆ¶åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> ä¹‹é—´ï¼ŒåŒºé—´ä»¥å¤–è®¾ç½®ä¸ºæŒ‡å®šçš„è¾¹æ¡†é¢œè‰²ã€‚</li>
</ul>
<p>ä»£ç ä¸Šï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ä¸ºé‡å¤</span></span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ä¸º <code>GL_CLAMP_TO_BORDER</code>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);</span><br><span class="line"><span class="type">float</span> redColor[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="built_in">glTexParameterfv</span>(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, redColor);</span><br></pre></td></tr></table></figure>
<h3 id="5-7-é€è§†å˜å½¢">5.7 é€è§†å˜å½¢</h3>
<p>åœ¨çº¹ç†åæ ‡çš„æƒ…å†µä¸‹ï¼Œçº¿æ€§æ’å€¼å¯èƒ½å¯¼è‡´åœ¨å…·æœ‰é€è§†æŠ•å½±çš„ 3D åœºæ™¯ä¸­å‡ºç°æ˜æ˜¾çš„å¤±çœŸã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_distortion.jpg" alt="å¤±çœŸï¼ˆå·¦ï¼‰ï¼Œçº æ­£ï¼ˆå³ï¼‰ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenGL åœ¨æ …æ ¼åŒ–æœŸé—´ä¼šåº”ç”¨é€è§†æ ¡æ­£ç®—æ³•ã€‚</p>
<ul>
<li>å¯ä»¥åœ¨é¡¶ç‚¹å±æ€§ä¸­æ·»åŠ å…³é”®å­— <code>noperspective</code> æ¥ç¦ç”¨é€è§†æ ¡æ­£ã€‚</li>
<li>é¡¶ç‚¹ç€è‰²å™¨ï¼š<code>noperspective out vec2 texCoord;</code></li>
<li>ç‰‡æ®µç€è‰²å™¨ï¼š<code>noperspective in vec2 texCoord;</code></li>
</ul>
<h3 id="5-8-æè´¨çš„æ›´å¤šç»†èŠ‚">5.8 æè´¨çš„æ›´å¤šç»†èŠ‚</h3>
<p>å¯ä»¥ä½¿ç”¨ C++ å’Œ OpenGL å‡½æ•°ç›´æ¥å°†çº¹ç†å›¾åƒæ–‡ä»¶æ•°æ®åŠ è½½åˆ° OpenGL ä¸­ï¼ˆä¸é€‚ç”¨ SOIL2 åº“ï¼‰ï¼š</p>
<ol>
<li>ä½¿ç”¨ C++ å·¥å…·è¯»å–å›¾åƒæ–‡ä»¶æ•°æ®ã€‚
<ul>
<li>C++ å‡½æ•° <code>fopen()</code>ã€<code>fread()</code>ã€‚</li>
</ul>
</li>
<li>ç”Ÿæˆ OpenGL çº¹ç†å¯¹è±¡ã€‚
<ul>
<li>ä½¿ç”¨ <code>glGenTextures()</code> å‡½æ•°ç”Ÿæˆçº¹ç†å¯¹è±¡ã€‚</li>
<li><code>glGenTextures(1, &amp;textureID);</code></li>
</ul>
</li>
<li>å°†å›¾åƒæ–‡ä»¶æ•°æ®å¤åˆ¶åˆ°çº¹ç†å¯¹è±¡ä¸­ã€‚
<ul>
<li>
<p>ä½¿ç”¨ <code>glTexImage2D()</code> å‡½æ•°å°†å›¾åƒæ–‡ä»¶æ•°æ®å¤åˆ¶åˆ°çº¹ç†å¯¹è±¡ä¸­ã€‚</p>
</li>
<li>
<p><code>data</code> ä¸ºå›¾åƒæ–‡ä»¶æ•°æ®ï¼Œæ•°æ®ç±»å‹ä¸º <code>unsigned char</code>ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GLuint textureID;</span><br><span class="line"><span class="built_in">glGenTextures</span>(<span class="number">1</span>, &amp;textureID);</span><br><span class="line"><span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"><span class="built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="number">0</span>, GL_RGB, width, height, <span class="number">0</span>, GL_RGB, GL_UNSIGNED_BYTE, data);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="å…­-3dæ¨¡å‹">å…­ã€3Dæ¨¡å‹</h2>
<p>å¯¹äºå››æ£±é”¥å’Œç«‹æ–¹ä½“ï¼Œå¯ä»¥é€šè¿‡åœ¨OpenGLä¸­ä½¿ç”¨é¡¶ç‚¹æ•°ç»„æ¥åˆ›å»ºã€‚ä½†æ˜¯å¤§éƒ¨åˆ† 3D åœºæ™¯å¯¹è±¡éƒ½æ¯”è¾ƒå¤æ‚ï¼Œæ— æ³•æ‰‹åŠ¨æ„å»ºé¡¶ç‚¹æ•°ç»„ã€‚</p>
<p>å¯¹äºæ›´ä¸ºå¤æ‚çš„æ¨¡å‹ï¼Œæ­¤å¤„å…³æ³¨ï¼š</p>
<ul>
<li>é€šè¿‡ç¨‹åºæ¥æ„å»ºæ¨¡å‹</li>
<li>åŠ è½½å¤–éƒ¨åˆ›å»ºçš„æ¨¡å‹</li>
</ul>
<h3 id="6-1-ç¨‹åºæ„å»ºæ¨¡å‹">6.1 ç¨‹åºæ„å»ºæ¨¡å‹</h3>
<h4 id="6-1-1-æ„å»ºä¸€ä¸ªçƒä½“">6.1.1 æ„å»ºä¸€ä¸ªçƒä½“</h4>
<p>åƒåœ†ã€çƒä½“ç­‰å…·æœ‰æ•°å­¦å®šä¹‰ï¼Œå…¶é¡¶ç‚¹æ•°ç»„å¯ä»¥é€šè¿‡æ•°å­¦è®¡ç®—è€Œç”Ÿæˆã€‚</p>
<p>å»ºç«‹ä¸€ä¸ªçƒä½“æ¨¡å‹ï¼š</p>
<ol>
<li>é€‰æ‹©æ¨¡å‹ç²¾åº¦ï¼šä¸€ä¸ªè¡¨ç¤ºå°†çƒä½“åˆ†æˆç›¸åº”ä»½æ•°çš„åœ†å½¢éƒ¨åˆ†çš„æ•°å­—ï¼Œä½“ç°ä¸ºåˆ‡ç‰‡æ•°ã€‚</li>
<li>å°†æ¯ä¸ªåœ†å½¢åˆ‡ç‰‡çš„åœ†å‘¨ç»†åˆ†è‹¥å¹²ä¸ªç‚¹ï¼Œæ­¤å¤„æ¯ä¸ªåˆ‡ç‰‡å…·æœ‰ç›¸åŒæ•°é‡çš„ç‚¹ã€‚</li>
<li>å°†é¡¶ç‚¹åˆ†ç»„ä¸ºä¸‰è§’å½¢ï¼šé€æ­¥éå†é¡¶ç‚¹ï¼Œåœ¨æ¯ä¸€æ­¥æ„å»ºä¸¤ä¸ªä¸‰è§’å½¢ã€‚</li>
</ol>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_group.jpg" alt="å°†é¡¶ç‚¹ç»„åˆæˆä¸‰è§’å½¢"></p>
<ol start="4">
<li>æ ¹æ®çº¹ç†å›¾åƒçš„æ€§è´¨é€‰æ‹©çº¹ç†åæ ‡ã€‚å¯¹äºçƒä½“ï¼Œæƒ³è±¡è®©çº¹ç†å›¾åƒå›´ç»•çƒä½“åŒ…è£¹ï¼Œå¯ä»¥æ ¹æ®å›¾åƒä¸­åƒç´ çš„æœ€ç»ˆå¯¹åº”ä½ç½®ä¸ºæ¯ä¸ªé¡¶ç‚¹æŒ‡å®šçº¹ç†åæ ‡ã€‚</li>
<li>å¯¹äºæ¯ä¸ªé¡¶ç‚¹ï¼Œè¿˜åº”è¯¥ç”Ÿæˆæ³•å‘é‡ï¼Œç”¨äºå…‰ç…§ã€‚</li>
</ol>
<p>åœ¨ç¬¬3ç‚¹ä¸­ï¼Œå­˜åœ¨é¡¶ç‚¹å‡ºç°åœ¨å¤šä¸ªä¸‰è§’å½¢ä¸­ï¼Œå¯¼è‡´æ¯ä¸ªé¡¶ç‚¹è¢«å¤šæ¬¡æŒ‡å®šï¼Œè¿™å¯¹ç¨‹åºä¸åˆ©ã€‚ä»…å­˜å‚¨æ¯ä¸ªé¡¶ç‚¹ä¸€æ¬¡ï¼Œç„¶åä¸ºä¸‰è§’å½¢çš„æ¯ä¸ªè§’æŒ‡å®šç´¢å¼•ï¼Œå¼•ç”¨æ‰€éœ€çš„é¡¶ç‚¹ã€‚</p>
<ul>
<li>éœ€è¦å­˜å‚¨æ¯ä¸ªé¡¶ç‚¹çš„ä½ç½®ã€çº¹ç†åæ ‡å’Œæ³•å‘é‡ã€‚
<ul>
<li>é¡¶ç‚¹å­˜å‚¨åœ¨ä¸€ç»´æ•°ç»„ä¸­ï¼Œä»æœ€ä¸‹é¢çš„æ°´å¹³åˆ‡ç‰‡å¼€å§‹ã€‚</li>
<li>ç´¢å¼•æ•°ç»„åŒ…å«ç›¸åº”ä¸‰è§’å½¢çš„æ¯ä¸ªè§’ï¼Œå°†å€¼è®¾ä¸ºé¡¶ç‚¹æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_index.png" alt="é¡¶ç‚¹æ•°ç»„å’Œç´¢å¼•æ•°ç»„"></p>
<p>ç„¶åï¼Œä»çƒä½“åº•éƒ¨å¼€å§‹ï¼Œå›´ç»•æ¯ä¸ªæ°´å¹³åˆ‡ç‰‡ä»¥åœ†å½¢æ–¹å¼éå†é¡¶ç‚¹ã€‚è®¿é—®æ¯ä¸ªé¡¶ç‚¹æ—¶ï¼Œæ„å»ºä¸¤ä¸ªä¸‰è§’å½¢ï¼Œåœ¨å…¶å³ä¸Šæ–¹å½¢æˆä¸€ä¸ªæ–¹å½¢åŒºåŸŸã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// slices ä¸ºåˆ‡ç‰‡æ•°ï¼Œä¹Ÿæ˜¯ç²¾åº¦</span></span><br><span class="line"><span class="comment">// vertexs ä¸ºæ¯ä¸ªæ°´å¹³åˆ‡ç‰‡çš„é¡¶ç‚¹æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; slices; i++) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; vertexs; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—é¡¶ç‚¹jçš„æŒ‡å‘å³è¾¹ç›¸é‚»é¡¶ç‚¹ã€ä¸Šæ–¹é¡¶ç‚¹</span></span><br><span class="line">        <span class="comment">// ä»¥åŠå³ä¸Šæ–¹é¡¶ç‚¹çš„ä¸¤ä¸ªä¸‰è§’å½¢çš„ç´¢å¼•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç´¢å¼•æ•°ç»„ä¹ŸåŠ è½½åˆ° VBO ä¸­ï¼ŒæŒ‡å®š VBO çš„ç±»å‹ä¸º <code>GL_ELEMENT_ARRAY_BUFFER</code>ï¼ˆè¿™ä¼šå‘Šè¯‰ OpenGL è¿™ä¸ª VBO åŒ…å«ç´¢å¼•ï¼‰ã€‚</p>
<ul>
<li>åœ¨ <code>display()</code> ä¸­ï¼š
<ul>
<li>å°† <code>glDrawArrays()</code> è°ƒç”¨æ›¿æ¢ä¸º  <code>glDrawElements()</code> è°ƒç”¨ï¼Œå®ƒä¼šå‘Šè¯‰ OpenGLåˆ©ç”¨ç´¢å¼• VBO æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹ã€‚</li>
<li>è¿˜éœ€è¦ä½¿ç”¨ <code>glBindBuffer()</code> å¯ç”¨åŒ…å«ç´¢å¼•çš„ VBOï¼ŒæŒ‡å®šå“ªä¸ª VBO åŒ…å«ç´¢å¼•å¹¶ä¸”ä¸º <code>GL_ELEMENT_ARRAY_BUFFER</code> ç±»å‹ã€‚</li>
</ul>
</li>
</ul>
<p>ç¼–å†™ç±» <code>Sphere</code>ï¼Œç”¨äºåˆ›å»ºçƒä½“æ¨¡å‹ï¼Œçƒä½“ä¸­å¿ƒä½äºåŸç‚¹ã€‚</p>
<ul>
<li>
<p>é¡¶ç‚¹å­˜å‚¨åœ¨ <code>GLM</code> ä¸­çš„ <code>vec2</code> å’Œ <code>vec3</code> ç¤ºä¾‹çš„ <code>std::vector</code> ä¸­ã€‚</p>
</li>
<li>
<p>å› ä¸ºçº¹ç†è´´å›¾å®Œå…¨åŒ…è£¹åœ¨çƒä½“å‘¨å›´ï¼Œæ‰€ä»¥åœ¨çº¹ç†è´´å›¾çš„å·¦å³è¾¹ç¼˜ç›¸äº¤çš„æ¯ä¸ªç‚¹å¤„éœ€è¦ä¸€ä¸ªé¢å¤–çš„é¡¶ç‚¹æ¥ä½¿è´´å›¾ä¸¤ä¾§é‡åˆã€‚</p>
<ul>
<li>é¡¶ç‚¹çš„æ€»æ•°æ˜¯ <code>(prec+1)*(prec+1)</code>ã€‚ç”±äºæ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆ 6 ä¸ªä¸‰è§’å½¢ç´¢å¼•ï¼Œå› æ­¤ç´¢å¼•çš„æ€»æ•°æ˜¯ <code>prec*prec*6</code>ã€‚</li>
<li><code>prec</code> ä¸ºç²¾åº¦ï¼Œä½“ç°åœ¨åˆ‡ç‰‡æ•°ã€‚</li>
</ul>
</li>
</ul>
<p>æ•ˆæœæˆªå›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sphere.jpg" alt="çƒä½“"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function">Sphere <span class="title">sphere</span><span class="params">(<span class="number">48</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; ind = sphere.<span class="built_in">getIndices</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; vert = sphere.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;glm::vec2&gt; tex = sphere.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; norm = sphere.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> numIndices = sphere.<span class="built_in">getNumIndices</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">    textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>));</span><br><span class="line">    mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">    <span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">    <span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">        <span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glDrawElements</span>(GL_TRIANGLES, sphere.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Sphere&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>çƒä½“ç±»</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sphere.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sphere</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numVertices;    <span class="comment">// é¡¶ç‚¹æ•°ç»„å¤§å°</span></span><br><span class="line">    <span class="type">int</span> numIndices;        <span class="comment">// ç´¢å¼•æ•°ç»„å¤§å°</span></span><br><span class="line">    std::vector&lt;glm::vec3&gt; vertices;    <span class="comment">// é¡¶ç‚¹æ•°ç»„</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; indices;            <span class="comment">// ç´¢å¼•æ•°ç»„</span></span><br><span class="line">    std::vector&lt;glm::vec3&gt; normals;        <span class="comment">// æ³•å‘é‡æ•°ç»„</span></span><br><span class="line">    std::vector&lt;glm::vec2&gt; texCoords;    <span class="comment">// çº¹ç†åæ ‡æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Sphere</span>(<span class="type">int</span> prec = <span class="number">48</span>);</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumIndices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">getIndices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sphere.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Sphere::<span class="built_in">Sphere</span>(<span class="type">int</span> prec)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">init</span>(prec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sphere::init</span><span class="params">(<span class="type">int</span> _prec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    numVertices = (_prec + <span class="number">1</span>) * (_prec + <span class="number">1</span>);</span><br><span class="line">    numIndices = _prec * _prec * <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">        indices.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸‰è§’å½¢é¡¶ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= _prec; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= _prec; ++ j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">float</span> y = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(<span class="number">180.0f</span> - i * <span class="number">180.0f</span> / _prec)));</span><br><span class="line">            <span class="type">float</span> x = - <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">            <span class="type">float</span> z = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">sin</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">            vertices[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">            texCoords[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec2</span>(j * <span class="number">1.0f</span> / _prec, i * <span class="number">1.0f</span> / _prec);</span><br><span class="line">            normals[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸‰è§’å½¢ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; _prec; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; _prec; ++ j)</span><br><span class="line">        &#123;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">0</span>] = i * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">1</span>] = i * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">2</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">3</span>] = i * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">4</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">            indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">5</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Sphere::toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> degrees * <span class="number">2.0f</span> * <span class="number">3.14159f</span> / <span class="number">360.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sphere::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sphere::getNumIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numIndices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Sphere::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">Sphere::getIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Sphere::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">Sphere::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">    tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h4 id="6-1-2-æ„å»ºä¸€ä¸ªç¯é¢">6.1.2 æ„å»ºä¸€ä¸ªç¯é¢</h4>
<p>äº§ç”Ÿç¯é¢éœ€è¦ä¸€å®šçš„ç®—æ³•ã€‚</p>
<p>æ„å»ºä¸€ä¸ªç¯é¢å¦‚å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_totorus.jpg" alt="å›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"></p>
<p>å°†ä¸€ä¸ªé¡¶ç‚¹å®šä½åˆ°åŸç‚¹çš„å³ä¾§ï¼Œç„¶ååœ¨ xOy å¹³é¢ä¸Šçš„åœ†ä¸­è®©è¿™ä¸ªé¡¶ç‚¹å›´ç»• z è½´æ—‹è½¬ï¼Œä»¥å½¢æˆâ€œç¯â€ï¼Œæœ€åå°†è¿™ä¸ªç¯â€œå‘å¤–â€ç§»åŠ¨â€œå†…å¾„â€çš„è·ç¦»ã€‚</p>
<p>åœ¨æ„å»ºè¿™äº›é¡¶ç‚¹æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªé¡¶ç‚¹è®¡ç®—çº¹ç†åæ ‡å’Œæ³•å‘é‡ï¼Œè¿˜ä¼šé¢å¤–ä¸ºæ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆä¸ç¯é¢è¡¨é¢ç›¸åˆ‡çš„å‘é‡ï¼ˆç§°ä¸ºåˆ‡å‘é‡ï¼‰ã€‚åœ¨é¡¶ç‚¹åˆ›å»ºä¹‹åï¼Œé€ç¯éå†æ‰€æœ‰é¡¶ç‚¹ï¼Œå¹¶åœ¨æ¯ä¸ªé¡¶ç‚¹ä¸Šç”Ÿæˆä¸¤ä¸ªä¸‰è§’å½¢ã€‚ä¸¤ä¸ªä¸‰è§’å½¢çš„ 6 ä¸ªç´¢å¼•è¡¨çš„ç”Ÿæˆæ–¹å¼å’Œä¹‹å‰çš„çƒä½“ç±»ä¼¼ã€‚</p>
<p>æ•ˆæœæˆªå›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_torus.jpg" alt="ç¯é¢"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="comment">//#include &quot;Sphere.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere sphere(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">torus</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; ind = torus.<span class="built_in">getIndices</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; vert = torus.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;glm::vec2&gt; tex = torus.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; norm = torus.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> numIndices = torus.<span class="built_in">getNumIndices</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">    textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">    <span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-0.5f</span>));</span><br><span class="line">    mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">    <span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">    <span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">        <span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glDrawElements</span>(GL_TRIANGLES, torus.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Torus&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ç¯é¢ç±»</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Torus.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Torus</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numVertices;</span><br><span class="line">    <span class="type">int</span> numIndices;</span><br><span class="line">    <span class="type">int</span> prec;</span><br><span class="line">    <span class="type">float</span> inner, outer;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; indices;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; vertices;</span><br><span class="line">    std::vector&lt;glm::vec2&gt; texCoords;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; normals;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; sTangents;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; tTangents;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Torus</span>(<span class="type">int</span> _prec = <span class="number">48</span>, <span class="type">float</span> _inner = <span class="number">0.5</span>, <span class="type">float</span> _outer = <span class="number">0.2</span>);</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumIndices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">getIndices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getStangents</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getTtangents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Torus.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Torus::<span class="built_in">Torus</span>(<span class="type">int</span> _prec, <span class="type">float</span> _inner, <span class="type">float</span> _outer)</span><br><span class="line">&#123;</span><br><span class="line">    prec = _prec;</span><br><span class="line">    inner = _inner;</span><br><span class="line">    outer = _outer;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Torus::init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    numVertices = (prec + <span class="number">1</span>) * (prec + <span class="number">1</span>);</span><br><span class="line">    numIndices = prec * prec * <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">        indices.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        sTangents.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">        tTangents.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ç¬¬ä¸€ä¸ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec + <span class="number">1</span>; ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float</span> amt = <span class="built_in">toRadians</span>(i * <span class="number">360.0f</span> / prec);</span><br><span class="line">        glm::mat4 rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">        <span class="function">glm::vec3 <span class="title">initPos</span><span class="params">(rMat * glm::vec4(<span class="number">0.0f</span>, outer, <span class="number">0.0f</span>, <span class="number">1.0f</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">        vertices[i] = glm::<span class="built_in">vec3</span>(initPos + glm::<span class="built_in">vec3</span>(inner, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        texCoords[i] = glm::<span class="built_in">vec2</span>(<span class="number">0.0f</span>, <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(i) / prec);</span><br><span class="line"></span><br><span class="line">        rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt + (<span class="number">3.14159f</span> / <span class="number">2.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">        tTangents[i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(<span class="number">0.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">        sTangents[i] = glm::<span class="built_in">vec3</span>(glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>));</span><br><span class="line"></span><br><span class="line">        normals[i] = glm::<span class="built_in">cross</span>(tTangents[i], sTangents[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç¬¬ä¸€ä¸ªç¯ç»•Yè½´æ—‹è½¬ï¼Œå¾—åˆ°å…¶ä»–ç¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> ring = <span class="number">1</span>; ring &lt; prec + <span class="number">1</span>; ++ ring)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec + <span class="number">1</span>; ++ i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">float</span> amt = <span class="built_in">toRadians</span>(ring * <span class="number">360.0f</span> / prec);</span><br><span class="line"></span><br><span class="line">            glm::mat4 rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">            vertices[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(vertices[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">            texCoords[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec2</span>(ring * <span class="number">2.0f</span> / prec, texCoords[i].t);</span><br><span class="line"></span><br><span class="line">            rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">            sTangents[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(sTangents[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">            rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">            tTangents[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(tTangents[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">            rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">            normals[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(normals[i], <span class="number">1.0f</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸‰è§’å½¢ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> ring = <span class="number">0</span>; ring &lt; prec; ++ ring)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec; ++ i)</span><br><span class="line">        &#123;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">0</span>] = ring * (prec + <span class="number">1</span>) + i;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">1</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">2</span>] = ring * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">0</span>] = ring * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">1</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i;</span><br><span class="line">            indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">2</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Torus::toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> degrees * <span class="number">2.0f</span> * <span class="number">3.14159f</span> / <span class="number">360.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Torus::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Torus::getNumIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numIndices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">Torus::getIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">Torus::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getStangents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sTangents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getTtangents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tTangents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“ç»• y è½´æ—‹è½¬ç”Ÿæˆç¯æ—¶ï¼ŒæŒ‡å®šä¸€ä¸ªä» 1 å¼€å§‹å¹¶å¢åŠ åˆ°æŒ‡å®šç²¾åº¦çš„å˜é‡ <code>ring</code>ã€‚ç„¶åå°†çº¹ç†åæ ‡å€¼è®¾ç½®ä¸º <code>ring*2.0/prec</code>ï¼Œä½¿å…¶å–å€¼èŒƒå›´ä¸º 0.0ï½2.0ï¼Œå†å‰é¢æè¿°çš„ï¼Œå°†çº¹ç†çš„å¹³é“ºæ¨¡å¼è®¾ä¸º <code>GL_REPEAT</code>ã€‚è¿ç”¨è¿™ç§æ–¹æ³•çš„ç›®çš„æ˜¯é¿å…çº¹ç†å›¾åƒåœ¨æ°´å¹³æ–¹å‘ä¸Šè¿‡åº¦â€œæ‹‰ä¼¸â€ã€‚åä¹‹ï¼Œå¦‚æœç¡®å®å¸Œæœ›çº¹ç†å®Œå…¨å›´ç»•ç¯é¢æ‹‰ä¼¸ï¼Œåªéœ€ä»çº¹ç†åæ ‡è®¡ç®—ä»£ç ä¸­åˆ é™¤ <code>*2.0</code>ã€‚</li>
</ul>
</details>
<h3 id="6-2-åŠ è½½å¤–éƒ¨æ„å»ºçš„æ¨¡å‹">6.2 åŠ è½½å¤–éƒ¨æ„å»ºçš„æ¨¡å‹</h3>
<p>é€šè¿‡ä¸€äº›å»ºæ¨¡å·¥å…·ä¹Ÿå¯ä»¥æ„å»ºæ¨¡å‹ï¼Œå¦‚ï¼šMayaã€Blenderã€Cinema4Dç­‰ï¼Œè€Œä¸€èˆ¬æ¨¡å‹å¯¼å‡ºä¹Ÿæœ‰è®¸å¤šæ ¼å¼ã€‚æ­¤å¤„ä½¿ç”¨ OBJ æ ¼å¼è¿›è¡Œå¤„ç†ã€‚</p>
<p>OBJ æ–‡ä»¶ä¸­çš„è¡Œä»¥å­—ç¬¦æ ‡ç­¾å¼€å¤´ï¼Œè¡¨æ˜è¯¥è¡Œçš„æ•°æ®ç±»å‹ï¼Œå¸¸è§çš„æ ‡ç­¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>vï¼šå‡ ä½•æ•°æ®ï¼ˆé¡¶ç‚¹ä½ç½®ï¼‰</li>
<li>vtï¼šçº¹ç†åæ ‡</li>
<li>vnï¼šé¡¶ç‚¹æ³•å‘é‡</li>
<li>fï¼šé¢ï¼ˆé€šå¸¸æ˜¯ä¸‰è§’å½¢ä¸­çš„é¡¶ç‚¹ï¼‰<br>
å¯èƒ½è¿˜æœ‰æ ‡ç­¾å­˜å‚¨å¯¹è±¡åç§°ã€ä½¿ç”¨çš„æè´¨ã€æ›²çº¿ã€é˜´å½±å’Œè®¸å¤šå…¶ä»–ç»†èŠ‚ã€‚</li>
</ul>
<p>ä½¿ç”¨ Blender ç»˜åˆ¶ä¸€ä¸ªå››æ£±é”¥ï¼Œå¹¶å¯¼å‡ºä¸º OBJæ–‡ä»¶ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_blender.jpg" alt="Blenderå¯¼å‡ºè®¾ç½®"></p>
<p>ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€ä¸€ä¸ª OBJ æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Pyramidobj.jpg" alt="ç«‹æ–¹ä½“çš„OBJæ–‡ä»¶"></p>
<ul>
<li>ä»¥ <code>#</code> å¼€å¤´çš„æ˜¯ Blender æ·»åŠ çš„æ³¨é‡Šï¼Œå¯ä»¥å¿½ç•¥ã€‚</li>
<li>ä»¥ <code>o</code> å¼€å¤´çš„æ˜¯å¯¹è±¡çš„åç§°ï¼Œå¯¼å…¥æ—¶ä¹Ÿå¯ä»¥å¿½ç•¥ã€‚</li>
<li>ä»¥ <code>s</code> å¼€å¤´è¡¨æ˜ä¸åº”è¯¥å¹³æ»‘å¤„ç†ï¼Œæ­¤å¤„åŒæ ·å¿½ç•¥ã€‚</li>
<li>ä»¥ <code>v</code> å¼€å¤´çš„æ˜¯é¡¶ç‚¹ä½ç½®ï¼Œé¡¶ç‚¹ä½ç½®çš„é¡ºåºæ˜¯ <code>x y z</code>ã€‚æ­¤å¤„æœ‰8ä¸ªé¡¶ç‚¹ï¼ŒåŸç‚¹åœ¨ä¸­å¿ƒã€‚</li>
<li>ä»¥ <code>vt</code> å¼€å¤´çš„æ˜¯å„ç§çº¹ç†åæ ‡ï¼Œçº¹ç†åæ ‡åˆ—è¡¨æ¯”é¡¶ç‚¹åˆ—è¡¨é•¿çš„åŸå› æ˜¯ä¸€äº›é¡¶ç‚¹å‚ä¸äº†å¤šä¸ªä¸‰è§’å½¢çš„æ„å»ºï¼Œå¹¶ä¸”åœ¨è¿™äº›æƒ…å†µä¸‹å¯èƒ½ä½¿ç”¨ä¸åŒçš„çº¹ç†åæ ‡ã€‚</li>
<li>ä»¥ <code>vn</code> å¼€å¤´çš„æ˜¯å„ç§æ³•å‘é‡ï¼Œé€šå¸¸ä¹Ÿæ˜¯æ¯”é¡¶ç‚¹åˆ—è¡¨é•¿ï¼ŒåŸå› åŒä¸Šã€‚</li>
<li>ä»¥ <code>f</code> å¼€å¤´çš„è¡ŒæŒ‡å®šé¢ï¼ˆä¸‰è§’å½¢ï¼‰ã€‚æ¯ä¸ªé¢ï¼ˆä¸‰è§’å½¢ï¼‰å…·æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œç”± <code>/</code> åˆ†éš”ã€‚æ¯ä¸ªå…ƒç´ çš„å€¼åˆ†åˆ«æ˜¯é¡¶ç‚¹åˆ—è¡¨ã€çº¹ç†åæ ‡å’Œæ³•å‘é‡çš„ç´¢å¼•ï¼Œå¦‚ç¬¬ä¸‰ä¸ªé¢æ˜¯ï¼š<code>3/4/3 5/2/3 4/5/3</code>ï¼Œè¡¨æ˜é¡¶ç‚¹åˆ—è¡¨ç¬¬3ä¸ªã€ç¬¬5ä¸ªã€ç¬¬4ä¸ªç»„æˆä¸€ä¸ªé¢ï¼Œç›¸åº”çš„çº¹ç†åæ ‡æ˜¯ç¬¬4é¡¹ã€ç¬¬2é¡¹ã€ç¬¬5é¡¹ï¼Œæ³•å‘é‡ç›¸åŒéƒ½æ˜¯ç¬¬3é¡¹ã€‚</li>
</ul>
<p>OBJ æ ¼å¼çš„æ¨¡å‹å¹¶ä¸è¦æ±‚å…·æœ‰æ³•å‘é‡ï¼Œç”šè‡³çº¹ç†åæ ‡ã€‚</p>
<ul>
<li>å¦‚æœæ¨¡å‹æ²¡æœ‰çº¹ç†åæ ‡å’Œæ³•å‘é‡ï¼Œåˆ™é¢çš„æ•°å€¼å°†ä»…æŒ‡å®šé¡¶ç‚¹ç´¢å¼•ï¼š
<ul>
<li><code>3 5 4</code></li>
</ul>
</li>
<li>å¦‚æœæ¨¡å‹æœ‰çº¹ç†åæ ‡ï¼Œæ²¡æœ‰æ³•å‘é‡ï¼Œåˆ™æ ¼å¼ä¸ºï¼š
<ul>
<li><code>3/4 5/2 4/5</code></li>
</ul>
</li>
<li>å¦‚æœæ¨¡å‹æ²¡æœ‰çº¹ç†åæ ‡ï¼Œæœ‰æ³•å‘é‡ï¼Œåˆ™æ ¼å¼ä¸ºï¼š
<ul>
<li><code>3//3 5//3 4//3</code></li>
</ul>
</li>
</ul>
<p>åœ¨äº’è”ç½‘ä¸Šå¯ä»¥è·å¾—å„ç§èƒ½å¯¼å…¥ OBJ æ¨¡å‹çš„ç¨‹åºï¼Œä½†æ­¤å¤„æ‰‹åŠ¨ç¼–å†™ç¨‹åºè¿›è¡Œç®€å•åœ°å¯¼å…¥ OBJ æ–‡ä»¶ï¼Œå±€é™å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»…æ”¯æŒåŒ…å« 3 ä¸ªé¢å±æ€§å­—æ®µï¼Œå³ä»¥ <code>f #/#/# #/#/# #/#/#</code> çš„å½¢å¼å­˜åœ¨ã€‚</li>
<li>æè´¨æ ‡ç­¾å°†è¢«å¿½ç•¥ã€‚</li>
<li>ä»…æ”¯æŒç”±å•ä¸ªä¸‰è§’å½¢ç½‘æ ¼ç»„æˆçš„ OBJ æ¨¡å‹ã€‚</li>
<li>å‡è®¾æ¯è¡Œä¸Šçš„å…ƒç´ éƒ½åªç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚</li>
<li>æ²¡æœ‰ä½¿ç”¨ä¸Šç´¢å¼•æœºåˆ¶ã€‚</li>
</ul>
<p>å®šä¹‰ä¸¤ä¸ªç±»ï¼ˆç½®äºåŒä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼š</p>
<ul>
<li><code>ModelImporter</code> ç±»ç”¨äºä» OBJ æ–‡ä»¶ä¸­å¯¼å…¥æ¨¡å‹æ•°æ®ã€‚</li>
<li><code>ImportedModel</code> ç±»ç”¨äºä¿å­˜å¹¶æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œç±»ä¼¼äºä¸Šé¢çš„çƒä½“ç±»ã€ç¯é¢ç±»ã€‚</li>
</ul>
<p>å¯¹äºå››æ£±é”¥ï¼ŒåŠ è½½ OBJ ä¸å…ˆå‰æ‰‹åŠ¨æ„å»ºçš„æ¨¡å‹å·®ä¸å¤šã€‚é€šè¿‡ Windows è‡ªå¸¦çš„ 3D æŸ¥çœ‹å™¨ï¼Œå¯ä»¥è·å–ä¸€äº›æ¨¡å‹ï¼ˆæ ¼å¼ä¸º <code>.glb</code> ï¼Œå°†å…¶æ”¾å…¥ Blender ä¸­ï¼Œå†å¯¼å‡ºä¸º OBJ æ–‡ä»¶ï¼‰ã€‚è·å–æ¨¡å‹ååœ¨ OpenGL ç¨‹åºä¸­åŠ è½½ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_unicorn.jpg" alt="ç‹¬è§’å…½æ¨¡å‹"></p>
<p>å¯¼å…¥æ¨¡å‹åï¼Œå¯¹æ¨¡å‹çš„å¤§å°å’Œä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œç§»åŠ¨é€‚åˆçš„ç›¸æœºä½ç½®å¹¶åŠ å…¥æè´¨ï¼Œæœ€åå¦‚å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_iceUnicorn.jpg" alt="å†°ç‹¬è§’å…½"></p>
<p>æ›´å¤šå¯ä»¥è‡ªå·±æ‘¸ç´¢ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere sphere(48);</span></span><br><span class="line"><span class="comment">//Torus torus(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model</span><span class="params">(<span class="string">&quot; Pyramid.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//std::vector&lt;int&gt; ind = model.getIndices(); ä¸ä½¿ç”¨ç´¢å¼•æ•°ç»„</span></span><br><span class="line">    std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> numObjVertices = model.<span class="built_in">getNumVertices</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numObjVertices; ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">    textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">    <span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">    <span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">        <span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model.<span class="built_in">getNumVertices</span>());</span><br><span class="line">    <span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="comment">// glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">    <span class="comment">// glDrawElements(GL_TRIANGLES, torus.getVertices(), GL_UNSIGNED_INT, 0);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Pyramid&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>å¯¼å…¥æ¨¡å‹ç±»</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ImportedModel.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImportedModel</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numVertices;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; vertices;</span><br><span class="line">    std::vector&lt;glm::vec2&gt; texCoords;</span><br><span class="line">    std::vector&lt;glm::vec3&gt; normals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ImportedModel</span>();</span><br><span class="line">    <span class="built_in">ImportedModel</span>(<span class="type">const</span> std::string &amp;filePath);</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelImporter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// OBJ è¯»å–</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; vertVals;</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; stVals;</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; normalVals;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜ä¸ºé¡¶ç‚¹å±æ€§ä»¥ä¾›åç»­ä½¿ç”¨çš„æ•°å€¼</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; triangleVerts;</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; texCoords;</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; normals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModelImporter</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">parseOBJ</span><span class="params">(<span class="type">const</span> std::string &amp;filePath)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ImportedModel.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">ImportedModel::<span class="built_in">ImportedModel</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">ImportedModel::<span class="built_in">ImportedModel</span>(<span class="type">const</span> std::string &amp;filePath)</span><br><span class="line">&#123;</span><br><span class="line">    ModelImporter modelImporter = <span class="built_in">ModelImporter</span>();</span><br><span class="line">    modelImporter.<span class="built_in">parseOBJ</span>(filePath);</span><br><span class="line">    numVertices = modelImporter.<span class="built_in">getNumVertices</span>();</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; verts = modelImporter.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tcs = modelImporter.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nms = modelImporter.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>(verts[i * <span class="number">3</span>], verts[i * <span class="number">3</span> + <span class="number">1</span>], verts[i * <span class="number">3</span> + <span class="number">2</span>]));</span><br><span class="line">        texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>(tcs[i * <span class="number">2</span>], tcs[i * <span class="number">2</span> + <span class="number">1</span>]));</span><br><span class="line">        normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>(nms[i * <span class="number">3</span>], nms[i * <span class="number">3</span> + <span class="number">1</span>], nms[i * <span class="number">3</span> + <span class="number">2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ImportedModel::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">ImportedModel::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">ImportedModel::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">ImportedModel::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ModelImporter::<span class="built_in">ModelImporter</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ModelImporter::parseOBJ</span><span class="params">(<span class="type">const</span> std::string &amp;filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> x, y, z;</span><br><span class="line">    std::string content;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">fin</span><span class="params">(filePath, std::ios::in)</span></span>;</span><br><span class="line">    std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (!fin.<span class="built_in">eof</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">getline</span>(fin, line);</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;v &quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">1</span>))</span></span>;</span><br><span class="line">            s &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">            vertVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">            vertVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">            vertVals.<span class="built_in">push_back</span>(z);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;vt&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">            s &gt;&gt; x &gt;&gt; y;</span><br><span class="line">            stVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">            stVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;vn&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">            s &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">            normalVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">            normalVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">            normalVals.<span class="built_in">push_back</span>(z);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;f &quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::string oneCorner, v, t, n;</span><br><span class="line">            <span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++ i)</span><br><span class="line">            &#123;</span><br><span class="line">                std::<span class="built_in">getline</span>(s, oneCorner, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                <span class="function">std::stringstream <span class="title">oneCornerSS</span><span class="params">(oneCorner)</span></span>;</span><br><span class="line">                std::<span class="built_in">getline</span>(oneCornerSS, v, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">                std::<span class="built_in">getline</span>(oneCornerSS, t, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">                std::<span class="built_in">getline</span>(oneCornerSS, n, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> vertRef = (std::<span class="built_in">stoi</span>(v) - <span class="number">1</span>) * <span class="number">3</span>;</span><br><span class="line">                <span class="type">int</span> tcRef = (std::<span class="built_in">stoi</span>(t) - <span class="number">1</span>) * <span class="number">2</span>;</span><br><span class="line">                <span class="type">int</span> nmRef = (std::<span class="built_in">stoi</span>(n) - <span class="number">1</span>) * <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef]);</span><br><span class="line">                triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef + <span class="number">1</span>]);</span><br><span class="line">                triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef + <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                texCoords.<span class="built_in">push_back</span>(stVals[tcRef]);</span><br><span class="line">                texCoords.<span class="built_in">push_back</span>(stVals[tcRef + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">                normals.<span class="built_in">push_back</span>(normalVals[nmRef]);</span><br><span class="line">                normals.<span class="built_in">push_back</span>(normalVals[nmRef + <span class="number">1</span>]);</span><br><span class="line">                normals.<span class="built_in">push_back</span>(normalVals[nmRef + <span class="number">2</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ModelImporter::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> triangleVerts.<span class="built_in">size</span>() / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> triangleVerts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h2 id="ä¸ƒ-å…‰ç…§">ä¸ƒã€å…‰ç…§</h2>
<h3 id="7-1-å…‰ç…§æ¨¡å‹">7.1 å…‰ç…§æ¨¡å‹</h3>
<p>å…‰ç…§æ¨¡å‹æœ‰æ—¶ä¹Ÿç§°ä¸ºç€è‰²æ¨¡å‹ã€‚</p>
<p>å¸¸è§çš„å…‰ç…§æ¨¡å‹ç§°ä¸º ADS æ¨¡å‹ï¼ŒåŸºäºæ ‡è®°ä¸º Aã€D å’Œ S ä¸‰ç§ç±»å‹çš„åå°„ï¼š</p>
<ul>
<li>Aï¼šç¯å¢ƒå…‰åå°„ï¼ˆambient reflectionï¼‰ï¼šæ¨¡æ‹Ÿä½çº§å…‰ç…§ï¼Œå½±å“åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“ã€‚</li>
<li>Dï¼šæ¼«åå°„ï¼ˆdiffuse reflectionï¼‰ï¼šæ ¹æ®å…‰çº¿çš„å…¥å°„è§’åº¦è°ƒæ•´ç‰©ä½“äº®åº¦ã€‚</li>
<li>Sï¼šé•œé¢åå°„ï¼ˆspecular reflectionï¼‰ï¼šå±•ç¤ºç‰©ä½“çš„å…‰æ³½ï¼Œé€šè¿‡åœ¨ç‰©ä½“è¡¨é¢ä¸Šï¼Œå…‰çº¿ç›´æ¥åœ°åå°„åˆ°æˆ‘ä»¬çš„çœ¼ç›çš„ä½ç½®ï¼Œç­–ç•¥æ€§åœ°æ”¾ç½®é€‚å½“å¤§å°çš„é«˜å…‰æ¥ä½“ç°ã€‚</li>
</ul>
<p>ä½¿ç”¨ ADS å…‰ç…§æ¨¡å‹éœ€è¦æŒ‡å®šç”¨äºåƒç´ è¾“å‡ºçš„ RGBA å€¼ä¸Šå› å…‰ç…§<br>
è€Œäº§ç”Ÿçš„åˆ†é‡ã€‚å› ç´ åŒ…æ‹¬ï¼š</p>
<ul>
<li>å…‰æºç±»å‹åŠå…¶ç¯å¢ƒå…‰åå°„ã€æ¼«åå°„å’Œé•œé¢åå°„ç‰¹æ€§ï¼›</li>
<li>å¯¹è±¡æè´¨çš„ç¯å¢ƒå…‰åå°„ã€æ¼«åå°„å’Œé•œé¢åå°„ç‰¹å¾ï¼›</li>
<li>å¯¹è±¡æè´¨çš„â€œå…‰æ³½åº¦â€ï¼›</li>
<li>å…‰çº¿ç…§å°„ç‰©ä½“çš„è§’åº¦ï¼›</li>
<li>ä»ä¸­æŸ¥çœ‹åœºæ™¯çš„è§’åº¦ã€‚</li>
</ul>
<h3 id="7-2-å…‰æº">7.2 å…‰æº</h3>
<p>å¸¸è§çš„å…‰æºç±»å‹æœ‰ï¼š</p>
<ul>
<li>å…¨å±€å…‰ï¼šé€šå¸¸ç§°ä¸ºå…¨å±€ç¯å¢ƒå…‰ï¼Œä»…åŒ…å«ç¯å¢ƒå…‰ç»„ä»¶</li>
<li>å®šå‘å…‰ï¼šè¿œè·ç¦»å…‰</li>
<li>ä½ç½®å…‰ï¼šç‚¹å…‰æº</li>
<li>èšå…‰ç¯</li>
</ul>
<p>å…¨å±€ç¯å¢ƒå…‰ç”¨äºæ˜¾ç¤ºå¯¹è±¡çš„æ¯ä¸ªåƒç´ éƒ½æœ‰ç›¸åŒçš„å…‰ç…§ã€‚</p>
<ul>
<li>å…¨å±€ç¯å¢ƒå…‰æ¨¡æ‹Ÿäº†ç°å®ä¸–ç•Œå…‰çº¿ç»è¿‡å¤šæ¬¡åå°„ï¼Œ<strong>æ— æ³•ç¡®å®šå…‰æºå’Œæ–¹å‘</strong>ã€‚</li>
<li>ä»…æœ‰ç¯å¢ƒå…‰åå°„åˆ†é‡ï¼Œæ²¡æœ‰æ¼«åå°„æˆ–é•œé¢åå°„åˆ†é‡ã€‚</li>
<li>é€šå¸¸è¢«å»ºæ¨¡ä¸ºåæš—çš„ç™½å…‰ã€‚</li>
<li>ç”¨ RGBA å€¼è®¾å®šï¼š<code>float globalAmbient[4] = &#123;0.6f, 0.6f, 0.6f, 1.0f&#125;;</code>
<ul>
<li>RGBA å€¼çš„èŒƒå›´æ˜¯ 0.0 åˆ° 1.0ã€‚A è®¾ç½®ä¸º1ã€‚</li>
</ul>
</li>
</ul>
<p>å®šå‘å…‰æˆ–è¿œè·ç¦»å…‰</p>
<ul>
<li><strong>æ²¡æœ‰æºä½ç½®ä½†å…·æœ‰æ–¹å‘</strong>ã€‚ç”¨äºæ¨¡æ‹Ÿå…‰æºè·ç¦»éå¸¸è¿œï¼Œå…‰çº¿æ¥è¿‘å¹³è¡Œçš„æƒ…å†µã€‚</li>
<li>å®šå‘å…‰å¯¹ç‰©ä½“çš„å½±å“å–å†³äºå…‰ç…§è§’åº¦ï¼Œç‰©ä½“æœå‘å®šå‘å…‰çš„ä¸€ä¾§æ¯”å¯¹ä¾§æ›´äº®ã€‚</li>
<li>å»ºæ¨¡å®šå‘å…‰éœ€è¦æŒ‡å®šå…¶æ–¹å‘ï¼ˆå‘é‡ï¼‰åŠå…¶ç¯å¢ƒã€æ¼«åå°„å’Œé•œé¢ç‰¹å¾ã€‚</li>
<li>ç”¨ RGBA è®¾å®šï¼Œå¦‚æŒ‡å‘ z è½´è´Ÿæ–¹å‘çš„çº¢è‰²å®šå‘å…‰ä»£ç ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> dirLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightDirection[<span class="number">3</span>] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>ä½ç½®å…‰åœ¨ 3D åœºæ™¯ä¸­å…·æœ‰ç‰¹å®šä½ç½®ï¼Œç”¨ä»¥ä½“ç°é è¿‘åœºæ™¯çš„å…‰æºã€‚</p>
<ul>
<li><strong>ä½ç½®å…‰æ²¡æœ‰æ–¹å‘</strong>ï¼Œå› ä¸ºå®ƒå¯¹åœºæ™¯ä¸­æ¯ä¸ªé¡¶ç‚¹çš„å…‰ç…§æ–¹å‘éƒ½ä¸åŒã€‚</li>
<li>ä½ç½®å…‰è¿˜å¯ä»¥åŒ…å«è¡°å‡å› å­ï¼Œç”¨äºæ¨¡æ‹Ÿå®ƒä»¬çš„å¼ºåº¦éšç€è·ç¦»å‡å°çš„ç¨‹åº¦ã€‚</li>
<li>ç”¨ RGBA è®¾å®šï¼Œå¦‚ä½ç½®(5,2,-3)å¤„çš„çº¢è‰²ä½ç½®å…‰å¯ä»¥æŒ‡å®šä¸ºï¼š</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> posLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightPosition[<span class="number">3</span>] = &#123;<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">-3.0f</span>&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¡°å‡å› å­æœ‰è®¸å¤šå»ºæ¨¡æ–¹å¼ï¼Œå…¶ä¸­ä¸€ç§æ˜¯ä½¿ç”¨æ’å®šè¡°å‡ã€çº¿æ€§è¡°å‡å’ŒäºŒæ¬¡æ–¹è¡°å‡ï¼Œå¼•å…¥3ä¸ªéè´Ÿå¯è°ƒå‚æ•°ï¼Œä¸ç¦»å…‰æºçš„è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> ç»“åˆè¿›è¡Œè®¡ç®—ï¼š</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>k</mi><mi>c</mi></msub><mo>+</mo><msub><mi>k</mi><mi>l</mi></msub><mi>d</mi><mo>+</mo><msub><mi>k</mi><mi>q</mi></msub><msup><mi>d</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">attenuationFactor = \frac{1}{k_c + k_l d + k_q d^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">u</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.293548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">k_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼šåº”æ°¸è¿œå¤§äºç­‰äº1ï¼›</p>
</li>
<li>
<p>å¦å¤–ä¸¤ä¸ªå‚æ•°è‡³å°‘æœ‰ä¸€ä¸ªå¤§äºé›¶ï¼›</p>
</li>
<li>
<p>ä½¿å¾—å› å­å–å€¼ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ï¼Œå¹¶å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> å¢å¤§æ—¶æ¥è¿‘0ã€‚</p>
</li>
<li>
<p>å°†å› å­ä¸å…‰çš„å¼ºåº¦ç›¸ä¹˜å³å¯ã€‚</p>
</li>
</ul>
<p>èšå…‰ç¯</p>
<ul>
<li><strong>åŒæ—¶å…·æœ‰ä½ç½®å’Œæ–¹å‘</strong>ã€‚</li>
<li>èšå…‰ç¯å‚æ•°å¦‚ä¸‹å›¾</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_spotlightargs.jpg" alt="èšå…‰ç¯å‚æ•°ï¼Œå›¾æºè®¡ç®—æœºå›¾å½¢å­¦ç¼–ç¨‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"></p>
<ul>
<li>å…·æœ‰è¡°å‡æŒ‡æ•°æ¨¡æ‹Ÿéšå…‰æŸè§’åº¦çš„å¼ºåº¦å˜åŒ–ï¼Œå…·æœ‰è¡°å‡å› å­æ¨¡æ‹Ÿå…‰æŸè·ç¦»è¡°å‡ã€‚
<ul>
<li>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> å°äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span></span> æ—¶ï¼Œè®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> çš„ä½™å¼¦çš„è¡°å‡æŒ‡æ•°æ¬¡å¹‚æ¥è®¡ç®—å¼ºåº¦å› å­ã€‚</li>
<li>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> å¤§äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span></span> æ—¶ï¼Œå¼ºåº¦å› å­ä¸º0ã€‚</li>
<li>å¼ºåº¦å› å­å–å€¼èŒƒå›´ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ï¼Œå°†å¼ºåº¦å› å­ä¹˜å…‰çš„å¼ºåº¦å³å¯æ¨¡æ‹Ÿé”¥å½¢æ•ˆæœã€‚</li>
</ul>
</li>
<li>ç”¨ RGBA è®¾å®šï¼Œå¦‚ä½ç½®(5,2,-3)å¤„å‘ä¸‹ç…§å°„ z è½´è´Ÿæ–¹å‘çš„çº¢è‰²èšå…‰ç¯å¯ä»¥è¡¨ç¤ºä¸ºï¼š</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> spotLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightPosition[<span class="number">3</span>] = &#123;<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">-3.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightDirection[<span class="number">3</span>] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightCutoff = <span class="number">20.0f</span>;</span><br><span class="line"><span class="type">float</span> spotLightExponent = <span class="number">10.0f</span>;</span><br></pre></td></tr></table></figure>
<p><em>å½“è®¾è®¡æ‹¥æœ‰è®¸å¤šå…‰æºçš„ç³»ç»Ÿæ—¶ï¼Œç¨‹åºå‘˜åº”è¯¥è€ƒè™‘åˆ›å»ºç›¸åº”çš„ç±»ç»“æ„ï¼Œå¦‚å®šä¹‰ Light ç±»åŠå…¶å­ç±» GlobalAmbientã€Directionalã€Positionalã€Spotlight</em></p>
<h3 id="7-3-æè´¨">7.3 æè´¨</h3>
<p>åœºæ™¯ä¸­ç»™ç‰©ä½“çš„å¤–è§‚æ·»åŠ å…‰ç…§ï¼Œäº§ç”Ÿåå°„ç‰¹æ€§ã€‚å³å¯¹è±¡ä¸ ADS å…‰ç…§æ¨¡å‹ç›¸äº’ä½œç”¨ã€‚</p>
<p>é€šè¿‡æŒ‡å®š4ä¸ªå€¼ï¼Œåœ¨ ADS å…‰ç…§æ¨¡å‹ä¸­æ¨¡æ‹Ÿæè´¨ï¼š</p>
<ul>
<li>ç¯å¢ƒå…‰åå°„</li>
<li>æ¼«åå°„</li>
<li>é•œé¢åå°„</li>
<li>å…‰æ³½</li>
</ul>
<p>å¦‚é”¡é“åˆé‡‘çš„æ•ˆæœï¼ŒæŒ‡å®šï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> pewterMatAmbient[<span class="number">4</span>] = &#123;<span class="number">0.11f</span>, <span class="number">0.06f</span>, <span class="number">0.11f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> pewterMatDiffuse[<span class="number">4</span>] = &#123;<span class="number">0.43f</span>, <span class="number">0.47f</span>, <span class="number">0.54f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> pewterMatSpecular[<span class="number">4</span>] = &#123;<span class="number">0.33f</span>, <span class="number">0.33f</span>, <span class="number">0.52f</span>, <span class="number">1.0f</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰çº¹ç†çš„ç‰©ä½“åœ¨æ¸²æŸ“æ—¶ï¼Œå¯ä»¥æŒ‡å®šæè´¨ç‰¹æ€§ã€‚æ­¤å¤„é¢„å®šä¹‰ä¸€äº›å¯é€‰æ‹©çš„æè´¨ï¼ˆç½®äºUtilç±»ä¸­ï¼‰ï¼š</p>
<details><summary>é»„é‡‘ã€ç™½é“¶ã€é’é“œæè´¨ä»£ç </summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2473f</span>, <span class="number">0.1995f</span>, <span class="number">0.0745f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.7516f</span>, <span class="number">0.6065f</span>, <span class="number">0.2265f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.6283f</span>, <span class="number">0.5559f</span>, <span class="number">0.3661f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::goldShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::silverShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2125f</span>, <span class="number">0.1275f</span>, <span class="number">0.054f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.714f</span>, <span class="number">0.4284f</span>, <span class="number">0.18144f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.393548f</span>, <span class="number">0.271906f</span>, <span class="number">0.166721f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::bronzeShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25.6f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p><strong>è¿™äº›ä»£ç ä»…ä»…æä¾›äº†ç”¨äºæè¿°å¹¶å­˜å‚¨åœºæ™¯ä¸­å…ƒç´ æ‰€éœ€å…‰ç…§å’Œæè´¨ç‰¹æ€§çš„ä¸€ç§æ–¹å¼ï¼Œä»ç„¶éœ€è¦è‡ªå·±è®¡ç®—å…‰ç…§ã€‚</strong></p>
<h3 id="7-4-adså…‰ç…§è®¡ç®—">7.4 ADSå…‰ç…§è®¡ç®—</h3>
<p>å½“ç»˜åˆ¶åœºæ™¯æ—¶ï¼Œæ¯ä¸ªé¡¶ç‚¹åæ ‡éƒ½ä¼šè¿›è¡Œå˜æ¢ä»¥å°† 3D ä¸–ç•Œæ¨¡æ‹Ÿåˆ° 2D å±å¹•ä¸Šã€‚æ¯ä¸ªåƒç´ çš„é¢œè‰²éƒ½æ˜¯æ …æ ¼åŒ–ã€çº¹ç†è´´å›¾ä»¥åŠæ’å€¼çš„ç»“æœã€‚</p>
<p>ç°åœ¨éœ€è¦åŠ å…¥ä¸€ä¸ªæ–°çš„æ­¥éª¤æ¥è°ƒæ•´è¿™äº›æ …æ ¼åŒ–ä¹‹åçš„åƒç´ é¢œè‰²ï¼Œä»¥ä¾¿ååº”åœºæ™¯ä¸­çš„å…‰ç…§å’Œæè´¨ã€‚</p>
<p>é¦–å…ˆç¡®å®šæ¯ä¸ªåƒç´ çš„åå°„å¼ºåº¦ Iï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>+</mo><msub><mi>I</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{observed} = I_{ambient} + I_{diffuse} + I_{specular}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>å…¶ä¸­ç¯å¢ƒå…‰å€¼ä¸ºåœºæ™¯ç¯å¢ƒå…‰ä¸æè´¨ç¯å¢ƒå…‰åˆ†é‡çš„ä¹˜ç§¯ï¼ˆRGBåˆ†åˆ«ä¹˜ç§¯ï¼‰ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mtext>Â </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">I_{ambient}=Light_{ambient}\ Material_{ambient}=
\begin{cases}
I_{ambient}^{red}=Light_{ambient}^{red}Material_{ambient}^{red}\\
I_{ambient}^{green}=Light_{ambient}^{green}Material_{ambient}^{green}\\
I_{ambient}^{blue}=Light_{ambient}^{blue}Material_{ambient}^{blue}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>å…¶ä¸­æ¼«åå°„åˆ†é‡åŸºäºå…‰å¯¹äºå¹³é¢çš„å…¥å°„è§’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span></span>ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_angleOfIncidence.png" alt="å…¥å°„è§’"></p>
<p>å…¶ä¸­ç¡®å®šå…¥å°„è§’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span></span></span></span> éœ€è¦ï¼š</p>
<ol>
<li>æ±‚ä»ç»˜åˆ¶å‘é‡åˆ°å…‰æºçš„å‘é‡ï¼ˆæˆ–ä¸å…‰ç…§æ–¹å‘ç›¸åçš„å‘é‡ï¼‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span></li>
<li>æ¸²æŸ“ç‰©ä½“è¡¨æ˜çš„æ³•å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></li>
</ol>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ç”±</mtext><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>cos</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>N</mi><mo>â‹…</mo><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>N</mi><mi mathvariant="normal">âˆ¥</mi><mi>L</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mfrac><mi>Ï€</mi><mn>2</mn></mfrac><mo>â‰¤</mo><mi>Î¸</mi><mo>â‰¤</mo><mfrac><mi>Ï€</mi><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr></mtable></mrow><mspace linebreak="newline"></mspace><mtext>å¾—</mtext><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mtext>Â </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mtext>Â </mtext><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>N</mi><mo>â‹…</mo><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>N</mi><mi mathvariant="normal">âˆ¥</mi><mi>L</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mtext>åŒæ ·åˆ†åˆ«è¿›è¡Œ</mtext><mi>R</mi><mi>G</mi><mi>B</mi><mtext>è¿ç®—</mtext></mrow><annotation encoding="application/x-tex">ç”±\begin{cases}
I_{diffuse}=\cos(\theta)Light_{diffuse}Material_{diffuse}\\
\cos(\theta)=\frac{N\cdot L}{\vert N\|L\vert}\\
-\frac{\pi}{2}\leq\theta\leq\frac{\pi}{2}
\end{cases}\\
å¾—I_{diffuse}=Light_{diffuse}\ Material_{diffuse}\ \max(\frac{N\cdot L}{\vert N\|L\vert},0)\\
åŒæ ·åˆ†åˆ«è¿›è¡ŒRGBè¿ç®—
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.4079999999999995em;vertical-align:-1.9539999999999997em;"></span><span class="mord cjk_fallback">ç”±</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.454em;"><span style="top:-4.454000000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.0140000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ£</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mtight">âˆ¥</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">âˆ£</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">â‹…</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.4860000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">Ï€</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">Ï€</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9539999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord cjk_fallback">å¾—</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord">âˆ¥</span><span class="mord mathdefault">L</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">L</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">åŒ</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">åˆ†</span><span class="mord cjk_fallback">åˆ«</span><span class="mord cjk_fallback">è¿›</span><span class="mord cjk_fallback">è¡Œ</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">è¿</span><span class="mord cjk_fallback">ç®—</span></span></span></span></span></p>
<p>å…¶ä¸­é•œé¢åå°„åˆ†é‡é™¤äº†ä¸å…¥å°„è§’ç›¸å…³ï¼Œä¹Ÿä¸å…‰åœ¨è¡¨é¢ä¸Šçš„åå°„è§’ä»¥åŠè§‚å¯Ÿç‚¹ä¸åå…‰è¡¨é¢ä¹‹é—´çš„å¤¹è§’ç›¸å…³ã€‚ä¸‹å›¾ R è¡¨ç¤ºå…‰åå°„ï¼ŒV è¡¨ç¤ºè§‚å¯Ÿå‘é‡ï¼ˆåƒç´ åˆ°çœ¼ç›ï¼‰ã€‚</p>
<ul>
<li>V æ˜¯ä»çœ¼ç›åˆ°åƒç´ çš„å–åã€‚</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> è¶Šå°ï¼Œé•œé¢åå°„åˆ†é‡è¶Šå¤§ã€‚
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> ç”¨äºè®¡ç®—é•œé¢åå°„åˆ†é‡çš„æ–¹å¼å–å†³äºç‰©ä½“çš„å…‰æ³½åº¦ã€‚å…‰æ³½åº¦è¶Šå¤§è¶Šé—ªäº®ï¼Œåˆ™å…¥å°„å…‰æ›´å¤šåå°„ç»™çœ¼ç›ï¼›å…‰æ³½åº¦è¾ƒå°ï¼Œä¸é‚£ä¹ˆé—ªäº®ï¼Œåˆ™é•œé¢é«˜å…‰ä¼šæ•£å¼€ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_observationPointIncidence.png" alt="è§‚å¯Ÿç‚¹å…¥å°„è§’"></p>
<p>åå…‰åº¦å¯ä»¥ç”¨è¡°å‡å‡½æ•°å»ºæ¨¡ï¼Œè¡°å‡å‡½æ•°è¡¨ç¤ºè§’åº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> å¢å¤§æ—¶é•œé¢åå°„åˆ†é‡è¡°å‡åˆ°0çš„é€Ÿåº¦ã€‚</p>
<ul>
<li>ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo><mi>cos</mi><mo>â¡</mo></mo><mi>n</mi></msup><mo stretchy="false">(</mo><mi>Ï†</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos^n(\varphi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">cos</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">Ï†</span><span class="mclose">)</span></span></span></span> è¿›è¡Œè¡°å‡ï¼ŒæŒ‡æ•°è¶Šå¤§ï¼Œè¡°å‡é€Ÿåº¦è¶Šå¿«ã€‚
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> åˆå«ä½œæè´¨çš„åå…‰åº¦å› å­ã€‚</li>
<li>åå…‰åº¦å› å­ä»¥å…‰æ³½åº¦å½¢å¼ç»™å‡ºã€‚</li>
</ul>
</li>
</ul>
<p>é•œé¢åå°„è®¡ç®—å¦‚ä¸‹ï¼ˆå®é™…è¿ç®—ä½¿ç”¨RGBè¿ç®—ï¼‰ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mtext>Â </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mtext>Â </mtext><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>R</mi><mo>â‹…</mo><mi>V</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>R</mi><mi mathvariant="normal">âˆ¥</mi><mi>V</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">I_{specular}=Light_{specular}\ Material_{specular}\ \max((\frac{R\cdot V}{\vert R\|V\vert})^n,0)\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mop">max</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord">âˆ¥</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span></span></span></span></p>
<h3 id="7-5-å®ç°adså…‰ç…§">7.5 å®ç°ADSå…‰ç…§</h3>
<p>å¹³æ»‘ç€è‰²æ–¹æ³•ï¼š</p>
<ul>
<li>Gouraud ç€è‰²</li>
<li>Phong ç€è‰²</li>
</ul>
<h4 id="7-5-1-gouraud-ç€è‰²">7.5.1 Gouraud ç€è‰²</h4>
<p>è¿™æ–¹æ³•åˆç§°ä¸ºåŒçº¿æ€§å…‰å¼ºæ’å€¼æ³•</p>
<p>ä½¿ç”¨ 3D å›¾å½¢ç®¡çº¿ä¸­çš„è‡ªåŠ¨æ’å€¼æ¸²æŸ“ï¼Œé€‚ç”¨äºç°ä»£æ˜¾å¡ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¡®å®šæ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ï¼Œå¹¶è¿›è¡Œå…‰ç…§ç›¸å…³è®¡ç®—ã€‚</li>
<li>å…è®¸æ­£å¸¸çš„æ …æ ¼åŒ–è¿‡ç¨‹åœ¨æ’å…¥åƒç´ æ—¶å¯¹é¢œè‰²ä¹Ÿè¿›è¡Œæ’å€¼ï¼ˆåŒæ—¶ä¹Ÿå¯¹å…‰ç…§è¿›è¡Œæ’å€¼ï¼‰ã€‚</li>
</ol>
<p>OpenGL ä¸­ï¼Œå¤§å¤šæ•°å…‰ç…§è®¡ç®—éƒ½æ˜¯é¡¶ç‚¹ç€è‰²å™¨ä¸­å®Œæˆï¼Œç‰‡æ®µç€è‰²å™¨ä»…ä¼ é€’å¹¶å±•ç¤ºè‡ªåŠ¨æ’å€¼çš„å…‰ç…§åçš„é¢œè‰²ã€‚</p>
<ul>
<li>é¡¶ç‚¹ç€è‰²å™¨
<ol>
<li>æ ¹æ®é¡¶ç‚¹è®¡ç®— Nã€Lã€V å’Œ R å‘é‡</li>
<li>è®¡ç®— Aã€Dã€Såˆ†é‡</li>
<li>è¾“å‡ºå±æ€§ã€å…‰ç…§åçš„é¢œè‰²ã€<code>gl_position</code></li>
</ol>
</li>
<li>ç‰‡æ®µç€è‰²å™¨
<ol>
<li>ä¼ å…¥æ’å€¼ï¼šé¢œè‰²ã€ä½ç½®</li>
</ol>
</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_goldtorus.jpg" alt="é€šè¿‡ Gouraud ç€è‰²çš„é»„é‡‘æè´¨ç¯é¢"></p>
<p>ç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>Utilç±»</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> GLuint <span class="title">loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldAmbient</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldSpecular</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">goldShininess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverAmbient</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverSpecular</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">silverShininess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeAmbient</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeSpecular</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">bronzeShininess</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä»æ–‡ä»¶ä¸­è¯»å– GLSL ä»£ç </span></span><br><span class="line"><span class="comment">* @param path æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">    std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">        content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fileStream.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL ä»£ç ç¼–è¯‘å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param shader ç€è‰²å™¨æ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å½“ GLSL é“¾æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º OpenGL æ—¥å¿—å†…å®¹</span></span><br><span class="line"><span class="comment">* @param program ç€è‰²å™¨ç¨‹åºæ ‡è¯†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *log;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">delete</span>[] log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* æ£€æŸ¥ OpenGL é”™è¯¯æ ‡å¿—ï¼Œå³æ˜¯å¦å‘ç”Ÿ OpenGL é”™è¯¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    <span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        err = <span class="literal">true</span>;</span><br><span class="line">        glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* åˆ›å»ºç€è‰²å™¨ç¨‹åº</span></span><br><span class="line"><span class="comment">* @param vpath é¡¶ç‚¹ç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">* @param fpath ç‰‡æ®µç€è‰²å™¨è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">    <span class="comment">// ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å­˜å…¥ vShader å’Œ fShader å˜é‡</span></span><br><span class="line">    GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">    GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† GLSL ä»£ç ä»å­—ç¬¦ä¸²è½½å…¥ç©ºç€è‰²å™¨å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">    <span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line">    <span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">    <span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">    <span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">    <span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">    <span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">        <span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vProgram; <span class="comment">// è¿”å›ç€è‰²å™¨ç¨‹åºID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ä»æ–‡ä»¶ä¸­è¯»å–çº¹ç†å›¾åƒå¹¶è¿”å›çº¹ç† ID</span></span><br><span class="line"><span class="comment">* @param imgPath å›¾åƒæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLuint textureID;</span><br><span class="line">    textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">    <span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2473f</span>, <span class="number">0.1995f</span>, <span class="number">0.0745f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.7516f</span>, <span class="number">0.6065f</span>, <span class="number">0.2265f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.6283f</span>, <span class="number">0.5559f</span>, <span class="number">0.3661f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»„é‡‘æè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::goldShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½é“¶æè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::silverShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„ç¯å¢ƒå…‰</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2125f</span>, <span class="number">0.1275f</span>, <span class="number">0.054f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„æ¼«åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.714f</span>, <span class="number">0.4284f</span>, <span class="number">0.18144f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„é•œé¢åå°„</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.393548f</span>, <span class="number">0.271906f</span>, <span class="number">0.166721f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’é“œæè´¨çš„å…‰æ³½åº¦</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::bronzeShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25.6f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;    <span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];    <span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å…‰ç…§ä½ç½®</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">goldAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">goldDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">goldSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">goldShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"><span class="comment">//ImportedModel model(&quot;unicorn.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">    lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">    lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">    lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">    lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">    globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">    ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">    diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">    specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">    posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">    mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">    mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">    mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">    mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">    <span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">    <span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; ind = model.<span class="built_in">getIndices</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">    nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºå½“å‰å…‰æºä½ç½®ï¼Œåˆå§‹åŒ–å…‰ç…§</span></span><br><span class="line">    currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">    <span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line">    <span class="comment">// æ„å»º MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">    invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="comment">//glDrawArrays(GL_TRIANGLES, 0, model.getNumVertices());</span></span><br><span class="line">    <span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Light&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å®šä¹‰å‡½æ•° <code>installLights()</code> å°†å…‰æºåœ¨è§†è§‰ç©ºé—´ä¸­çš„ä½ç½®å’Œæè´¨çš„ ADS ç‰¹æ€§è¯»å…¥ç›¸åº”çš„ç»Ÿä¸€å˜é‡ã€‚</li>
<li>ç›´æ¥å¯¹æ³•å‘é‡åº”ç”¨ MV çŸ©é˜µä¸èƒ½ä¿è¯æ³•å‘é‡ä¾ç„¶ä¸ç‰©ä½“è¡¨é¢å‚ç›´ã€‚ä½¿ç”¨ MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡ã€‚</li>
<li>å˜é‡ lightPosV åŒ…å«å…‰æºåœ¨ç›¸æœºç©ºé—´ä¸­çš„ä½ç½®ï¼Œæ¯å¸§åªéœ€è¦è®¡ç®—ä¸€æ¬¡ã€‚</li>
</ul>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    <span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;    <span class="comment">// ç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†é¡¶ç‚¹ä½ç½®å’Œæ³•å‘é‡è½¬æ¢åˆ°è§†è§‰ç©ºé—´</span></span><br><span class="line">    <span class="comment">// è®¡ç®—è§†è§‰ç©ºé—´å…‰ç…§å‘é‡ï¼ˆä»é¡¶ç‚¹åˆ°å…‰æºï¼‰</span></span><br><span class="line">    vec4 P = mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">    vec3 N = <span class="built_in">normalize</span>((norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">0.0</span>)).xyz);</span><br><span class="line">    vec3 L = <span class="built_in">normalize</span>(light.position - P.xyz);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§†è§‰å‘é‡ç­‰äºè§†è§‰ç©ºé—´ä¸­è´Ÿé¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    vec3 V = <span class="built_in">normalize</span>(-P.xyz);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// R æ˜¯ -L çš„ç›¸å¯¹äºè¡¨é¢å‘é‡ N çš„é•œåƒ</span></span><br><span class="line">    vec3 R = <span class="built_in">reflect</span>(-L, N);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¯å¢ƒå…‰ã€æ¼«åå°„å’Œé•œé¢åå°„åˆ†é‡</span></span><br><span class="line">    vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">    vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(<span class="built_in">dot</span>(N, L), <span class="number">0.0</span>);</span><br><span class="line">    vec3 specular = <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="built_in">dot</span>(R, V), <span class="number">0.0f</span>), material.shininess) * material.specular.xyz * light.specular.xyz;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†é¢œè‰²è¾“å‡ºåˆ°ç‰‡æ®µç€è‰²å™¨</span></span><br><span class="line"></span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">    color = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å­—æ®µé€‰æ‹©å™¨ç¬¦å·â€œ.xyzâ€ï¼Œæ˜¯å°† <code>vec4</code> è½¬æ¢ä¸ºä»…åŒ…å«å…¶å‰ 3 ä¸ªå…ƒç´ çš„ç­‰æ•ˆ <code>vec3</code> çš„â€œå¿«æ·æ–¹å¼â€ã€‚</li>
<li><code>normalize()</code> ç”¨æ¥å°†å‘é‡è½¬æ¢ä¸ºå•ä½é•¿åº¦ã€‚</li>
<li><code>reflect()</code> å‡½æ•°ç”¨ä¸è®¡ç®—ä¸€ä¸ªå‘é‡åŸºäºå¦ä¸€ä¸ªå‘é‡çš„åå°„ã€‚</li>
<li><code>dot()</code> å‡½æ•°ä¸ºç‚¹ä¹˜è¿ç®—ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 color;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fragColor = color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>Gouraud ç€è‰²å®¹æ˜“å—åˆ°å…¶ä»–ä¼ªå½±å½±å“ã€‚</p>
<ul>
<li>å¦‚æœé•œé¢é«˜å…‰èŒƒå›´å†…ä¸€ä¸ªæ¨¡å‹é¡¶ç‚¹ä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸ä¼šè¢«æ¸²æŸ“å‡ºæ¥ã€‚</li>
<li>é•œé¢åå°„åˆ†é‡æ˜¯ä¾é¡¶ç‚¹è®¡ç®—çš„ï¼Œå› æ­¤ï¼Œå½“æ¨¡å‹çš„æ‰€æœ‰é¡¶ç‚¹éƒ½æ²¡æœ‰é•œé¢åå°„åˆ†é‡æ—¶ï¼Œå…¶æ …æ ¼åŒ–åçš„åƒç´ ä¹Ÿä¸ä¼šæœ‰é•œé¢åå°„æ•ˆæœã€‚</li>
</ul>
<h4 id="7-5-2-phong-ç€è‰²">7.5.2 Phong ç€è‰²</h4>
<p>è¯¥ç®—æ³•çš„ç»“æ„ç±»ä¼¼ Gouraud ç€è‰²ç®—æ³•ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…‰ç…§è®¡ç®—æ˜¯<strong>æŒ‰åƒç´ è€Œéé¡¶ç‚¹</strong>å®Œæˆçš„ã€‚</p>
<ul>
<li>é¡¶ç‚¹ç€è‰²å™¨
<ol>
<li>è®¡ç®—å‘é‡ Nã€Lã€V</li>
<li>è¾“å‡ºå±æ€§ Nã€Lã€Vã€<code>gl_position</code></li>
</ol>
</li>
<li>ç‰‡æ®µç€è‰²å™¨
<ol>
<li>ä¼ å…¥æ’å€¼ Nã€Lã€V</li>
<li>è®¡ç®— Rã€Î¸ã€Ï†</li>
<li>è®¡ç®— ADS åˆ†é‡</li>
<li>è¾“å‡ºé¢œè‰²</li>
</ol>
</li>
</ul>
<p>å°†ä¹‹å‰åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®ç°çš„è¿‡ç¨‹ç§»åˆ°ç‰‡æ®µç€è‰²å™¨ä¸­è¿›è¡Œã€‚</p>
<p>æ•… main.cppå’Œ Util ç±»æ— éœ€æ”¹å˜ï¼Œåªéœ€ä¿®æ”¹ç€è‰²å™¨çš„ä»£ç ã€‚</p>
<p>å¯¹äºåŸå§‹çš„ Phong è¿›è¡Œä¼˜åŒ–ï¼š</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> çš„è®¡ç®—æ˜¯éå¿…é¡»çš„ã€‚</li>
<li>è§’ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> å¯ä»¥é€šè¿‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> çš„è§’å¹³åˆ†çº¿å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> å¾—åˆ°ã€‚
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>L</mi><mo>+</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">H = L + V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\theta = \frac{1}{2}\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">Ï†</span></span></span></span></li>
<li>ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">Î±</span></span></span></span> ä»£æ›¿ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Ï†</span></span></span></span> å°±å·²ç»å¯ä»¥è·å¾—è¶³å¤Ÿå¥½çš„ç»“æœã€‚</li>
</ul>
</li>
<li>æœ€åé•œé¢åå°„åˆ†é‡åœ¨å…‰æ³½åº¦ä¹˜ 3.0 ä½œä¸ºæ”¹å–„é•œé¢é«˜å…‰çš„å¾®è°ƒã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_optobPointIncidence.png" alt="ä½¿ç”¨Î±ä»£æ›¿Ï†"></p>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;    <span class="comment">// ç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">uniform PositionalLight light;</span><br><span class="line"></span><br><span class="line">out vec3 normals;    <span class="comment">// è§†è§‰ç©ºé—´é¡¶ç‚¹æ³•å‘é‡</span></span><br><span class="line">out vec3 lightDir;    <span class="comment">// æŒ‡å‘å…‰æºçš„å‘é‡</span></span><br><span class="line">out vec3 halfVector;<span class="comment">// è§’å¹³åˆ†çº¿å‘é‡ H</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec3 _vertPos;    <span class="comment">// è§†è§‰ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    <span class="comment">// è¾“å‡ºé¡¶ç‚¹ä½ç½®ã€å…‰ç…§æ–¹å‘å’Œæ³•å‘é‡åˆ°å…‰æ …ç€è‰²å™¨è¿›è¡Œæ’å€¼</span></span><br><span class="line">    _vertPos = (mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">    lightDir = light.position - _vertPos;</span><br><span class="line">    normals = (norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">1.0</span>)).xyz;</span><br><span class="line">    halfVector = (lightDir + (-_vertPos)).xyz;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    <span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">in vec3 normals;</span><br><span class="line">in vec3 lightDir;</span><br><span class="line">in vec3 halfVector;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å½’ä¸€åŒ–å…‰ç…§å‘é‡ã€æ³•å‘é‡ã€å¹³åˆ†çº¿å‘é‡</span></span><br><span class="line">    vec3 L = <span class="built_in">normalize</span>(lightDir);</span><br><span class="line">    vec3 N = <span class="built_in">normalize</span>(normals);</span><br><span class="line">    vec3 H = <span class="built_in">normalize</span>(halfVector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å…‰ç…§ä¸å¹³é¢æ³•å‘é‡é—´çš„è§’åº¦</span></span><br><span class="line">    <span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">    <span class="comment">// è®¡ç®—æ³•å‘é‡ N ä¸è§’å¹³åˆ†çº¿å‘é‡ H ä¹‹é—´çš„è§’åº¦</span></span><br><span class="line">    <span class="type">float</span> cosPhi = <span class="built_in">dot</span>(H, N);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰åƒç´ è®¡ç®— ADS åˆ†é‡ï¼Œåˆå¹¶æ„å»ºè¾“å‡ºé¢œè‰²</span></span><br><span class="line">    vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">    vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(cosTheta, <span class="number">0.0</span>);</span><br><span class="line">    vec3 specular = light.specular.xyz * material.specular.xyz * <span class="built_in">pow</span>(<span class="built_in">max</span>(cosPhi, <span class="number">0.0</span>), material.shininess * <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">    fragColor = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="7-6-ç»“åˆå…‰ç…§å’Œçº¹ç†">7.6 ç»“åˆå…‰ç…§å’Œçº¹ç†</h3>
<p>ç»“åˆå…‰ç…§å’Œçº¹ç†çš„æ–¹å¼å–å†³äºç‰©ä½“çš„ç‰¹æ€§åŠå…¶çº¹ç†çš„ç›®çš„ï¼š</p>
<ul>
<li>çº¹ç†å›¾åƒå¾ˆå†™å®åœ°åæ˜ äº†ç‰©ä½“çœŸå®çš„è¡¨é¢å¤–è§‚ï¼›</li>
<li>ç‰©ä½“åŒæ—¶å…·æœ‰æè´¨å’Œçº¹ç†ï¼›</li>
<li>æè´¨åŒ…æ‹¬é˜´å½±å’Œåå°„ä¿¡æ¯ï¼›</li>
<li>æœ‰å¤šç§å…‰æˆ–å¤šä¸ªçº¹ç†</li>
</ul>
<p>å½“ç‰©ä½“æ‹¥æœ‰ä¸€ä¸ªç®€å•çš„çº¹ç†ï¼ŒåŒæ—¶è¿›è¡Œå…‰ç…§æ—¶ï¼Œç®€å•çš„æ–¹æ³•æ˜¯ï¼š</p>
<ol>
<li>åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å®Œå…¨å°†æè´¨ç‰¹æ€§å»é™¤ï¼›</li>
<li>ä½¿ç”¨çº¹ç†å–æ ·æ‰€å¾—çº¹ç†é¢œè‰²ä»£æ›¿æè´¨çš„ ADS å€¼ã€‚</li>
</ol>
<ul>
<li>å¯¹äºé—ªäº®è¡¨é¢ï¼š
<ul>
<li>çº¹ç†é¢œè‰²å½±å“äº†ç¯å¢ƒå…‰å’Œæ¼«åå°„åˆ†é‡ï¼Œè€Œé•œé¢åå°„é¢œè‰²ä»…ç”±å…‰æºå†³å®šã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragColor = textureColor * (ambient + diffuse) + specular;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>å¯¹äºéé—ªäº®è¡¨é¢ï¼š</p>
<ul>
<li>
<p>é•œé¢é«˜å…‰éƒ¨åˆ†åº”å½“åŒ…å«ç‰©ä½“è¡¨é¢é¢œè‰²ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragColor = textureColor * (ambient + diffuse + specular);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å¯¹äºç‰©ä½“æ—¢æœ‰ ADS æè´¨ï¼Œåˆæœ‰çº¹ç†å›¾åƒï¼ŒåŠ æƒæ±‚å’Œã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">textureColor = <span class="built_in">texture</span>(samp, texCoord);</span><br><span class="line">lightColor = (ambLight * ambMaterial) + (diffLight * diffMaterial) + specLight;</span><br><span class="line">fragColor = <span class="number">0.5</span> * textureColor + <span class="number">0.5</span> * lightColor;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç»“åˆäº†å…‰ç…§ã€æè´¨ã€çº¹ç†ï¼Œå¹¶èƒ½å¤Ÿæ‰©å±•åˆ°å¤šä¸ªå…‰æºã€å¤šç§æè´¨çš„æƒ…å†µã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">texture1Color = <span class="built_in">texture</span>(sampler1, texCoord);</span><br><span class="line">texture2Color = <span class="built_in">texture</span>(sampler2, texCoord);</span><br><span class="line">light1Color = (ambLight1 * ambMaterial) + (diffLight1 * diffMaterial) + specLight1;</span><br><span class="line">light2Color = (ambLight2 * ambMaterial) + (diffLight2 * diffMaterial) + specLight2;</span><br><span class="line">fragColor = <span class="number">0.25</span> * texture1Color + </span><br><span class="line">            <span class="number">0.25</span> * texture2Color +</span><br><span class="line">            <span class="number">0.25</span> * light1Color +</span><br><span class="line">            <span class="number">0.25</span> * light2Color;</span><br></pre></td></tr></table></figure>
<p>ç¨ä½œå°è¯•çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movinglight.gif" alt="é’é“œæè´¨ã€å†°å—çº¹ç†ã€ç§»åŠ¨å…‰æºä¸‹çš„æé¾™"></p>
<p>å¯¹äºè¿™ä¸ªä¾‹å­çš„ä»£ç ï¼ˆImportedModel ç±»å’Œ Util ç±»åŒä¹‹å‰ï¼‰ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line">GLuint textureID;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;    <span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];    <span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å…‰ç…§ä½ç½®</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">bronzeAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">bronzeDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">bronzeSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">bronzeShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="comment">//Torus model(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="comment">// åŠ è½½çš„æ¨¡å‹è¿˜ä¸èƒ½ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model</span><span class="params">(<span class="string">&quot;model/velociraptor.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">    lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">    lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">    lightPos[<span class="number">1</span>] = lightPosV.y * <span class="number">10.0f</span> * <span class="built_in">cos</span>(<span class="built_in">glfwGetTime</span>() * <span class="number">2.0f</span>);</span><br><span class="line">    lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">    globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">    ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">    diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">    specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">    posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">    mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">    mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">    mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">    mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">    <span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">    <span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">    <span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//std::vector&lt;int&gt; ind = model.getIndices();</span></span><br><span class="line">    std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">    std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">    std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">    std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">    &#123;</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">        pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">        tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">        nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">    <span class="comment">// é¡¶ç‚¹ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">    <span class="comment">//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">    <span class="comment">//glBufferData(GL_ELEMENT_ARRAY_BUFFER, 4 * ind.size(), &amp;ind[0], GL_STATIC_DRAW);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;Phong/vertex.glsl&quot;</span>, <span class="string">&quot;Phong/fragment.glsl&quot;</span>);</span><br><span class="line">    cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">    aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">    pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">makeVertexArray</span>();</span><br><span class="line"></span><br><span class="line">    textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/ice.jpg&quot;</span>);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">    mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">    projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">    nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">    mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">5.0f</span>, <span class="number">5.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºå½“å‰å…‰æºä½ç½®ï¼Œåˆå§‹åŒ–å…‰ç…§</span></span><br><span class="line">    currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">    <span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">    mvMat = vMat * mMat;</span><br><span class="line">    <span class="comment">// æ„å»º MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">    invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">    <span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">2</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">    <span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">    <span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">        <span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model.<span class="built_in">getNumVertices</span>());</span><br><span class="line">    <span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="comment">//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">    <span class="comment">//glDrawElements(GL_TRIANGLES, model.getNumIndices(), GL_UNSIGNED_INT, 0);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">    GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Light&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    <span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">2</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;    <span class="comment">// ç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">uniform PositionalLight light;</span><br><span class="line"></span><br><span class="line">out vec3 normals;    <span class="comment">// è§†è§‰ç©ºé—´é¡¶ç‚¹æ³•å‘é‡</span></span><br><span class="line">out vec3 lightDir;    <span class="comment">// æŒ‡å‘å…‰æºçš„å‘é‡</span></span><br><span class="line">out vec3 halfVector;<span class="comment">// è§’å¹³åˆ†çº¿å‘é‡ H</span></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec3 _vertPos;    <span class="comment">// è§†è§‰ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    <span class="comment">// è¾“å‡ºé¡¶ç‚¹ä½ç½®ã€å…‰ç…§æ–¹å‘å’Œæ³•å‘é‡åˆ°å…‰æ …ç€è‰²å™¨è¿›è¡Œæ’å€¼</span></span><br><span class="line">    _vertPos = (mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">    lightDir = light.position - _vertPos;</span><br><span class="line">    normals = (norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">1.0</span>)).xyz;</span><br><span class="line">    halfVector = (lightDir + (-_vertPos)).xyz;</span><br><span class="line">    gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">    tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">    vec4 ambient;</span><br><span class="line">    vec4 diffuse;</span><br><span class="line">    vec4 specular;</span><br><span class="line">    <span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">in vec3 normals;</span><br><span class="line">in vec3 lightDir;</span><br><span class="line">in vec3 halfVector;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å½’ä¸€åŒ–å…‰ç…§å‘é‡ã€æ³•å‘é‡ã€è§†è§‰å‘é‡</span></span><br><span class="line">    vec3 L = <span class="built_in">normalize</span>(lightDir);</span><br><span class="line">    vec3 N = <span class="built_in">normalize</span>(normals);</span><br><span class="line">    vec3 H = <span class="built_in">normalize</span>(halfVector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å…‰ç…§ä¸å¹³é¢æ³•å‘é‡é—´çš„è§’åº¦</span></span><br><span class="line">    <span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">    <span class="comment">// è®¡ç®—æ³•å‘é‡ N ä¸è§’å¹³åˆ†çº¿å‘é‡ H ä¹‹é—´çš„è§’åº¦</span></span><br><span class="line">    <span class="type">float</span> cosPhi = <span class="built_in">dot</span>(H, N);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰åƒç´ è®¡ç®— ADS åˆ†é‡ï¼Œåˆå¹¶æ„å»ºè¾“å‡ºé¢œè‰²</span></span><br><span class="line">    vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">    vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(cosTheta, <span class="number">0.0</span>);</span><br><span class="line">    vec3 specular = light.specular.xyz * material.specular.xyz * <span class="built_in">pow</span>(<span class="built_in">max</span>(cosPhi, <span class="number">0.0</span>), material.shininess * <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">    vec4 textureColor = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">    vec4 lightColor = light.ambient + light.diffuse + light.specular;</span><br><span class="line">    vec4 stripLightColor = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    fragColor = <span class="number">0.3</span> * textureColor + <span class="number">0.7</span> * stripLightColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h2 id="å…«-é˜´å½±">å…«ã€é˜´å½±</h2>
<h3 id="8-1-æŠ•å½±é˜´å½±">8.1 æŠ•å½±é˜´å½±</h3>
<p>æŠ•å½±é˜´å½±ï¼šç»™å®šä¸€ä¸ªä½äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_1, y_1, z_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> çš„ç‚¹å…‰æºï¼Œä¸€ä¸ªéœ€è¦æ¸²æŸ“çš„ç‰©ä½“ï¼ˆç‰©ä½“ä¸Šçš„ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>z</mi><mi>w</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_w, y_w, z_w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼‰å’Œä¸€ä¸ªæŠ•å°„é˜´å½±çš„å¹³é¢ï¼Œå¯ä»¥é€šè¿‡ç”Ÿæˆä¸€ä¸ªå˜æ¢çŸ©é˜µï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_projectedShadow.png" alt="æŠ•å½±é˜´å½±"></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>w</mi></msub><mo separator="true">,</mo><msub><mi>z</mi><mi>w</mi></msub><mo stretchy="false">)</mo><mo>â†’</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>S</mi></msub><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><msub><mi>z</mi><mi>S</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_w, y_w, z_w)\rightarrow(x_S,0,z_S)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li>é€šå¸¸ä½¿ç”¨æš—è‰²ç‰©ä½“ä¸åœ°å¹³é¢çº¹ç†æ··åˆä½œä¸ºé˜´å½±çš„çº¹ç†ã€‚</li>
</ul>
<p>æŠ•å½±é˜´å½±æ˜“äºå®ç°ï¼Œä½†ä»…é€‚ç”¨äºå¹³å¦è¡¨é¢ã€‚</p>
<h3 id="8-2-é˜´å½±ä½“">8.2 é˜´å½±ä½“</h3>
<p>æ‰¾åˆ°è¢«ç‰©ä½“é˜´å½±è¦†ç›–çš„é˜´å½±ä½“ï¼Œä¹‹åå‡å°‘è§†ä½“ä¸é˜´å½±ä½“ç›¸äº¤éƒ¨åˆ†ä¸­çš„å¤šè¾¹å½¢çš„é¢œè‰²å¼ºåº¦ã€‚</p>
<p>é˜´å½±ä½“çš„ä¼˜ç‚¹åœ¨äºå…¶é«˜åº¦å‡†ç¡®ï¼Œæ¯”èµ·å…¶ä»–æ–¹æ³•æ¥æ›´ä¸å®¹æ˜“äº§ç”Ÿä¼ªå½±ã€‚</p>
<p>å‡ ä½•ç€è‰²å™¨å¯ä»¥ç”¨äºè®¡ç®—é˜´å½±ä½“ï¼Œæ¨¡æ¿ç¼“å†²åŒºå¯ä»¥ç”¨äºåˆ¤æ–­åƒç´ <br>
æ˜¯å¦åœ¨é˜´å½±ä½“å†…ã€‚æœ‰äº›æ˜¾å¡å¯¹äºç‰¹å®šçš„é˜´å½±ä½“æ“ä½œä¼˜åŒ–æä¾›äº†ç¡¬ä»¶æ”¯æŒã€‚</p>
<h3 id="8-3-é˜´å½±è´´å›¾">8.3 é˜´å½±è´´å›¾</h3>
<p>é˜´å½±è´´å›¾çš„æƒ³æ³•ï¼šå…‰çº¿æ— æ³•â€œçœ‹åˆ°â€çš„ä»»ä½•ä¸œè¥¿éƒ½åœ¨é˜´å½±ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯¹è±¡ 1 é˜»æŒ¡å…‰çº¿åˆ°è¾¾å¯¹è±¡ 2ï¼Œç­‰åŒäºå…‰çº¿ä¸èƒ½â€œçœ‹åˆ°â€å¯¹è±¡ 2</p>
<p>æ‰€ä»¥è®¡ç®—ç­–ç•¥æ˜¯ï¼šæš‚æ—¶å°†ç›¸æœºç§»åŠ¨åˆ°å…‰çš„ä½ç½®ï¼Œåº”ç”¨ Z-buffer ç®—æ³•ï¼Œç„¶åä½¿ç”¨ç”Ÿæˆçš„æ·±åº¦ä¿¡æ¯æ¥è®¡ç®—ã€‚</p>
<p>ç”±æ­¤å¯å¾—ï¼Œæ¸²æŸ“åœºæ™¯éœ€è¦ä¸¤è½®ï¼š</p>
<ul>
<li>ç¬¬ä¸€è½®ä»å…‰æºè§’åº¦æ¸²æŸ“åœºæ™¯ï¼ˆä¸ç»˜åˆ¶ï¼‰ã€‚å¯¹äºæ¯ä¸ªåƒç´ ï¼Œæ·±åº¦ç¼“å†²åŒºåŒ…å«å…‰æºä¸æœ€è¿‘çš„å¯¹è±¡ä¹‹é—´çš„è·ç¦»ã€‚
<ul>
<li>ç”Ÿæˆæ·±åº¦ç¼“å†²åŒºã€‚</li>
</ul>
</li>
<li>å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†å¯¹è±¡ã€‚
<ul>
<li>å½“çº¹ç†å¯¹è±¡ç”¨äºå‚¨å­˜é˜´å½±æ·±åº¦ä¿¡æ¯æ—¶ï¼Œç§°å…¶ä¸ºé˜´å½±çº¹ç†ã€‚</li>
<li>å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†ä¸­çš„è¿‡ç¨‹ç§°ä¸ºâ€œé˜´å½±è´´å›¾â€ã€‚</li>
</ul>
</li>
<li>ç¬¬äºŒè½®ä»ç›¸æœºè§’åº¦æ¸²æŸ“åœºæ™¯ï¼ˆæ­£å¸¸æ¸²æŸ“ï¼‰ã€‚å¯¹äºæ¯ä¸ªåƒç´ ï¼Œåœ¨é˜´å½±çº¹ç†ä¸­æŸ¥æ‰¾ç›¸åº”çš„ä½ç½®ã€‚
<ul>
<li>å¦‚æœç›¸æœºåˆ°æ¸²æŸ“ç‚¹çš„è·ç¦»å¤§äºä»é˜´å½±çº¹ç†æ£€ç´¢åˆ°çš„å€¼ï¼Œåˆ™åœ¨è¯¥åƒç´ å¤„ç»˜åˆ¶çš„å¯¹è±¡ç¦»å…‰æºçš„è·ç¦»æ¯”å½“å‰ç¦»å…‰æºæœ€è¿‘çš„å¯¹è±¡ç¦»å…‰æºæ›´è¿œï¼Œå¾—å‡ºè¯¥åƒç´ å¤„äºé˜´å½±ä¸­ã€‚</li>
</ul>
</li>
</ul>
<p>é˜´å½±çš„å¤„ç†ï¼šä»…æ¸²æŸ“ç¯å¢ƒå…‰ï¼Œå¿½ç•¥æ¼«åå°„å’Œé•œé¢åå°„åˆ†é‡ã€‚</p>
<h4 id="8-3-1-ç¬¬ä¸€è½®-ä»å…‰æºä½ç½®ç»˜åˆ¶">8.3.1 ç¬¬ä¸€è½®â€”â€”ä»å…‰æºä½ç½®ç»˜åˆ¶</h4>
<p>ç¬¬ä¸€è½®ä¸­å¹¶ä¸æ˜¯çœŸçš„åœ¨æ˜¾ç¤ºå…¶ä¸­ç»˜åˆ¶åœºæ™¯ï¼Œæ•…ä»…éœ€ç”¨åˆ°é¡¶ç‚¹ç€è‰²å™¨ã€‚</p>
<p>é€šè¿‡å˜æ¢çŸ©é˜µï¼ˆæ„å»ºè§‚å¯ŸçŸ©é˜µï¼‰ç§»åŠ¨ç›¸æœºï¼š</p>
<ul>
<li>ç›¸æœºç§»åŠ¨åˆ°å…‰æºçš„ä½ç½®</li>
<li>ç›¸æœºæ–¹å‘æœå‘å‘ˆç°çš„åŒºåŸŸ</li>
</ul>
<p>ç¬¬ä¸€è½®éœ€è¦å¤„ç†çš„ç»†èŠ‚ï¼š</p>
<ol>
<li>é…ç½®ç¼“å†²åŒºå’Œé˜´å½±çº¹ç†ã€‚</li>
<li>ç¦ç”¨é¢œè‰²è¾“å‡ºã€‚</li>
<li>åœ¨å…‰æºå¤„ä¸ºè§†é‡ä¸­çš„ç‰©ä½“æ„å»ºä¸€ä¸ª LookAt çŸ©é˜µã€‚</li>
<li>å¯ç”¨ GLSL ç¬¬ä¸€è½®ç€è‰²å™¨ç¨‹åºï¼Œå‡†å¤‡æ¥å— MVP çŸ©é˜µã€‚
<ul>
<li>Mï¼šå¯¹è±¡çš„æ¨¡å‹çŸ©é˜µ</li>
<li>Vï¼šLookAt çŸ©é˜µä½œä¸ºè§‚å¯ŸçŸ©é˜µ</li>
<li>Pï¼šé€è§†çŸ©é˜µ</li>
<li>è¯¥ MVP çŸ©é˜µ ç§°ä¸º <code>shadowMVP</code>ã€‚</li>
</ul>
</li>
<li>ä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ª <code>shadowMVP</code> çŸ©é˜µï¼Œå¹¶è°ƒç”¨ <code>glDrawArrays()</code>ã€‚</li>
</ol>
<p>é¡¶ç‚¹ç€è‰²å™¨å˜æˆï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> shadowMVP;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">gl_Position</span> = shadowMVP * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç‰‡æ®µç€è‰²å™¨å˜æˆï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"><span class="type">void</span> main() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-2-å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†">8.3.2 å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†</h4>
<p>OpenGL æä¾›äº†ä¸¤ç§å°†æ·±åº¦ç¼“å†²åŒºæ·±åº¦æ•°æ®æ”¾å…¥çº¹ç†å•å…ƒçš„æ–¹æ³•ï¼š</p>
<ol>
<li>ç”Ÿæˆç©ºé˜´å½±çº¹ç†ï¼Œç„¶åä½¿ç”¨å‘½ä»¤ <code>glCopyTexImage2D()</code> å°†æ´»åŠ¨çš„æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°é˜´å½±çº¹ç†ä¸­ã€‚</li>
<li>åœ¨ç¬¬ä¸€è½®ä¸­æ„å»ºâ€œè‡ªå®šä¹‰å¸§ç¼“å†²åŒºâ€ï¼Œå¹¶ä½¿ç”¨å‘½ä»¤ <code>glFrameBufferTexture2D()</code> å°†é˜´å½±çº¹ç†é™„åŠ åˆ°ä¸Šé¢ã€‚
<ul>
<li>ä½¿ç”¨è¯¥æ–¹æ³•æ— é¡»å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†ï¼Œå› ä¸ºç¼“å†²åŒºå·²ç»é™„åŠ äº†çº¹ç†ï¼Œæ·±åº¦ä¿¡æ¯ç”± OpenGL è‡ªåŠ¨æ”¾å…¥çº¹ç†ä¸­ã€‚</li>
</ul>
</li>
</ol>
<h4 id="8-3-3-ç¬¬äºŒè½®-ä»ç›¸æœºä½ç½®ç»˜åˆ¶">8.3.3 ç¬¬äºŒè½®â€”â€”ä»ç›¸æœºä½ç½®ç»˜åˆ¶</h4>
<p>ç¬¬äºŒè½®éœ€è¦æ¸²æŸ“å®Œæ•´çš„åœºæ™¯ã€å…¶ä¸­çš„æ‰€æœ‰ç‰©ä½“ä»¥åŠå…‰ç…§ã€æè´¨å’Œè£…é¥°åœºæ™¯ä¸­ç‰©ä½“çš„çº¹ç†ï¼ŒåŒæ—¶è¿˜ç¡®å®šé˜´å½±ã€‚</p>
<p>ä½¿ç”¨ä¸¤ä¸ª MVP çŸ©é˜µï¼š</p>
<ol>
<li>ä¸€ä¸ªå°†å¯¹è±¡åæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡çš„æ ‡å‡† MVP çŸ©é˜µï¼ˆåƒä¹‹å‰ä¸€æ ·ï¼‰ï¼›</li>
<li>ä¸€ä¸ªæ˜¯ç¬¬ä¸€è½®ç”Ÿæˆçš„ shadowMVP çŸ©é˜µï¼Œç”¨äºä»å…‰æºçš„è§’åº¦è¿›è¡Œæ¸²æŸ“ï¼Œå³ä»é˜´å½±çº¹ç†ä¸­æŸ¥æ‰¾æ·±åº¦ä¿¡æ¯ã€‚</li>
</ol>
<p>ä»çº¹ç†è´´å›¾æŸ¥æ‰¾åƒç´ æ—¶ï¼Œåº”è¯¥å¤„ç† OpenGL ç›¸æœºç©ºé—´ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-1,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> è€Œçº¹ç†è´´å›¾ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> ç©ºé—´çš„é—®é¢˜ï¼š</p>
<ul>
<li>ä½¿ç”¨é¢å¤–çš„å˜æ¢çŸ©é˜µ  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span>ã€‚
<ul>
<li>ç”¨äºä»ç›¸æœºç©ºé—´åˆ°çº¹ç†ç©ºé—´çš„è½¬æ¢</li>
</ul>
</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">B = \begin{bmatrix}
0.5 &amp; 0 &amp; 0 &amp; 0.5 \\
0 &amp; 0.5 &amp; 0 &amp; 0.5 \\
0 &amp; 0 &amp; 0.5 &amp; 0.5 \\
0 &amp; 0 &amp; 0 &amp; 1\\
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>å°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> å’Œ <code>shadowMVP</code> çŸ©é˜µç›¸ä¹˜ï¼Œå¾—åˆ° <code>shadowMVP2</code> çŸ©é˜µã€‚</p>
<p>ç¬¬äºŒè½®çš„å¤§æ¦‚æ“ä½œï¼š</p>
<ol>
<li>æ„å»ºå˜æ¢çŸ©é˜µ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span>ï¼Œç”¨äºä»å…‰ç…§ç©ºé—´è½¬æ¢åˆ°çº¹ç†ç©ºé—´ã€‚</li>
<li>å¯ç”¨é˜´å½±çº¹ç†ï¼Œè¿›è¡ŒæŸ¥æ‰¾ã€‚</li>
<li>å¯ç”¨é¢œè‰²è¾“å‡ºã€‚</li>
<li>å¯ç”¨ GLSL ç¬¬äºŒè½®æ¸²æŸ“ç¨‹åºã€‚</li>
<li>æ ¹æ®ç›¸æœºæ­£å¸¸ä½ç½®ä¸ºå¯¹è±¡æ„å»º MVP çŸ©é˜µã€‚</li>
<li>æ„å»º shadowMVP2 çŸ©é˜µã€‚ç€è‰²å™¨ç”¨å…¶æŸ¥æ‰¾é˜´å½±çº¹ç†ä¸­çš„åƒç´ åæ ‡ã€‚</li>
<li>å°†ç”Ÿæˆçš„å˜æ¢çŸ©é˜µå‘é€åˆ°ç€è‰²å™¨ç»Ÿä¸€å˜é‡ã€‚</li>
<li>å¯ç”¨åŒ…å«é¡¶ç‚¹ã€æ³•å‘é‡å’Œçº¹ç†åæ ‡çš„ç¼“å†²åŒºã€‚</li>
<li>è°ƒç”¨ <code>glDrawArrays()</code>ã€‚</li>
</ol>
<p>ç€è‰²å™¨çš„å·¥ä½œï¼š</p>
<ul>
<li>é¡¶ç‚¹ç€è‰²å™¨å°†é¡¶ç‚¹ä½ç½®ä»ç›¸æœºç©ºé—´è½¬æ¢ä¸ºå…‰ç…§ç©ºé—´ï¼Œå°†ç»“æœå‘é€åˆ°é¡¶ç‚¹å±æ€§ä¸­çš„ç‰‡æ®µç€è‰²å™¨ã€‚</li>
<li>ç‰‡æ®µç€è‰²å™¨è°ƒç”¨ <code>textureProj()</code> å‡½æ•°æŒ‡ç¤ºåƒç´ æ˜¯å¦å¤„äºå¼•ç”¨ä¸­ï¼ˆè¿”å›0æˆ–1ï¼‰ã€‚å¦‚æœä½äºé˜´å½±ä¸­ï¼Œåˆ™å‰”é™¤æ¼«åå°„å’Œé•œé¢åå°„ã€‚
<ul>
<li>ä½¿ç”¨ç‰¹æ®Šé‡‡æ ·å™¨å˜é‡ç±»å‹ <code>sampler2DShadow</code>ï¼Œå¯ä»¥é™„åŠ åˆ°ç¨‹åºä¸­çš„é˜´å½±çº¹ç†ä¸­ã€‚</li>
</ul>
</li>
</ul>
<p>å…³æ³¨ç»†èŠ‚ï¼šæ­£åœ¨æ¸²æŸ“çš„åƒç´ å’Œé˜´å½±çº¹ç†ä¸­çš„å€¼çš„æ·±åº¦æ¯”è¾ƒ</p>
<ol>
<li>åœ¨æ¨¡å‹ç©ºé—´ä¸­ä½¿ç”¨é¡¶ç‚¹åæ ‡ï¼Œä¸ shadowMVP2 ç›¸ä¹˜ç”Ÿæˆé˜´å½±çº¹ç†åæ ‡ï¼ˆå¯¹åº”äºæŠ•å½±åˆ°å…‰ç…§ç©ºé—´ä¸­çš„é¡¶ç‚¹åæ ‡ï¼Œæ˜¯ä¹‹å‰ä»å…‰æºè§†è§’ç”Ÿæˆçš„ï¼‰ã€‚</li>
<li>ç»è¿‡æ’å€¼åçš„å…‰ç…§ç©ºé—´ï¼ˆ3Dï¼‰åæ ‡ (x, y, z) åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ä½¿ç”¨æƒ…å†µï¼š
<ul>
<li>z åˆ†é‡è¡¨ç¤ºä»å…‰åˆ°åƒç´ çš„è·ç¦»ï¼›</li>
<li>(x, y) åˆ†é‡ç”¨äºæ£€ç´¢å­˜å‚¨åœ¨é˜´å½±çº¹ç†ï¼ˆ2Dï¼‰ä¸­çš„æ·±åº¦ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>å°†è¯¥æ£€ç´¢çš„å€¼ï¼ˆåˆ°æœ€é è¿‘å…‰çš„ç‰©ä½“çš„è·ç¦»ï¼‰ä¸ z è¿›è¡Œæ¯”è¾ƒã€‚</li>
</ol>
<p>ä¾‹å­æ•ˆæœå±•ç¤ºå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_shadow.jpg" alt="å…‰ä»å·¦å¾€å³å‘å‡º"></p>
<p>ä»£ç ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">5</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line">GLuint renderProgram1, renderProgram2;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc, nLoc, sLoc;</span><br><span class="line">GLuint textureID;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;	<span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];	<span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æè´¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> *ambient, *diffuse, *specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Material gold&#123; Util::<span class="built_in">goldAmbient</span>(), Util::<span class="built_in">goldDiffuse</span>(), Util::<span class="built_in">goldSpecular</span>(), Util::<span class="built_in">goldShininess</span>() &#125;;</span><br><span class="line">Material silver&#123; Util::<span class="built_in">silverAmbient</span>(), Util::<span class="built_in">silverDiffuse</span>(), Util::<span class="built_in">silverSpecular</span>(), Util::<span class="built_in">silverShininess</span>() &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜´å½±ç›¸å…³</span></span><br><span class="line"><span class="type">int</span> scSizeX, scSizeY;</span><br><span class="line">GLuint shadowTex, shadowBuffer;</span><br><span class="line">glm::mat4 lightVmatrix, lightPmatrix;</span><br><span class="line">glm::mat4 shadowMVP1, shadowMVP2;</span><br><span class="line">glm::mat4 b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹ç›¸å…³</span></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model1</span><span class="params">(<span class="number">48</span>, <span class="number">0.6f</span>, <span class="number">0.4f</span>)</span></span>;</span><br><span class="line"><span class="comment">// åŠ è½½çš„æ¨¡å‹è¿˜ä¸èƒ½ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model2</span><span class="params">(<span class="string">&quot;model/pyr.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ç½®ç›¸å…³</span></span><br><span class="line"><span class="function">glm::vec3 <span class="title">cameraLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">6.0f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">lightLoc</span><span class="params">(<span class="number">-3.8f</span>, <span class="number">2.2f</span>, <span class="number">1.1f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">model1Loc</span><span class="params">(<span class="number">1.6f</span>, <span class="number">0.0f</span>, <span class="number">-0.3f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">model2Loc</span><span class="params">(<span class="number">-1.0f</span>, <span class="number">0.1f</span>, <span class="number">0.3f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(GLuint renderProgram, glm::mat4 vMatrix, Material &amp;m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, m.ambient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, m.diffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, m.specular);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, m.shininess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// model1çš„é¡¶ç‚¹æ„å»º</span></span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; model1Ind = model<span class="number">1.</span><span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model<span class="number">1.</span><span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model<span class="number">1.</span><span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; model1Pvalues;	<span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; model1Nvalues;	<span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model<span class="number">1.</span><span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		model1Pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		model1Pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		model1Pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		model1Nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		model1Nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		model1Nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// model2çš„é¡¶ç‚¹æ„å»º</span></span><br><span class="line">	vert = model<span class="number">2.</span><span class="built_in">getVertices</span>();</span><br><span class="line">	norm = model<span class="number">2.</span><span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; model2Pvalues;	<span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; model2Nvalues;	<span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model<span class="number">2.</span><span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		model2Pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		model2Pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		model2Pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		model2Nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		model2Nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		model2Nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// model1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * model1Pvalues.<span class="built_in">size</span>(), &amp;model1Pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * model1Nvalues.<span class="built_in">size</span>(), &amp;model1Nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * model1Ind.<span class="built_in">size</span>(), &amp;model1Ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// model2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * model2Pvalues.<span class="built_in">size</span>(), &amp;model2Pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * model2Nvalues.<span class="built_in">size</span>(), &amp;model2Nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupShadowBuffers</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	scSizeX = width;</span><br><span class="line">	scSizeY = height;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ›å»ºè‡ªå®šä¹‰å¸§ç¼“å†²åŒº</span></span><br><span class="line">	<span class="built_in">glGenFramebuffers</span>(<span class="number">1</span>, &amp;shadowBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆ›å»ºé˜´å½±çº¹ç†å¹¶è®©å®ƒå­˜å‚¨æ·±åº¦ä¿¡æ¯</span></span><br><span class="line">	<span class="built_in">glGenTextures</span>(<span class="number">1</span>, &amp;shadowTex);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, shadowTex);</span><br><span class="line">	<span class="built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="number">0</span>, GL_DEPTH_COMPONENT32,</span><br><span class="line">		scSizeX, scSizeY, <span class="number">0</span>, GL_DEPTH_COMPONENT, GL_FLOAT, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_COMPARE_MODE, GL_COMPARE_REF_TO_TEXTURE);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_COMPARE_FUNC, GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram1 = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;shadows/vertex1.glsl&quot;</span>, <span class="string">&quot;shadows/fragment1.glsl&quot;</span>);</span><br><span class="line">	renderProgram2 = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;shadows/vertex2.glsl&quot;</span>, <span class="string">&quot;shadows/fragment2.glsl&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	<span class="built_in">setupShadowBuffers</span>(window);</span><br><span class="line"></span><br><span class="line">	b = glm::<span class="built_in">mat4</span>(</span><br><span class="line">		<span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">passOne</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram1);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶model1</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), model1Loc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">25.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	shadowMVP1 = lightPmatrix * lightVmatrix * mMat;</span><br><span class="line">	sLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram1, <span class="string">&quot;shadowMVP&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(sLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(shadowMVP1));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model<span class="number">1.</span><span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶model2</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), model2Loc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">40.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	shadowMVP1 = lightPmatrix * lightVmatrix * mMat;</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(sLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(shadowMVP1));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model<span class="number">2.</span><span class="built_in">getNumVertices</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">passTwo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram2);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram2, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram2, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram2, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line">	sLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram2, <span class="string">&quot;shadowMVP&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraLoc.x, -cameraLoc.y, -cameraLoc.z));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶model1</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), model1Loc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">25.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(lightLoc);</span><br><span class="line">	<span class="built_in">installLights</span>(renderProgram2, vMat, gold);</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line">	shadowMVP2 = b * lightPmatrix * lightVmatrix * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(sLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(shadowMVP2));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model<span class="number">1.</span><span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶model2</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), model2Loc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">40.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(lightLoc);</span><br><span class="line">	<span class="built_in">installLights</span>(renderProgram2, vMat, silver);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line">	shadowMVP2 = b * lightPmatrix * lightVmatrix * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(sLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(shadowMVP2));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model<span class="number">2.</span><span class="built_in">getNumVertices</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(lightLoc);</span><br><span class="line">	lightVmatrix = glm::<span class="built_in">lookAt</span>(currentLightPos, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	lightPmatrix = glm::<span class="built_in">perspective</span>(<span class="number">60.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, shadowBuffer);</span><br><span class="line">	<span class="built_in">glFramebufferTexture</span>(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, shadowTex, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDrawBuffer</span>(GL_NONE);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_POLYGON_OFFSET_FILL);</span><br><span class="line">	<span class="built_in">glPolygonOffset</span>(<span class="number">2.0f</span>, <span class="number">4.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">passOne</span>();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDisable</span>(GL_POLYGON_OFFSET_FILL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, shadowTex);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDrawBuffer</span>(GL_FRONT);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">passTwo</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Light&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ç¬¬ä¸€è½®çš„ç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex1.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> shadowMVP;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">gl_Position</span> = shadowMVP * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment1.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()&#123;&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ç¬¬äºŒè½®çš„ç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex2.glsl</span></span><br><span class="line"><span class="meta">#version 460</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Material</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertNormal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> vNormal, vLightDir, vVertPos, vHalfVec;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> shadowCoord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec4</span> globalAmbient;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"><span class="keyword">uniform</span> Material material;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> shadowMVP;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// è¾“å‡ºé¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	vVertPos = (mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	<span class="comment">// è·å–ä¸€ä¸ªä»é¡¶ç‚¹åˆ°å…‰çº¿çš„å‘é‡å¹¶è¾“å‡º</span></span><br><span class="line">	vLightDir = light.position - vVertPos;</span><br><span class="line">	<span class="comment">// åœ¨è§†å›¾ç©ºé—´ä¸­è·å¾—ä¸€ä¸ªé¡¶ç‚¹æ³•å‘é‡è¾“å‡º</span></span><br><span class="line">	vNormal = (norm_matrix * <span class="type">vec4</span>(vertNormal, <span class="number">0.0</span>)).xyz;</span><br><span class="line">	<span class="comment">// è®¡ç®—é¡¶ç‚¹çš„åŠå‘é‡</span></span><br><span class="line">	vHalfVec = (vLightDir - vVertPos).xyz;</span><br><span class="line"></span><br><span class="line">	shadowCoord = shadowMVP * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment2.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Material</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> vNormal, vLightDir, vVertPos, vHalfVec;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec4</span> shadowCoord;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec4</span> globalAmbient;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"><span class="keyword">uniform</span> Material material;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> shadowMVP;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2DShadow</span> shadowTex;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec3</span> L = <span class="built_in">normalize</span>(vLightDir);</span><br><span class="line">	<span class="type">vec3</span> N = <span class="built_in">normalize</span>(vNormal);</span><br><span class="line">	<span class="type">vec3</span> V = <span class="built_in">normalize</span>(-vVertPos);</span><br><span class="line">	<span class="type">vec3</span> H = <span class="built_in">normalize</span>(vHalfVec);</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> inShadow = <span class="built_in">textureProj</span>(shadowTex, shadowCoord);</span><br><span class="line"></span><br><span class="line">	fragColor = globalAmbient * material.ambient + light.ambient * material.ambient;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (inShadow != <span class="number">0.0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		fragColor +=</span><br><span class="line">			light.diffuse * material.diffuse * <span class="built_in">max</span>(<span class="built_in">dot</span>(L, N), <span class="number">0.0</span>) +</span><br><span class="line">			light.specular * material.specular * <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="built_in">dot</span>(H, N), <span class="number">0.0</span>), material.shininess * <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="8-4-æŸ”å’Œé˜´å½±">8.4 æŸ”å’Œé˜´å½±</h3>
<p>ä½¿ç”¨ç™¾åˆ†æ¯”ä¸´è¿‘æ»¤æ³¢ PCF ç”ŸæˆæŸ”å’Œé˜´å½±ã€‚</p>
<p>ä¸€ç§ç”¨äºå®ç° PCF çš„å¸¸è§ç®—æ³•æ˜¯ï¼š</p>
<ul>
<li>å¯¹æ¯ä¸ªåƒç´ é™„è¿‘çš„ 4 ä¸ªçº¹å…ƒï¼ˆçº¹ç†å›¾åƒåƒç´ ï¼‰è¿›è¡Œé‡‡æ ·ï¼Œå…¶ä¸­æ ·æœ¬é€šè¿‡åƒç´ å¯¹åº”çº¹å…ƒçš„ç‰¹å®šåç§»é‡é€‰æ‹©ã€‚</li>
<li>å¯¹äºæ¯ä¸ªåƒç´ ï¼Œéƒ½éœ€è¦æ”¹å˜åç§»é‡ï¼Œå¹¶ç”¨æ–°çš„åç§»é‡ç¡®å®šé‡‡æ ·çš„ 4 ä¸ªçº¹å…ƒã€‚</li>
<li>ä½¿ç”¨äº¤é”™çš„æ–¹å¼æ”¹å˜åç§»é‡çš„æ–¹æ³•è¢«ç§°ä¸ºæŠ–åŠ¨ï¼Œå®ƒæ—¨åœ¨ä½¿æŸ”å’Œé˜´å½±çš„è¾¹ç•Œä¸ä¼šç”±äºé‡‡æ ·ç‚¹ä¸è¶³è€Œçœ‹èµ·æ¥â€œç»“å—â€ã€‚</li>
</ul>
<p>å‡è®¾æœ‰4ç§åç§»æ¨¡å¼ï¼Œæ¯æ¬¡å–ä¸€ç§è®¡ç®—åƒç´  <code>glFragCorrd mod 2</code> å€¼é€‰æ‹©å½“å‰åç§»ï¼Œç»“æœå¯èƒ½ä¸ºï¼š(0,0)ã€(1,0)ã€(0,1)ã€(1,1)ã€‚</p>
<p>åç§»æ¨¡å¼é€šå¸¸åœ¨ x å’Œ y æ–¹å‘ä¸ŠæŒ‡å®šï¼Œå…·æœ‰-1.5ã€-0.5ã€+0.5å’Œ+1.5ä¸åŒç»„åˆï¼š</p>
<p>4ç§è®¡ç®—ç»“æœå¯¹åº”çš„åç§»æ¨¡å¼é‡‡æ ·ç‚¹å¦‚ä¸‹è¡¨</p>
<table>
<thead>
<tr>
<th style="text-align:center">è®¡ç®—ç»“æœ</th>
<th style="text-align:center">(0,0)</th>
<th style="text-align:center">(0,1)</th>
<th style="text-align:center">(1,0)</th>
<th style="text-align:center">(1,1)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-1.5,s_y+1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-1.5,s_y+0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-0.5,s_y+1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-0.5,s_y+0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-1.5,s_y-0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-1.5,s_y-1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-0.5,s_y-0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x-0.5,s_y-1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+0.5,s_y+1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+0.5,s_y+0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+1.5,s_y+1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>+</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+1.5,s_y+0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+0.5,s_y-0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>0.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+0.5,s_y-1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+1.5,s_y-0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>x</mi></msub><mo>+</mo><mn>1.5</mn><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo>âˆ’</mo><mn>1.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s_x+1.5,s_y-1.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9305479999999999em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></td>
</tr>
</tbody>
</table>
<p>å‡è®¾éšä¾¿ä¸€ç»„ï¼Œå¯¹å…¶4ä¸ªé‡‡æ ·ç‚¹åˆ†åˆ«è°ƒç”¨ <code>textureProj()</code>ï¼Œå°†å¾—åˆ°çš„4ä¸ªç»“æœç›¸åŠ æ±‚å¹³å‡ï¼Œç¡®å®šé˜´å½±ä¸­é‡‡æ ·ç‚¹çš„ç™¾åˆ†æ¯”ï¼Œä»¥æ­¤ç™¾åˆ†æ¯”ä½œç³»æ•°ï¼Œç¡®å®šæ¸²æŸ“å½“å‰åƒç´ æ—¶è¦åº”ç”¨çš„æ¼«åå°„å’Œé•œé¢åå°„åˆ†é‡ã€‚</p>
<p>é‡‡æ ·ç‚¹å¯ä»¥æœ‰å¤šä¸ªï¼Œä½†æ¸²æŸ“é€Ÿåº¦ä¹Ÿä¼šéšä¹‹ä¸‹é™ã€‚</p>
<p>64ä¸ªé‡‡æ ·ç‚¹æŸ”å’Œé˜´å½±æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_softShadows.jpg" alt="æŸ”å’Œé˜´å½±"></p>
<p>ä»…éœ€ä¿®æ”¹ç¬¬äºŒè½®çš„ç‰‡æ®µç€è‰²å™¨ï¼š</p>
<details><summary>fragment2.glsl</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Material</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient, diffuse, specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> vNormal, vLightDir, vVertPos, vHalfVec;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec4</span> shadowCoord;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec4</span> globalAmbient;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"><span class="keyword">uniform</span> Material material;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> shadowMVP;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2DShadow</span> shadowTex;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> lookup(<span class="type">float</span> ox, <span class="type">float</span> oy)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> t = <span class="built_in">textureProj</span>(shadowTex,</span><br><span class="line">		shadowCoord + <span class="type">vec4</span>(ox * <span class="number">0.001</span> * shadowCoord.w, oy * <span class="number">0.001</span> * shadowCoord.w,</span><br><span class="line">			<span class="number">-0.01</span>, <span class="number">0.0</span>));</span><br><span class="line">	<span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> shadowFactor = <span class="number">0.0</span>;</span><br><span class="line">	<span class="type">vec3</span> L = <span class="built_in">normalize</span>(vLightDir);</span><br><span class="line">	<span class="type">vec3</span> N = <span class="built_in">normalize</span>(vNormal);</span><br><span class="line">	<span class="type">vec3</span> V = <span class="built_in">normalize</span>(-vVertPos);</span><br><span class="line">	<span class="type">vec3</span> H = <span class="built_in">normalize</span>(vHalfVec);</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> swidth = <span class="number">2.5</span>;	<span class="comment">// å¯è°ƒæ•´çš„é˜´å½±æ‰©æ•£é‡</span></span><br><span class="line">	<span class="comment">// 64 ä¸ªé‡‡æ ·ç‚¹</span></span><br><span class="line">	<span class="type">float</span> endp = swidth * <span class="number">3.0</span> + swidth / <span class="number">2.0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">float</span> m = -endp; m &lt;= endp; m += swidth)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">float</span> n = -endp; n &lt;= endp; n += swidth)</span><br><span class="line">			shadowFactor += lookup(m, n);</span><br><span class="line"></span><br><span class="line">	shadowFactor /= <span class="number">64.0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">vec4</span> shadowColor = globalAmbient * material.ambient + light.ambient * material.ambient;</span><br><span class="line">	<span class="type">vec4</span> lightedColor = light.diffuse * material.diffuse * <span class="built_in">max</span>(<span class="built_in">dot</span>(L, N), <span class="number">0.0</span>) +</span><br><span class="line">		light.specular * material.specular *</span><br><span class="line">		<span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="built_in">dot</span>(H, N), <span class="number">0.0</span>), material.shininess * <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">	fragColor = <span class="type">vec4</span>((shadowColor.xyz + shadowFactor * (lightedColor.xyz)), <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>æœ‰äº›æ—¶å€™ï¼Œåœ¨åœºæ™¯ä¸­çš„æŸäº›å¯¹è±¡æ‹¥æœ‰çº¹ç†æ—¶ï¼Œæ·»åŠ é˜´å½±æ—¶å¿…é¡»ç¡®ä¿ç‰‡æ®µç€è‰²å™¨æ­£ç¡®åŒºåˆ†é˜´å½±çº¹ç†å’Œå…¶ä»–çº¹ç†ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å°†å®ƒä»¬ç»‘å®šåˆ°ä¸åŒçš„çº¹ç†å•å…ƒï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2DShadow</span> shadowTex;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">1</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> tex;</span><br></pre></td></tr></table></figure>
<p>ç„¶åé€šè¿‡ç»‘å®šå€¼å¼•ç”¨ä¸¤ä¸ªé‡‡æ ·å™¨ã€‚</p>
<p>å½“åœºæ™¯ä½¿ç”¨å¤šä¸ªç¯å…‰æ—¶ï¼Œåˆ™éœ€è¦å¤šä¸ªé˜´å½±çº¹ç†ï¼Œå³æ¯ä¸ªå…‰æºéœ€è¦ä¸€ä¸ªé˜´å½±çº¹ç†ã€‚</p>
<ul>
<li>æ¯ä¸ªå…‰æºéƒ½éœ€è¦å•ç‹¬æ‰§è¡Œç¬¬ 1 è½®æ¸²æŸ“ï¼Œå¹¶åœ¨ç¬¬ 2 è½®æ¸²æŸ“ä¸­åˆå¹¶ç»“æœã€‚</li>
</ul>
<h2 id="ä¹-å¤©ç©ºå’ŒèƒŒæ™¯">ä¹ã€å¤©ç©ºå’ŒèƒŒæ™¯</h2>
<h3 id="9-1-å¤©ç©ºç›’">9.1 å¤©ç©ºç›’</h3>
<p>å¤©ç©ºç›’ï¼š</p>
<ol>
<li>å®ä¾‹åŒ–ä¸€ä¸ªç«‹æ–¹ä½“å¯¹è±¡</li>
<li>å°†ç«‹æ–¹ä½“çš„çº¹ç†è®¾ç½®ä¸ºæ‰€éœ€çš„ç¯å¢ƒ</li>
<li>å°†ç«‹æ–¹ä½“å›´ç»•ç›¸æœºè®¾ç½®</li>
</ol>
<p>å¦‚ä½•ä¸ºåœ°å¹³çº¿åˆ¶ä½œçº¹ç†ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªåŒ…å«6ä¸ªé¢çš„çº¹ç†å›¾åƒã€‚</li>
<li>å¯ä½¿ç”¨ Terragenã€Blenderã€PSç­‰è½¯ä»¶å·¥å…·è¾…åŠ©æ„å»ºè´´å›¾å›¾åƒã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_cubeTexCoord.png" alt="ç«‹æ–¹ä½“è´´å›¾çº¹ç†åæ ‡"></p>
<p>å¦‚ä½•è®©å¤©ç©ºç›’çœ‹èµ·æ¥è·ç¦»å¾ˆè¿œï¼š</p>
<ul>
<li>ç¡®ä¿çº¹ç†è¡¨ç°çœ‹èµ·æ¥åƒè¿œå¤„çš„åœ°å¹³çº¿ã€‚</li>
<li>ç¦ç”¨æ·±åº¦æµ‹è¯•å¹¶å…ˆæ¸²æŸ“å¤©ç©ºç›’ï¼Œç„¶åå¯ç”¨æ·±åº¦æµ‹è¯•å†æ¸²æŸ“å…¶ä»–å¯¹è±¡ã€‚
<ul>
<li>æ·±åº¦ç¼“å†²åŒºçš„å€¼ä»å…¨è®¾ä¸º1.0ï¼ˆæœ€è¿œè·ç¦»ï¼‰ã€‚</li>
</ul>
</li>
<li>ä½¿å¤©ç©ºç›’éšç€ç›¸æœºç§»åŠ¨ã€‚</li>
</ul>
<h3 id="9-2-ç©¹é¡¶">9.2 ç©¹é¡¶</h3>
<p>ä¸å¤©ç©ºç›’ç±»ä¼¼ï¼Œä¸è¿‡ä½¿ç”¨å¸¦çº¹ç†çš„çƒä½“æˆ–åŠçƒä½“ä»£æ›¿å¸¦çº¹ç†çš„ç«‹æ–¹ä½“ã€‚</p>
<p>ä¸€æ ·éœ€è¦å…ˆç¦ç”¨æ·±åº¦æµ‹è¯•æ¸²æŸ“ç©¹é¡¶ï¼Œå†å°†ç›¸æœºç½®äºç©¹é¡¶çš„ä¸­å¿ƒä½ç½®ã€‚</p>
<p>ç©¹é¡¶ç›¸æ¯”å¤©ç©ºç›’ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸æ˜“å—åˆ°ç•¸å˜å’Œæ¥ç¼çš„å½±å“ï¼ˆå°½ç®¡åœ¨çº¹ç†å›¾åƒ<br>
ä¸­å¿…é¡»è€ƒè™‘æç‚¹å¤„çš„çƒå½¢ç•¸å˜ï¼‰ã€‚</li>
<li>ç¼ºç‚¹ï¼šçƒä½“æˆ–ç©¹é¡¶æ¨¡å‹æ¯”ç«‹æ–¹ä½“æ¨¡å‹æ›´å¤æ‚ï¼Œç©¹é¡¶æœ‰æ›´å¤šçš„é¡¶ç‚¹ï¼Œå…¶æ•°é‡å–å†³äºæœŸæœ›çš„ç²¾åº¦ã€‚</li>
</ul>
<h3 id="9-3-å®ç°å¤©ç©ºç›’">9.3 å®ç°å¤©ç©ºç›’</h3>
<h4 id="9-3-1-ä»å¤´å¼€å§‹æ„å»ºå¤©ç©ºç›’">9.3.1 ä»å¤´å¼€å§‹æ„å»ºå¤©ç©ºç›’</h4>
<p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_skybox.jpg" alt="å¤©ç©ºç›’"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">5</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line">GLuint textureID, skyboxTex;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹ç›¸å…³</span></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"><span class="comment">// åŠ è½½çš„æ¨¡å‹è¿˜ä¸èƒ½ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="comment">//ImportedModel model2(&quot;model/pyr.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ç½®ç›¸å…³</span></span><br><span class="line"><span class="function">glm::vec3 <span class="title">cameraLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">5.0f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">modelLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">-0.75</span>, <span class="number">0.0f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ç«‹æ–¹ä½“å¤©ç©ºç›’</span></span><br><span class="line">	<span class="type">float</span> cubeVertexPositions[<span class="number">108</span>] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">float</span> cubeTextureCoord[<span class="number">72</span>] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">1.00f</span>, <span class="number">0.666666f</span>, <span class="number">1.00f</span>, <span class="number">0.333333f</span>, <span class="number">0.75f</span>, <span class="number">0.333333f</span>,</span><br><span class="line">		<span class="number">0.75f</span>, <span class="number">0.333333f</span>, <span class="number">0.75f</span>, <span class="number">0.666666f</span>, <span class="number">1.00f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.75f</span>, <span class="number">0.333333f</span>, <span class="number">0.50f</span>, <span class="number">0.333333f</span>, <span class="number">0.75f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.50f</span>, <span class="number">0.333333f</span>, <span class="number">0.50f</span>, <span class="number">0.666666f</span>, <span class="number">0.75f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.50f</span>, <span class="number">0.333333f</span>, <span class="number">0.25f</span>, <span class="number">0.333333f</span>, <span class="number">0.50f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.25f</span>, <span class="number">0.333333f</span>, <span class="number">0.25f</span>, <span class="number">0.666666f</span>, <span class="number">0.50f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.25f</span>, <span class="number">0.333333f</span>, <span class="number">0.00f</span>, <span class="number">0.333333f</span>, <span class="number">0.25f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.00f</span>, <span class="number">0.333333f</span>, <span class="number">0.00f</span>, <span class="number">0.666666f</span>, <span class="number">0.25f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.25f</span>, <span class="number">0.333333f</span>, <span class="number">0.50f</span>, <span class="number">0.333333f</span>, <span class="number">0.50f</span>, <span class="number">0.000000f</span>,</span><br><span class="line">		<span class="number">0.50f</span>, <span class="number">0.000000f</span>, <span class="number">0.25f</span>, <span class="number">0.000000f</span>, <span class="number">0.25f</span>, <span class="number">0.333333f</span>,</span><br><span class="line">		<span class="number">0.25f</span>, <span class="number">1.000000f</span>, <span class="number">0.50f</span>, <span class="number">1.000000f</span>, <span class="number">0.50f</span>, <span class="number">0.666666f</span>,</span><br><span class="line">		<span class="number">0.50f</span>, <span class="number">0.666666f</span>, <span class="number">0.25f</span>, <span class="number">0.666666f</span>, <span class="number">0.25f</span>, <span class="number">1.000000f</span>,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; modelInd = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelPvalues;	<span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelTvalues;	<span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelNvalues;	<span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(cubeVertexPositions), cubeVertexPositions, GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(cubeTextureCoord), cubeTextureCoord, GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// model</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelPvalues.<span class="built_in">size</span>(), &amp;modelPvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelTvalues.<span class="built_in">size</span>(), &amp;modelTvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * modelInd.<span class="built_in">size</span>(), &amp;modelInd[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/brick1.jpg&quot;</span>);</span><br><span class="line">	skyboxTex = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/alien.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraLoc.x, -cameraLoc.y, -cameraLoc.z));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line">	<span class="comment">// å‡†å¤‡ç»˜åˆ¶å¤©ç©ºç›’ã€‚æ¨¡å‹çŸ©é˜µå°†å¤©ç©ºç›’æ”¾ç½®åœ¨ç›¸æœºä½ç½®</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), cameraLoc);</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, skyboxTex);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);    <span class="comment">// è§‚å¯Ÿç«‹æ–¹ä½“å†…éƒ¨ï¼Œåè½¬æ–¹å‘</span></span><br><span class="line">	<span class="built_in">glDisable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="comment">// æ— æ·±åº¦æµ‹è¯•ä¸‹ç»˜åˆ¶å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶åœºæ™¯å¯¹è±¡</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), modelLoc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, glm::<span class="built_in">radians</span>(<span class="number">15.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Skybox&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec2</span> texCoord;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec2</span> tc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	tc = texCoord;</span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec2</span> tc;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> s;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	fragColor = <span class="built_in">texture</span>(s, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h4 id="9-3-2-ä½¿ç”¨openglç«‹æ–¹ä½“è´´å›¾">9.3.2 ä½¿ç”¨OpenGLç«‹æ–¹ä½“è´´å›¾</h4>
<p>OpenGL çº¹ç†ç«‹æ–¹ä½“è´´å›¾ä½¿ç”¨å¸¦æœ‰ 3 ä¸ªå˜é‡çš„çº¹ç†åæ ‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(s, t, r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span> è®¿é—®ã€‚</p>
<p>ç«‹æ–¹ä½“è´´å›¾çš„å¦ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼Œå…¶ä¸­çš„å›¾åƒä»¥çº¹ç†å›¾åƒçš„å·¦ä¸Šè§’ä½œä¸ºçº¹ç†åæ ‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<p>å¦å¤–å®šä¹‰å‡½æ•° <code>loadCubeMap()</code> å‡½æ•°è¯»å…¥6ä¸ªå•ç‹¬çš„ç«‹æ–¹ä½“é¢å›¾åƒæ–‡ä»¶ï¼Œä»¥è¿™ç§å½¢å¼å†è°ƒç”¨ <code>SOIL_load_OGL_cubemap()</code> è¿›è¡Œæ„å»ºçº¹ç†ã€‚è¯¥å‡½æ•°ç½®äº <code>Util</code> ç±»ä¸­ã€‚</p>
<p>æ•ˆæœæˆªå›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_skybox2.jpg" alt="å¤©ç©ºç›’"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>æ–°å¢å‡½æ•°</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLuint <span class="title">Util::loadCubeMap</span><span class="params">(<span class="type">const</span> std::string &amp;mapDirPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLuint textureRef;</span><br><span class="line">	std::string xp = mapDirPath + <span class="string">&quot;/xp.jpg&quot;</span>;</span><br><span class="line">	std::string xn = mapDirPath + <span class="string">&quot;/xn.jpg&quot;</span>;</span><br><span class="line">	std::string yp = mapDirPath + <span class="string">&quot;/yp.jpg&quot;</span>;</span><br><span class="line">	std::string yn = mapDirPath + <span class="string">&quot;/yn.jpg&quot;</span>;</span><br><span class="line">	std::string zp = mapDirPath + <span class="string">&quot;/zp.jpg&quot;</span>;</span><br><span class="line">	std::string zn = mapDirPath + <span class="string">&quot;/zn.jpg&quot;</span>;</span><br><span class="line">	textureRef = <span class="built_in">SOIL_load_OGL_cubemap</span>(xp.<span class="built_in">c_str</span>(), xn.<span class="built_in">c_str</span>(), yp.<span class="built_in">c_str</span>(), yn.<span class="built_in">c_str</span>(), zp.<span class="built_in">c_str</span>(), zn.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_MIPMAPS);</span><br><span class="line">	<span class="keyword">if</span> (textureRef == <span class="number">0</span>)	std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; mapDirPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> textureRef;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line">GLuint renderProgram, renderProgramCubeMap;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc, vLoc;</span><br><span class="line">GLuint textureID, skyboxTex;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹ç›¸å…³</span></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.8f</span>, <span class="number">0.4f</span>)</span></span>;</span><br><span class="line"><span class="comment">// åŠ è½½çš„æ¨¡å‹è¿˜ä¸èƒ½ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="comment">//ImportedModel model2(&quot;model/pyr.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ç½®ç›¸å…³</span></span><br><span class="line"><span class="function">glm::vec3 <span class="title">cameraLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">5.0f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">modelLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ç«‹æ–¹ä½“å¤©ç©ºç›’</span></span><br><span class="line">	<span class="type">float</span> cubeVertexPositions[<span class="number">108</span>] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; modelInd = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelPvalues;	<span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelTvalues;	<span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelNvalues;	<span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(cubeVertexPositions), cubeVertexPositions, GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// model</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelPvalues.<span class="built_in">size</span>(), &amp;modelPvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelTvalues.<span class="built_in">size</span>(), &amp;modelTvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * modelInd.<span class="built_in">size</span>(), &amp;modelInd[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	renderProgramCubeMap = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertexCubeMap.glsl&quot;</span>, <span class="string">&quot;fragmentCubeMap.glsl&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/brick1.jpg&quot;</span>);</span><br><span class="line">	skyboxTex = Util::<span class="built_in">loadCubeMap</span>(<span class="string">&quot;textureImg/cubeMap&quot;</span>);</span><br><span class="line">    <span class="comment">// å°è¯•æ··åˆç«‹æ–¹ä½“ç›¸é‚»çš„è¾¹ä»¥å‡å°‘æˆ–æ¶ˆé™¤æ¥ç¼</span></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_TEXTURE_CUBE_MAP_SEAMLESS);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraLoc.x, -cameraLoc.y, -cameraLoc.z));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgramCubeMap);</span><br><span class="line">	<span class="comment">// å‡†å¤‡ç»˜åˆ¶å¤©ç©ºç›’ã€‚æ¨¡å‹çŸ©é˜µå°†å¤©ç©ºç›’æ”¾ç½®åœ¨ç›¸æœºä½ç½®</span></span><br><span class="line"></span><br><span class="line">	vLoc = <span class="built_in">glGetUniformLocation</span>(renderProgramCubeMap, <span class="string">&quot;v_matrix&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(vLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(vMat));</span><br><span class="line"></span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgramCubeMap, <span class="string">&quot;p_matrix&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_CUBE_MAP, skyboxTex);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glDisable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="comment">// æ— æ·±åº¦æµ‹è¯•ä¸‹ç»˜åˆ¶å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶åœºæ™¯å¯¹è±¡</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), modelLoc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, glm::<span class="built_in">radians</span>(<span class="number">35.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Skybox&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>ç«‹æ–¹ä½“è´´å›¾ç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertexCubeMap.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> tc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> v_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> p_matrix;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	tc = vertPos;</span><br><span class="line">	<span class="type">mat4</span> v3_matrix = <span class="type">mat4</span>(<span class="type">mat3</span>(v_matrix));</span><br><span class="line">    <span class="comment">// å¤§å°è½¬æ¢ä¸º 3Ã—3ï¼Œç„¶åè½¬æ¢å› 4Ã—4ã€‚ç§»é™¤äº†å¹³ç§»åˆ†é‡ï¼ŒåŒæ—¶ä¿ç•™äº†æ—‹è½¬ï¼ˆå¹³ç§»å€¼åœ¨è½¬æ¢çŸ©é˜µçš„ç¬¬å››åˆ—ä¸­ï¼‰</span></span><br><span class="line">	<span class="built_in">gl_Position</span> = p_matrix * v3_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragmentCubeMap.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> tc;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">samplerCube</span> samp;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	fragColor = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>æç»˜åœºæ™¯çš„ç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec2</span> texCoord;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec2</span> tc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	tc = texCoord;</span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec2</span> tc;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> s;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	fragColor = <span class="built_in">texture</span>(s, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="9-4-ç¯å¢ƒè´´å›¾">9.4 ç¯å¢ƒè´´å›¾</h3>
<p>ç¯å¢ƒè´´å›¾ï¼šä½¿ç”¨ç«‹æ–¹ä½“è´´å›¾æ¥æ„é€ åå°„å¯¹è±¡æœ¬èº«ã€‚</p>
<ul>
<li>åœ¨å…‰ç…§æ—¶è®¡ç®—è¿‡åå°„å‘é‡ï¼Œç°åœ¨ä½¿ç”¨åå°„å‘é‡ä»çº¹ç†è´´å›¾ä¸­æŸ¥æ‰¾å€¼ã€‚</li>
</ul>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_envmap.gif" alt="ç¯å¢ƒè´´å›¾ä¾‹å­"></p>
<p>ä»ç„¶éœ€è¦ä¸¤ç»„ç€è‰²å™¨ï¼Œä¸€ç»„ç”¨äºç«‹æ–¹ä½“è´´å›¾ï¼Œä¸€ç»„ç”¨äºåœºæ™¯ç‰©ä½“ï¼ˆç¯é¢ï¼‰ã€‚</p>
<p>ç¨‹åºä¸Šï¼š</p>
<ul>
<li><code>makeVertexArray()</code> å‡½æ•°ä¸­ï¼š
<ul>
<li>æ„å»ºç¯é¢çš„æ³•å‘é‡ç¼“å†²åŒº</li>
<li>å»æ‰ç¯é¢çš„çº¹ç†åæ ‡ç¼“å†²åŒº</li>
</ul>
</li>
<li><code>display()</code> å‡½æ•°ä¸­ï¼š
<ul>
<li>åˆ›å»ºå˜æ¢æ³•å‘é‡çš„çŸ©é˜µå¹¶å…³è”åˆ°ç»Ÿä¸€å˜é‡</li>
<li>æ¿€æ´»ç¯é¢æ³•å‘é‡ç¼“å†²åŒº</li>
<li>æ¿€æ´»ç«‹æ–¹ä½“è´´å›¾ä¸ºç¯é¢çš„çº¹ç†</li>
</ul>
</li>
<li>é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼š
<ul>
<li>è¾“å‡ºå˜æ¢çš„é¡¶ç‚¹å’Œæ³•å‘é‡ï¼Œç”¨äºè®¡ç®—åå°„å‘é‡</li>
</ul>
</li>
<li>ç‰‡æ®µç€è‰²å™¨ä¸­ï¼š
<ul>
<li>è®¡ç®—åå°„å‘é‡</li>
<li>ä»ç«‹æ–¹ä½“è´´å›¾ä½¿ç”¨åå°„å‘é‡æ£€ç´¢è¾“å‡ºé¢œè‰²</li>
</ul>
</li>
</ul>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line">GLuint renderProgram, renderProgramCubeMap;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc, vLoc, nLoc;</span><br><span class="line">GLuint skyboxTex;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> rotAmt;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹ç›¸å…³</span></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.8f</span>, <span class="number">0.4f</span>)</span></span>;</span><br><span class="line"><span class="comment">// åŠ è½½çš„æ¨¡å‹è¿˜ä¸èƒ½ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="comment">//ImportedModel model2(&quot;model/pyr.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ç½®ç›¸å…³</span></span><br><span class="line"><span class="function">glm::vec3 <span class="title">cameraLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">5.0f</span>)</span></span>;</span><br><span class="line"><span class="function">glm::vec3 <span class="title">modelLoc</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ç«‹æ–¹ä½“å¤©ç©ºç›’</span></span><br><span class="line">	<span class="type">float</span> cubeVertexPositions[<span class="number">108</span>] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; modelInd = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelPvalues;	<span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelTvalues;	<span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; modelNvalues;	<span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		modelPvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		modelTvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		modelNvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(cubeVertexPositions), cubeVertexPositions, GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// model</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelPvalues.<span class="built_in">size</span>(), &amp;modelPvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * modelTvalues.<span class="built_in">size</span>(), &amp;modelTvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * modelInd.<span class="built_in">size</span>(), &amp;modelInd[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	renderProgramCubeMap = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertexCubeMap.glsl&quot;</span>, <span class="string">&quot;fragmentCubeMap.glsl&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	skyboxTex = Util::<span class="built_in">loadCubeMap</span>(<span class="string">&quot;textureImg/lakeCubeMap&quot;</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_TEXTURE_CUBE_MAP_SEAMLESS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraLoc.x, -cameraLoc.y, -cameraLoc.z));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgramCubeMap);</span><br><span class="line">	<span class="comment">// å‡†å¤‡ç»˜åˆ¶å¤©ç©ºç›’ã€‚æ¨¡å‹çŸ©é˜µå°†å¤©ç©ºç›’æ”¾ç½®åœ¨ç›¸æœºä½ç½®</span></span><br><span class="line"></span><br><span class="line">	vLoc = <span class="built_in">glGetUniformLocation</span>(renderProgramCubeMap, <span class="string">&quot;v_matrix&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(vLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(vMat));</span><br><span class="line"></span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgramCubeMap, <span class="string">&quot;p_matrix&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_CUBE_MAP, skyboxTex);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glDisable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="comment">// æ— æ·±åº¦æµ‹è¯•ä¸‹ç»˜åˆ¶å¤©ç©ºç›’</span></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»˜åˆ¶åœºæ™¯å¯¹è±¡</span></span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	rotAmt = currentTime * <span class="number">0.5f</span>;</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), modelLoc);</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, rotAmt, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¯é¢çº¹ç†ç°åœ¨æ˜¯ç«‹æ–¹ä½“è´´å›¾</span></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_CUBE_MAP, skyboxTex);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line">	<span class="built_in">glFrontFace</span>(GL_CCW);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Skybox&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>æç»˜åœºæ™¯çš„ç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> normal;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> vNormal;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> vVertPos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	vVertPos = (mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	vNormal = (norm_matrix * <span class="type">vec4</span>(normal, <span class="number">0.0</span>)).xyz;</span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> vVertPos;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> vNormal;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">samplerCube</span> t;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec3</span> r = -<span class="built_in">reflect</span>(<span class="built_in">normalize</span>(-vVertPos), <span class="built_in">normalize</span>(vNormal));</span><br><span class="line">	fragColor = <span class="built_in">texture</span>(t, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>ç¯å¢ƒè´´å›¾çš„ä¸»è¦é™åˆ¶ä¹‹ä¸€æ˜¯å®ƒåªèƒ½æ„å»ºåå°„ç«‹æ–¹ä½“è´´å›¾å†…å®¹çš„å¯¹è±¡ã€‚</p>
<ul>
<li>åœ¨åœºæ™¯ä¸­æ¸²æŸ“çš„å…¶ä»–å¯¹è±¡å¹¶ä¸ä¼šå‡ºç°åœ¨ä½¿ç”¨è´´å›¾æ¨¡æ‹Ÿåå°„çš„å¯¹è±¡ä¸­ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºæˆ–å…¶ä»–æ•™ç¨‹å®ç°åå°„å‡ºå¤šä¸ªç‰©ä½“çš„æ•ˆæœã€‚</li>
</ul>
<hr>
<p>ä½¿ç”¨ SOIL2 å¯ä»¥å¾ˆæ–¹ä¾¿åŠ è½½çº¹ç†è´´å›¾ï¼Œä½†ä¹Ÿæœ‰å…¶ä»–æ–¹æ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>stb_image.h</code>ï¼š
<ul>
<li>åŒ…å«å¤´æ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>glGenTextures()</code> ä¸ºç«‹æ–¹ä½“è´´å›¾åˆ›å»ºçº¹ç†åŠå…¶ ID</li>
<li>ä½¿ç”¨ <code>glBindTexture()</code> æŒ‡å®šçº¹ç† ID å’Œ <code>GL_TEXTURE_CUBE_MAP</code></li>
<li>ä½¿ç”¨ <code>stbi_load()</code> åŠ è½½çº¹ç†æ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>glTexImage2D()</code> å°†å›¾åƒåˆ†é…ç»™ç«‹æ–¹ä½“çš„å„ä¸ªé¢</li>
</ul>
</li>
</ul>
<p><em>SOIL2 ä»¥åŠåŒ…å«æ–‡ä»¶ stb_image.h</em></p>
<p><em>ä¹Ÿè®¸Terragenå¯¹äºåˆ¶ä½œè´´å›¾ä¸é”™ã€‚</em></p>
<hr>
<h2 id="å-å¢å¼ºè¡¨é¢ç»†èŠ‚">åã€å¢å¼ºè¡¨é¢ç»†èŠ‚</h2>
<h3 id="10-1-å‡¹å‡¸è´´å›¾">10.1 å‡¹å‡¸è´´å›¾</h3>
<p>å¦‚æœæƒ³è®©ä¸€ä¸ªç‰©ä½“çœ‹èµ·æ¥å¥½åƒæœ‰å‡¹å‡¸ï¼Œä¸€ç§æ–¹æ³•æ˜¯è®¡ç®—è¡¨é¢ç¡®å®å‡¹å‡¸ä¸å¹³æ—¶å…¶ä¸Šçš„æ³•å‘é‡ï¼Œç„¶åæ¨¡æ‹Ÿæ³•å‘é‡ã€‚</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_disturbNorm.png" alt="æ‰°åŠ¨æ³•å‘é‡"></p>
<p>ä½¿ç”¨æ­£å¼¦å‡½æ•°ç”Ÿæˆå‡¹å‡¸ä¸å¹³çš„æ³•å‘é‡ã€‚</p>
<ul>
<li>é¡¶ç‚¹ç€è‰²å™¨éœ€è¦å°†æœªç»å˜æ¢çš„é¡¶ç‚¹ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨</li>
</ul>
<p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_bumps.jpg" alt="è¿‡ç¨‹å¼å‡¹å‡¸è´´å›¾"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;    <span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];    <span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å…‰ç…§ä½ç½®</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">silverAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">silverDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">silverSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">silverShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"><span class="comment">//ImportedModel model(&quot;unicorn.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; ind = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// é¡¶ç‚¹ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;bumpMap/vertex.glsl&quot;</span>, <span class="string">&quot;bumpMap/fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åŸºäºå½“å‰å…‰æºä½ç½®ï¼Œåˆå§‹åŒ–å…‰ç…§</span></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">	<span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="comment">// æ„å»º MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">//glDrawArrays(GL_TRIANGLES, 0, model.getNumVertices());</span></span><br><span class="line">	<span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Bumps&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertNormal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingNormal;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingLightDir;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingVertPos;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> originalVertex;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	varyingVertPos = (mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	varyingLightDir = light.position - varyingVertPos;</span><br><span class="line">	varyingNormal = (norm_matrix * <span class="type">vec4</span>(vertNormal, <span class="number">0.0</span>)).xyz;</span><br><span class="line">	originalVertex = vertPos;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Material</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec4</span> globalAmbient;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"><span class="keyword">uniform</span> Material material;</span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingNormal;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingLightDir;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingVertPos;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> originalVertex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec3</span> L = <span class="built_in">normalize</span>(varyingLightDir);</span><br><span class="line">	<span class="type">vec3</span> N = <span class="built_in">normalize</span>(varyingNormal);</span><br><span class="line">	<span class="type">vec3</span> V = <span class="built_in">normalize</span>(-varyingVertPos);</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> a = <span class="number">0.25</span>;		<span class="comment">// å‡¸èµ·æ·±åº¦</span></span><br><span class="line">	<span class="type">float</span> b = <span class="number">100.0</span>;	<span class="comment">// å‡¸èµ·å®½åº¦</span></span><br><span class="line">	<span class="type">float</span> x = originalVertex.x;</span><br><span class="line">	<span class="type">float</span> y = originalVertex.y;</span><br><span class="line">	<span class="type">float</span> z = originalVertex.z;</span><br><span class="line">	N.x = varyingNormal.x + a * <span class="built_in">sin</span>(b * x);</span><br><span class="line">	N.y = varyingNormal.y + a * <span class="built_in">sin</span>(b * y);</span><br><span class="line">	N.z = varyingNormal.z + a * <span class="built_in">sin</span>(b * z);</span><br><span class="line">	N = <span class="built_in">normalize</span>(N);</span><br><span class="line"></span><br><span class="line">	<span class="type">vec3</span> R = <span class="built_in">normalize</span>(<span class="built_in">reflect</span>(-L, N));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—å…‰ç…§ä¸å¹³é¢æ³•å‘é‡é—´çš„è§’åº¦</span></span><br><span class="line">	<span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">	<span class="comment">// è®¡ç®—æ³•å‘é‡ N ä¸è§’å¹³åˆ†çº¿å‘é‡ H ä¹‹é—´çš„è§’åº¦</span></span><br><span class="line">	<span class="type">float</span> cosPhi = <span class="built_in">dot</span>(V, R);</span><br><span class="line"></span><br><span class="line">	fragColor = globalAmbient * material.ambient +</span><br><span class="line">		light.ambient * material.diffuse +</span><br><span class="line">		light.diffuse * material.diffuse * <span class="built_in">max</span>(cosTheta, <span class="number">0.0</span>) +</span><br><span class="line">		light.specular * material.specular * <span class="built_in">pow</span>(<span class="built_in">max</span>(cosPhi, <span class="number">0.0</span>), material.shininess);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<h3 id="10-2-æ³•çº¿è´´å›¾">10.2 æ³•çº¿è´´å›¾</h3>
<p>å‡¹å‡¸è´´å›¾å¯ä»¥ä½¿ç”¨æŸ¥æ‰¾è¡¨æ¥æ›¿æ¢æ³•å‘é‡çš„å½¢å¼æ›¿ä»£ã€‚</p>
<p>ä»¥æŸ¥æ‰¾è¡¨çš„æ–¹æ³•å®ç°å‡¹å‡¸ç»†èŠ‚å«ä½œæ³•çº¿è´´å›¾ã€‚</p>
<p>å¯ä»¥å°†æ³•å‘é‡å­˜å‚¨åœ¨å½©è‰²å›¾åƒæ–‡ä»¶ä¸­ï¼Œæ°å¥½ RGB ä¸‰é€šé“å¯¹åº”å‘é‡çš„ xyzã€‚</p>
<ul>
<li>RGB å€¼ä»¥å­—èŠ‚å½¢å¼å­˜å‚¨ï¼Œé€šå¸¸ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ã€‚</li>
<li>å‘é‡é™åˆ¶åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-1,+1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">+</span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ã€‚</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>R</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>N</mi><mi>x</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>N</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>N</mi><mi>z</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
R=(N_x+1)/2 \\
G=(N_y+1)/2 \\
B=(N_z+1)/2
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>æ³•çº¿è´´å›¾ä½¿ç”¨ä¸€ä¸ªå›¾åƒï¼ˆç§°ä¸ºæ³•çº¿å›¾ï¼‰æ–‡ä»¶ï¼Œè¯¥å›¾åƒæ–‡ä»¶åŒ…å«åœ¨å…‰ç…§ä¸‹æ‰€æœŸæœ›è¡¨é¢å¤–è§‚çš„æ³•å‘é‡ã€‚</p>
<ul>
<li>æ³•å‘é‡çš„ x å’Œ y åˆ†é‡è¡¨ç¤ºå…¶è¢«æ‰°åŠ¨åä¸â€œå‚ç›´â€æ–¹å‘çš„åå·®ï¼Œz åˆ†é‡è®¾ç½®ä¸º 1ã€‚</li>
<li>ä¸¥æ ¼å‚ç›´çš„å‘é‡ï¼ˆå³æ²¡æœ‰åå·®ï¼‰å°†è¡¨ç¤ºä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ã€‚</li>
</ul>
<p>ä½†å‘ç°å›¾æŸ¥æ‰¾åˆ°çš„æ³•å‘é‡ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è€ƒè™‘æ³•å‘é‡åœ¨ç‰©ä½“ä¸Šçš„ä½ç½®ä»¥åŠåœ¨ç›¸æœºç©ºé—´ç§çš„æ–¹å‘ã€‚</p>
<ul>
<li>å»ºç«‹è½¬æ¢çŸ©é˜µï¼Œå°†æ³•å‘é‡è½¬æ¢åˆ°ç›¸æœºç©ºé—´ã€‚</li>
</ul>
<p>åœ¨å¯¹è±¡é¡¶ç‚¹å‡ºï¼Œè€ƒè™‘å¯¹è±¡çš„åˆ‡å¹³é¢ï¼Œå–åˆ‡å¹³é¢ä¸¤ä¸ªç›¸äº’å‚ç›´çš„å‘é‡ï¼ˆåˆ‡å‘é‡å’Œå‰¯åˆ‡å‘é‡ï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—åˆ‡å‘é‡å’Œæ³•å‘é‡çš„å‰ç§¯æ„å»ºå‰¯åˆ‡å‘é‡ã€‚</p>
<ul>
<li>å¦‚æœæ¨¡å‹æ²¡æœ‰å®šä¹‰åˆ‡å‘é‡ï¼Œè¿˜éœ€è®¡ç®—åˆ‡å‘é‡ã€‚</li>
<li>å¯¹äºé‚£äº›è¡¨é¢æ— æ³•æ±‚å¯¼ã€æ— æ³•ç²¾ç¡®æ±‚è§£åˆ‡å‘é‡çš„æ¨¡å‹ï¼Œå…¶åˆ‡å‘é‡å¯ä»¥é€šè¿‡è¿‘ä¼¼å¾—åˆ°ã€‚</li>
</ul>
<p>åˆ‡å‘é‡ä¸€æ ·é€šè¿‡ VBO ä¼ é€’åˆ°é¡¶ç‚¹ç€è‰²å™¨ä¸­ã€‚</p>
<p>ä¸€æ—¦åœ¨ç›¸æœºç©ºé—´ä¸­å¾—åˆ°æ³•å‘é‡ã€åˆ‡å‘é‡å’Œå‰¯åˆ‡å‘é‡ï¼Œå°±å¯ä»¥æ„é€ çŸ©é˜µï¼ˆç§°ä¸º TBN çŸ©é˜µï¼‰ã€‚</p>
<ul>
<li>è¯¥çŸ©é˜µç”¨äºå°†ä»æ³•çº¿è´´å›¾ä¸­æ£€ç´¢åˆ°çš„æ³•å‘é‡è½¬æ¢ä¸ºåœ¨ç›¸æœºç©ºé—´ä¸­ç›¸å¯¹äºç‰©ä½“è¡¨é¢çš„æ³•å‘é‡ã€‚</li>
<li>åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ï¼Œæ–°æ³•å‘é‡çš„è®¡ç®—åœ¨ <code>calcNewNormal()</code> å‡½æ•°ä¸­å®Œæˆã€‚
<ul>
<li>è¯¥å‡½æ•°åŒ…å« <code>dot(tangent, normal)</code> çš„è®¡ç®—ç¡®ä¿åˆ‡å‘é‡å‚ç›´äºæ³•å‘é‡ã€‚æ–°çš„åˆ‡å‘é‡å’Œæ³•å‘é‡çš„å‰ç§¯å°±æ˜¯å‰¯åˆ‡å‘é‡ã€‚</li>
</ul>
</li>
</ul>
<p>åˆ¶ä½œæ³•çº¿å›¾å¯ä»¥é€šè¿‡ GIMP å’Œ PS ç­‰å·¥å…·å®Œæˆã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ³•çº¿è´´å›¾ä¾‹å­</th>
<th style="text-align:center">æ³•çº¿å›¾</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_normMap.jpg"/></td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_normalMapping.jpg"/></td>
</tr>
</tbody>
</table>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">5</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;    <span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];    <span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å…‰ç…§ä½ç½®</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">-5.0f</span>, <span class="number">2.0f</span>, <span class="number">5.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">goldAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">goldDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">goldSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">goldShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="function">Sphere <span class="title">model</span><span class="params">(<span class="number">48</span>)</span></span>;</span><br><span class="line"><span class="comment">//Torus model(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="comment">//ImportedModel model(&quot;unicorn.obj&quot;);</span></span><br><span class="line"></span><br><span class="line">GLuint texture;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; ind = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; tang = model.<span class="built_in">getTangents</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tanvalues;  <span class="comment">// åˆ‡çº¿</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">		tanvalues.<span class="built_in">push_back</span>(tang[i].x);</span><br><span class="line">		tanvalues.<span class="built_in">push_back</span>(tang[i].y);</span><br><span class="line">		tanvalues.<span class="built_in">push_back</span>(tang[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// åˆ‡å‘é‡æ”¾å…¥ç¼“å†²åŒº3</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tanvalues.<span class="built_in">size</span>(), &amp;tanvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// é¡¶ç‚¹ç´¢å¼•æ”¾å…¥ç¼“å†²åŒº4</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;normalMap/vertex.glsl&quot;</span>, <span class="string">&quot;normalMap/fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line"></span><br><span class="line">	texture = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;normalMap/castleroofNORMAL.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åŸºäºå½“å‰å…‰æºä½ç½®ï¼Œåˆå§‹åŒ–å…‰ç…§</span></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">	<span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="comment">// æ„å»º MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">2</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">3</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, texture);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">//glDrawArrays(GL_TRIANGLES, 0, model.getNumVertices());</span></span><br><span class="line">	<span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">4</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Bumps&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>çƒä½“ç±»æ–°å¢</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sphere.cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sphere::init</span><span class="params">(<span class="type">int</span> _prec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	numVertices = (_prec + <span class="number">1</span>) * (_prec + <span class="number">1</span>);</span><br><span class="line">	numIndices = _prec * _prec * <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">		texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>());</span><br><span class="line">		normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">		tangents.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">		indices.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—ä¸‰è§’å½¢é¡¶ç‚¹</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= _prec; ++ i)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= _prec; ++ j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">float</span> y = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(<span class="number">180.0f</span> - i * <span class="number">180.0f</span> / _prec)));</span><br><span class="line">			<span class="type">float</span> x = - <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">			<span class="type">float</span> z = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">sin</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">			vertices[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">			<span class="comment">// è®¡ç®—åˆ‡å‘é‡ï¼ˆæ–°å¢ï¼‰</span></span><br><span class="line">			<span class="keyword">if</span> (((x == <span class="number">0</span>) <span class="built_in">and</span> (y == <span class="number">1</span>) <span class="built_in">and</span> (z == <span class="number">0</span>)) <span class="built_in">or</span> ((x == <span class="number">0</span>) <span class="built_in">and</span> (y == <span class="number">-1</span>) <span class="built_in">and</span> (z == <span class="number">0</span>)))</span><br><span class="line">				tangents[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>);</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				tangents[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">cross</span>(glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>), glm::<span class="built_in">vec3</span>(x, y, z));</span><br><span class="line">            <span class="comment">// æ–°å¢ä¸Šè¿°è®¡ç®—åˆ‡å‘é‡</span></span><br><span class="line">			texCoords[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec2</span>(j * <span class="number">1.0f</span> / _prec, i * <span class="number">1.0f</span> / _prec);</span><br><span class="line">			normals[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Sphere::getTangents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tangents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec2</span> texCoord;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">2</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertNormal;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">3</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertTangent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> norm_matrix;	<span class="comment">// ç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingLightDir;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingVertPos;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingNormal;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingTangent;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> originalVertex;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec2</span> tc;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> varyingHalfVector;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	varyingVertPos = (mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	varyingLightDir = light.position - varyingVertPos;</span><br><span class="line">	tc = texCoord;</span><br><span class="line"></span><br><span class="line">	originalVertex = vertPos;</span><br><span class="line"></span><br><span class="line">	varyingNormal = (norm_matrix * <span class="type">vec4</span>(vertNormal, <span class="number">0.0</span>)).xyz;</span><br><span class="line">	varyingTangent = (norm_matrix * <span class="type">vec4</span>(vertTangent, <span class="number">0.0</span>)).xyz;</span><br><span class="line"></span><br><span class="line">	varyingHalfVector = <span class="built_in">normalize</span>(<span class="built_in">normalize</span>(varyingLightDir) + <span class="built_in">normalize</span>(-varyingVertPos)).xyz;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">struct PositionalLight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">vec3</span> position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Material</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> ambient;</span><br><span class="line">	<span class="type">vec4</span> diffuse;</span><br><span class="line">	<span class="type">vec4</span> specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> nromsamp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec4</span> globalAmbient;</span><br><span class="line"><span class="keyword">uniform</span> PositionalLight light;</span><br><span class="line"><span class="keyword">uniform</span> Material material;</span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingLightDir;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingNormal;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingVertPos;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingTangent;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> originalVertPos;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec2</span> tc;</span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> varyingHalfVector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">vec3</span> calcNewNormal()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec3</span> normal = <span class="built_in">normalize</span>(varyingNormal);</span><br><span class="line">	<span class="type">vec3</span> tangent = <span class="built_in">normalize</span>(varyingTangent);</span><br><span class="line">	tangent = <span class="built_in">normalize</span>(tangent - <span class="built_in">dot</span>(tangent, normal) * normal);</span><br><span class="line">	<span class="type">vec3</span> bitangent = <span class="built_in">cross</span>(normal, tangent);</span><br><span class="line">	<span class="type">mat3</span> tbn = <span class="type">mat3</span>(tangent, bitangent, normal);</span><br><span class="line">	<span class="type">vec3</span> retrievedNormal = <span class="built_in">texture</span>(nromsamp, tc).xyz;</span><br><span class="line">	<span class="type">vec3</span> newNormal = tbn * retrievedNormal;</span><br><span class="line">	newNormal = <span class="built_in">normalize</span>(newNormal);</span><br><span class="line">	<span class="keyword">return</span> newNormal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec3</span> L = <span class="built_in">normalize</span>(varyingLightDir);</span><br><span class="line">	<span class="type">vec3</span> N = calcNewNormal();</span><br><span class="line">	<span class="type">vec3</span> R = <span class="built_in">normalize</span>(<span class="built_in">reflect</span>(-L, N));</span><br><span class="line">	<span class="type">vec3</span> H = <span class="built_in">normalize</span>(varyingHalfVector);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¡ç®—å…‰ç…§ä¸å¹³é¢æ³•å‘é‡é—´çš„è§’åº¦</span></span><br><span class="line">	<span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">	<span class="comment">// è®¡ç®—æ³•å‘é‡ N ä¸è§’å¹³åˆ†çº¿å‘é‡ H ä¹‹é—´çš„è§’åº¦</span></span><br><span class="line">	<span class="type">float</span> cosPhi = <span class="built_in">dot</span>(H, N);</span><br><span class="line"></span><br><span class="line">	fragColor = globalAmbient * material.ambient +</span><br><span class="line">		light.ambient * material.ambient +</span><br><span class="line">		light.diffuse * material.diffuse * <span class="built_in">max</span>(<span class="number">0.0</span>, cosTheta) +</span><br><span class="line">		light.specular * material.specular * <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="number">0.0</span>, cosPhi), material.shininess);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>å¯ä»¥ä½¿ç”¨çº¹ç†åŠ æ³•çº¿è´´å›¾ï¼Œä½¿å¾—æ¨¡å‹æ›´é€¼çœŸã€‚</p>
<ul>
<li>æ³•çº¿è´´å›¾ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šçº§æ¸è¿œçº¹ç†è´´å›¾æ”¹å–„æ•ˆæœã€‚</li>
<li>æ³•çº¿è´´å›¾çš„å„å‘å¼‚æ€§è¿‡æ»¤æ›´æœ‰æ•ˆï¼Œå®ƒä¸ä½†å‡å°‘äº†é—ªçƒçš„ä¼ªå½±ï¼ŒåŒæ—¶è¿˜ä¿ç•™äº†ç»†èŠ‚ã€‚</li>
</ul>
<h3 id="10-3-é«˜åº¦è´´å›¾">10.3 é«˜åº¦è´´å›¾</h3>
<p>ä½¿ç”¨çº¹ç†å›¾åƒæ¥å­˜å‚¨é«˜åº¦å€¼ï¼Œç„¶åä½¿ç”¨è¯¥é«˜åº¦å€¼æ¥æå‡ï¼ˆæˆ–é™ä½ï¼‰é¡¶ç‚¹ä½ç½®ã€‚</p>
<ul>
<li>å«æœ‰é«˜åº¦ä¿¡æ¯çš„å›¾åƒç§°ä¸ºé«˜åº¦å›¾ã€‚</li>
</ul>
<p>ä½¿ç”¨é«˜åº¦å›¾æ›´æ”¹å¯¹è±¡çš„é¡¶ç‚¹çš„æ–¹æ³•ç§°ä¸ºé«˜åº¦è´´å›¾ã€‚</p>
<ul>
<li>é»‘è‰²ä¸ºé«˜åº¦ä½ï¼Œç™½è‰²ä¸ºé«˜åº¦é«˜ã€‚</li>
</ul>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_heightMap.jpg" alt="é«˜åº¦è´´å›¾"></p>
<p>ç”¨äºå±•ç¤ºçš„é«˜åº¦å›¾å’Œçº¹ç†å›¾å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">é«˜åº¦å›¾</th>
<th style="text-align:center">çº¹ç†å›¾</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_height.jpg"/></td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_ice.jpg"/></td>
</tr>
</tbody>
</table>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<details><summary>main.cpp</summary>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLEW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLFW åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// å¯¼å…¥ GLM åº“</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">3</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…‰æºå±æ€§</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// æè´¨å±æ€§</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;    <span class="comment">// æ¨¡å‹å’Œè§†è§‰ç©ºé—´ä¸­çš„å…‰ç…§ä½ç½®</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];    <span class="comment">// å…‰ç…§ä½ç½®çš„æµ®ç‚¹æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å…‰ç…§ä½ç½®</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">-5.0f</span>, <span class="number">2.0f</span>, <span class="number">5.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™½å…‰ç‰¹æ€§</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">goldAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">goldDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">goldSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">goldShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="comment">//Torus model(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model</span><span class="params">(<span class="string">&quot;heightMap/grid.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">GLuint heightMap;</span><br><span class="line">GLuint texture;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// å°†å…‰æºä½ç½®è½¬æ¢ä¸ºè§†å›¾ç©ºé—´åæ ‡ï¼Œå­˜å…¥æµ®ç‚¹æ•°ç»„</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨è·å–å…‰æºä½ç½®å’Œæè´¨å±æ€§</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åœ¨ç€è‰²å™¨ä¸­ä¸ºå…‰æºä¸æè´¨ç»Ÿä¸€å˜é‡èµ‹å€¼</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;    <span class="comment">// é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;    <span class="comment">// çº¹ç†åæ ‡</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;    <span class="comment">// æ³•å‘é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// é¡¶ç‚¹åæ ‡æ”¾å…¥ç¼“å†²åŒº0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// çº¹ç†åæ ‡æ”¾å…¥ç¼“å†²åŒº1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// æ³•å‘é‡æ”¾å…¥ç¼“å†²åŒº2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;heightMap/vertex.glsl&quot;</span>, <span class="string">&quot;heightMap/fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.03f</span>; cameraY = <span class="number">0.03f</span>; cameraZ = <span class="number">0.8f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line"></span><br><span class="line">	texture = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/ice.jpg&quot;</span>);</span><br><span class="line">	heightMap = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;heightMap/height.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">15.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åŸºäºå½“å‰å…‰æºä½ç½®ï¼Œåˆå§‹åŒ–å…‰ç…§</span></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">	<span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="comment">// æ„å»º MV çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µï¼Œç”¨äºå˜æ¢æ³•å‘é‡</span></span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">2</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, texture);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE1);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, heightMap);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model.<span class="built_in">getNumVertices</span>());</span><br><span class="line">	<span class="comment">// åˆ©ç”¨ç´¢å¼• vbo3 æ¥æŸ¥æ‰¾è¦ç»˜åˆ¶çš„é¡¶ç‚¹</span></span><br><span class="line">	<span class="comment">//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[4]);</span></span><br><span class="line">	<span class="comment">//glDrawElements(GL_TRIANGLES, model.getNumIndices(), GL_UNSIGNED_INT, 0);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Bumps&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<details><summary>é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</summary>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 430</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec2</span> texCoord;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">2</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertNormal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">1</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> h; <span class="comment">// é«˜åº¦å›¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec2</span> tc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> mv_matrix;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec4</span> p = <span class="type">vec4</span>(vertPos, <span class="number">1.0</span>) + <span class="type">vec4</span>((vertNormal * ((<span class="built_in">texture</span>(h, texCoord).r) / <span class="number">5.0</span>f)), <span class="number">1.0</span>f);</span><br><span class="line">	tc = texCoord;</span><br><span class="line">	<span class="built_in">gl_Position</span> = proj_matrix * mv_matrix * p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec2</span> tc;</span><br><span class="line"><span class="keyword">out</span> <span class="type">vec4</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>)  <span class="keyword">uniform</span> <span class="type">sampler2D</span> t;	<span class="comment">// çº¹ç†</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	fragColor = <span class="built_in">texture</span>(t, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<p>å‡¹å‡¸è´´å›¾æˆ–æ³•çº¿è´´å›¾çš„ä¸€ä¸ªåŸºæœ¬é™åˆ¶æ˜¯ï¼š</p>
<ul>
<li>è™½ç„¶èƒ½å¤Ÿåœ¨æ‰€æ¸²æŸ“å¯¹è±¡çš„å†…éƒ¨æä¾›è¡¨é¢ç»†èŠ‚ï¼Œ</li>
<li>ä½†æ˜¯ç‰©ä½“è½®å»“ï¼ˆå¤–è¾¹ç•Œï¼‰æ— æ³•æ˜¾ç¤ºè¿™äº›ç»†èŠ‚ï¼ˆä»ä¿æŒå¹³æ»‘ï¼‰ã€‚</li>
</ul>
<p>é«˜åº¦è´´å›¾åœ¨ç”¨äºå®é™…ä¿®æ”¹é¡¶ç‚¹ä½ç½®æ—¶ä¿®å¤äº†è¿™ä¸ªç¼ºé™·ï¼Œä½†å®ƒä¹Ÿæœ‰å…¶è‡ªèº«çš„å±€é™æ€§ã€‚</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></article>
<div class="article-footer">
    <section id="license">
      <div class="header"><span>è®¸å¯åè®®</span></div>
      <div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div>
    </section>
    

</div>

<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2024/cppbasic/">C++åŸºç¡€è¯­æ³•æ‚è®°</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2023/cpproad/">ä¸ªäººæ•´ç†çš„C++å­¦ä¹ è·¯çº¿</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="sitemap" style="column-count:2;"><div class="sitemap-group"><span class="fs15">åšå®¢</span><a href="/">è¿‘æœŸå‘å¸ƒ</a><a href="/categories/">åˆ†ç±»</a><a href="/tags/">æ ‡ç­¾</a><a href="/archives/">å½’æ¡£</a></div><div class="sitemap-group"><span class="fs15">å…³äº</span><a href="/about/me/">å…³äºæˆ‘</a><a href="/about/site/">å…³äºåšå®¢</a></div></div><div class="text"><p>æœ¬ç«™ç”± <a href="/">Fingsinz</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.0">Stellar 1.33.0</a> ä¸»é¢˜åˆ›å»ºã€‚<br>
æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">æœ¬æ–‡ç›®å½•</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-opengl%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">ä¸€ã€OpenGLå®‰è£…ä¸ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AE%A4%E8%AF%86opengl"><span class="toc-text">1.1 è®¤è¯†OpenGL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEopengl"><span class="toc-text">1.2 å®‰è£…å’Œé…ç½®OpenGL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E5%87%86%E5%A4%87opengl-glsl"><span class="toc-text">1.2.1 å‡†å¤‡OpenGL&#x2F;GLSL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E5%87%86%E5%A4%87glfw"><span class="toc-text">1.2.2 å‡†å¤‡GLFW</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E5%87%86%E5%A4%87glew"><span class="toc-text">1.2.3 å‡†å¤‡GLEW</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-%E5%87%86%E5%A4%87glm"><span class="toc-text">1.2.4 å‡†å¤‡GLM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-%E5%87%86%E5%A4%87soil2"><span class="toc-text">1.2.5 å‡†å¤‡SOIL2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-%E5%87%86%E5%A4%87%E5%85%B1%E4%BA%AB%E7%9A%84lib%E5%92%8Cinclude"><span class="toc-text">1.2.6 å‡†å¤‡å…±äº«çš„libå’Œinclude</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%9C%A8vs%E4%B8%AD%E9%85%8D%E7%BD%AEopengl%E9%A1%B9%E7%9B%AE"><span class="toc-text">1.3 åœ¨VSä¸­é…ç½®OpenGLé¡¹ç›®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3"><span class="toc-text">1.4 åˆ›å»ºä¸€ä¸ªçª—å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-opengl%E5%9B%BE%E5%83%8F%E7%AE%A1%E7%BA%BF"><span class="toc-text">äºŒã€OpenGLå›¾åƒç®¡çº¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%AE%A1%E7%BA%BF"><span class="toc-text">2.1 ç®¡çº¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E7%AC%AC%E4%B8%80%E4%B8%AAc-opengl%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">2.1.1 ç¬¬ä¸€ä¸ªC++&#x2F;OpenGLåº”ç”¨ç¨‹åº</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E5%92%8C%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-text">2.2 é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-glsl%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5"><span class="toc-text">2.3 GLSLä»£ç æ£€æŸ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E8%AE%A9%E5%9B%BE%E5%83%8F%E5%8A%A8%E8%B5%B7%E6%9D%A5"><span class="toc-text">2.4 è®©å›¾åƒåŠ¨èµ·æ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-opengl%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80"><span class="toc-text">ä¸‰ã€OpenGLæ•°å­¦åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-text">3.1 åæ ‡ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E7%82%B9"><span class="toc-text">3.2 ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%90%91%E9%87%8F"><span class="toc-text">3.3 å‘é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E7%82%B9%E7%A7%AF%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">3.3.1 ç‚¹ç§¯çš„åº”ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E5%8F%89%E7%A7%AF%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">3.3.2 å‰ç§¯çš„åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E7%9F%A9%E9%98%B5"><span class="toc-text">3.4 çŸ©é˜µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5"><span class="toc-text">3.5 å˜æ¢çŸ©é˜µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-1-%E5%B9%B3%E7%A7%BB%E7%9F%A9%E9%98%B5"><span class="toc-text">3.5.1 å¹³ç§»çŸ©é˜µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-%E7%BC%A9%E6%94%BE%E7%9F%A9%E9%98%B5"><span class="toc-text">3.5.2 ç¼©æ”¾çŸ©é˜µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-3-%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="toc-text">3.5.3 æ—‹è½¬çŸ©é˜µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E8%A7%86%E8%A7%89%E7%A9%BA%E9%97%B4%E5%92%8C%E5%90%88%E6%88%90%E7%9B%B8%E6%9C%BA"><span class="toc-text">3.6 è§†è§‰ç©ºé—´å’Œåˆæˆç›¸æœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="toc-text">3.7 æŠ•å½±çŸ©é˜µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="toc-text">3.7.1 é€è§†æŠ•å½±çŸ©é˜µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-%E6%AD%A3%E5%B0%84%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="toc-text">3.7.2 æ­£å°„æŠ•å½±çŸ©é˜µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-lookat%E7%9F%A9%E9%98%B5"><span class="toc-text">3.8 LookAtçŸ©é˜µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-opengl%E7%AE%A1%E7%90%863d%E5%9B%BE%E5%BD%A2%E6%95%B0%E6%8D%AE"><span class="toc-text">å››ã€OpenGLç®¡ç†3Då›¾å½¢æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="toc-text">4.1 ç¼“å†²åŒºå’Œé¡¶ç‚¹å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E7%BB%9F%E4%B8%80%E5%8F%98%E9%87%8F"><span class="toc-text">4.2 ç»Ÿä¸€å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7%E6%8F%92%E5%80%BC"><span class="toc-text">4.3 é¡¶ç‚¹å±æ€§æ’å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-mv-%E7%9F%A9%E9%98%B5%E5%92%8C%E9%80%8F%E8%A7%86%E7%9F%A9%E9%98%B5"><span class="toc-text">4.4 MV çŸ©é˜µå’Œé€è§†çŸ©é˜µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA-3d-%E7%AB%8B%E6%96%B9%E4%BD%93"><span class="toc-text">4.5 æ„å»ºä¸€ä¸ª 3D ç«‹æ–¹ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E6%B8%B2%E6%9F%93%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%89%AF%E6%9C%AC"><span class="toc-text">4.6 æ¸²æŸ“ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå‰¯æœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E5%90%8C%E4%B8%80%E5%9C%BA%E6%99%AF%E6%B8%B2%E6%9F%93%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-text">4.7 åŒä¸€åœºæ™¯æ¸²æŸ“å¤šä¸ªå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E7%9F%A9%E9%98%B5%E6%A0%88"><span class="toc-text">4.8 çŸ©é˜µæ ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E5%BA%94%E5%AF%B9-z%E5%86%B2%E7%AA%81-%E4%BC%AA%E5%BD%B1"><span class="toc-text">4.9 åº”å¯¹â€œZå†²çªâ€ä¼ªå½±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-%E5%85%B6%E4%BB%96%E5%9B%BE%E5%85%83"><span class="toc-text">4.10 å…¶ä»–å›¾å…ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-1-%E4%B8%89%E8%A7%92%E5%BD%A2%E5%9B%BE%E5%85%83"><span class="toc-text">4.10.1 ä¸‰è§’å½¢å›¾å…ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-2-%E7%BA%BF%E5%9B%BE%E5%85%83"><span class="toc-text">4.10.2 çº¿å›¾å…ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-3-%E7%82%B9%E5%9B%BE%E5%85%83"><span class="toc-text">4.10.3 ç‚¹å›¾å…ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%9B%BE%E5%85%83"><span class="toc-text">è¡¥ä¸å›¾å…ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11-%E6%80%A7%E8%83%BD%E4%BC%98%E5%85%88%E7%BC%96%E7%A8%8B"><span class="toc-text">4.11 æ€§èƒ½ä¼˜å…ˆç¼–ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="toc-text">äº”ã€çº¹ç†è´´å›¾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%8A%A0%E8%BD%BD%E7%BA%B9%E7%90%86%E5%9B%BE%E5%83%8F%E6%96%87%E4%BB%B6"><span class="toc-text">5.1 åŠ è½½çº¹ç†å›¾åƒæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BA%B9%E7%90%86%E5%9D%90%E6%A0%87"><span class="toc-text">5.2 çº¹ç†åæ ‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B8%A6%E7%BA%B9%E7%90%86%E7%9A%84%E5%9B%9B%E6%A3%B1%E9%94%A5"><span class="toc-text">5.3 æ„å»ºä¸€ä¸ªå¸¦çº¹ç†çš„å››æ£±é”¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%A4%9A%E7%BA%A7%E6%B8%90%E8%BF%9C%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="toc-text">5.4 å¤šçº§æ¸è¿œçº¹ç†è´´å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%90%84%E5%90%91%E5%BC%82%E6%80%A7%E8%BF%87%E6%BB%A4"><span class="toc-text">5.5 å„å‘å¼‚æ€§è¿‡æ»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E7%8E%AF%E7%BB%95%E5%92%8C%E5%B9%B3%E9%93%BA"><span class="toc-text">5.6 ç¯ç»•å’Œå¹³é“º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E9%80%8F%E8%A7%86%E5%8F%98%E5%BD%A2"><span class="toc-text">5.7 é€è§†å˜å½¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-%E6%9D%90%E8%B4%A8%E7%9A%84%E6%9B%B4%E5%A4%9A%E7%BB%86%E8%8A%82"><span class="toc-text">5.8 æè´¨çš„æ›´å¤šç»†èŠ‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-3d%E6%A8%A1%E5%9E%8B"><span class="toc-text">å…­ã€3Dæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%A8%8B%E5%BA%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">6.1 ç¨‹åºæ„å»ºæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%90%83%E4%BD%93"><span class="toc-text">6.1.1 æ„å»ºä¸€ä¸ªçƒä½“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%8E%AF%E9%9D%A2"><span class="toc-text">6.1.2 æ„å»ºä¸€ä¸ªç¯é¢</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%8A%A0%E8%BD%BD%E5%A4%96%E9%83%A8%E6%9E%84%E5%BB%BA%E7%9A%84%E6%A8%A1%E5%9E%8B"><span class="toc-text">6.2 åŠ è½½å¤–éƒ¨æ„å»ºçš„æ¨¡å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-%E5%85%89%E7%85%A7"><span class="toc-text">ä¸ƒã€å…‰ç…§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">7.1 å…‰ç…§æ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%85%89%E6%BA%90"><span class="toc-text">7.2 å…‰æº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%9D%90%E8%B4%A8"><span class="toc-text">7.3 æè´¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-ads%E5%85%89%E7%85%A7%E8%AE%A1%E7%AE%97"><span class="toc-text">7.4 ADSå…‰ç…§è®¡ç®—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%AE%9E%E7%8E%B0ads%E5%85%89%E7%85%A7"><span class="toc-text">7.5 å®ç°ADSå…‰ç…§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-1-gouraud-%E7%9D%80%E8%89%B2"><span class="toc-text">7.5.1 Gouraud ç€è‰²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-phong-%E7%9D%80%E8%89%B2"><span class="toc-text">7.5.2 Phong ç€è‰²</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E7%BB%93%E5%90%88%E5%85%89%E7%85%A7%E5%92%8C%E7%BA%B9%E7%90%86"><span class="toc-text">7.6 ç»“åˆå…‰ç…§å’Œçº¹ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-%E9%98%B4%E5%BD%B1"><span class="toc-text">å…«ã€é˜´å½±</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E6%8A%95%E5%BD%B1%E9%98%B4%E5%BD%B1"><span class="toc-text">8.1 æŠ•å½±é˜´å½±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E9%98%B4%E5%BD%B1%E4%BD%93"><span class="toc-text">8.2 é˜´å½±ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E9%98%B4%E5%BD%B1%E8%B4%B4%E5%9B%BE"><span class="toc-text">8.3 é˜´å½±è´´å›¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-%E7%AC%AC%E4%B8%80%E8%BD%AE-%E4%BB%8E%E5%85%89%E6%BA%90%E4%BD%8D%E7%BD%AE%E7%BB%98%E5%88%B6"><span class="toc-text">8.3.1 ç¬¬ä¸€è½®â€”â€”ä»å…‰æºä½ç½®ç»˜åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-2-%E5%B0%86%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2%E5%8C%BA%E5%A4%8D%E5%88%B6%E5%88%B0%E7%BA%B9%E7%90%86"><span class="toc-text">8.3.2 å°†æ·±åº¦ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-%E7%AC%AC%E4%BA%8C%E8%BD%AE-%E4%BB%8E%E7%9B%B8%E6%9C%BA%E4%BD%8D%E7%BD%AE%E7%BB%98%E5%88%B6"><span class="toc-text">8.3.3 ç¬¬äºŒè½®â€”â€”ä»ç›¸æœºä½ç½®ç»˜åˆ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E6%9F%94%E5%92%8C%E9%98%B4%E5%BD%B1"><span class="toc-text">8.4 æŸ”å’Œé˜´å½±</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D-%E5%A4%A9%E7%A9%BA%E5%92%8C%E8%83%8C%E6%99%AF"><span class="toc-text">ä¹ã€å¤©ç©ºå’ŒèƒŒæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%A4%A9%E7%A9%BA%E7%9B%92"><span class="toc-text">9.1 å¤©ç©ºç›’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E7%A9%B9%E9%A1%B6"><span class="toc-text">9.2 ç©¹é¡¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E7%A9%BA%E7%9B%92"><span class="toc-text">9.3 å®ç°å¤©ç©ºç›’</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-1-%E4%BB%8E%E5%A4%B4%E5%BC%80%E5%A7%8B%E6%9E%84%E5%BB%BA%E5%A4%A9%E7%A9%BA%E7%9B%92"><span class="toc-text">9.3.1 ä»å¤´å¼€å§‹æ„å»ºå¤©ç©ºç›’</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-%E4%BD%BF%E7%94%A8opengl%E7%AB%8B%E6%96%B9%E4%BD%93%E8%B4%B4%E5%9B%BE"><span class="toc-text">9.3.2 ä½¿ç”¨OpenGLç«‹æ–¹ä½“è´´å›¾</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E7%8E%AF%E5%A2%83%E8%B4%B4%E5%9B%BE"><span class="toc-text">9.4 ç¯å¢ƒè´´å›¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81-%E5%A2%9E%E5%BC%BA%E8%A1%A8%E9%9D%A2%E7%BB%86%E8%8A%82"><span class="toc-text">åã€å¢å¼ºè¡¨é¢ç»†èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%87%B9%E5%87%B8%E8%B4%B4%E5%9B%BE"><span class="toc-text">10.1 å‡¹å‡¸è´´å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE"><span class="toc-text">10.2 æ³•çº¿è´´å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E9%AB%98%E5%BA%A6%E8%B4%B4%E5%9B%BE"><span class="toc-text">10.3 é«˜åº¦è´´å›¾</span></a></li></ol></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>å›åˆ°é¡¶éƒ¨</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"originalHost":null,"officialHosts":["localhost"],"encoded":""};
  const ctx = {
    date_suffix: {
      just: `åˆšåˆš`,
      min: `åˆ†é’Ÿå‰`,
      hour: `å°æ—¶å‰`,
      day: `å¤©å‰`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // å­˜æ”¾å›è°ƒå‡½æ•°
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // æ„é€ ä¸€ä¸ªå¯ä»¥runçš„å¯¹è±¡
    function Item(fn, name) {
      // å‡½æ•°åç§°
      this.name = name || fn.name;
      // runæ–¹æ³•
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] è¶…æ—¶:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('è¯·æ±‚è¶…æ—¶');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('å“åº”å¤±è´¥');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] é”™è¯¯:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1ã€requestAnimationFrame ä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰ DOM æ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›æµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›æµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé¢‘ç‡ä¸ºæ¯ç§’60å¸§ã€‚
    // 2ã€åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrame å°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›æµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„çš„ cpuï¼Œgpu å’Œå†…å­˜ä½¿ç”¨é‡ã€‚
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode å½“å‰æ¨¡å¼ dark or light
  // utils.dark.toggle() æš—é»‘æ¨¡å¼è§¦å‘å™¨
  // utils.dark.push(callBack[,"callBackName"]) ä¼ å…¥è§¦å‘å™¨å›è°ƒå‡½æ•°
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // é€šçŸ¥ LazyLoad æ›´æ–°
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.0" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: è¿™ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ preferred_color_scheme ä»¥å¤–çš„ä¸»é¢˜
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼`,
      dark: `åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼`,
      auto: `åˆ‡æ¢åˆ°è·Ÿéšç³»ç»Ÿé…è‰²`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `å¤åˆ¶æˆåŠŸ`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
