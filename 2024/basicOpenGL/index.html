<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Fingsinz">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://fingsinz.github.io/2024/basicopengl/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="关键词：C++、OpenGL">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenGL图形学编程基础学习记录">
<meta property="og:url" content="https://fingsinz.github.io/2024/basicOpenGL/index.html">
<meta property="og:site_name" content="Fingsinz&#39;s space">
<meta property="og:description" content="关键词：C++、OpenGL">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_OpenGLversion.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwfiles.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwbuild.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwlib.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwinclude.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glew.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glm.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_premake.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_soil2.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_openglstructure.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_template.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_newwindow.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle1.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movingtriangle.gif">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_View.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zhengshe.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_lookat.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_rasterized.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_greenCube.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube1.gif">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_mcoloredCube.gif">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_100kcubes.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_2objects.gif">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sunearthmoon.gif">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zfighting.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltriangle.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglestrip.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglefan.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_glline.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gllinestrip.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_texture.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_pyramidwithtexture.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Multileveltexture.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_distortion.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_group.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_index.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sphere.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_totorus.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_torus.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_blender.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Pyramidobj.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_unicorn.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_iceUnicorn.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_spotlightargs.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_angleOfIncidence.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_observationPointIncidence.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_goldtorus.jpg">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_optobPointIncidence.png">
<meta property="og:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movinglight.gif">
<meta property="article:published_time" content="2024-01-09T07:00:00.000Z">
<meta property="article:modified_time" content="2024-01-25T14:20:05.782Z">
<meta property="article:author" content="Fingsinz">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="OpenGL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_OpenGLversion.jpg">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/icon1.webp" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon1.webp">
    <meta name="theme-color" content="#93b5cf">
    <link rel="shortcut icon" href="/images/icon1.webp">
    <!--- Page Info-->
    
    <title>
        
            OpenGL图形学编程基础学习记录 -
        
        Fingsinz&#39; Space
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fingsinz.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":true,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":4,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/3.webp","skip_dirs":[]}},"colors":{"primary":"#93b5cf","secondary":"#15559a"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":false,"site_pv":false,"site_uv":false,"post_pv":false},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/3.webp","dark":"/images/3.webp"},"title":"Fingsinz's Space","subtitle":{"text":null,"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"smart_backspace":true},"text_color":{"light":"#ffffff","dark":"#ffffff"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"email":"fingsinz@foxmail.com"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#815c94","transparency":35},"links":{"主页":{"path":"/","icon":"fa-regular fa-house"},"日常":{"path":"/categories/日常/","icon":"fa fa-calendar"},"分享":{"path":null,"icon":"fa fa-heartbeat","submenus":{"软件":"/categories/软件/","网页":"/categories/网页/","其他":"/categories/其他分享/"}},"笔记":{"path":"/notes","icon":"fa fa-circle-nodes"},"归档":{"path":"/archives","icon":"fa-regular fa-archive"},"关于":{"icon":"fa-regular fa-user","submenus":{"Me&Blog":"/about","Github部署(直连)":"https://fingsinz.space/","Gitee部署(备用)":"https://fingsinz.gitee.io/"}}},"search":{"enable":false,"preload":false}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"不忘初心，方得始终。","links":null},"article_date_format":"YYYY-MM-DD","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/5/28 12:00:00"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/icon1.webp">
                </a>
            
            <a class="logo-title" href="/">
                
                Fingsinz&#39; Space
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        主页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories/%E6%97%A5%E5%B8%B8/"  >
                                    
                                        
                                            <i class="fa fa-calendar"></i>
                                        
                                        日常
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa fa-heartbeat"></i>
                                        
                                        分享&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/categories/%E8%BD%AF%E4%BB%B6/">软件
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/categories/%E7%BD%91%E9%A1%B5/">网页
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E4%BA%AB/">其他
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/notes"  >
                                    
                                        
                                            <i class="fa fa-circle-nodes"></i>
                                        
                                        笔记
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME&amp;BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://fingsinz.space/">GITHUB部署(直连)
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://fingsinz.gitee.io/">GITEE部署(备用)
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                主页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories/%E6%97%A5%E5%B8%B8/"  >
                             
                                
                                    <i class="fa fa-calendar"></i>
                                
                                日常
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa fa-heartbeat"></i>
                                
                                分享&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E8%BD%AF%E4%BB%B6/">软件</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E7%BD%91%E9%A1%B5/">网页</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E4%BA%AB/">其他</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/notes"  >
                             
                                
                                    <i class="fa fa-circle-nodes"></i>
                                
                                笔记
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME&amp;BLOG</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://fingsinz.space/">GITHUB部署(直连)</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://fingsinz.gitee.io/">GITEE部署(备用)</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title">
            
                <h1 class="article-title-regular">OpenGL图形学编程基础学习记录</h1>
            
            </div>
            
                    
        
        
            <div class="article-header flex flex-row gap-2 items-center">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/icon.webp">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Fingsinz</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-01-09 15:00</span>
        <span class="mobile">2024-01-09 15:00</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-01-25 22:20:05</span>
            <span class="mobile">2024-01-25 22:20:05</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/C/">C++</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/OpenGL/">OpenGL</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>36.3k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>170 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body">
            <p>关键词：C++、OpenGL</p>
<span id="more"></span>
<hr>
<h2 id="一-opengl安装与使用">一、OpenGL安装与使用</h2>
<p><em>Reference：计算机图形学编程（使用OpenGL和C++）（第2版）</em></p>
<h3 id="1-1-认识opengl">1.1 认识OpenGL</h3>
<p>在 C++中使用 OpenGL 需要配置多个库。此处，使用到：</p>
<ul>
<li>
<p>C++开发环境；</p>
</li>
<li>
<p>OpenGL / GLSL：2004 年，2.0 版本中引入了 OpenGL 着色语言 GLSL，使得“着色器程序”可以被直接安装到图形管线的各个阶段并执行；</p>
</li>
<li>
<p>窗口管理库：OpenGL会将图像渲染到一个帧缓冲区，然后由计算机将帧缓冲区的内容绘制到屏幕的窗口中，GLFW 库是最流行的选择之一。</p>
</li>
<li>
<p>扩展库：常用如 GLEW 库；</p>
</li>
<li>
<p>数学库：3D 图形编程会大量使用向量和矩阵代数，可使用 OpenGL Mathematics（GLM）库、 Eigen 库或 vmath 库；</p>
</li>
<li>
<p>纹理图像加载库：比如 FreeImage、DevIL、GLI、Glraw 和 SOIL。</p>
</li>
</ul>
<h3 id="1-2-安装和配置opengl">1.2 安装和配置OpenGL</h3>
<p><em>基于Visual Studio 2022进行</em></p>
<h4 id="1-2-1-准备opengl-glsl">1.2.1 准备OpenGL/GLSL</h4>
<ul>
<li>了解计算机支持什么版本的OpenGL，可使用 <a class="link" target="_blank" rel="noopener" href="https://www.realtech-vr.com/home/?page_id=1402">GLView <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 查看。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_OpenGLversion.jpg" alt="OpenGL版本"><figcaption>OpenGL版本</figcaption></figure></p>
<h4 id="1-2-2-准备glfw">1.2.2 准备GLFW</h4>
<ol>
<li>下载 GLFW 源代码，<a class="link" target="_blank" rel="noopener" href="https://www.glfw.org/">下载地址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwfiles.jpg" alt="GLFW文件"><figcaption>GLFW文件</figcaption></figure></p>
<ol start="2">
<li>使用 CMake 进行编译源码</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glfwbuild.jpg" alt="编译GLFW"><figcaption>编译GLFW</figcaption></figure></p>
<p>接着找到 GLFW.sln，使用VS打开并编译为64位应用程序。</p>
<ol start="3">
<li>构建完成后得到下面两个内容：lib静态库文件和include文件夹</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwlib.jpg" alt="静态库"><figcaption>静态库</figcaption></figure></p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs%2Fopengl_glfwinclude.jpg" alt="include"><figcaption>include</figcaption></figure></p>
<h4 id="1-2-3-准备glew">1.2.3 准备GLEW</h4>
<p>下载 GLEW 的二进制文件，<a class="link" target="_blank" rel="noopener" href="https://glew.sourceforge.net/">下载地址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。解压后内有库文件和头文件等。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glew.jpg" alt="GLEW文件夹"><figcaption>GLEW文件夹</figcaption></figure></p>
<h4 id="1-2-4-准备glm">1.2.4 准备GLM</h4>
<p>下载 GLM 压缩包，<a class="link" target="_blank" rel="noopener" href="https://github.com/g-truc/glm/releases">下载地址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，解压后即可。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_glm.jpg" alt="GLM"><figcaption>GLM</figcaption></figure></p>
<h4 id="1-2-5-准备soil2">1.2.5 准备SOIL2</h4>
<ol>
<li>
<p>下载并解压 <a class="link" target="_blank" rel="noopener" href="https://premake.github.io/">premake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，包含 premake5.exe。</p>
</li>
<li>
<p>下载 SOIL2 的源码，<a class="link" target="_blank" rel="noopener" href="https://github.com/SpartanJ/SOIL2/tags">下载地址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，解压。</p>
</li>
<li>
<p>将 premake5.exe 复制到 soil2 目录下。</p>
</li>
<li>
<p>在 soil2 目录下使用cmd，运行命令：</p>
</li>
</ol>
<div class="highlight-container" data-rel="Cmd"><figure class="iseeu highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">premake5 vs2022</span><br></pre></td></tr></table></figure></div>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_premake.jpg" alt="运行命令"><figcaption>运行命令</figcaption></figure></p>
<ol start="5">
<li>打开 make/windows 文件夹的 SOIL2.sln 文件，右键 soil2-static-lib 在 x64 下选择进行生成。</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_soil2.jpg" alt="生成文件"><figcaption>生成文件</figcaption></figure></p>
<h4 id="1-2-6-准备共享的lib和include">1.2.6 准备共享的lib和include</h4>
<p>选择合适的位置创建文件夹，并设置 lib 和 include 子文件夹。</p>
<ul>
<li>
<p>在 lib 文件夹中放入 glew32.lib、glfw3.lib 和 soil2-debug.lib。</p>
</li>
<li>
<p>在 include 文件夹中放入 GLEW 的 GL 文件夹、GLFW 文件夹、glm 文件夹 和 SOIL2-1.3.0/src 的 SOIL2 文件夹。</p>
</li>
<li>
<p>在当前文件夹放入 glew32.dll</p>
</li>
</ul>
<p>文件结构如下图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_openglstructure.jpg" alt="共享文件夹结构"><figcaption>共享文件夹结构</figcaption></figure></p>
<h3 id="1-3-在vs中配置opengl项目">1.3 在VS中配置OpenGL项目</h3>
<p><em>创建 VS 自定义项目模板</em></p>
<ol>
<li>
<p>启动 VS， 创建空白项目，选择 x64。</p>
</li>
<li>
<p>在 Debug 模式下，进入“项目属性”，在“VC++”目录下的包含目录添加上共享文件夹的 include 文件夹；在“链接器”下，“常规-&gt;附加库目录”（或“VC+±&gt;库目录”）添加上共享文件夹的 lib 文件夹，“输入-&gt;附加依赖项”添加以下文件名： <code>glfw3.lib</code>、<code>glew32.lib</code>、<code>soil2-debug.lib</code> 和 <code>opengl32.lib</code>。</p>
</li>
<li>
<p>在 Release 模式下，重复上述步骤。</p>
</li>
<li>
<p>“项目-&gt;导出模板”，选择项目模板，命名自定义，此处为“OpenGL project”。</p>
</li>
</ol>
<p>创建 OpenGL C++ 项目时，启动 VS 时，点击“新建项目”，在左上方选择 OpenGL 模板即可使用。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_template.jpg" alt="使用模板创建项目"><figcaption>使用模板创建项目</figcaption></figure></p>
<p>需要注意的是，在新建OpenGL C++项目时，需要把 <code>glew32.dll</code> 放到项目目录下。</p>
<h3 id="1-4-创建一个窗口">1.4 创建一个窗口</h3>
<p>这部分可以用来测试上面的配置是否成功。下面给出一个 OpenGL C++ 创建窗口的代码：</p>
<details><summary>展开代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLFWwindow *window;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 GLFW</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_SAMPLES, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); <span class="comment">// MacOS 不需要</span></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开一个窗口并创建它的OpenGL上下文</span></span><br><span class="line">	window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 GLEW</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line">	<span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 蓝色背景</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 清除屏幕</span></span><br><span class="line">		<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 交换缓冲区</span></span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// 检查是否按下了ESC键或窗口已关闭</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭OpenGL窗口并终止GLFW</span></span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>运行结果：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/opengl_newwindow.jpg" alt="运行结果"><figcaption>运行结果</figcaption></figure></p>
<h2 id="二-opengl图像管线">二、OpenGL图像管线</h2>
<p>C++/OpenGL 应用程序的一个重要任务是让程序员的 GLSL 代码运行于 GPU 上。</p>
<p>OpenGL 提供了一个多级图形管线，可以使用 GLSL 语言进行部分编程。GLSL 是一种着色器语言。着色器语言主要运行于 GPU 上，在图形管线上下文中。</p>
<h3 id="2-1-管线">2.1 管线</h3>
<p>OpenGL 图像管线是 OpenGL 的核心，它是一个图像处理的管线。图像管线的工作原理是将图像数据从原始的纹理中渲染到屏幕上。</p>
<p>3D 图形编程会使用管线的概念，在管线中，将 3D 场景转换成  2D 图形的过程被分割成许多步骤。</p>
<p>C++/OpenGL 应用程序发送图形数据到顶点着色器，随着管线处理，最终生成在显示器上显示的像素点。</p>
<h4 id="2-1-1-第一个c-opengl应用程序">2.1.1 第一个C++/OpenGL应用程序</h4>
<p><em>即详细解释之前的创建窗口代码</em></p>
<p>该程序将会使用一些扩展库：GLEW、GLM、SOIL2 和 GLFW。</p>
<ul>
<li>GLFW 库提供了 GLFWwindow 类，可在其上进行3D场景绘制。</li>
</ul>
<p>该程序的大概操作有：</p>
<ol>
<li>初始化 GLFW</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化 GLFW</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ol start="2">
<li>创建窗口的设置</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"><span class="comment">// WindowHint 指定了计算机必须与 OpenGL 版本 4.6 兼容（主版本号为 4，次版本号为 6）。</span></span><br></pre></td></tr></table></figure></div>
<ol start="3">
<li>创建一个 GLFWwindow 实例并创建窗口</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// glfwCreateWindow 命令的参数指定了窗口的宽、高（以像素为单位）以及窗口顶部的标题，后两个NULL分别用来控制全屏显示和资源共享）</span></span><br><span class="line"><span class="comment">// 创建一个新窗口，大小为1024×768，窗口名为“New Window”</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"><span class="comment">// 创建 GLFW 窗口并不会自动将它与当前 OpenGL 上下文关联起来，因此需要调用 glfwMakeContextCurrent()。</span></span><br></pre></td></tr></table></figure></div>
<ol start="4">
<li>设置窗口属性</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line"><span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置绿色背景，四个参数分别为RGBA。</span></span><br><span class="line"><span class="comment">// glClearColor()能够指定颜色缓冲区清除后填充的值</span></span><br><span class="line"><span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br></pre></td></tr></table></figure></div>
<ol start="5">
<li>初始化 GLEW 库</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化 GLEW</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ol start="6">
<li>循环显示窗口</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 清除屏幕，重置缓冲区时填充的颜色</span></span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 交换缓冲区，绘制屏幕</span></span><br><span class="line">	<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">    <span class="comment">// 处理窗口相关事件（如按键事件）</span></span><br><span class="line">	<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// 检查是否按下了ESC键或窗口已关闭</span></span><br></pre></td></tr></table></figure></div>
<ol start="7">
<li>退出程序</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭OpenGL窗口并终止GLFW</span></span><br><span class="line"><span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line"><span class="built_in">glfwTerminate</span>();</span><br></pre></td></tr></table></figure></div>
<details><summary>完整程序</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glm;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 GLFW</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开一个窗口并创建它的OpenGL上下文</span></span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;New Window&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line">	<span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绿色背景</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 GLEW</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 清除屏幕</span></span><br><span class="line">		<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 交换缓冲区</span></span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS &amp;&amp; <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>); <span class="comment">// 检查是否按下了ESC键或窗口已关闭</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭OpenGL窗口并终止GLFW</span></span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h3 id="2-2-顶点着色器和片段着色器">2.2 顶点着色器和片段着色器</h3>
<p>多数 3D 模型通常由多个三角形图元构成。如点、线、三角形这些简单的图形称作图元。</p>
<p>图元由顶点组成。</p>
<p>在加载顶点之前，C++/OpenGL 应用程序必须编译并链接合适的 GLSL 顶点着色器和片段着色器程序，之后将它们载入管线。</p>
<p>比如绘画三角形时，可以通过该函数实现：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glDrawArrays</span>(GLenum mode, Glint first, Glsizei count);</span><br></pre></td></tr></table></figure></div>
<ul>
<li>
<p>mode：表示图元的类型；</p>
</li>
<li>
<p>first：表示从哪个顶点开始绘制；</p>
</li>
<li>
<p>count：表示绘制的顶点数。</p>
</li>
</ul>
<p>以绘画三角形为例子，步骤如下：</p>
<p><em>注： <code>GLuint</code> 是 OpenGL 提供的 <code>unsigned int</code></em></p>
<ol>
<li>
<p>初始化阶段，对 GLFW 和 GLEW 库进行初始化，同时创建窗口；</p>
</li>
<li>
<p>创建顶点数组对象VAO和缓存区；</p>
</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个顶点数组对象，并将它设为当前对象</span></span><br><span class="line">GLuint VertexArrayID;</span><br><span class="line"><span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"><span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三角形的三个顶点：(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">	<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">	 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">	 <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建缓存区</span></span><br><span class="line">GLuint vertexbuffer; <span class="comment">// 顶点缓冲区标识</span></span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// 生成1个缓冲区，将生成的标识符放入顶点缓冲</span></span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// 把这个三角形传给OpenGL</span></span><br></pre></td></tr></table></figure></div>
<ol start="3">
<li>循环中绘画三角形</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 启用顶点数组</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);	<span class="comment">// 绘制三角形</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 禁用顶点数组</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSwapBuffers</span>(window);	<span class="comment">// 交换缓冲区，更新屏幕</span></span><br><span class="line">	<span class="built_in">glfwPollEvents</span>();			<span class="comment">// 监听事件</span></span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>
<ol start="4">
<li>后处理，删除申请的资源</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 后处理，删除资源</span></span><br><span class="line"><span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line"><span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"><span class="built_in">glfwTerminate</span>();</span><br></pre></td></tr></table></figure></div>
<details><summary>完整代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 GLFW</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开一个窗口并创建它的OpenGL上下文</span></span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line">	<span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绿色背景</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 GLEW</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个顶点数组对象，并将它设为当前对象</span></span><br><span class="line">	GLuint VertexArrayID; <span class="comment">// 顶点数组标识</span></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 三角形的三个顶点：(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建缓存区</span></span><br><span class="line">	GLuint vertexbuffer; <span class="comment">// 顶点缓冲区标识</span></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// 生成1个缓冲区，将生成的标识符放入顶点缓冲</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// 把这个三角形传给OpenGL</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 启用顶点数组属性</span></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);	<span class="comment">// 绘制三角形</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 禁用顶点数组属性</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);	<span class="comment">// 交换缓冲区，更新屏幕</span></span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();			<span class="comment">// 监听事件</span></span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 后处理，删除资源</span></span><br><span class="line">	<span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">	<span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle.jpg" alt="绘画三角形"><figcaption>绘画三角形</figcaption></figure></p>
<p>这个三角形是白色的，因为其并没有进行任何着色。</p>
<p>使用顶点着色器和片段着色器可以进行着色。</p>
<details><summary>完整代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">GLuint <span class="title">createShadeProgram</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 顶点着色器</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *vshaderSource =</span><br><span class="line">		<span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line">		<span class="string">&quot;layout(location = 0) in vec3 vertexPosition_modelspace;\n&quot;</span></span><br><span class="line">		<span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">		<span class="string">&quot;&#123; gl_Position.xyz = vertexPosition_modelspace; gl_Position.w = 1.0; &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 片段着色器</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *fshaderSource =</span><br><span class="line">		<span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line">		<span class="string">&quot;out vec3 color;\n&quot;</span></span><br><span class="line">		<span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">		<span class="string">&quot;&#123; color = vec3(0, 0, 0.3); &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// OpenGL 创建每个着色器对象（初始值为空）的时候，会返回一个整数 ID 作为后面引用它的序号</span></span><br><span class="line">	<span class="comment">// 分别存入 vShader 和 fShader 变量</span></span><br><span class="line">	GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER); <span class="comment">// 创建了类型为GL_VERTEX_SHADER 的着色器，即顶点着色器</span></span><br><span class="line">	GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER); <span class="comment">// 创建了类型为GL_FRAGMENT_SHADER 的着色器，即片段着色器</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 GLSL 代码从字符串载入空着色器对象中</span></span><br><span class="line">	<span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 编译着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">	<span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建了一个叫作 vfProgram 的程序对象并记录其ID</span></span><br><span class="line">	GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">	<span class="comment">// 将着色器加入程序对象</span></span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">	<span class="comment">// 请求 GLSL 编译器，以确保它们的兼容性</span></span><br><span class="line">	<span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> vProgram; <span class="comment">// 返回着色器程序ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 GLFW</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开一个窗口并创建它的OpenGL上下文</span></span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line">	<span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绿色背景</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 GLEW</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个顶点数组对象，并将它设为当前对象</span></span><br><span class="line">	GLuint VertexArrayID; <span class="comment">// 顶点数组标识</span></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 三角形的三个顶点：(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建缓存区</span></span><br><span class="line">	GLuint vertexbuffer; <span class="comment">// 顶点缓冲区标识</span></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// 生成1个缓冲区，将生成的标识符放入顶点缓冲</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// 把这个三角形传给OpenGL</span></span><br><span class="line"></span><br><span class="line">	GLuint programID = <span class="built_in">createShadeProgram</span>(); <span class="comment">// 创建着色器</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glUseProgram</span>(programID);	<span class="comment">// 使用着色器</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 启用顶点数组属性</span></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);	<span class="comment">// 绘制三角形</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 禁用顶点数组属性</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);	<span class="comment">// 交换缓冲区，更新屏幕</span></span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();			<span class="comment">// 监听事件</span></span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 后处理，删除资源</span></span><br><span class="line">	<span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">	<span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">	<span class="built_in">glDeleteProgram</span>(programID);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_triangle1.jpg" alt="着色后的三角形"><figcaption>着色后的三角形</figcaption></figure></p>
<p>观察着色器部分的代码：</p>
<p>顶点着色器：所有顶点着色器的主要目标都是将顶点发送给管线。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;#version 460 core\n&quot;</span></span><br><span class="line"><span class="string">&quot;layout(location = 0) in vec3 vertexPosition_modelspace;\n&quot;</span></span><br><span class="line"><span class="string">&quot;void main()\n&quot;</span></span><br><span class="line"><span class="string">&quot;&#123; gl_Position.xyz = vertexPosition_modelspace; gl_Position.w = 1.0; &#125;&quot;</span></span><br></pre></td></tr></table></figure></div>
<ol>
<li>
<p>第一行表示OpenGL版本，同时也使用该版本的语法，我这里是4.6.0；</p>
</li>
<li>
<p>第二行</p>
<ul>
<li><code>layout(location = 0)</code> 指用来赋给 <code>vertexPosition_modelspace</code> 这个属性的缓冲区。每个顶点能有多种属性：位置，一种或多种颜色，一个或多个纹理坐标，等等；通过将 <code>glvertexAttribPointer</code> 函数的第一个参数值赋给layout，就完成了这一点。参数值“0”并不重要，它可以是12（但是不大于 <code>glGetIntegerv(GL_MAX_VERTEX_ATTRIBS, &amp;v)</code> ）；重要的是两边参数值保持一致</li>
<li><code>in</code> 表示表明变量是输入变量；</li>
<li><code>vec3</code> 在GLSL中是一个三维向量；</li>
<li><code>vertexPosition_modelspace</code> 是变量名，将包含每个顶点着色器运行所需的顶点位置值。</li>
</ul>
</li>
<li>
<p>第三行表示主函数，与C++语法相似；</p>
</li>
<li>
<p>第四行内置变量 gl_Position 用来设置顶点在 3D 空间中的坐标位置，并将其发送至下一个管线阶段。</p>
</li>
</ol>
<p>片段着色器：所有片段着色器的目的都是给为要展示的像素赋予颜色。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;#version 460 core\n&quot;</span> </span><br><span class="line"><span class="string">&quot;out vec3 color;\n&quot;</span></span><br><span class="line"><span class="string">&quot;void main()\n&quot;</span></span><br><span class="line"><span class="string">&quot;&#123; color = vec3(0, 0, 0.3); &#125;&quot;</span></span><br></pre></td></tr></table></figure></div>
<ol>
<li>
<p>第一行表示OpenGL版本，同时也使用该版本的语法，我这里是4.6.0；</p>
</li>
<li>
<p>第二行 out 标签表明 color 变量是输出变量；</p>
</li>
<li>
<p>第三行表示主函数，与C++语法相似；</p>
</li>
<li>
<p>第四行表示设置颜色RGB值。</p>
</li>
</ol>
<p>解释 <code>glvertexAttribPointer</code> 函数，函数使用如下：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>
<ol>
<li>
<p>第一参数：指定要配置的顶点属性。在顶点着色器中使用 <code>layout(location = 0)</code> 定义了顶点属性的位置值，它可以把顶点属性的位置值设置为0，所以这里传入0；</p>
</li>
<li>
<p>第二参数：指定顶点属性的大小；</p>
</li>
<li>
<p>第三参数：指定数据的类型；</p>
</li>
<li>
<p>第四参数：是否希望数据被标准化（Normalize）；</p>
</li>
<li>
<p>第五参数：步长，告诉在连续的顶点属性组之间的间隔；</p>
</li>
<li>
<p>第六参数：数组缓冲区偏移量。</p>
</li>
</ol>
<p>此示例中着色器代码较短，可以直接编写到程序中。但当着色器代码较为复杂时，希望能文件分开，从文件中读入着色器代码。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读代码函数</span></span><br><span class="line"><span class="function">std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(filePath, std::ios::in)</span></span>;</span><br><span class="line">	std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">		content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fileStream.<span class="built_in">close</span>();</span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>相应地 <code>createShadeProgram()</code> 改成：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::string vs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;vertex.glsl&quot;</span>);</span><br><span class="line">std::string fs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br></pre></td></tr></table></figure></div>
<h3 id="2-3-glsl代码检查">2.3 GLSL代码检查</h3>
<p>编译和运行 GLSL 代码的过程与普通代码的不同，GLSL 的编译发生在 C++运行时。另外一个复杂的点是 GLSL 代码并没有运行在 CPU 中（它运行在 GPU 中），因此操作系统并不总能捕获 OpenGL 运行时的错误。着色器运行时错误的常见结果是输出屏幕上完全空白，根本没有输出。</p>
<p>但是 GLSL 函数 <code>glGetShaderiv()</code> 和 <code>glGetProgramiv()</code> 可提供有关编译过的 GLSL 着色器和程序的信息。</p>
<p>设计三个函数：</p>
<ul>
<li>
<p><code>checkOpenGLError()</code>：既用于检测 GLSL 代码编译错误，又用于检测 OpenGL 运行时的错误。</p>
</li>
<li>
<p><code>printShaderLog()</code>：当 GLSL 代码编译失败时，显示 OpenGL 日志内容。</p>
</li>
<li>
<p><code>printProgramLog()</code>：当 GLSL 链接失败时，显示 OpenGL 日志内容。</p>
</li>
</ul>
<details><summary>详细代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 代码编译失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param shader 着色器标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 链接失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param program 着色器程序标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 检查 OpenGL 错误标志，即是否发生 OpenGL 错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	<span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		err = <span class="literal">true</span>;</span><br><span class="line">		glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>加入错误检查，创建着色器程序代码更改为：</p>
<details><summary>展开代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLuint <span class="title">createShadeProgram</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 记录错误信息</span></span><br><span class="line">	GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 顶点着色器</span></span><br><span class="line">	std::string vs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;vertex.glsl&quot;</span>);</span><br><span class="line">	<span class="comment">// 片段着色器</span></span><br><span class="line">	std::string fs = <span class="built_in">readShaderSource</span>(<span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// OpenGL 创建每个着色器对象（初始值为空）的时候，会返回一个整数 ID 作为后面引用它的序号</span></span><br><span class="line">	<span class="comment">// 分别存入 vShader 和 fShader 变量</span></span><br><span class="line">	GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER); <span class="comment">// 创建了类型为GL_VERTEX_SHADER 的着色器，即顶点着色器</span></span><br><span class="line">	GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER); <span class="comment">// 创建了类型为GL_FRAGMENT_SHADER 的着色器，即片段着色器</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 GLSL 代码从字符串载入空着色器对象中</span></span><br><span class="line">	<span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 编译顶点着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">	<span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 编译片段着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">	<span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建了一个叫作 vfProgram 的程序对象并记录其ID</span></span><br><span class="line">	GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">	<span class="comment">// 将着色器加入程序对象</span></span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">	<span class="comment">// 请求 GLSL 编译器，以确保它们的兼容性</span></span><br><span class="line">	<span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">	<span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> vProgram; <span class="comment">// 返回着色器程序ID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h3 id="2-4-让图像动起来">2.4 让图像动起来</h3>
<p>实际上，在主函数的循环中，每一次循环都会刷新一次显示。但由于显示内容相同，故看起来是静态的。</p>
<p>对于上面的三角形，添加上些许偏移量，则会自由移动。</p>
<p>效果如下：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movingtriangle.gif" alt="移动的三角形"><figcaption>移动的三角形</figcaption></figure></p>
<details><summary>主函数代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化 GLFW</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开一个窗口并创建它的OpenGL上下文</span></span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">1024</span>, <span class="number">768</span>, <span class="string">&quot;triangle&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 确保我们可以捕捉到下面按下的转义键</span></span><br><span class="line">	<span class="built_in">glfwSetInputMode</span>(window, GLFW_STICKY_KEYS, GL_TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绿色背景</span></span><br><span class="line">	<span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化 GLEW</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glfwTerminate</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个顶点数组对象，并将它设为当前对象</span></span><br><span class="line">	GLuint VertexArrayID; <span class="comment">// 顶点数组标识</span></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(VertexArrayID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 三角形的三个顶点：(-1,-1,0),(1,-1,0),(0,1,0)</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> GLfloat g_vertex_buffer_data[] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建缓存区</span></span><br><span class="line">	GLuint vertexbuffer; <span class="comment">// 顶点缓冲区标识</span></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer); <span class="comment">// 生成1个缓冲区，将生成的标识符放入顶点缓冲</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW); <span class="comment">// 把这个三角形传给OpenGL</span></span><br><span class="line"></span><br><span class="line">	GLuint programID = <span class="built_in">createShadeProgram</span>(); <span class="comment">// 创建着色器</span></span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> x = <span class="number">0.0f</span>, inc = <span class="number">0.001f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glUseProgram</span>(programID);	<span class="comment">// 使用着色器</span></span><br><span class="line"></span><br><span class="line">		x += inc;	<span class="comment">// 移动</span></span><br><span class="line">		<span class="keyword">if</span> (x &gt; <span class="number">1.0f</span>) inc = <span class="number">-0.001f</span>;</span><br><span class="line">		<span class="keyword">if</span> (x &lt; <span class="number">-1.0f</span>) inc = <span class="number">0.001f</span>;</span><br><span class="line">		<span class="comment">// 获取指向 offset 变量的指针</span></span><br><span class="line">		GLuint offsetLoc = <span class="built_in">glGetUniformLocation</span>(programID, <span class="string">&quot;offset&quot;</span>);</span><br><span class="line">		<span class="comment">// 将 x 的值复制给 offset</span></span><br><span class="line">		<span class="built_in">glProgramUniform1f</span>(programID, offsetLoc, x);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 启用顶点数组</span></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vertexbuffer); <span class="comment">// 绑定缓冲区</span></span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);	<span class="comment">// 绘制三角形</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glDisableVertexAttribArray</span>(<span class="number">0</span>);	<span class="comment">// 禁用顶点数组</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);	<span class="comment">// 交换缓冲区，更新屏幕</span></span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();			<span class="comment">// 监听事件</span></span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) != GLFW_PRESS <span class="keyword">and</span> <span class="built_in">glfwWindowShouldClose</span>(window) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 后处理，删除资源</span></span><br><span class="line">	<span class="built_in">glDeleteBuffers</span>(<span class="number">1</span>, &amp;vertexbuffer);</span><br><span class="line">	<span class="built_in">glDeleteVertexArrays</span>(<span class="number">1</span>, &amp;VertexArrayID);</span><br><span class="line">	<span class="built_in">glDeleteProgram</span>(programID);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>而顶点着色器也需要根据偏移量作修改：</p>
<div class="highlight-container" data-rel="Glsl"><figure class="iseeu highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> <span class="keyword">offset</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> vertexPosition_modelspace;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">gl_Position</span> = <span class="type">vec4</span>(vertexPosition_modelspace.x + <span class="keyword">offset</span>, vertexPosition_modelspace.y, vertexPosition_modelspace.z, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>其中 <code>uniform</code> 表示统一变量。</p>
<h2 id="三-opengl数学基础">三、OpenGL数学基础</h2>
<h3 id="3-1-坐标系">3.1 坐标系</h3>
<p>3D 空间中常常使用三个坐标轴组成的坐标系，如左手坐标系和右手坐标系。</p>
<ul>
<li>
<p>左手坐标系：伸出左手，使得拇指、食指和中指两两垂直，则拇指指向为 x 方向，中指指向为 z 方向，食指指向为 y 方向。</p>
</li>
<li>
<p>右手坐标系：伸出右手，使得拇指、食指和中指两两垂直，则拇指指向为 x 方向，中指指向为 z 方向，食指指向为 y 方向。</p>
</li>
</ul>
<p><em>此学习记录使用右手坐标系</em></p>
<h3 id="3-2-点">3.2 点</h3>
<p>齐次坐标：具有四个值，分别是 x 坐标、y 坐标、z 坐标、w 坐标。其中 w 总是非零值。</p>
<p>OpenGL 中可用 <code>vec3</code> 或 <code>vec4</code> 类表示点数据。</p>
<h3 id="3-3-向量">3.3 向量</h3>
<p>向量表示大小和方向。它们没有特定位置。在 3D 图形学中，向量一般用空间中的单个点表示，向量的大小是原点到该点的距离，方向则是原点到该点的方向。</p>
<p>GLSL 和 GLM 所提供的 <code>vec3</code> 和 <code>vec4</code> 类型既能用来存储点，又能用来存储向量。</p>
<p>设有向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A=(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> 和 向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B=(u,v,w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>：</p>
<ul>
<li>
<p>向量的加法：对应位置相加</p>
</li>
<li>
<p>向量归一化：将长度变为1。GLM 库提供了函数 <code>glm::normalize(vec3)</code></p>
</li>
</ul>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>^</mo></mover><mo>=</mo><mfrac><mi>A</mi><mrow><mi mathvariant="normal">∣</mi><mi>A</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mo>=</mo><mfrac><mi>A</mi><msqrt><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\hat{A}=\frac A{\vert A\vert}=\frac A{\sqrt{x^2+y^2+z^2}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9467699999999999em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.11110999999999999em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathdefault">A</span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">A</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.49033em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.1521660000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9578340000000001em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.917834em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2821659999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathdefault">A</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>
<p>向量点积： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>⋅</mo><mi>B</mi><mo>=</mo><mi>x</mi><mi>u</mi><mo>+</mo><mi>y</mi><mi>v</mi><mo>+</mo><mi>z</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">A\cdot B = xu+yv+zw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>。GLM 库提供了函数 <code>glm::dot(vec3,vec3)</code></p>
</li>
<li>
<p>向量叉积： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>×</mo><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mi>y</mi><mi>w</mi><mo>−</mo><mi>v</mi><mi>z</mi><mo separator="true">,</mo><mi>u</mi><mi>z</mi><mo>−</mo><mi>x</mi><mi>w</mi><mo separator="true">,</mo><mi>x</mi><mi>v</mi><mo>−</mo><mi>u</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A\times B=(yw-vz, uz-xw, xv-uy)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>。GLM 库提供了函数 <code>glm::cross(vec3,vec3)</code></p>
</li>
</ul>
<h4 id="3-3-1-点积的应用">3.3.1 点积的应用</h4>
<ol>
<li>点积的基本应用是求两向量夹角。</li>
</ol>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><mfrac><mrow><mi>V</mi><mo>⋅</mo><mi>W</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>W</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\cos\theta=\frac{V\cdot W}{\vert V\vert\vert W\vert}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ol start="2">
<li>
<p>求向量的大小： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mi>V</mi><mo>⋅</mo><mi>V</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{V\cdot V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.11333499999999996em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9266650000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span><span style="top:-2.886665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11333499999999996em;"><span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>判断向量是否正交，若正交，则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>⋅</mo><mi>W</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">V\cdot W=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p>
</li>
<li>
<p>判断向量是否平行，若平行，则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>⋅</mo><mi>W</mi><mo>=</mo><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mi>W</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">V\cdot W=\vert V\vert\vert W\vert</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord">∣</span></span></span></span></p>
</li>
</ol>
<h4 id="3-3-2-叉积的应用">3.3.2 叉积的应用</h4>
<ul>
<li>
<p>两向量叉积的一个重要特性是，它会生成一个新的向量（法向量），新的向量正交（垂直）于之前两个向量所定义的平面。所得法向量的方向遵循右手定则，即将右手手指从 V 向 W 卷曲会使得大拇指指向法向量 R 的方向。</p>
</li>
<li>
<p>叉积的计算与向量顺序有关。</p>
</li>
</ul>
<h3 id="3-4-矩阵">3.4 矩阵</h3>
<p>矩阵式矩形的值的阵列，跟很多领域上的矩阵概念相似。</p>
<p>GLSL中的 <code>mat4</code> 数据类型便是用来存储 4 x 4 矩阵。同样 GLM 中的 <code>mat4</code> 类也是用来实例化并表示 4 x 4 矩阵。</p>
<p>比如单位矩阵是对角线值全为1，其余值都为0的矩阵。在 GLM 中，调用构造函数 <code>glm::mat4 m(1.0f)</code> 可以在变量 m 中生成单位矩阵。</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(单位矩阵)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\tag{单位矩阵}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">单</span><span class="mord cjk_fallback">位</span><span class="mord cjk_fallback">矩</span><span class="mord cjk_fallback">阵</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>矩阵转置：矩阵的列与行交换。GLM 库和 GLSL 库都有转置函数，分别是 <code>glm::transpose(mat4)</code> 和 <code>transpose(mat4)</code>。</p>
<p>矩阵加法：两个矩阵对应值相加。在GLSL中，<code>+</code> 作了重载，支持矩阵加法。</p>
<p>矩阵乘法：与线性代数中的矩阵乘法一致。</p>
<ul>
<li>在 3D 图形学中，点与矩阵相乘通常将点视作列向量，并从右向左计算，得到点。</li>
<li>矩阵相乘也叫作合并。
<ul>
<li>矩阵乘法结合律</li>
</ul>
</li>
</ul>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>e</mi><mi>w</mi><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mo>=</mo><msub><mi>M</mi><mn>1</mn></msub><mo>×</mo><mo stretchy="false">[</mo><msub><mi>M</mi><mn>2</mn></msub><mo>×</mo><mo stretchy="false">(</mo><msub><mi>M</mi><mn>3</mn></msub><mo>×</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>M</mi><mn>1</mn></msub><mo>×</mo><msub><mi>M</mi><mn>2</mn></msub><mo>×</mo><msub><mi>M</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo>×</mo><mi>P</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">NewPoint = M_1\times[M_2\times(M_3\times Point)]=(M_1\times M_2\times M_3)\times Point
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span></span></span></span></span></p>
<ul>
<li>GLSL 和 GLM 都支持 vec4 与矩阵相乘，并使用 <code>*</code> 操作符表示。</li>
</ul>
<p>逆矩阵： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>M</mi><mo>=</mo><mtext>单位矩阵</mtext></mrow><annotation encoding="application/x-tex">MM^{-1}=M^{-1}M=单位矩阵</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">单</span><span class="mord cjk_fallback">位</span><span class="mord cjk_fallback">矩</span><span class="mord cjk_fallback">阵</span></span></span></span>，GLSL 和 GLM 都提供了 <code>mat4.inverse()</code> 函数。</p>
<h3 id="3-5-变换矩阵">3.5 变换矩阵</h3>
<p>变换矩阵基于 4x4 矩阵，使用齐次坐标系，包括平移矩阵、缩放矩阵、旋转矩阵、投影矩阵和 LookAt 矩阵。</p>
<h4 id="3-5-1-平移矩阵">3.5.1 平移矩阵</h4>
<p>平移矩阵 A 用于将物体从一个位置移至另一位置。</p>
<p>在单位矩阵的基础上，将 x、y、z 的移动量记录在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>03</mn></msub></mrow><annotation encoding="application/x-tex">A_{03}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>13</mn></msub></mrow><annotation encoding="application/x-tex">A_{13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>23</mn></msub></mrow><annotation encoding="application/x-tex">A_{23}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 位置。</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>+</mo><msub><mi>T</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mo>+</mo><msub><mi>T</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>z</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(
\begin{matrix}
X+T_x\\
Y+T_y\\
Z+T_z\\
1
\end{matrix}
\right)
=
\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; T_x\\
0 &amp; 1 &amp; 0 &amp; T_y\\
0 &amp; 0 &amp; 1 &amp; T_z\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\left(
\begin{matrix}
X\\
Y\\
Z\\
1
\end{matrix}
\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>结果就是点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><mo separator="true">,</mo><mi>Z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X,Y,Z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span></span></span></span> 平移到位置 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>+</mo><msub><mi>T</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>Y</mi><mo>+</mo><msub><mi>T</mi><mi>y</mi></msub><mo separator="true">,</mo><mi>Z</mi><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X+T_x,Y+T_y,Z+T_z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>平移矩阵的构建可以使用 GLM 中 <code>glm::translate(x,y,z)</code> 函数。接着矩阵与点相乘。</p>
<h4 id="3-5-2-缩放矩阵">3.5.2 缩放矩阵</h4>
<p>缩放矩阵用于改变物体的大小或者将点沿朝向或远离原点的方向移动。</p>
<p>缩放矩阵 A 在单位矩阵的基础上，将位于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>00</mn></msub></mrow><annotation encoding="application/x-tex">A_{00}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>11</mn></msub></mrow><annotation encoding="application/x-tex">A_{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mn>22</mn></msub></mrow><annotation encoding="application/x-tex">A_{22}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的值替换为 x、y、z 缩放因子。</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mtext> </mtext><msub><mi>S</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mtext> </mtext><msub><mi>S</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mtext> </mtext><msub><mi>S</mi><mi>z</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>S</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(
\begin{matrix}
X\ S_x\\
Y\ S_y\\
Z\ S_z\\
1
\end{matrix}
\right)
=
\left[
\begin{matrix}
S_x &amp; 0 &amp; 0 &amp; 0\\
0 &amp; S_y &amp; 0 &amp; 0\\
0 &amp; 0 &amp; S_z &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
\left(
\begin{matrix}
X\\
Y\\
Z\\
1
\end{matrix}
\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>GLM 的 <code>glm::scale(x,y,z)</code> 函数用于构建依照 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> 缩放的矩阵，接着矩阵与点相乘。</p>
<p>缩放还可以用来切换坐标系，比如在右手坐标系下确定左手坐标系的坐标，只需把 z 坐标反转即可。切换坐标系的缩放矩阵：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[
\begin{matrix}
1 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; -1&amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\right]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<h4 id="3-5-3-旋转矩阵">3.5.3 旋转矩阵</h4>
<p>3D 空间中旋转物体需要指定旋转轴和旋转角（以度或弧度为单位）。</p>
<p>数学上可证明：围绕任何轴的旋转都可以表示为绕 x 轴、y<br>
轴、z 轴旋转的组合。围绕这 3 个轴的旋转角度被称为欧拉角。</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(绕x轴旋转)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X \\ Y&#x27;\\ Z&#x27;\\ 1\end{matrix}\right)=\left[\begin{matrix}1 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \cos\theta &amp; -\sin\theta &amp; 0\\ 0 &amp; \sin\theta &amp; \cos\theta &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{绕x轴旋转}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">绕</span><span class="mord">x</span><span class="mord cjk_fallback">轴</span><span class="mord cjk_fallback">旋</span><span class="mord cjk_fallback">转</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(绕y轴旋转)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X&#x27; \\ Y\\ Z&#x27;\\ 1\end{matrix}\right)=\left[\begin{matrix}\cos\theta &amp; 0 &amp; \sin\theta &amp; 0\\ 0 &amp; 1 &amp; 0 &amp; 0\\ -\sin\theta &amp; 0 &amp; \cos\theta &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{绕y轴旋转}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">绕</span><span class="mord">y</span><span class="mord cjk_fallback">轴</span><span class="mord cjk_fallback">旋</span><span class="mord cjk_fallback">转</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>X</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>Y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(绕z轴旋转)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left(\begin{matrix}X&#x27; \\ Y&#x27;\\ Z\\ 1\end{matrix}\right)=\left[\begin{matrix}\cos\theta &amp; -\sin\theta &amp; 0 &amp; 0\\ \sin\theta &amp; \cos\theta &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 1 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\left(\begin{matrix}X\\ Y\\ Z\\ 1\end{matrix}\right)\tag{绕z轴旋转}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">绕</span><span class="mord">z</span><span class="mord cjk_fallback">轴</span><span class="mord cjk_fallback">旋</span><span class="mord cjk_fallback">转</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>旋转变换有 3 种，分别是绕 x 轴、y 轴、z 轴旋转。GLM 提供了函数 <code>glm::rotate(mat4,θ,x,y,z)</code> 构建绕 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> 旋转 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span> 度的矩阵，接着矩阵与点相乘。</p>
<p>通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>−</mtext><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos(−θ) = \cos(θ)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>−</mtext><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>−</mtext><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sin(−θ) = −\sin(θ)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span> 即可验证反向旋转的矩阵恰等于其转置矩阵。</p>
<p>当在 3D 空间中旋转轴不穿过原点时，物体使用欧拉角进行旋转需要几个额外的步骤。一般有：</p>
<ol>
<li>平移旋转轴以使它经过原点；</li>
<li>绕 x 轴、y 轴、z 轴旋转适当的欧拉角；</li>
<li>复原步骤 1 中的平移。</li>
</ol>
<h3 id="3-6-视觉空间和合成相机">3.6 视觉空间和合成相机</h3>
<p>3D 空间中，需要找到一点并确立观察方向，这个点叫作视图或视觉空间或合成相机。</p>
<p>观察 3D 世界需要以下步骤</p>
<ol>
<li>确定相机的位置；</li>
<li>调整相机的角度，通常需要一套它自己的直角坐标轴u、v、n；</li>
<li>定义一个视体。视体是从相机的位置出发，沿着相机的视线朝向的可视范围。</li>
<li>将视体内的对象投影到投影平面上。</li>
</ol>
<p>OpenGL 具有一个固定在原点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0,0,0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> 且朝向 z 轴负方向的相机。所以当使用这个相机时，由于相机自身不能移动，所以需要将对象移动到适合的位置并调整合适的方向。</p>
<p>假设有世界空间（类似于全局的空间）中某点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>W</mi></msub></mrow><annotation encoding="application/x-tex">P_W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，需要对该点进行变换转换成相机空间中适合的点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">P_C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。构建一个单一变换矩阵以完成旋转和平移，这个矩阵叫作视图变换矩阵，记作 V（V合并了平移矩阵和旋转矩阵）。</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub><mo>=</mo><mi>V</mi><mo>×</mo><msub><mi>P</mi><mi>W</mi></msub></mrow><annotation encoding="application/x-tex">P_C=V\times P_W
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>将 V 矩阵与模型矩阵 M 的积定义为 <strong>模型-视图(Model-View, MV)</strong> 矩阵，记作MV，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>V</mi><mo>=</mo><mi>V</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">MV=VM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>。</p>
<ul>
<li><em>模型矩阵 M 是世界空间中对象定位及定向的矩阵</em></li>
</ul>
<p>之后，对于某点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>M</mi></msub></mrow><annotation encoding="application/x-tex">P_M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 就可以从自己的模型空间直接转换到相机空间：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>C</mi></msub><mo>=</mo><mi>M</mi><mi>V</mi><msub><mi>P</mi><mi>M</mi></msub></mrow><annotation encoding="application/x-tex">P_C=MVP_M
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h3 id="3-7-投影矩阵">3.7 投影矩阵</h3>
<p>透视投影矩阵和正射投影矩阵</p>
<h4 id="3-7-1-透视投影矩阵">3.7.1 透视投影矩阵</h4>
<p>透视投影通过使用透视概念模仿我们看真实世界的方<br>
式，尝试让 2D 图像看起来像是 3D 的。</p>
<p>使用叫作 <strong>透视矩阵</strong> 或者 <strong>透视变换</strong> 的变换矩阵将平行线变为恰当的不平行线来实现这个效果。定义 4 个参数来构建视体：</p>
<ul>
<li>纵横比：远近剪裁平面的宽度与高度之比；</li>
<li>视场：可视空间的纵向角度；</li>
<li>近剪裁平面（也称投影平面）</li>
<li>远剪裁平面。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_View.jpg" alt="透视视体或视锥，图源计算机图形学编程（第2版）"><figcaption>透视视体或视锥，图源计算机图形学编程（第2版）</figcaption></figure></p>
<p>透视矩阵：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>A</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>q</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>B</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>C</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(透视矩阵)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
A &amp; 0 &amp; 0 &amp; 0\\
0 &amp; q &amp; 0 &amp; 0\\
0 &amp; 0 &amp; B &amp; C\\
0 &amp; 0 &amp;-1 &amp; 0
\end{matrix}
\right]
\tag{透视矩阵}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">A</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">透</span><span class="mord cjk_fallback">视</span><span class="mord cjk_fallback">矩</span><span class="mord cjk_fallback">阵</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>其中：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>tan</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mfrac><mtext>视场</mtext><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">q = \frac{1}{\tan{(\frac{视场}{2})}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.428771em;vertical-align:-1.1073309999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2376690000000004em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">tan</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">视</span><span class="mord cjk_fallback mtight">场</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1073309999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mfrac><mi>q</mi><mtext>纵横比</mtext></mfrac></mrow><annotation encoding="application/x-tex">A = \frac{q}{纵横比}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.7935599999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">纵</span><span class="mord cjk_fallback">横</span><span class="mord cjk_fallback">比</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mfrac><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub><mo>−</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">B = \frac{Z_{near}+Z_{far}}{Z_{nead}-Z_{far}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.332438em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mfrac><mrow><mn>2</mn><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>Z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>Z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac><mrow></mrow></mrow><annotation encoding="application/x-tex">C = \frac{2Z_{near}Z_{far}}{Z_{near}-Z_{far}}{}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.332438em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"></span></span></span></span></span></p>
<p>GLM 库提供了构建透视矩阵函数 <code>glm::perspective()</code>。</p>
<h4 id="3-7-2-正射投影矩阵">3.7.2 正射投影矩阵</h4>
<p>在正射投影中，平行线仍然是平行的。</p>
<p>构建正射矩阵需要以下参数：</p>
<ol>
<li>从相机到投影平面的距离 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{near}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>从相机到远剪裁平面的距离 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{far}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>投影平面左边界 x 坐标 L， 投影平面右边界 x 坐标 R，投影平面上边界 y 坐标 T， 投影平面下边界 y 坐标 B</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zhengshe.jpg" alt="正射投影，图源计算机图形学编程（第2版）"><figcaption>正射投影，图源计算机图形学编程（第2版）</figcaption></figure></p>
<p>正射矩阵：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>2</mn><mrow><mi>R</mi><mo>−</mo><mi>L</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mrow><mi>R</mi><mo>+</mo><mi>L</mi></mrow><mrow><mi>R</mi><mo>−</mo><mi>L</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>2</mn><mrow><mi>T</mi><mo>−</mo><mi>B</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mrow><mi>T</mi><mo>+</mo><mi>B</mi></mrow><mrow><mi>T</mi><mo>−</mo><mi>B</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mo>−</mo><mn>2</mn></mrow><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>+</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><mrow><msub><mi>z</mi><mrow><mi>f</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>−</mo><msub><mi>z</mi><mrow><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(正射矩阵)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
\frac{2}{R-L} &amp; 0 &amp; 0 &amp; -\frac{R+L}{R-L}\\
0 &amp; \frac{2}{T-B} &amp; 0 &amp; -\frac{T+B}{T-B}\\
0 &amp; 0 &amp; \frac{-2}{z_{far}-z_{near}} &amp; -\frac{z_{far}+z_{near}}{z_{far}-z_{near}}\\
0 &amp; 0 &amp;0 &amp; 1
\end{matrix}
\right]
\tag{正射矩阵}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.220815em;vertical-align:-2.3604075em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">L</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5480799999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8604075em;"><span style="top:-4.9880765em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">L</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.7124145em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.3876725em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.921411em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.51308em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5480799999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.9995925000000001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3604075em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:5.220815em;vertical-align:-2.3604075em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord cjk_fallback">正</span><span class="mord cjk_fallback">射</span><span class="mord cjk_fallback">矩</span><span class="mord cjk_fallback">阵</span></span><span class="mord">)</span></span></span></span></span></span></p>
<h3 id="3-8-lookat矩阵">3.8 LookAt矩阵</h3>
<p>当把相机放在某处并看向一个特定的位置时，就需要用到 LookAt 矩阵。LookAt 变换依然由相机旋转决定。</p>
<p>通过指定大致旋转朝向的向量（如世界空间 y 轴）。可以通过一系列叉积获得一组向量，代表相机的正面（向量 fwd）、侧面（向量 side），以及上面（向量 up）。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_lookat.jpg" alt="LookAt元素，图源计算机图形学编程（第2版）"><figcaption>LookAt元素，图源计算机图形学编程（第2版）</figcaption></figure></p>
<p>由相机位置（点eye）、目标位置（点target）、初始向上向量 Y 构建 LookAt 矩阵：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>d</mi><msub><mi>e</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>d</mi><msub><mi>e</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>z</mi><msub><mi>e</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>⋅</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>u</mi><msub><mi>p</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>u</mi><mi>p</mi><mo>⋅</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>x</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>y</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>f</mi><mi>w</mi><msub><mi>d</mi><mi>z</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mo>−</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo>⋅</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(LookAt矩阵)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\left[
\begin{matrix}
side_x &amp; side_y &amp; size_z &amp; -(side\cdot eye)\\
up_x &amp; up_y &amp; up_z &amp; -(up\cdot eye)\\
-fwd_x &amp; -fwd_y &amp; -fwd_z &amp; -(-fwd\cdot eye)\\
0 &amp; 0 &amp;0 &amp; 1
\end{matrix}
\right]
\tag{LookAt矩阵}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mclose">)</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">L</span><span class="mord">o</span><span class="mord">o</span><span class="mord">k</span><span class="mord">A</span><span class="mord">t</span><span class="mord cjk_fallback">矩</span><span class="mord cjk_fallback">阵</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>其中：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>w</mi><mi>d</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mi>e</mi><mi>y</mi><mi>e</mi><mo>−</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fwd = normalize(eye-target)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mo>−</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo>×</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">side = normalize(-fwd \times Y)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span></span></p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mo>=</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mi>s</mi><mi>i</mi><mi>d</mi><mi>e</mi><mo>×</mo><mo stretchy="false">(</mo><mo>−</mo><mi>f</mi><mi>w</mi><mi>d</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">up = normalize(side \times (-fwd))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">d</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<h2 id="opengl管理3d图形数据">OpenGL管理3D图形数据</h2>
<p>使用 OpenGL 渲染一个 3D 图形 需要将若干数据发送给 OpenGL 着色器管线。</p>
<p>比如一个立方体，需要发送：</p>
<ul>
<li>立方体模型的顶点；</li>
<li>控制立方体在3D空间中朝向的变换矩阵。</li>
</ul>
<p>然而，发送数据到 OpenGL 管线的方式有：</p>
<ul>
<li>通过顶点属性的 <strong>缓冲区</strong>；</li>
<li>直接发送给 <strong>统一变量</strong>。</li>
</ul>
<h3 id="缓冲区和顶点属性">缓冲区和顶点属性</h3>
<p>绘制对象时，它的顶点数据需要发送给顶点着色器。通常：</p>
<ol>
<li>顶点数据被发送到一个缓冲区中；</li>
<li>把缓冲区和着色器中声明的顶点属性相关联。</li>
</ol>
<p>完成这件事，有一系列的步骤，有的步骤只需要做一次，有的步骤每帧都需做一次：</p>
<ul>
<li>只做一次的步骤：
<ol>
<li>创建缓冲区</li>
<li>将顶点数据复制到缓冲区</li>
</ol>
</li>
<li>每帧刷新需要的步骤：
<ol>
<li>启用包含顶点数据的缓冲区</li>
<li>将缓冲区和一个顶点属性相关联</li>
<li>启用这个顶点属性</li>
<li>使用 <code>glDrawArrays()</code> 绘制对象</li>
</ol>
</li>
</ul>
<p>在 OpenGL 中，缓冲区被包含在顶点缓冲对象（Vertex Buffer Object，VBO）中，VBO 在 C++/OpenGL 应用程序中被声明和实例化。一个场景可能需要很多 VBO，所以常常会在一个地方中生成并填充若干个 VBO，以备程序需要时直接使用。</p>
<p>缓冲区使用特定的方式和顶点属性交互。当 <code>glDrawArrays()</code> 执行时，缓冲区中的数据开始流动，从缓冲区的开头开始，按顺序流过顶点着色器，顶点着色器对每个顶点执行一次。</p>
<p>OpenGL 中还有一种相关的结构，叫作顶点数组对象（Vertex Array Object，VAO）。OpenGL的 3.0 版本引入了 VAO，作为一种组织缓冲区的方法，让缓冲区在复杂场景中更容易操控。OpenGL 要求至少创建一个 VAO。</p>
<p>举个例子，假设想显示两个对象，那么声明一个 VAO 和两个相关的 VBO：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GLuint vao[<span class="number">1</span>];</span><br><span class="line">GLuint vbo[<span class="number">2</span>];</span><br><span class="line"><span class="comment">// ……</span></span><br><span class="line"><span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, vao);</span><br><span class="line"><span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">2</span>, vbo);</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>glGenVertexArrays()</code>：生成一个 VAO，返回 VAO 的整型 ID 并将存到vao
<ul>
<li>第一参数表示创建 ID 个数</li>
<li>第二参数表示保存返回 ID 的数组</li>
</ul>
</li>
<li><code>glBindVertexArray()</code>：将 vao[0] 设为当前对象，这样生成的缓冲区就会和这个 VAO 相关联</li>
<li><code>glGenBuffers()</code>：生成两个 VBO，返回 VBO 的整型 ID 并将它们存到vbo
<ul>
<li>第一参数表示创建 ID 个数</li>
<li>第二参数表示保存返回 ID 的数组</li>
</ul>
</li>
</ul>
<p>缓冲区大概完成之后，顶点着色器需要有相应地顶点属性变量。如：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">layout</span> (location = <span class="number">0</span>) in vec3 position;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>layout (location = 0)</code>：layout修饰符，顶点属性和特定缓冲区关联的方法，这里表示顶点属性的识别号是0</li>
<li><code>in</code>：表示顶点属性将会从缓冲区中接收数值</li>
<li><code>vec3</code>：表示顶点属性的类型是三维向量</li>
<li><code>position</code>：顶点属性的名字</li>
</ul>
<p>继续假设绘制一个立方体，假定立方体的顶点数据在代码中用数组直接指定，还需要进行以下步骤：</p>
<ol>
<li>将顶点数据值复制到之前生成的两个缓冲区之一。使用 OpenGL 的函数 <code>glBindBuffer()</code> 将缓冲区标为活跃（使用）</li>
<li>使用 <code>glBufferData()</code> 函数将包含顶点数据的数组复制进活跃缓冲区</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure></div>
<p>上述是初始化时执行一次的步骤，接下来对于每一帧刷新，需要进行：</p>
<ol>
<li>使用 <code>glBindBuffer()</code> 函数标记缓冲区为活跃</li>
<li>将活跃缓冲区与着色器中的顶点属性相关联</li>
<li>启用顶点属性</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标记第0个缓冲区为活跃</span></span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// 将第0个属性关联到缓冲区</span></span><br><span class="line"><span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 启用第0个顶点属性</span></span><br><span class="line"><span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>
<h3 id="统一变量">统一变量</h3>
<p>使用关键字 <code>uniform</code> 在着色器中声明统一变量。</p>
<p>将数据从 C++/OpenGL 应用程序发送到统一变量需要以下步骤：</p>
<ol>
<li>获取统一变量的引用</li>
<li>将指向所需数值的指针与获取的统一变量引用相关联</li>
</ol>
<p>比如在上面绘制立方体的例子，假设链接的渲染程序保存在名为 <code>rendering</code> 的变量中，则以下代码会把 MV 和投影矩阵发送到两个统一变量中：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取着色器程序中的统一变量位置</span></span><br><span class="line">mvLoc = <span class="built_in">glGetUniformLocation</span>(rendering, <span class="string">&quot;mv_m&quot;</span>);</span><br><span class="line">projLoc = <span class="built_in">glGetUniformLocation</span>(rendering, <span class="string">&quot;proj_m&quot;</span>);</span><br><span class="line"><span class="comment">// 将矩阵数据发送到统一变量中</span></span><br><span class="line"><span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mv));</span><br><span class="line"><span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(proj));</span><br><span class="line"><span class="comment">// mv 是模型视图矩阵，proj 是投影矩阵</span></span><br></pre></td></tr></table></figure></div>
<p><em><code>value_ptr()</code> 返回对矩阵数据的引用， <code>glUniformMatrix4fv()</code> 将矩阵数据传递给统一变量</em></p>
<h3 id="顶点属性插值">顶点属性插值</h3>
<p>在片段着色器栅格化之前，由顶点定义的图元被转换为片段。</p>
<ul>
<li>栅格化：将 3D 空间信息表达在 2D 屏幕的栅格（像素阵列）中。</li>
<li>栅格化过程会线性插值顶点属性值，以便显示的像素能无缝连接建模后的曲面。</li>
<li>比如栅格化一个三角形时，将三角形顶点传入，首先沿着连接顶点的线开始插值，其精度级别和像素显示密度相关。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_rasterized.png" alt="三角形栅格化"><figcaption>三角形栅格化</figcaption></figure></p>
<p>而统一变量在每次顶点着色器调用时保持不变，本身不是插值的，无论顶点数量有多少，变量都包含相同的值。</p>
<p>顶点着色器中，顶点属性被声明为 <code>in</code>，表示从缓冲区接收，也可以被声明为 <code>out</code>，表示值发送到管线的下一阶段。</p>
<p>OpenGL 内置一个 <code>vec4</code> 变量 <code>gl_Position</code>，在顶点着色器中，将矩阵变换后的顶点赋值给它：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gl_Position = proj_matrix * mv_matrix * position;</span><br></pre></td></tr></table></figure></div>
<h3 id="mv-矩阵和透视矩阵">MV 矩阵和透视矩阵</h3>
<p>渲染 3D 对象的一个基础步骤是创建适当的变换矩阵并将它们发送到统一变量。</p>
<ul>
<li>模型矩阵：在世界空间中表示对象的位置和朝向。</li>
<li>视图矩阵：移动并旋转世界中的模型，以模拟相机看到的效果。</li>
<li>透视矩阵：根据所需的视锥提供 3D 效果。</li>
</ul>
<p>假设模型是变动的，相机是可移动的，那么：</p>
<ul>
<li>需要每帧为每个模型创建模型矩阵；</li>
<li>需要每帧创建视图矩阵，对于这一帧所渲染的所有对象都是一致的；</li>
<li>需要创建一次透视矩阵，确定视锥。</li>
</ul>
<h3 id="构建一个-3d-立方体">构建一个 3D 立方体</h3>
<p>由于 OpenGL 代码繁多，需要处理多文件，给出文件结构：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OpenGL项目</span><br><span class="line">├─ main.cpp        // 主程序</span><br><span class="line">├─ fragment.glsl   // 片段着色器</span><br><span class="line">├─ vertex.glsl     // 顶点着色器</span><br><span class="line">├─ Util.h          // 常用函数的声明</span><br><span class="line">└─ Util.cpp        // 常用函数的实现</span><br></pre></td></tr></table></figure></div>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_greenCube.jpg" alt="绿色的立方体"><figcaption>绿色的立方体</figcaption></figure></p>
<details><summary>源代码main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">1</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">double</span> cubeLocX, cubeLocY, cubeLocZ;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// 生成的缓冲区和 VAO 相关联</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]); <span class="comment">// 将缓冲区标为活跃（使用）</span></span><br><span class="line">	<span class="comment">// 将包含顶点数据的数组复制进活跃缓冲区</span></span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">8.0f</span>;</span><br><span class="line">	cubeLocX = <span class="number">0.0f</span>, cubeLocY = <span class="number">-2.0f</span>, cubeLocZ = <span class="number">0.0f</span>;	<span class="comment">// 沿 y 轴下移展示透视</span></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 MV 矩阵 和投影矩阵的统一变量</span></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建透视矩阵</span></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">	<span class="comment">// 参数为：视角，宽高比，近裁剪面，远裁剪面</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建视图矩阵、模型矩阵和 MV 矩阵</span></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(cubeLocX, cubeLocY, cubeLocZ));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将矩阵复制给相应的统一变量</span></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 VBO 关联给顶点着色器中相应的顶点属性</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调整 OpenGL 设置，绘制模型</span></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>解释 <code>main.cpp</code>：</p>
<ul>
<li>函数 <code>makeVertexArray()</code>
<ul>
<li>创建顶点数组，使用三角形绘制立方体，每个面需要两个三角形，共需要12个三角形，有36个顶点，合36×3=108个坐标（值）。</li>
<li>立方体定义在自己的坐标系上，中心为(0,0,0)。</li>
<li>建立一个 VAO 和 VBO，并把立方体顶点加载到VBO中。</li>
</ul>
</li>
<li>函数 <code>init()</code>
<ul>
<li>读取着色器代码并构建渲染程序。</li>
<li>将立方体通过函数 <code>makeVertexArray()</code> 加载到 VBO 中。</li>
<li>定义立方体和相机在世界中的位置：(0,0,8)和(0,-2,0)。</li>
</ul>
</li>
<li>函数 <code>display()</code>
<ul>
<li>不断重绘帧。</li>
<li>调用 <code>glClear(GL_DEPTH_BUFFER_BIT)</code> 清除深度缓冲区。</li>
<li>调用 <code>glUseProgram()</code> 启用着色器，在 GPU 上加载 GLSL 代码，但不会运行着色器程序。</li>
<li>获取统一变量位置，构建透视、视图矩阵和模型矩阵，并合成 MV 矩阵。
<ul>
<li>使用 <code>glm::translate(glm::mat4(1.0f), glm::vec3(-cameraX, -cameraY, -cameraZ));</code> 构建视图矩阵。为了模拟以某种方式移动的相机的表现，需要向相反的方向移动物体本身。</li>
<li>使用 <code>glm::translate(glm::mat4(1.0f), glm::vec3(cubeLocX, cubeLocY, cubeLocZ));</code> 构建模型矩阵。</li>
</ul>
</li>
<li>将透视矩阵和 MV 矩阵赋给相应的统一变量。</li>
<li>启用立方体顶点数据的缓冲区，并将其附加到第0个顶点属性。</li>
<li>调用 <code>glDrawArrays()</code> 绘制模型。</li>
</ul>
</li>
</ul>
</details>
<details><summary>Util.h</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>Util.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 从文件中读取 GLSL 代码</span></span><br><span class="line"><span class="comment">* @param path 文件路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">	std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">		content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fileStream.<span class="built_in">close</span>();</span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 代码编译失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param shader 着色器标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 链接失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param program 着色器程序标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 检查 OpenGL 错误标志，即是否发生 OpenGL 错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	<span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		err = <span class="literal">true</span>;</span><br><span class="line">		glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 创建着色器程序</span></span><br><span class="line"><span class="comment">* @param vpath 顶点着色器路径</span></span><br><span class="line"><span class="comment">* @param fpath 片段着色器路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 记录错误信息</span></span><br><span class="line">	GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 顶点着色器</span></span><br><span class="line">	std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">	<span class="comment">// 片段着色器</span></span><br><span class="line">	std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 分别存入 vShader 和 fShader 变量</span></span><br><span class="line">	GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">	GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 GLSL 代码从字符串载入空着色器对象中</span></span><br><span class="line">	<span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 编译顶点着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">	<span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 编译片段着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">	<span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">	<span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">	<span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> vProgram; <span class="comment">// 返回着色器程序ID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>vertex.glsl 和 fragment.glsl</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = <span class="built_in">vec4</span>(<span class="number">0</span>, <span class="number">0.6</span>, <span class="number">0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>关于着色器方面</p>
<ul>
<li>着色器中传入的顶点属性的 <code>position</code> 变量上存在。<code>layout</code> 修饰符，位置指定为“0”，因此 <code>display()</code> 函数可以简单地通过在 <code>glVertexAttribPointer()</code> 函数调用中（第一个参数）和在 <code>glEnableVertexAttribArray()</code> 函数调用中使用 0 来引用此变量。</li>
<li><code>position</code> 顶点属性被声明为 <code>vec3</code> 类型，需要将其转换为 <code>vec4</code> 类型，由 <code>vec4(position,1.0)</code> 完成。</li>
<li>顶点着色器中的乘法将矩阵变换应用于顶点，将其转换为相机空间，接着被放入内置的 OpenGL 输出变量 <code>gl_Position</code> 中，然后继续通过管线，并由光栅着色器进行插值。</li>
<li>插值后的像素位置（称为片段）被发送到片段着色器。
<ul>
<li>片段着色器中也有两个统一变量，但在该着色器中尚未使用。</li>
</ul>
</li>
</ul>
</details>
<details><summary>通过修改着色器，实现彩色立方体</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">	changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube.jpg" alt="彩色立方体"><figcaption>彩色立方体</figcaption></figure></p>
<p>同样地，也可以让立方体动起来，只需要在刷新的每一帧加上平移变换和旋转变换：</p>
<details><summary>展开代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ……</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 MV 矩阵 和投影矩阵的统一变量</span></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建透视矩阵</span></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">	<span class="comment">// 参数为：视角，宽高比，近裁剪面，远裁剪面</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 一系列旋转变换矩阵</span></span><br><span class="line">	glm::mat tMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="number">0.35f</span> * currentTime) * <span class="number">2.0f</span>, <span class="built_in">cos</span>(<span class="number">0.52f</span> * currentTime) * <span class="number">2.0f</span>, <span class="built_in">sin</span>(<span class="number">0.7f</span> * currentTime) * <span class="number">2.0f</span>));</span><br><span class="line">	glm::mat rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建视图矩阵、模型矩阵和 MV 矩阵</span></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	<span class="comment">//mMat = glm::translate(glm::mat4(1.0f), glm::vec3(cubeLocX, cubeLocY, cubeLocZ));</span></span><br><span class="line">	mMat = rMat * tMat;</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将矩阵复制给相应的统一变量</span></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 VBO 关联给顶点着色器中相应的顶点属性</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调整 OpenGL 设置，绘制模型</span></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ……</span></span><br></pre></td></tr></table></figure></div>
</details>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_coloredCube1.gif" alt="旋转的立方体"><figcaption>旋转的立方体</figcaption></figure></p>
<h3 id="渲染一个对象的多个副本">渲染一个对象的多个副本</h3>
<p>上面实现了一个翻滚的立方体，接着可以考虑实现多个翻滚的立方体。</p>
<p>可以将 <code>display()</code> 函数中用于构建 MV 矩阵并绘制立方体的代码移动到一个执行 24 次的循环中来完成此操作。</p>
<details><summary>展开代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">32.0f</span>;</span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 MV 矩阵 和投影矩阵的统一变量</span></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 视图矩阵</span></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建透视矩阵</span></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="comment">// 参数为：视角，宽高比，近裁剪面，远裁剪面</span></span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> tf;</span><br><span class="line">	glm::mat4 tMat, rMat;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i ++)</span><br><span class="line">	&#123;</span><br><span class="line">		tf = currentTime + i;</span><br><span class="line">		tMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="number">0.35f</span> * tf) * <span class="number">8.0f</span>, <span class="built_in">cos</span>(<span class="number">0.52f</span> * tf) * <span class="number">8.0f</span>, <span class="built_in">sin</span>(<span class="number">0.7f</span> * tf) * <span class="number">8.0f</span>));</span><br><span class="line">		rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		rMat = glm::<span class="built_in">rotate</span>(rMat, <span class="number">1.75f</span> * tf, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">		<span class="comment">// 构建模型矩阵和 MV 矩阵</span></span><br><span class="line">		mMat = rMat * tMat;</span><br><span class="line">		mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将矩阵复制给相应的统一变量</span></span><br><span class="line">		<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将 VBO 关联给顶点着色器中相应的顶点属性</span></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 调整 OpenGL 设置，绘制模型</span></span><br><span class="line">		<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">		<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">		<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_mcoloredCube.gif" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<p>OpenGL 的实例化提供了一种机制，可以只用一个调用就渲染一个对象的多个副本。</p>
<ul>
<li>带来显著的性能优势</li>
</ul>
<p>把原来调用的 <code>glDrawArrays()</code> 改为 <code>glDrawArraysInstanced()</code>。</p>
<p>同时实例化时，顶点着色器可以访问内置变量 <code>gl_InstanceID</code> 来获取当前正在处理对象的实例序号。</p>
<p>实例化的程序：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">1</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">float</span> aspect, timeFactor;</span><br><span class="line"></span><br><span class="line">GLuint mLoc, vLoc, projLoc, tfLoc;</span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line">glm::mat4 pMat, vMat, mMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// 生成的缓冲区和 VAO 相关联</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]); <span class="comment">// 将缓冲区标为活跃（使用）</span></span><br><span class="line">	<span class="comment">// 将包含顶点数据的数组复制进活跃缓冲区</span></span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">32.0f</span>;</span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取视图矩阵和投影矩阵的统一变量</span></span><br><span class="line">	vLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;v_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(vLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(vMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取时间因子的统一变量</span></span><br><span class="line">	timeFactor = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime);</span><br><span class="line">	tfLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;tf&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniform1f</span>(tfLoc, timeFactor);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 VBO 关联给顶点着色器中相应的顶点属性</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">// 实例化</span></span><br><span class="line">	<span class="built_in">glDrawArraysInstanced</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>, <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>从之前的循环多个模型矩阵展示 改为了 在顶点着色器中构建模型矩阵。</p>
<ul>
<li>将时间因子通过统一变量传递给顶点着色器，还需要将视图矩阵传递到单独的统一变量中</li>
<li>旋转计算被移动到了顶点着色器中</li>
</ul>
</details>
<details><summary>顶点着色器和片段着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 v_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform <span class="type">float</span> tf;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateX</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mat4 xrot = <span class="built_in">mat4</span>(</span><br><span class="line">		<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="built_in">cos</span>(rad), -<span class="built_in">sin</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="built_in">sin</span>(rad), <span class="built_in">cos</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">return</span> xrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateY</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mat4 yrot = <span class="built_in">mat4</span>(</span><br><span class="line">		<span class="built_in">cos</span>(rad), <span class="number">0.0</span>, <span class="built_in">sin</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		-<span class="built_in">sin</span>(rad), <span class="number">0.0</span>, <span class="built_in">cos</span>(rad), <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">return</span> yrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildRotateZ</span><span class="params">(<span class="type">float</span> rad)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mat4 zrot = <span class="built_in">mat4</span>(</span><br><span class="line">		<span class="built_in">cos</span>(rad), -<span class="built_in">sin</span>(rad), <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="built_in">sin</span>(rad), <span class="built_in">cos</span>(rad), <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">return</span> zrot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">mat4 <span class="title">buildTranslate</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mat4 trans = <span class="built_in">mat4</span>(</span><br><span class="line">		<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">		x, y, z, <span class="number">1.0</span>);</span><br><span class="line">	<span class="keyword">return</span> trans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> i = gl_InstanceID + tf;</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> a = <span class="built_in">sin</span>(<span class="number">0.35</span> * i) * <span class="number">8.0</span>;</span><br><span class="line">	<span class="type">float</span> b = <span class="built_in">cos</span>(<span class="number">0.52</span> * i) * <span class="number">8.0</span>;</span><br><span class="line">	<span class="type">float</span> c = <span class="built_in">sin</span>(<span class="number">0.70</span> * i) * <span class="number">8.0</span>;</span><br><span class="line"></span><br><span class="line">	mat4 localRotx = <span class="built_in">buildRotateX</span>(<span class="number">1.75</span> * i);</span><br><span class="line">	mat4 localRoty = <span class="built_in">buildRotateY</span>(<span class="number">1.75</span> * i);</span><br><span class="line">	mat4 localRotz = <span class="built_in">buildRotateZ</span>(<span class="number">1.75</span> * i);</span><br><span class="line">	mat4 localTrans = <span class="built_in">buildTranslate</span>(a, b, c);</span><br><span class="line"></span><br><span class="line">	mat4 newM_matrix = localTrans * localRotx * localRoty * localRotz;</span><br><span class="line">	mat4 mv_matrix = v_matrix * newM_matrix;</span><br><span class="line"></span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">	changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>由于着色器内部无法调用 GLM 的函数，故需要编写矩阵变换的相关函数。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>片段着色器无需做改变。</p>
</details>
<p>如果渲染的立方体很多时，实例化极大的方便了程序的编写，只需要修改视野相关的常量：</p>
<p>比如想渲染 100000 个彩色立方体，只需修改：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="comment">// 实例化个数</span></span><br><span class="line"><span class="built_in">glDrawArraysInstanced</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>, <span class="number">100000</span>);</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="comment">// 镜头位置，镜头拉远</span></span><br><span class="line">cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">402.0f</span>;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="comment">// 位移变大</span></span><br><span class="line"><span class="type">float</span> a = <span class="built_in">sin</span>(<span class="number">203.0</span> * i / <span class="number">8000.0</span>) * <span class="number">403.0</span>;</span><br><span class="line"><span class="type">float</span> b = <span class="built_in">cos</span>(<span class="number">301.0</span> * i / <span class="number">4001.0</span>) * <span class="number">401.0</span>;</span><br><span class="line"><span class="type">float</span> c = <span class="built_in">sin</span>(<span class="number">400.0</span> * i / <span class="number">6003.0</span>) * <span class="number">405.0</span>;</span><br></pre></td></tr></table></figure></div>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_100kcubes.jpg" alt="效果截图(静态图)"><figcaption>效果截图(静态图)</figcaption></figure></p>
<h3 id="同一场景渲染多个对象">同一场景渲染多个对象</h3>
<p>要在单个场景中渲染多个模型，简单的做法：</p>
<ol>
<li>为每个模型使用单独的缓冲区；</li>
<li>每个模型都需要自己的模型矩阵，为渲染的每个模型生成一个新的 MV 矩阵；</li>
<li>为每个模型单独调用 <code>glDrawArrays()</code>。</li>
</ol>
<p>假如在场景中渲染立方体和四棱锥，且不考虑复杂的情况，复用着色器，效果如下图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_2objects.gif" alt="渲染立方体和四棱锥"><figcaption>渲染立方体和四棱锥</figcaption></figure></p>
<p>代码如下（自主研究，不过多解释）：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"><span class="type">float</span> cubeLocx, cubeLocy, cubeLocz;</span><br><span class="line"><span class="type">float</span> pyramidLocx, pyramidLocy, pyramidLocz;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> pyramids[<span class="number">54</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// 生成的缓冲区和 VAO 相关联</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 立方体与缓冲区0绑定</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 四棱锥与缓冲区1绑定</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(pyramids), pyramids, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">8.0f</span>;</span><br><span class="line">	cubeLocx = <span class="number">0.0f</span>, cubeLocy = <span class="number">-2.0f</span>, cubeLocz = <span class="number">0.0f</span>;</span><br><span class="line">	pyramidLocx = <span class="number">0.0f</span>, pyramidLocy = <span class="number">1.0f</span>, pyramidLocz = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取视图矩阵和投影矩阵的统一变量</span></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绘画立方体</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(cubeLocx, cubeLocy, cubeLocz));</span><br><span class="line">	mMat *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绘画四棱锥</span></span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(pyramidLocx, pyramidLocy, pyramidLocz));</span><br><span class="line">	mMat *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Cube&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>顶点着色器和片段着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顶点着色器</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line">out vec4 changingColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">	changingColor = <span class="built_in">vec4</span>(position, <span class="number">1.0</span>) * <span class="number">0.5</span> + <span class="built_in">vec4</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 片段着色器</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 changingColor;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = changingColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h3 id="矩阵栈">矩阵栈</h3>
<p>前面渲染的模型都是由一组顶点构成，而实际上希望通过组装许多简单地模型来构建复杂的模型。以这种方式构建的对象称为分层模型。</p>
<ul>
<li>构建分层模型的棘手部分是跟踪所有 MV 矩阵并保证矩阵完美协调。</li>
</ul>
<p>矩阵栈：变换矩阵的栈。</p>
<ul>
<li>使得创建和管理复杂分层对象和场景变得容易</li>
<li>使得变换可以构建在其他变换之上</li>
<li>通过 STL 的 <code>stack</code> 类构建 <code>mat4</code> 的栈。</li>
</ul>
<p>对于 <code>std::stack&lt;glm::mat4&gt;</code> 的实例 <code>s</code>：</p>
<ul>
<li><code>s.push(mat4)</code>：将栈顶的矩阵复制一份，并作变换后把新的矩阵压入栈。</li>
<li><code>s.pop()</code>：弹出栈顶的矩阵。</li>
<li><code>s.top()</code>：返回栈顶的矩阵的引用。</li>
<li><code>s.top() *= rotate(args)</code>：直接对栈顶矩阵作旋转变换。</li>
<li><code>s.top() *= translate(args)</code>：直接对栈顶矩阵作平移变换。</li>
<li><code>s.top() *= scale(args)</code>：直接对栈顶矩阵作缩放变换。</li>
</ul>
<p>在此之后，不再通过创建 <code>mat4</code> 的实例来构建变换，而是使用 <code>push()</code> 命令在栈顶部创建新的矩阵，然后根据需要将期望的变换应用于栈顶部的新创建的矩阵。</p>
<ul>
<li>压入栈的第一个矩阵通常是视图矩阵。它上面的矩阵是复杂程度越来越高的 MV 矩阵，也就是说，它们应用了越来越多的模型变换。这些变换既可以直接应用，也可以先结合其他矩阵再应用。</li>
</ul>
<p>假设一个例子，实现一个地球围绕太阳旋转和月球围绕地球旋转的场景：</p>
<ol>
<li>首先压入视图矩阵 V；</li>
<li>压入太阳的 MV 矩阵；</li>
<li>压入地球的 MV 矩阵，由太阳的 MV 矩阵的副本和应用于其之上的地球模型矩阵变换组成；</li>
<li>压入月球的 MV 矩阵，由地球的 MV 矩阵的副本和应用于其之上的月球模型矩阵变换组成。</li>
</ol>
<p>接着，渲染月球并把月球矩阵弹出，后面的地球和太阳只需要重复即可。步骤如下：</p>
<ol>
<li>声明矩阵栈；</li>
<li>当相对于父对象创建新对象时，调用 <code>s.push(s.top())</code>；</li>
<li>应用新对象所需的变换；</li>
<li>完成对象或子对象的绘制后，弹出栈顶，移除对应的 MV 矩阵。</li>
</ol>
<p>在这个例子中，需要注意：</p>
<ul>
<li>太阳的自转在它自己的局部坐标空间中进行，不应影响地球和月球。因此，太阳的旋转变换矩阵被推到栈上，但是在绘制太阳之后，它必须被从栈中弹出。</li>
<li>地球的公转将影响月球的运动，因此地球的平移变换矩阵被压入栈并保持到绘制月球。</li>
<li>地球的自转是局部的，不会影响月球，因此在绘制月球之前地球的旋转变换矩阵需要从栈中弹出。</li>
</ul>
<p>效果如图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sunearthmoon.gif" alt="太阳-地球-月球场景"><figcaption>太阳-地球-月球场景</figcaption></figure></p>
<p>顶点着色器与片段着色器无需改变，同上面渲染两个目标的程序。</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line"></span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line">std::stack&lt;glm::mat4&gt; matrixStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> vertexs[<span class="number">108</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]); <span class="comment">// 生成的缓冲区和 VAO 相关联</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertexs), vertexs, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">4.0f</span>, cameraZ = <span class="number">20.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	matrixStack.<span class="built_in">push</span>(vMat);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绘制太阳</span></span><br><span class="line">	matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// 太阳位置</span></span><br><span class="line">	matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// 太阳自转</span></span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	matrixStack.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绘制地球</span></span><br><span class="line">	matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="built_in">sin</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">8.0</span>, <span class="number">0.0</span>, <span class="built_in">cos</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">8.0</span>)); <span class="comment">// 平移矩阵变换</span></span><br><span class="line">	matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime) * <span class="number">2.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">2.0f</span>, <span class="number">0.0f</span>)); <span class="comment">// 旋转矩阵变换</span></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	matrixStack.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绘制月球</span></span><br><span class="line">	matrixStack.<span class="built_in">push</span>(matrixStack.<span class="built_in">top</span>());</span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0</span>, <span class="built_in">sin</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">2.0</span>, <span class="built_in">cos</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime)) * <span class="number">2.0</span>)); <span class="comment">// 平移矩阵变换</span></span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(currentTime), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>)); <span class="comment">// 旋转矩阵变换</span></span><br><span class="line">	matrixStack.<span class="built_in">top</span>() *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.25f</span>, <span class="number">0.25f</span>, <span class="number">0.25f</span>));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(matrixStack.<span class="built_in">top</span>()));</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">	matrixStack.<span class="built_in">pop</span>(); matrixStack.<span class="built_in">pop</span>(); matrixStack.<span class="built_in">pop</span>();</span><br><span class="line">	matrixStack.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;sun-earth-moon&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>注意的点：</p>
<ul>
<li>加入缩放矩阵调节各个模型的大小</li>
<li>使用三角函数实现自转和公转</li>
<li>在 <code>glUniformMatrix4fv()</code> 命令中调用的  <code>glm::value_ptr(mvStack.top())</code> 函数，获取栈顶部矩阵中的值</li>
</ul>
</details>
<h3 id="应对-z冲突-伪影">应对“Z冲突”伪影</h3>
<p>在渲染多个对象时，OpenGL 使用 Z-buffer 算法来进行隐藏面消除。通常情况下，通过选择最接近相机的相应片段的颜色作为像素的颜色，这种方法可决定哪些物体的曲面可见并呈现到屏幕，而位于其他物体后面的曲面不应该被渲染。</p>
<p><em>Z-buffer 算法思想：先将 Z 缓冲器中各单元的初始置设置为最小值。当要改变某个像素的颜色值时，首先检查当前多边形的深度值是否大于该像素原来的深度值（保存在该像素所对应的Z 缓冲器的单元中）。如果大于原来的 Z 值，说明当前多边形更靠近观察点，用它的颜色替换像素原来的颜色。</em></p>
<p>然而，有时候场景中的两个物体表面重叠并位于重合的平面中，这使得深度缓冲区算法难以确定应该渲染两个表面中的哪一个。</p>
<p>发生这种情况时，浮点舍入误差可能会导致渲染表面的某些部分使用其中一个对象的颜色，而其他部分则使用另一个对象的颜色。这种不自然的伪影称为 Z 冲突（Z-fighting）或深度冲突（depth-fighting）。</p>
<ul>
<li>是渲染的片段在深度缓冲区中相互对应的像素条目上“斗争”的结果。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_zfighting.jpg" alt="Z冲突例子，图源计算机图形学编程（第2版）"><figcaption>Z冲突例子，图源计算机图形学编程（第2版）</figcaption></figure></p>
<p>部分应对方法：</p>
<ul>
<li>可以选择适当的近、远剪裁平面值来最小化两个平面之间的距离，同时仍然确保场景必需的所有对象都位于视锥内</li>
<li>建议避免选择太靠近相机的近剪裁平面</li>
</ul>
<h3 id="其他图元">其他图元</h3>
<p>目前一直使用三角形进行绘制，其实 OpenGL 还有其他选择。</p>
<h4 id="三角形图元">三角形图元</h4>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_TRIANGLES</code></td>
<td style="text-align:center">管线中传递的每3个顶点数据组成一个三角形</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltriangle.jpg"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_STRIP</code></td>
<td style="text-align:center">管线中传递的每个顶点和之前的两个顶点组成一个三角形</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglestrip.png"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_FAN</code></td>
<td style="text-align:center">管线中传递的每对顶点和最开始的顶点组成一个三角形</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gltrianglefan.png"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLES_ADJACENCY</code></td>
<td style="text-align:center">仅用于几何着色器，允许着色器访问当前三角形的顶点，以及额外的相邻顶点</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_TRIANGLE_STRIP_ADJACENCY</code></td>
<td style="text-align:center">仅用于几何着色器，类似于 <code>GL_TRIANGLES_ADJACENCY</code>，但三角形顶点像在 <code>GL_TRIANGLE_STRIP</code> 中一样重叠</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="线图元">线图元</h4>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_LINES</code></td>
<td style="text-align:center">管线中传递的每两个顶点组成一条线</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_glline.png"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_STRIP</code></td>
<td style="text-align:center">管线中每个顶点和前一个顶点组成一条线</td>
<td style="text-align:center"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_gllinestrip.png"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_LOOP</code></td>
<td style="text-align:center">类似于 <code>GL_LINE_STRIP</code>，但最后的顶点和第一个顶点之间会形成一条线</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_ADJACENCY</code></td>
<td style="text-align:center">仅用于几何着色器，允许着色器访问当前线的顶点，以及额外的相邻顶点</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><code>GL_LINE_STRIP_ADJACENCY</code></td>
<td style="text-align:center">仅用于几何着色器，类似于 <code>GL_LINE_ADJACENCY</code>，但线顶点像在 <code>GL_LINE_STRIP</code> 中一样重叠</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h4 id="点图元">点图元</h4>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_POINTS</code></td>
<td style="text-align:center">管线中传递的每个顶点组成一个点</td>
</tr>
</tbody>
</table>
<h4 id="补丁图元">补丁图元</h4>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>GL_PATCHES</code></td>
<td style="text-align:center">仅用于细分着色器，指示一组顶点从顶点着色器传递到细分控制着色器，在这里它们通常用于将曲面细分网格塑造成曲面</td>
</tr>
</tbody>
</table>
<h3 id="性能优先编程">性能优先编程</h3>
<p>随着 3D 场景逐渐复杂，性能方面不得不关心。</p>
<ol>
<li>尽量减少动态内存空间分配
<ul>
<li>关键部分 <code>display()</code> 函数会被重复调用
<ul>
<li>避免重复实例化对象</li>
<li>避免重复声明变量</li>
</ul>
</li>
<li>C++ 栈类，每次入栈可能会导致动态内存分配</li>
<li>将数据从一种类型转换为另一种类型的函数调用在某些情况下可能会实例化并返回新转换的数据</li>
<li>GLM 库函数优化有限，可能引起动态内存分配</li>
</ul>
</li>
<li>预先计算透视矩阵
<ul>
<li>将透视矩阵的计算移动到 <code>init()</code> 函数中</li>
<li>一般情况下不需要重新计算透视矩阵，但窗口大小变化时需要重新计算，可以将计算透视矩阵添加到回调函数中。</li>
</ul>
</li>
<li>背面剔除
<ul>
<li>利用 OpenGL 的背面剔除能力：当 3D 模型完全闭合时，其内部永远不可见时，那么这些部分不需要被栅格化或渲染。</li>
<li>默认背面剔除时关闭的</li>
<li>使用函数 <code>glEnable(GL_CULL_FACE)</code> 开启</li>
<li>启用背面剔除时，默认情况下，三角形只有朝前时才会被渲染。此外，默认情况下，从 OpenGL相机的角度看，如果三角形的 3 个顶点是以逆时针顺序排列的（基于它们在缓冲区中定义的顺序），则三角形被视为朝前；顶点沿顺时针方向排列的三角形是朝后的，不会被渲染
<ul>
<li><strong>定义“前向”的顶点顺序有时被称为缠绕顺序</strong></li>
<li>使用 <code>glFrontFace(GL_CW)</code> 设置顺时针为正向，使用 <code>glFrontFace(GL_CCW)</code> 设置逆时针为正向</li>
<li>默认下，<code>glCullFace(GL_BACK)</code> 设置背向的三角形被剔除，但参数还有 <code>GL_FRONT</code> 和 <code>GL_FRONT_AND_BACK</code>，分别设置前向或全部三角形被剔除</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="纹理贴图">纹理贴图</h2>
<p>纹理贴图是在栅格化的模型表面上覆盖图像的技术。</p>
<p>纹理图像可以是任何图像。</p>
<h3 id="加载纹理图像文件">加载纹理图像文件</h3>
<p>OpenGL/GLSL 中完成纹理贴图需要协调不同的数据集和机制：</p>
<ul>
<li>保存纹理图像的纹理对象</li>
<li>特殊的统一采样器变量，用于顶点着色器访问纹理</li>
<li>保存纹理坐标的缓冲区</li>
<li>将纹理坐标传递给管线的顶点属性</li>
<li>显卡上的纹理单元</li>
</ul>
<p>此处将用 SOIL2 库进行加载图像文件用于贴图：</p>
<ol>
<li>使用 SOIL2 实例化 OpenGL 纹理对象并从图像文件中读入数据；</li>
<li>调用 <code>glBindTexture()</code> 使得新创建的纹理对象处于激活状态；</li>
<li>使用 <code>glTexParameteri()</code> 调整纹理设置；</li>
</ol>
<ul>
<li>最终得到的结果是可用的 OpenGL 纹理对象的整型 ID。</li>
</ul>
<p>加载纹理的代码（加入在 Util 类中）如下：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLuint textureID;</span><br><span class="line">	textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">	<span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>代码先声明了一个 <code>GLuint</code> 类型的变量用于记录 OpenGL 纹理对象的 ID，接着调用 <code>SOIL_load_OGL_texture()</code> 函数生成纹理对象。</p>
<ul>
<li>函数参数及返回值
<ul>
<li>第一个参数为文件名；</li>
<li>第二个说明符，<code>SOIL_LOAD_AUTO</code> 表示使用磁盘载入的；</li>
<li>第三个表示让SOIL为我们创建一个ID；</li>
<li>第四个参数 <code>SOIL_FLAG_INVERT_Y</code> 允许做是翻转Y轴</li>
<li>返回值，0表示失败，其他表示 OpenGL 上下文句柄</li>
</ul>
</li>
</ul>
<h3 id="纹理坐标">纹理坐标</h3>
<p>通过为模型中的每个顶点指定纹理坐标来完成纹理贴图。</p>
<p>纹理坐标是对纹理图像（2D 图像文件）中像素的引用，用于将 3D 模型上的点映射到纹理中的位置。</p>
<ul>
<li>模型除了 3D 空间中的定位坐标 (x, y, z) 外，表面上每个点还具有纹理坐标 (s, t)，用来指定纹理图像中哪个像素为它提供颜色。</li>
</ul>
<p><strong>必须为要添加纹理的对象中每个顶点提供纹理坐标。</strong></p>
<p>设置两个缓冲区，一个用于顶点坐标，另一个用于纹理坐标。每次调用顶点着色器会接收到两组坐标。</p>
<p>2D 纹理图像被设定为矩形，左下角坐标为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0,0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span>，右上角坐标为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，故纹理坐标取值区间为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>。</p>
<p>由于之前渲染的立方体模型都是由三角形构成，每个面需要两个三角形。</p>
<p><em>对于立方体或四棱锥这样的简单模型，选择纹理坐标相对容易。但对于具有大量三角形的更复杂的弯曲模型，手动确定它们是不切实际的。在弯曲的几何形状（例如球形或环面）的情况下，可以通过算法或数学方式计算纹理坐标。使用 Maya 或 Blender 等建模工具构建模型时，可以使用“UV 映射”功能，使得确定纹理坐标的任务更容易完成</em></p>
<h3 id="构建一个带纹理的四棱锥">构建一个带纹理的四棱锥</h3>
<ol>
<li>首先创建纹理对象：</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLuint textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;texture.jpg&quot;</span>);</span><br></pre></td></tr></table></figure></div>
<ol start="2">
<li>接着构建纹理坐标：
<ul>
<li>四棱锥具有五个面，由6个三角形组成，每个三角形有3个顶点，共18个顶点</li>
<li>使图像的顶部中心对应四棱锥的顶（简单地贴上去）。</li>
</ul>
</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_texture.jpg" alt="纹理贴图"><figcaption>纹理贴图</figcaption></figure></p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> textures[<span class="number">36</span>] = &#123;</span><br><span class="line">	<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">	<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">	<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">	<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">	<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">	<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<ol start="3">
<li>然后将纹理载入缓冲区：载入缓冲区1。</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(textures), textures, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure></div>
<ol start="4">
<li>在着色器中使用纹理：采样器变量和纹理单元。为了提高性能，在硬件中执行纹理处理。则需要通过统一采样器变量实现。
<ul>
<li>统一采样器变量：指示显卡上的纹理单元，从加载的纹理对象中提取或采样纹理图像中的像素。</li>
</ul>
</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>layout(binding = 0)</code> 表示采样器变量 <code>samp</code> 的绑定第0个纹理单元。</li>
<li>可用纹理单元的数量取决于显卡提供的数量。</li>
</ul>
<ol start="5">
<li>
<p>在 <code>display()</code> 函数中，调用 <code>glActiveTexture()</code> 函数激活纹理单元并调用 <code>glBindTexture()</code> 函数将纹理单元绑定到特定的纹理对象。</p>
<ul>
<li>代码中使用 <code>GL_TEXTURE0</code> 让第0个纹理单元处于激活状态。</li>
</ul>
</li>
<li>
<p>片段着色器中使用顶点着色器接收的插值纹理坐标来对纹理对象进行采样：</p>
</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in vec2 tc;</span><br><span class="line">……</span><br><span class="line">color = <span class="built_in">texture</span>(samp, tc);</span><br></pre></td></tr></table></figure></div>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_pyramidwithtexture.jpg" alt="带纹理的四棱锥"><figcaption>带纹理的四棱锥</figcaption></figure></p>
<p>完整代码：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">2</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID[<span class="number">2</span>];</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line">std::stack&lt;glm::mat4&gt; matrixStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> pyramidVertexs[<span class="number">54</span>] = &#123;</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,  <span class="number">1.0f</span>,  <span class="number">0.0f</span>,</span><br><span class="line">		<span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>,</span><br><span class="line">		 <span class="number">1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span>,  <span class="number">1.0f</span>, <span class="number">-1.0f</span>, <span class="number">-1.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> textures[<span class="number">36</span>] = &#123;</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.5f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">		<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(pyramidVertexs), pyramidVertexs, GL_STATIC_DRAW);</span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(textures), textures, GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">1.5f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID[<span class="number">0</span>] = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;brick1.jpg&quot;</span>);</span><br><span class="line">	textureID[<span class="number">1</span>] = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++)</span><br><span class="line">	&#123;</span><br><span class="line">		vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">		mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(i * <span class="number">3.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		<span class="comment">// 旋转展示各个面</span></span><br><span class="line">		mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">-0.45f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">0.61f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">0.00f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">		mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">		<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">		<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID[i]);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">		<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">		<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">18</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Pyramid with texture&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>Util.h</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> GLuint <span class="title">loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>Util.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 从文件中读取 GLSL 代码</span></span><br><span class="line"><span class="comment">* @param path 文件路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">	std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">		content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fileStream.<span class="built_in">close</span>();</span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 代码编译失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param shader 着色器标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 链接失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param program 着色器程序标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 检查 OpenGL 错误标志，即是否发生 OpenGL 错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	<span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		err = <span class="literal">true</span>;</span><br><span class="line">		glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 创建着色器程序</span></span><br><span class="line"><span class="comment">* @param vpath 顶点着色器路径</span></span><br><span class="line"><span class="comment">* @param fpath 片段着色器路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 记录错误信息</span></span><br><span class="line">	GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 顶点着色器</span></span><br><span class="line">	std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">	<span class="comment">// 片段着色器</span></span><br><span class="line">	std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 分别存入 vShader 和 fShader 变量</span></span><br><span class="line">	GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">	GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 GLSL 代码从字符串载入空着色器对象中</span></span><br><span class="line">	<span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 编译顶点着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">	<span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 编译片段着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">	<span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">	<span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">	<span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> vProgram; <span class="comment">// 返回着色器程序ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 从文件中读取纹理图像并返回纹理 ID</span></span><br><span class="line"><span class="comment">* @param imgPath 图像文件路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLuint textureID;</span><br><span class="line">	textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">	<span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>vertex.glsl</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">	tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>fragment.glsl</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h3 id="多级渐远纹理贴图">多级渐远纹理贴图</h3>
<p>纹理贴图经常会在渲染图像中导致各种不利的伪影。</p>
<ul>
<li>这是因为纹理图像的分辨率或长宽比很少与被纹理贴图的场景中区域的分辨率或长宽比匹配。</li>
</ul>
<ol>
<li>
<p>当图像分辨率小于所绘制区域的分辨率时，会出现一种很常见的伪影。在这种情况下，需要拉伸图像以覆盖整个区域，这样图像就会变得模糊（并且可能变形）。</p>
<ul>
<li>根据纹理的性质，有时可以通过改变纹理坐标分配方式来应对这种情况，使得纹理需要较少的拉伸。</li>
<li>另一种解决方案是使用更高分辨率的纹理图像。</li>
</ul>
</li>
<li>
<p>相反的情况是图像纹理的分辨率大于被绘制区域的分辨率。</p>
<ul>
<li>在这种情况下，可能会出现明显的叠影，从而产生奇怪的错误图案，或移动物体中的“闪烁”效果。</li>
<li>叠影是由采样错误引起的。</li>
</ul>
</li>
</ol>
<p>使用多级渐远纹理贴图可以很大程度上矫正采样误差伪影。</p>
<ul>
<li>使用各种分辨率创建纹理图像的不同版本。</li>
<li>被贴图的区域使用最适合的分辨率的纹理图像。</li>
</ul>
<p>多级渐远纹理贴图的机制：</p>
<ul>
<li>它在纹理图像中存储相同图像的连续的一系列较低分辨率的副本。</li>
<li>所用的纹理图像比原始图像大 1/3，其中图像的 RGB 值分别存储在纹理图像空间的 3 个 1/4 区域中来实现的。</li>
<li>剩余的 1/4 区域中迭代地将图像分辨率设置为原来的 1/4，直到剩余区域太小而不包含任何有用的图像数据。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Multileveltexture.jpg" alt="多级渐远纹理贴图示例，图源计算机图形学编程（第二版）"><figcaption>多级渐远纹理贴图示例，图源计算机图形学编程（第二版）</figcaption></figure></p>
<p>使用代码进行构建多级渐远纹理：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ……</span></span><br><span class="line"><span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line"><span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line"><span class="comment">// ……</span></span><br></pre></td></tr></table></figure></div>
<p>对于函数 <code>glTexparameteri()</code> 其第三个参数设置为所需的缩小方法来选择多级渐远纹理的采样方法，方法如下：</p>
<ul>
<li><code>GL_NEAREST_MIPMAP_NEAREST</code>：选择具有与纹理坐标对应的纹理图像像素区域最相似的分辨率的多级渐远纹理，获取所需纹理坐标的最近的纹理图像像素。</li>
<li><code>GL_LINEAR_MIPMAP_NEAREST</code>：选择具有与纹理坐标对应的纹理图像像素区域最相似的分辨率的多级渐远纹理，获取最接近纹理坐标的4个纹理图像像素的插值。</li>
<li><code>GL_NEAREST_MIPMAP_LINEAR</code>：选择具有与纹理坐标对应的纹理图像像素区域最相似的分辨率的2个多级渐远纹理，从每个多级渐远纹理获取纹理坐标的最近的纹理图像像素进行插值。</li>
<li><code>GL_LINEAR_MIPMAP_LINEAR</code>：选择具有与纹理坐标对应的纹理图像像素区域最相似的分辨率的2多个渐远纹理，从每多个渐远纹理获取最接近纹理坐标的4个纹理图像像素进行插值，又称为“三线性过滤”。</li>
</ul>
<p>通常选择三线性过滤。</p>
<p><em>对于特殊的应用场景，可以使用任何图像编辑软件自行构建多级渐远纹理，然后通过为每个多级渐远纹理级别重复调用 OpenGL 的 <code>glTexImage2D()</code> 函数来创建纹理对象，并将它们添加为多级渐远纹理级别</em></p>
<h3 id="各向异性过滤">各向异性过滤</h3>
<p>多级渐远纹理贴图有时看起来比非多级渐远纹理贴图更模糊。</p>
<ul>
<li>这种细节的丢失是因为当物体倾斜时，其图元看起来在一个轴（即沿宽或高）上的尺寸比在另一个轴上更小。</li>
<li>当 OpenGL 为图元贴图时，它选择适合两个轴中尺寸较小的轴的多级渐远纹理）。</li>
</ul>
<p>可以通过各向异性过滤恢复一些丢失的细节。</p>
<ul>
<li>各向异性过滤比标准多级渐远纹理贴图的计算代价更高，并且不是 OpenGL 的必需部分。</li>
</ul>
<p>只需添加以下代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">	GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">	<span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">	<span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>if</code> 判断测试显卡是否支持各向异性过滤。如果支持，则设置为支持的最大采样程度，由 <code>glGetFloatv()</code> 函数获取。</li>
<li>使用 <code>glTexParameterf()</code> 函数激活并设置纹理的各向异性采样值。</li>
</ul>
<h3 id="环绕和平铺">环绕和平铺</h3>
<p>当纹理坐标超出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 时，可以使用 <code>glTexParameteri()</code> 函数设置：</p>
<ul>
<li><code>GL_REPEAT</code>：重复纹理图像，忽略纹理坐标的整数部分，生成重复或平铺的图案，这是默认选项。</li>
<li><code>GL_MIRRORED_REPEAT</code>：重复纹理图像，忽略纹理坐标的整数部分，但是当整数部分为奇数时反转坐标，重复的图案在原图案和其镜像图案之间交替。</li>
<li><code>GL_CLAMP_TO_EDGE</code>：将纹理坐标限制在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 之间，小于0的坐标设置为0，大于1的坐标设置为1。</li>
<li><code>GL_CLAMP_TO_BORDER</code>：将纹理坐标限制在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 之间，区间以外设置为指定的边框颜色。</li>
</ul>
<p>代码上：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置为重复</span></span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span><br></pre></td></tr></table></figure></div>
<p>修改为 <code>GL_CLAMP_TO_BORDER</code>：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);</span><br><span class="line"><span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);</span><br><span class="line"><span class="type">float</span> redColor[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="built_in">glTexParameterfv</span>(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, redColor);</span><br></pre></td></tr></table></figure></div>
<h3 id="透视变形">透视变形</h3>
<p>在纹理坐标的情况下，线性插值可能导致在具有透视投影的 3D 场景中出现明显的失真。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_distortion.jpg" alt="失真（左），纠正（右），图源计算机图形学编程（第二版）"><figcaption>失真（左），纠正（右），图源计算机图形学编程（第二版）</figcaption></figure></p>
<p>默认情况下，OpenGL 在栅格化期间会应用透视校正算法。</p>
<ul>
<li>可以在顶点属性中添加关键字 <code>noperspective</code> 来禁用透视校正。</li>
<li>顶点着色器：<code>noperspective out vec2 texCoord;</code></li>
<li>片段着色器：<code>noperspective in vec2 texCoord;</code></li>
</ul>
<h3 id="材质的更多细节">材质的更多细节</h3>
<p>可以使用 C++ 和 OpenGL 函数直接将纹理图像文件数据加载到 OpenGL 中（不适用 SOIL2 库）：</p>
<ol>
<li>使用 C++ 工具读取图像文件数据。
<ul>
<li>C++ 函数 <code>fopen()</code>、<code>fread()</code>。</li>
</ul>
</li>
<li>生成 OpenGL 纹理对象。
<ul>
<li>使用 <code>glGenTextures()</code> 函数生成纹理对象。</li>
<li><code>glGenTextures(1, &amp;textureID);</code></li>
</ul>
</li>
<li>将图像文件数据复制到纹理对象中。
<ul>
<li>使用 <code>glTexImage2D()</code> 函数将图像文件数据复制到纹理对象中。</li>
<li><code>data</code> 为图像文件数据，数据类型为 <code>unsigned char</code>。</li>
</ul>
</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GLuint textureID;</span><br><span class="line"><span class="built_in">glGenTextures</span>(<span class="number">1</span>, &amp;textureID);</span><br><span class="line"><span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line"><span class="built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="number">0</span>, GL_RGB, width, height, <span class="number">0</span>, GL_RGB, GL_UNSIGNED_BYTE, data);</span><br></pre></td></tr></table></figure></div>
<h2 id="3d模型">3D模型</h2>
<p>对于四棱锥和立方体，可以通过在OpenGL中使用顶点数组来创建。但是大部分 3D 场景对象都比较复杂，无法手动构建顶点数组。</p>
<p>对于更为复杂的模型，此处关注：</p>
<ul>
<li>通过程序来构建模型</li>
<li>加载外部创建的模型</li>
</ul>
<h3 id="程序构建模型">程序构建模型</h3>
<h4 id="构建一个球体">构建一个球体</h4>
<p>像圆、球体等具有数学定义，其顶点数组可以通过数学计算而生成。</p>
<p>建立一个球体模型：</p>
<ol>
<li>选择模型精度：一个表示将球体分成相应份数的圆形部分的数字，体现为切片数。</li>
<li>将每个圆形切片的圆周细分若干个点，此处每个切片具有相同数量的点。</li>
<li>将顶点分组为三角形：逐步遍历顶点，在每一步构建两个三角形。</li>
</ol>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_group.jpg" alt="将顶点组合成三角形"><figcaption>将顶点组合成三角形</figcaption></figure></p>
<ol start="4">
<li>根据纹理图像的性质选择纹理坐标。对于球体，想象让纹理图像围绕球体包裹，可以根据图像中像素的最终对应位置为每个顶点指定纹理坐标。</li>
<li>对于每个顶点，还应该生成法向量，用于光照。</li>
</ol>
<p>在第3点中，存在顶点出现在多个三角形中，导致每个顶点被多次指定，这对程序不利。仅存储每个顶点一次，然后为三角形的每个角指定索引，引用所需的顶点。</p>
<ul>
<li>需要存储每个顶点的位置、纹理坐标和法向量。
<ul>
<li>顶点存储在一维数组中，从最下面的水平切片开始。</li>
<li>索引数组包含相应三角形的每个角，将值设为顶点数组中的下标。</li>
</ul>
</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_index.png" alt="顶点数组和索引数组"><figcaption>顶点数组和索引数组</figcaption></figure></p>
<p>然后，从球体底部开始，围绕每个水平切片以圆形方式遍历顶点。访问每个顶点时，构建两个三角形，在其右上方形成一个方形区域。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// slices 为切片数，也是精度</span></span><br><span class="line"><span class="comment">// vertexs 为每个水平切片的顶点数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; slices; i++) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; vertexs; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 计算顶点j的指向右边相邻顶点、上方顶点</span></span><br><span class="line">        <span class="comment">// 以及右上方顶点的两个三角形的索引</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>索引数组也加载到 VBO 中，指定 VBO 的类型为 <code>GL_ELEMENT_ARRAY_BUFFER</code>（这会告诉 OpenGL 这个 VBO 包含索引）。</p>
<ul>
<li>在 <code>display()</code> 中：
<ul>
<li>将 <code>glDrawArrays()</code> 调用替换为  <code>glDrawElements()</code> 调用，它会告诉 OpenGL利用索引 VBO 来查找要绘制的顶点。</li>
<li>还需要使用 <code>glBindBuffer()</code> 启用包含索引的 VBO，指定哪个 VBO 包含索引并且为 <code>GL_ELEMENT_ARRAY_BUFFER</code> 类型。</li>
</ul>
</li>
</ul>
<p>编写类 <code>Sphere</code>，用于创建球体模型，球体中心位于原点。</p>
<ul>
<li>
<p>顶点存储在 <code>GLM</code> 中的 <code>vec2</code> 和 <code>vec3</code> 示例的 <code>std::vector</code> 中。</p>
</li>
<li>
<p>因为纹理贴图完全包裹在球体周围，所以在纹理贴图的左右边缘相交的每个点处需要一个额外的顶点来使贴图两侧重合。</p>
<ul>
<li>顶点的总数是 <code>(prec+1)*(prec+1)</code>。由于每个顶点生成 6 个三角形索引，因此索引的总数是 <code>prec*prec*6</code>。</li>
<li><code>prec</code> 为精度，体现在切片数。</li>
</ul>
</li>
</ul>
<p>效果截图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_sphere.jpg" alt="球体"><figcaption>球体</figcaption></figure></p>
<p>代码如下：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="function">Sphere <span class="title">sphere</span><span class="params">(<span class="number">48</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; ind = sphere.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = sphere.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = sphere.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = sphere.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;	<span class="comment">// 顶点位置</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;	<span class="comment">// 纹理坐标</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;	<span class="comment">// 法向量</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> numIndices = sphere.<span class="built_in">getNumIndices</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 顶点坐标放入缓冲区0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 纹理坐标放入缓冲区1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 法向量放入缓冲区2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 索引放入缓冲区3</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>));</span><br><span class="line">	mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">	<span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">		<span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">		<span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">// 利用索引 vbo3 来查找要绘制的顶点</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, sphere.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Sphere&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>球体类</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sphere.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sphere</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> numVertices;	<span class="comment">// 顶点数组大小</span></span><br><span class="line">	<span class="type">int</span> numIndices;		<span class="comment">// 索引数组大小</span></span><br><span class="line">	std::vector&lt;glm::vec3&gt; vertices;	<span class="comment">// 顶点数组</span></span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; indices;			<span class="comment">// 索引数组</span></span><br><span class="line">	std::vector&lt;glm::vec3&gt; normals;		<span class="comment">// 法向量数组</span></span><br><span class="line">	std::vector&lt;glm::vec2&gt; texCoords;	<span class="comment">// 纹理坐标数组</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Sphere</span>(<span class="type">int</span> prec = <span class="number">48</span>);</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumIndices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">getIndices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sphere.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Sphere::<span class="built_in">Sphere</span>(<span class="type">int</span> prec)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">init</span>(prec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sphere::init</span><span class="params">(<span class="type">int</span> _prec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	numVertices = (_prec + <span class="number">1</span>) * (_prec + <span class="number">1</span>);</span><br><span class="line">	numIndices = _prec * _prec * <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">		indices.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算三角形顶点</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= _prec; ++ i)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= _prec; ++ j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">float</span> y = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(<span class="number">180.0f</span> - i * <span class="number">180.0f</span> / _prec)));</span><br><span class="line">			<span class="type">float</span> x = - <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">cos</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">			<span class="type">float</span> z = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="built_in">sin</span>(<span class="built_in">toRadians</span>(j * <span class="number">360.0f</span> / _prec)) * <span class="built_in">fabs</span>(<span class="built_in">cos</span>(<span class="built_in">asin</span>(y))));</span><br><span class="line">			vertices[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">			texCoords[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec2</span>(j * <span class="number">1.0f</span> / _prec, i * <span class="number">1.0f</span> / _prec);</span><br><span class="line">			normals[i * (_prec + <span class="number">1</span>) + j] = glm::<span class="built_in">vec3</span>(x, y, z);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算三角形索引</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; _prec; ++ i)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; _prec; ++ j)</span><br><span class="line">		&#123;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">0</span>] = i * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">1</span>] = i * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">2</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">3</span>] = i * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">4</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j + <span class="number">1</span>;</span><br><span class="line">			indices[<span class="number">6</span> * (i * _prec + j) + <span class="number">5</span>] = (i + <span class="number">1</span>) * (_prec + <span class="number">1</span>) + j;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Sphere::toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> degrees * <span class="number">2.0f</span> * <span class="number">3.14159f</span> / <span class="number">360.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sphere::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sphere::getNumIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> numIndices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Sphere::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">Sphere::getIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Sphere::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">Sphere::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 position;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(position, <span class="number">1.0</span>);</span><br><span class="line">	tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	color = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h4 id="构建一个环面">构建一个环面</h4>
<p>产生环面需要一定的算法。</p>
<p>构建一个环面如图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_totorus.jpg" alt="图源计算机图形学编程（第二版）"><figcaption>图源计算机图形学编程（第二版）</figcaption></figure></p>
<p>将一个顶点定位到原点的右侧，然后在 xOy 平面上的圆中让这个顶点围绕 z 轴旋转，以形成“环”，最后将这个环“向外”移动“内径”的距离。</p>
<p>在构建这些顶点时，会为每个顶点计算纹理坐标和法向量，还会额外为每个顶点生成与环面表面相切的向量（称为切向量）。在顶点创建之后，逐环遍历所有顶点，并在每个顶点上生成两个三角形。两个三角形的 6 个索引表的生成方式和之前的球体类似。</p>
<p>效果截图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_torus.jpg" alt="环面"><figcaption>环面</figcaption></figure></p>
<p>代码如下：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="comment">//#include &quot;Sphere.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere sphere(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">torus</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; ind = torus.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = torus.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = torus.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = torus.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;	<span class="comment">// 顶点位置</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;	<span class="comment">// 纹理坐标</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;	<span class="comment">// 法向量</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> numIndices = torus.<span class="built_in">getNumIndices</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 顶点坐标放入缓冲区0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 纹理坐标放入缓冲区1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 法向量放入缓冲区2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 索引放入缓冲区3</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">5.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-0.5f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">	<span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">		<span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">		<span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">// 利用索引 vbo3 来查找要绘制的顶点</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, torus.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Torus&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>环面类</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Torus.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Torus</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> numVertices;</span><br><span class="line">	<span class="type">int</span> numIndices;</span><br><span class="line">	<span class="type">int</span> prec;</span><br><span class="line">	<span class="type">float</span> inner, outer;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; indices;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vertices;</span><br><span class="line">	std::vector&lt;glm::vec2&gt; texCoords;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; normals;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; sTangents;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; tTangents;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">float</span> <span class="title">toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Torus</span>(<span class="type">int</span> _prec = <span class="number">48</span>, <span class="type">float</span> _inner = <span class="number">0.5</span>, <span class="type">float</span> _outer = <span class="number">0.2</span>);</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumIndices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">getIndices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getStangents</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getTtangents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Torus.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Torus::<span class="built_in">Torus</span>(<span class="type">int</span> _prec, <span class="type">float</span> _inner, <span class="type">float</span> _outer)</span><br><span class="line">&#123;</span><br><span class="line">	prec = _prec;</span><br><span class="line">	inner = _inner;</span><br><span class="line">	outer = _outer;</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Torus::init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	numVertices = (prec + <span class="number">1</span>) * (prec + <span class="number">1</span>);</span><br><span class="line">	numIndices = prec * prec * <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numIndices; ++ i)</span><br><span class="line">		indices.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		sTangents.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">		tTangents.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算第一个环</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec + <span class="number">1</span>; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">float</span> amt = <span class="built_in">toRadians</span>(i * <span class="number">360.0f</span> / prec);</span><br><span class="line">		glm::mat4 rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">		<span class="function">glm::vec3 <span class="title">initPos</span><span class="params">(rMat * glm::vec4(<span class="number">0.0f</span>, outer, <span class="number">0.0f</span>, <span class="number">1.0f</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">		vertices[i] = glm::<span class="built_in">vec3</span>(initPos + glm::<span class="built_in">vec3</span>(inner, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">		texCoords[i] = glm::<span class="built_in">vec2</span>(<span class="number">0.0f</span>, <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(i) / prec);</span><br><span class="line"></span><br><span class="line">		rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt + (<span class="number">3.14159f</span> / <span class="number">2.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">		tTangents[i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(<span class="number">0.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">		sTangents[i] = glm::<span class="built_in">vec3</span>(glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>));</span><br><span class="line"></span><br><span class="line">		normals[i] = glm::<span class="built_in">cross</span>(tTangents[i], sTangents[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将第一个环绕Y轴旋转，得到其他环</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ring = <span class="number">1</span>; ring &lt; prec + <span class="number">1</span>; ++ ring)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec + <span class="number">1</span>; ++ i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">float</span> amt = <span class="built_in">toRadians</span>(ring * <span class="number">360.0f</span> / prec);</span><br><span class="line"></span><br><span class="line">			glm::mat4 rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">			vertices[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(vertices[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">			texCoords[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec2</span>(ring * <span class="number">2.0f</span> / prec, texCoords[i].t);</span><br><span class="line"></span><br><span class="line">			rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">			sTangents[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(sTangents[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">			rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">			tTangents[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(tTangents[i], <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">			rMat = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), amt, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">			normals[ring * (prec + <span class="number">1</span>) + i] = glm::<span class="built_in">vec3</span>(rMat * glm::<span class="built_in">vec4</span>(normals[i], <span class="number">1.0f</span>));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算三角形索引</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> ring = <span class="number">0</span>; ring &lt; prec; ++ ring)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; prec; ++ i)</span><br><span class="line">		&#123;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">0</span>] = ring * (prec + <span class="number">1</span>) + i;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">1</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span>) * <span class="number">3</span> + <span class="number">2</span>] = ring * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">0</span>] = ring * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">1</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i;</span><br><span class="line">			indices[((ring * prec + i) * <span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span> + <span class="number">2</span>] = (ring + <span class="number">1</span>) * (prec + <span class="number">1</span>) + i + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Torus::toRadians</span><span class="params">(<span class="type">float</span> degrees)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> degrees * <span class="number">2.0f</span> * <span class="number">3.14159f</span> / <span class="number">360.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Torus::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Torus::getNumIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> numIndices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">Torus::getIndices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">Torus::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getStangents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> sTangents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">Torus::getTtangents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> tTangents;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>当绕 y 轴旋转生成环时，指定一个从 1 开始并增加到指定精度的变量 <code>ring</code>。然后将纹理坐标值设置为 <code>ring*2.0/prec</code>，使其取值范围为 0.0～2.0，再前面描述的，将纹理的平铺模式设为 <code>GL_REPEAT</code>。运用这种方法的目的是避免纹理图像在水平方向上过度“拉伸”。反之，如果确实希望纹理完全围绕环面拉伸，只需从纹理坐标计算代码中删除 <code>*2.0</code>。</li>
</ul>
</details>
<h3 id="加载外部构建的模型">加载外部构建的模型</h3>
<p>通过一些建模工具也可以构建模型，如：Maya、Blender、Cinema4D等，而一般模型导出也有许多格式。此处使用 OBJ 格式进行处理。</p>
<p>OBJ 文件中的行以字符标签开头，表明该行的数据类型，常见的标签如下：</p>
<ul>
<li>v：几何数据（顶点位置）</li>
<li>vt：纹理坐标</li>
<li>vn：顶点法向量</li>
<li>f：面（通常是三角形中的顶点）<br>
可能还有标签存储对象名称、使用的材质、曲线、阴影和许多其他细节。</li>
</ul>
<p>使用 Blender 绘制一个四棱锥，并导出为 OBJ文件：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_blender.jpg" alt="Blender导出设置"><figcaption>Blender导出设置</figcaption></figure></p>
<p>使用记事本打开一个 OBJ 文件，其内容如下：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_Pyramidobj.jpg" alt="立方体的OBJ文件"><figcaption>立方体的OBJ文件</figcaption></figure></p>
<ul>
<li>以 <code>#</code> 开头的是 Blender 添加的注释，可以忽略。</li>
<li>以 <code>o</code> 开头的是对象的名称，导入时也可以忽略。</li>
<li>以 <code>s</code> 开头表明不应该平滑处理，此处同样忽略。</li>
<li>以 <code>v</code> 开头的是顶点位置，顶点位置的顺序是 <code>x y z</code>。此处有8个顶点，原点在中心。</li>
<li>以 <code>vt</code> 开头的是各种纹理坐标，纹理坐标列表比顶点列表长的原因是一些顶点参与了多个三角形的构建，并且在这些情况下可能使用不同的纹理坐标。</li>
<li>以 <code>vn</code> 开头的是各种法向量，通常也是比顶点列表长，原因同上。</li>
<li>以 <code>f</code> 开头的行指定面（三角形）。每个面（三角形）具有三个元素，由 <code>/</code> 分隔。每个元素的值分别是顶点列表、纹理坐标和法向量的索引，如第三个面是：<code>3/4/3 5/2/3 4/5/3</code>，表明顶点列表第3个、第5个、第4个组成一个面，相应的纹理坐标是第4项、第2项、第5项，法向量相同都是第3项。</li>
</ul>
<p>OBJ 格式的模型并不要求具有法向量，甚至纹理坐标。</p>
<ul>
<li>如果模型没有纹理坐标和法向量，则面的数值将仅指定顶点索引：
<ul>
<li><code>3 5 4</code></li>
</ul>
</li>
<li>如果模型有纹理坐标，没有法向量，则格式为：
<ul>
<li><code>3/4 5/2 4/5</code></li>
</ul>
</li>
<li>如果模型没有纹理坐标，有法向量，则格式为：
<ul>
<li><code>3//3 5//3 4//3</code></li>
</ul>
</li>
</ul>
<p>在互联网上可以获得各种能导入 OBJ 模型的程序，但此处手动编写程序进行简单地导入 OBJ 文件，局限如下：</p>
<ul>
<li>仅支持包含 3 个面属性字段，即以 <code>f #/#/# #/#/# #/#/#</code> 的形式存在。</li>
<li>材质标签将被忽略。</li>
<li>仅支持由单个三角形网格组成的 OBJ 模型。</li>
<li>假设每行上的元素都只用一个空格分隔。</li>
<li>没有使用上索引机制。</li>
</ul>
<p>定义两个类（置于同一个文件）：</p>
<ul>
<li><code>ModelImporter</code> 类用于从 OBJ 文件中导入模型数据。</li>
<li><code>ImportedModel</code> 类用于保存并构建一个模型，类似于上面的球体类、环面类。</li>
</ul>
<p>对于四棱锥，加载 OBJ 与先前手动构建的模型差不多。通过 Windows 自带的 3D 查看器，可以获取一些模型（格式为 <code>.glb</code> ，将其放入 Blender 中，再导出为 OBJ 文件）。获取模型后在 OpenGL 程序中加载，如图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_unicorn.jpg" alt="独角兽模型"><figcaption>独角兽模型</figcaption></figure></p>
<p>导入模型后，对模型的大小和位置进行修改，移动适合的相机位置并加入材质，最后如图：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_iceUnicorn.jpg" alt="冰独角兽"><figcaption>冰独角兽</figcaption></figure></p>
<p>更多可以自己摸索。</p>
<p>代码如下：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint textureID;</span><br><span class="line">GLuint mvLoc, projLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere sphere(48);</span></span><br><span class="line"><span class="comment">//Torus torus(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model</span><span class="params">(<span class="string">&quot; Pyramid.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//std::vector&lt;int&gt; ind = model.getIndices(); 不使用索引数组</span></span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;	<span class="comment">// 顶点位置</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;	<span class="comment">// 纹理坐标</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;	<span class="comment">// 法向量</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> numObjVertices = model.<span class="built_in">getNumVertices</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numObjVertices; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 顶点坐标放入缓冲区0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 纹理坐标放入缓冲区1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 法向量放入缓冲区2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;ice.jpg&quot;</span>);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">30.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">	<span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">		<span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">		<span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model.<span class="built_in">getNumVertices</span>());</span><br><span class="line">	<span class="comment">// 利用索引 vbo3 来查找要绘制的顶点</span></span><br><span class="line">	<span class="comment">// glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">	<span class="comment">// glDrawElements(GL_TRIANGLES, torus.getVertices(), GL_UNSIGNED_INT, 0);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Pyramid&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>导入模型类</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ImportedModel.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImportedModel</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> numVertices;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vertices;</span><br><span class="line">	std::vector&lt;glm::vec2&gt; texCoords;</span><br><span class="line">	std::vector&lt;glm::vec3&gt; normals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">ImportedModel</span>();</span><br><span class="line">	<span class="built_in">ImportedModel</span>(<span class="type">const</span> std::string &amp;filePath);</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec2&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;glm::vec3&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelImporter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// OBJ 读取</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; vertVals;</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; stVals;</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; normalVals;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 保存为顶点属性以供后续使用的数值</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; triangleVerts;</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; texCoords;</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; normals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">ModelImporter</span>();</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">parseOBJ</span><span class="params">(<span class="type">const</span> std::string &amp;filePath)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getVertices</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getTexCoords</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">getNormals</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ImportedModel.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">ImportedModel::<span class="built_in">ImportedModel</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">ImportedModel::<span class="built_in">ImportedModel</span>(<span class="type">const</span> std::string &amp;filePath)</span><br><span class="line">&#123;</span><br><span class="line">	ModelImporter modelImporter = <span class="built_in">ModelImporter</span>();</span><br><span class="line">	modelImporter.<span class="built_in">parseOBJ</span>(filePath);</span><br><span class="line">	numVertices = modelImporter.<span class="built_in">getNumVertices</span>();</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; verts = modelImporter.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tcs = modelImporter.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nms = modelImporter.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		vertices.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>(verts[i * <span class="number">3</span>], verts[i * <span class="number">3</span> + <span class="number">1</span>], verts[i * <span class="number">3</span> + <span class="number">2</span>]));</span><br><span class="line">		texCoords.<span class="built_in">push_back</span>(glm::<span class="built_in">vec2</span>(tcs[i * <span class="number">2</span>], tcs[i * <span class="number">2</span> + <span class="number">1</span>]));</span><br><span class="line">		normals.<span class="built_in">push_back</span>(glm::<span class="built_in">vec3</span>(nms[i * <span class="number">3</span>], nms[i * <span class="number">3</span> + <span class="number">1</span>], nms[i * <span class="number">3</span> + <span class="number">2</span>]));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ImportedModel::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> numVertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">ImportedModel::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> vertices;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec2&gt; <span class="title">ImportedModel::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;glm::vec3&gt; <span class="title">ImportedModel::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ModelImporter::<span class="built_in">ModelImporter</span>()</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ModelImporter::parseOBJ</span><span class="params">(<span class="type">const</span> std::string &amp;filePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">float</span> x, y, z;</span><br><span class="line">	std::string content;</span><br><span class="line">	<span class="function">std::ifstream <span class="title">fin</span><span class="params">(filePath, std::ios::in)</span></span>;</span><br><span class="line">	std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (!fin.<span class="built_in">eof</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">getline</span>(fin, line);</span><br><span class="line">		<span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;v &quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">1</span>))</span></span>;</span><br><span class="line">			s &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">			vertVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">			vertVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">			vertVals.<span class="built_in">push_back</span>(z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;vt&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">			s &gt;&gt; x &gt;&gt; y;</span><br><span class="line">			stVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">			stVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;vn&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">			s &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">			normalVals.<span class="built_in">push_back</span>(x);</span><br><span class="line">			normalVals.<span class="built_in">push_back</span>(y);</span><br><span class="line">			normalVals.<span class="built_in">push_back</span>(z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (line.<span class="built_in">compare</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;f &quot;</span>) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			std::string oneCorner, v, t, n;</span><br><span class="line">			<span class="function">std::stringstream <span class="title">s</span><span class="params">(line.erase(<span class="number">0</span>, <span class="number">2</span>))</span></span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++ i)</span><br><span class="line">			&#123;</span><br><span class="line">				std::<span class="built_in">getline</span>(s, oneCorner, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">				<span class="function">std::stringstream <span class="title">oneCornerSS</span><span class="params">(oneCorner)</span></span>;</span><br><span class="line">				std::<span class="built_in">getline</span>(oneCornerSS, v, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">				std::<span class="built_in">getline</span>(oneCornerSS, t, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">				std::<span class="built_in">getline</span>(oneCornerSS, n, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">				<span class="type">int</span> vertRef = (std::<span class="built_in">stoi</span>(v) - <span class="number">1</span>) * <span class="number">3</span>;</span><br><span class="line">				<span class="type">int</span> tcRef = (std::<span class="built_in">stoi</span>(t) - <span class="number">1</span>) * <span class="number">2</span>;</span><br><span class="line">				<span class="type">int</span> nmRef = (std::<span class="built_in">stoi</span>(n) - <span class="number">1</span>) * <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">				triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef]);</span><br><span class="line">				triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef + <span class="number">1</span>]);</span><br><span class="line">				triangleVerts.<span class="built_in">push_back</span>(vertVals[vertRef + <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">				texCoords.<span class="built_in">push_back</span>(stVals[tcRef]);</span><br><span class="line">				texCoords.<span class="built_in">push_back</span>(stVals[tcRef + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">				normals.<span class="built_in">push_back</span>(normalVals[nmRef]);</span><br><span class="line">				normals.<span class="built_in">push_back</span>(normalVals[nmRef + <span class="number">1</span>]);</span><br><span class="line">				normals.<span class="built_in">push_back</span>(normalVals[nmRef + <span class="number">2</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ModelImporter::getNumVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> triangleVerts.<span class="built_in">size</span>() / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getVertices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> triangleVerts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getTexCoords</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> texCoords;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">float</span>&gt; <span class="title">ModelImporter::getNormals</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> normals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h2 id="光照">光照</h2>
<h3 id="光照模型">光照模型</h3>
<p>光照模型有时也称为着色模型。</p>
<p>常见的光照模型称为 ADS 模型，基于标记为 A、D 和 S 三种类型的反射：</p>
<ul>
<li>A：环境光反射（ambient reflection）：模拟低级光照，影响场景中的所有物体。</li>
<li>D：漫反射（diffuse reflection）：根据光线的入射角度调整物体亮度。</li>
<li>S：镜面反射（specular reflection）：展示物体的光泽，通过在物体表面上，光线直接地反射到我们的眼睛的位置，策略性地放置适当大小的高光来体现。</li>
</ul>
<p>使用 ADS 光照模型需要指定用于像素输出的 RGBA 值上因光照<br>
而产生的分量。因素包括：</p>
<ul>
<li>光源类型及其环境光反射、漫反射和镜面反射特性；</li>
<li>对象材质的环境光反射、漫反射和镜面反射特征；</li>
<li>对象材质的“光泽度”；</li>
<li>光线照射物体的角度；</li>
<li>从中查看场景的角度。</li>
</ul>
<h3 id="光源">光源</h3>
<p>常见的光源类型有：</p>
<ul>
<li>全局光：通常称为全局环境光，仅包含环境光组件</li>
<li>定向光：远距离光</li>
<li>位置光：点光源</li>
<li>聚光灯</li>
</ul>
<p>全局环境光用于显示对象的每个像素都有相同的光照。</p>
<ul>
<li>全局环境光模拟了现实世界光线经过多次反射，<strong>无法确定光源和方向</strong>。</li>
<li>仅有环境光反射分量，没有漫反射或镜面反射分量。</li>
<li>通常被建模为偏暗的白光。</li>
<li>用 RGBA 值设定：<code>float globalAmbient[4] = &#123;0.6f, 0.6f, 0.6f, 1.0f&#125;;</code>
<ul>
<li>RGBA 值的范围是 0.0 到 1.0。A 设置为1。</li>
</ul>
</li>
</ul>
<p>定向光或远距离光</p>
<ul>
<li><strong>没有源位置但具有方向</strong>。用于模拟光源距离非常远，光线接近平行的情况。</li>
<li>定向光对物体的影响取决于光照角度，物体朝向定向光的一侧比对侧更亮。</li>
<li>建模定向光需要指定其方向（向量）及其环境、漫反射和镜面特征。</li>
<li>用 RGBA 设定，如指向 z 轴负方向的红色定向光代码：</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> dirLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> dirLightDirection[<span class="number">3</span>] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>&#125;;</span><br></pre></td></tr></table></figure></div>
<p>位置光在 3D 场景中具有特定位置，用以体现靠近场景的光源。</p>
<ul>
<li><strong>位置光没有方向</strong>，因为它对场景中每个顶点的光照方向都不同。</li>
<li>位置光还可以包含衰减因子，用于模拟它们的强度随着距离减小的程度。</li>
<li>用 RGBA 设定，如位置(5,2,-3)处的红色位置光可以指定为：</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> posLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> posLightPosition[<span class="number">3</span>] = &#123;<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">-3.0f</span>&#125;;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>衰减因子有许多建模方式，其中一种是使用恒定衰减、线性衰减和二次方衰减，引入3个非负可调参数，与离光源的距离 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> 结合进行计算：</li>
</ul>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>k</mi><mi>c</mi></msub><mo>+</mo><msub><mi>k</mi><mi>l</mi></msub><mi>d</mi><mo>+</mo><msub><mi>k</mi><mi>q</mi></msub><msup><mi>d</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">attenuationFactor = \frac{1}{k_c + k_l d + k_q d^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">u</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.293548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">k_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：应永远大于等于1；</p>
</li>
<li>
<p>另外两个参数至少有一个大于零；</p>
</li>
<li>
<p>使得因子取值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，并当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> 增大时接近0。</p>
</li>
<li>
<p>将因子与光的强度相乘即可。</p>
</li>
</ul>
<p>聚光灯</p>
<ul>
<li><strong>同时具有位置和方向</strong>。</li>
<li>聚光灯参数如下图</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_spotlightargs.jpg" alt="聚光灯参数，图源计算机图形学编程（第二版）"><figcaption>聚光灯参数，图源计算机图形学编程（第二版）</figcaption></figure></p>
<ul>
<li>具有衰减指数模拟随光束角度的强度变化，具有衰减因子模拟光束距离衰减。
<ul>
<li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 小于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span> 时，计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 的余弦的衰减指数次幂来计算强度因子。</li>
<li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span> 时，强度因子为0。</li>
<li>强度因子取值范围为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>，将强度因子乘光的强度即可模拟锥形效果。</li>
</ul>
</li>
<li>用 RGBA 设定，如位置(5,2,-3)处向下照射 z 轴负方向的红色聚光灯可以表示为：</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> spotLightAmbient[<span class="number">4</span>] = &#123;<span class="number">0.1f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightDiffuse[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightSpecular[<span class="number">4</span>] = &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightPosition[<span class="number">3</span>] = &#123;<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">-3.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightDirection[<span class="number">3</span>] = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> spotLightCutoff = <span class="number">20.0f</span>;</span><br><span class="line"><span class="type">float</span> spotLightExponent = <span class="number">10.0f</span>;</span><br></pre></td></tr></table></figure></div>
<p><em>当设计拥有许多光源的系统时，程序员应该考虑创建相应的类结构，如定义 Light 类及其子类 GlobalAmbient、Directional、Positional、Spotlight</em></p>
<h3 id="材质">材质</h3>
<p>场景中给物体的外观添加光照，产生反射特性。即对象与 ADS 光照模型相互作用。</p>
<p>通过指定4个值，在 ADS 光照模型中模拟材质：</p>
<ul>
<li>环境光反射</li>
<li>漫反射</li>
<li>镜面反射</li>
<li>光泽</li>
</ul>
<p>如锡铝合金的效果，指定：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> pewterMatAmbient[<span class="number">4</span>] = &#123;<span class="number">0.11f</span>, <span class="number">0.06f</span>, <span class="number">0.11f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> pewterMatDiffuse[<span class="number">4</span>] = &#123;<span class="number">0.43f</span>, <span class="number">0.47f</span>, <span class="number">0.54f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line"><span class="type">float</span> pewterMatSpecular[<span class="number">4</span>] = &#123;<span class="number">0.33f</span>, <span class="number">0.33f</span>, <span class="number">0.52f</span>, <span class="number">1.0f</span>&#125;;</span><br></pre></td></tr></table></figure></div>
<p>没有纹理的物体在渲染时，可以指定材质特性。此处预定义一些可选择的材质（置于Util类中）：</p>
<details><summary>黄金、白银、青铜材质代码</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 黄金材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2473f</span>, <span class="number">0.1995f</span>, <span class="number">0.0745f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.7516f</span>, <span class="number">0.6065f</span>, <span class="number">0.2265f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.6283f</span>, <span class="number">0.5559f</span>, <span class="number">0.3661f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::goldShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::silverShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2125f</span>, <span class="number">0.1275f</span>, <span class="number">0.054f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.714f</span>, <span class="number">0.4284f</span>, <span class="number">0.18144f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.393548f</span>, <span class="number">0.271906f</span>, <span class="number">0.166721f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::bronzeShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">25.6f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p><strong>这些代码仅仅提供了用于描述并存储场景中元素所需光照和材质特性的一种方式，仍然需要自己计算光照。</strong></p>
<h3 id="ads光照计算">ADS光照计算</h3>
<p>当绘制场景时，每个顶点坐标都会进行变换以将 3D 世界模拟到 2D 屏幕上。每个像素的颜色都是栅格化、纹理贴图以及插值的结果。</p>
<p>现在需要加入一个新的步骤来调整这些栅格化之后的像素颜色，以便反应场景中的光照和材质。</p>
<p>首先确定每个像素的反射强度 I：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>+</mo><msub><mi>I</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{observed} = I_{ambient} + I_{diffuse} + I_{specular}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中环境光值为场景环境光与材质环境光分量的乘积（RGB分别乘积）：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mtext> </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>I</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msubsup><mi>t</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msubsup><mi>l</mi><mrow><mi>a</mi><mi>m</mi><mi>b</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>b</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></msubsup></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">I_{ambient}=Light_{ambient}\ Material_{ambient}=
\begin{cases}
I_{ambient}^{red}=Light_{ambient}^{red}Material_{ambient}^{red}\\
I_{ambient}^{green}=Light_{ambient}^{green}Material_{ambient}^{green}\\
I_{ambient}^{blue}=Light_{ambient}^{blue}Material_{ambient}^{blue}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7823em;"><span style="top:-2.3986920000000005em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中漫反射分量基于光对于平面的入射角 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span>。</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_angleOfIncidence.png" alt="入射角"><figcaption>入射角</figcaption></figure></p>
<p>其中确定入射角 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span> 需要：</p>
<ol>
<li>求从绘制向量到光源的向量（或与光照方向相反的向量） <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span></li>
<li>渲染物体表明的法向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></li>
</ol>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>由</mtext><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>N</mi><mo>⋅</mo><mi>L</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi>N</mi><mi mathvariant="normal">∥</mi><mi>L</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mi>π</mi><mn>2</mn></mfrac><mo>≤</mo><mi>θ</mi><mo>≤</mo><mfrac><mi>π</mi><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr></mtable></mrow><mspace linebreak="newline"></mspace><mtext>得</mtext><msub><mi>I</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mtext> </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mtext> </mtext><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>N</mi><mo>⋅</mo><mi>L</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi>N</mi><mi mathvariant="normal">∥</mi><mi>L</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mtext>同样分别进行</mtext><mi>R</mi><mi>G</mi><mi>B</mi><mtext>运算</mtext></mrow><annotation encoding="application/x-tex">由\begin{cases}
I_{diffuse}
\cos(\theta)Light_{diffuse}Material_{diffuse}\\
\cos(\theta)=\frac{N\cdot L}{\vert N\|L\vert}\\
-\frac{\pi}{2}\leq\theta\leq\frac{\pi}{2}
\end{cases}\\
得I_{diffuse}=Light_{diffuse}\ Material_{diffuse}\ \max(\frac{N\cdot L}{\vert N\|L\vert},0)\\
同样分别进行RGB运算
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.4079999999999995em;vertical-align:-1.9539999999999997em;"></span><span class="mord cjk_fallback">由</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.454em;"><span style="top:-4.454000000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.0140000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mord mtight">∥</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">⋅</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.4860000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.9539999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord cjk_fallback">得</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord">∥</span><span class="mord mathdefault">L</span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">同</span><span class="mord cjk_fallback">样</span><span class="mord cjk_fallback">分</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">进</span><span class="mord cjk_fallback">行</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">运</span><span class="mord cjk_fallback">算</span></span></span></span></span></p>
<p>其中镜面反射分量除了与入射角相关，也与光在表面上的反射角以及观察点与反光表面之间的夹角相关。下图 R 表示光反射，V 表示观察向量（像素到眼睛）。</p>
<ul>
<li>V 是从眼睛到像素的取反。</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 越小，镜面反射分量越大。
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 用于计算镜面反射分量的方式取决于物体的光泽度。光泽度越大越闪亮，则入射光更多反射给眼睛；光泽度较小，不那么闪亮，则镜面高光会散开。</li>
</ul>
</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_observationPointIncidence.png" alt="观察点入射角"><figcaption>观察点入射角</figcaption></figure></p>
<p>反光度可以用衰减函数建模，衰减函数表示角度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 增大时镜面反射分量衰减到0的速度。</p>
<ul>
<li>使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo><mi>cos</mi><mo>⁡</mo></mo><mi>n</mi></msup><mo stretchy="false">(</mo><mi>φ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos^n(\varphi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">cos</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">φ</span><span class="mclose">)</span></span></span></span> 进行衰减，指数越大，衰减速度越快。
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> 又叫作材质的反光度因子。</li>
<li>反光度因子以光泽度形式给出。</li>
</ul>
</li>
</ul>
<p>镜面反射计算如下（实际运算使用RGB运算）：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>g</mi><mi>h</mi><msub><mi>t</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mtext> </mtext><mi>M</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>a</mi><msub><mi>l</mi><mrow><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>r</mi></mrow></msub><mtext> </mtext><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>R</mi><mo>⋅</mo><mi>V</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi>R</mi><mi mathvariant="normal">∥</mi><mi>V</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">I_{specular}=Light_{specular}\ Material_{specular}\ \max((\frac{R\cdot V}{\vert R\|V\vert})^n,0)\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.29633em;vertical-align:-0.936em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">h</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mop">max</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord">∥</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span></span></span></span></p>
<h3 id="实现ads光照">实现ADS光照</h3>
<p>平滑着色方法：</p>
<ul>
<li>Gouraud 着色</li>
<li>Phong 着色</li>
</ul>
<h4 id="gouraud-着色">Gouraud 着色</h4>
<p>这方法又称为双线性光强插值法</p>
<p>使用 3D 图形管线中的自动插值渲染，适用于现代显卡。过程如下：</p>
<ol>
<li>确定每个顶点的颜色，并进行光照相关计算。</li>
<li>允许正常的栅格化过程在插入像素时对颜色也进行插值（同时也对光照进行插值）。</li>
</ol>
<p>OpenGL 中，大多数光照计算都是顶点着色器中完成，片段着色器仅传递并展示自动插值的光照后的颜色。</p>
<ul>
<li>顶点着色器
<ol>
<li>根据顶点计算 N、L、V 和 R 向量</li>
<li>计算 A、D、S分量</li>
<li>输出属性、光照后的颜色、<code>gl_position</code></li>
</ol>
</li>
<li>片段着色器
<ol>
<li>传入插值：颜色、位置</li>
</ol>
</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_goldtorus.jpg" alt="通过 Gouraud 着色的黄金材质环面"><figcaption>通过 Gouraud 着色的黄金材质环面</figcaption></figure></p>
<p>程序代码如下：</p>
<details><summary>Util类</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SOIL2/soil2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">static</span> std::string <span class="title">readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printShaderLog</span><span class="params">(GLuint shader)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printProgramLog</span><span class="params">(GLuint program)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">checkOpenGLerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> GLuint <span class="title">createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> GLuint <span class="title">loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldAmbient</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">goldSpecular</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">goldShininess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverAmbient</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">silverSpecular</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">silverShininess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeAmbient</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeDiffuse</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> *<span class="title">bronzeSpecular</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">float</span> <span class="title">bronzeShininess</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Util.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 从文件中读取 GLSL 代码</span></span><br><span class="line"><span class="comment">* @param path 文件路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">std::string <span class="title">Util::readShaderSource</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::string content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="function">std::ifstream <span class="title">fileStream</span><span class="params">(path, std::ios::in)</span></span>;</span><br><span class="line">	std::string line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (!fileStream.<span class="built_in">eof</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">getline</span>(fileStream, line);</span><br><span class="line">		content.<span class="built_in">append</span>(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fileStream.<span class="built_in">close</span>();</span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 代码编译失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param shader 着色器标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printShaderLog</span><span class="params">(GLuint shader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(shader, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetShaderInfoLog</span>(shader, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Shader Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 当 GLSL 链接失败时，显示 OpenGL 日志内容</span></span><br><span class="line"><span class="comment">* @param program 着色器程序标识</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Util::printProgramLog</span><span class="params">(GLuint program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> chWrittn = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> *log;</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		log = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">		<span class="built_in">glGetProgramInfoLog</span>(program, len, &amp;chWrittn, log);</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Program Info: &quot;</span> &lt;&lt; log &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="keyword">delete</span>[] log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 检查 OpenGL 错误标志，即是否发生 OpenGL 错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Util::checkOpenGLerror</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">bool</span> err = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">int</span> glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	<span class="keyword">while</span> (glErr != GL_NO_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;glError: &quot;</span> &lt;&lt; glErr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		err = <span class="literal">true</span>;</span><br><span class="line">		glErr = <span class="built_in">glGetError</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 创建着色器程序</span></span><br><span class="line"><span class="comment">* @param vpath 顶点着色器路径</span></span><br><span class="line"><span class="comment">* @param fpath 片段着色器路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::createShadeProgram</span><span class="params">(<span class="type">const</span> std::string vpath, <span class="type">const</span> std::string fpath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 记录错误信息</span></span><br><span class="line">	GLint vertCompiled, fragCompiled, linked;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 顶点着色器</span></span><br><span class="line">	std::string vs = <span class="built_in">readShaderSource</span>(vpath);</span><br><span class="line">	<span class="comment">// 片段着色器</span></span><br><span class="line">	std::string fs = <span class="built_in">readShaderSource</span>(fpath);</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *vshaderSource = vs.<span class="built_in">c_str</span>();</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *fshaderSource = fs.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 分别存入 vShader 和 fShader 变量</span></span><br><span class="line">	GLuint vShader = <span class="built_in">glCreateShader</span>(GL_VERTEX_SHADER);</span><br><span class="line">	GLuint fShader = <span class="built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将 GLSL 代码从字符串载入空着色器对象中</span></span><br><span class="line">	<span class="built_in">glShaderSource</span>(vShader, <span class="number">1</span>, &amp;vshaderSource, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glShaderSource</span>(fShader, <span class="number">1</span>, &amp;fshaderSource, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 编译顶点着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(vShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(vShader, GL_COMPILE_STATUS, &amp;vertCompiled);</span><br><span class="line">	<span class="keyword">if</span> (vertCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;vertex compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(vShader);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 编译片段着色器</span></span><br><span class="line">	<span class="built_in">glCompileShader</span>(fShader);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetShaderiv</span>(fShader, GL_COMPILE_STATUS, &amp;fragCompiled);</span><br><span class="line">	<span class="keyword">if</span> (fragCompiled == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;fragment compilation failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printShaderLog</span>(fShader);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GLuint vProgram = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, vShader);</span><br><span class="line">	<span class="built_in">glAttachShader</span>(vProgram, fShader);</span><br><span class="line">	<span class="built_in">glLinkProgram</span>(vProgram);</span><br><span class="line">	<span class="built_in">checkOpenGLerror</span>();</span><br><span class="line">	<span class="built_in">glGetProgramiv</span>(vProgram, GL_LINK_STATUS, &amp;linked);</span><br><span class="line">	<span class="keyword">if</span> (linked == GL_FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;linking failed\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printProgramLog</span>(vProgram);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> vProgram; <span class="comment">// 返回着色器程序ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 从文件中读取纹理图像并返回纹理 ID</span></span><br><span class="line"><span class="comment">* @param imgPath 图像文件路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">GLuint <span class="title">Util::loadTexture</span><span class="params">(<span class="type">const</span> std::string &amp;imgPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	GLuint textureID;</span><br><span class="line">	textureID = <span class="built_in">SOIL_load_OGL_texture</span>(imgPath.<span class="built_in">c_str</span>(), SOIL_LOAD_AUTO, SOIL_CREATE_NEW_ID, SOIL_FLAG_INVERT_Y);</span><br><span class="line">	<span class="keyword">if</span> (textureID == <span class="number">0</span>)</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Failed to load texture: &quot;</span> &lt;&lt; imgPath &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> textureID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2473f</span>, <span class="number">0.1995f</span>, <span class="number">0.0745f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.7516f</span>, <span class="number">0.6065f</span>, <span class="number">0.2265f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::goldSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.6283f</span>, <span class="number">0.5559f</span>, <span class="number">0.3661f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 黄金材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::goldShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">0.1923f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">0.5075f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::silverSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">0.5083f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白银材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::silverShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">51.2f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的环境光</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeAmbient</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ambient[<span class="number">4</span>] = &#123; <span class="number">0.2125f</span>, <span class="number">0.1275f</span>, <span class="number">0.054f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> ambient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的漫反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeDiffuse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> diffuse[<span class="number">4</span>] = &#123; <span class="number">0.714f</span>, <span class="number">0.4284f</span>, <span class="number">0.18144f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> diffuse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的镜面反射</span></span><br><span class="line"><span class="function"><span class="type">float</span> *<span class="title">Util::bronzeSpecular</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> specular[<span class="number">4</span>] = &#123; <span class="number">0.393548f</span>, <span class="number">0.271906f</span>, <span class="number">0.166721f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> specular;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 青铜材质的光泽度</span></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">Util::bronzeShininess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">25.6f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 光源属性</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// 材质属性</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;	<span class="comment">// 模型和视觉空间中的光照位置</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];	<span class="comment">// 光照位置的浮点数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化光照位置</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白光特性</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">goldAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">goldDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">goldSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">goldShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="function">Torus <span class="title">model</span><span class="params">(<span class="number">48</span>, <span class="number">0.5f</span>, <span class="number">0.2f</span>)</span></span>;</span><br><span class="line"><span class="comment">//ImportedModel model(&quot;unicorn.obj&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 将光源位置转换为视图空间坐标，存入浮点数组</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y;</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在着色器获取光源位置和材质属性</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在着色器中为光源与材质统一变量赋值</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::vector&lt;<span class="type">int</span>&gt; ind = model.<span class="built_in">getIndices</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;	<span class="comment">// 顶点位置</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;	<span class="comment">// 纹理坐标</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;	<span class="comment">// 法向量</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 顶点坐标放入缓冲区0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 纹理坐标放入缓冲区1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 法向量放入缓冲区2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 顶点索引放入缓冲区3</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="number">4</span> * ind.<span class="built_in">size</span>(), &amp;ind[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;vertex.glsl&quot;</span>, <span class="string">&quot;fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 基于当前光源位置，初始化光照</span></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">	<span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="comment">// 构建 MV 矩阵的逆转置矩阵，用于变换法向量</span></span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="comment">//glDrawArrays(GL_TRIANGLES, 0, model.getNumVertices());</span></span><br><span class="line">	<span class="comment">// 利用索引 vbo3 来查找要绘制的顶点</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, vbo[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">glDrawElements</span>(GL_TRIANGLES, model.<span class="built_in">getNumIndices</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Light&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>注意：</p>
<ul>
<li>定义函数 <code>installLights()</code> 将光源在视觉空间中的位置和材质的 ADS 特性读入相应的统一变量。</li>
<li>直接对法向量应用 MV 矩阵不能保证法向量依然与物体表面垂直。使用 MV 矩阵的逆转置矩阵，用于变换法向量。</li>
<li>变量 lightPosV 包含光源在相机空间中的位置，每帧只需要计算一次。</li>
</ul>
</details>
<details><summary>顶点着色器和片段着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;	<span class="comment">// 用于变换法向量</span></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">out vec4 color;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 将顶点位置和法向量转换到视觉空间</span></span><br><span class="line">	<span class="comment">// 计算视觉空间光照向量（从顶点到光源）</span></span><br><span class="line">	vec4 P = mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">	vec3 N = <span class="built_in">normalize</span>((norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">0.0</span>)).xyz);</span><br><span class="line">	vec3 L = <span class="built_in">normalize</span>(light.position - P.xyz);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 视觉向量等于视觉空间中负顶点位置</span></span><br><span class="line">	vec3 V = <span class="built_in">normalize</span>(-P.xyz);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// R 是 -L 的相对于表面向量 N 的镜像</span></span><br><span class="line">	vec3 R = <span class="built_in">reflect</span>(-L, N);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 环境光、漫反射和镜面反射分量</span></span><br><span class="line">	vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">	vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(<span class="built_in">dot</span>(N, L), <span class="number">0.0</span>);</span><br><span class="line">	vec3 specular = <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="built_in">dot</span>(R, V), <span class="number">0.0f</span>), material.shininess) * material.specular.xyz * light.specular.xyz;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将颜色输出到片段着色器</span></span><br><span class="line"></span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">	color = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>注意：</p>
<ul>
<li>字段选择器符号“.xyz”，是将 <code>vec4</code> 转换为仅包含其前 3 个元素的等效 <code>vec3</code> 的“快捷方式”。</li>
<li><code>normalize()</code> 用来将向量转换为单位长度。</li>
<li><code>reflect()</code> 函数用与计算一个向量基于另一个向量的反射。</li>
<li><code>dot()</code> 函数为点乘运算。</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line">in vec4 color;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	fragColor = color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<p>Gouraud 着色容易受到其他伪影影响。</p>
<ul>
<li>如果镜面高光范围内一个模型顶点也没有，那么它可能不会被渲染出来。</li>
<li>镜面反射分量是依顶点计算的，因此，当模型的所有顶点都没有镜面反射分量时，其栅格化后的像素也不会有镜面反射效果。</li>
</ul>
<h4 id="phong-着色">Phong 着色</h4>
<p>该算法的结构类似 Gouraud 着色算法，不同之处在于光照计算是<strong>按像素而非顶点</strong>完成的。</p>
<ul>
<li>顶点着色器
<ol>
<li>计算向量 N、L、V</li>
<li>输出属性 N、L、V、<code>gl_position</code></li>
</ol>
</li>
<li>片段着色器
<ol>
<li>传入插值 N、L、V</li>
<li>计算 R、θ、φ</li>
<li>计算 ADS 分量</li>
<li>输出颜色</li>
</ol>
</li>
</ul>
<p>将之前在顶点着色器中实现的过程移到片段着色器中进行。</p>
<p>故 main.cpp和 Util 类无需改变，只需修改着色器的代码。</p>
<p>对于原始的 Phong 进行优化：</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> 的计算是非必须的。</li>
<li>角 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 可以通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span> 的角平分线向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span></span></span></span> 得到。
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>L</mi><mo>+</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">H = L + V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>φ</mi></mrow><annotation encoding="application/x-tex">\theta = \frac{1}{2}\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">φ</span></span></span></span></li>
<li>用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span> 代替 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi></mrow><annotation encoding="application/x-tex">\varphi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span> 就已经可以获得足够好的结果。</li>
</ul>
</li>
<li>最后镜面反射分量在光泽度乘 3.0 作为改善镜面高光的微调。</li>
</ul>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_optobPointIncidence.png" alt="使用α代替φ"><figcaption>使用α代替φ</figcaption></figure></p>
<details><summary>顶点着色器和片段着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;	<span class="comment">// 用于变换法向量</span></span><br><span class="line">uniform PositionalLight light;</span><br><span class="line"></span><br><span class="line">out vec3 normals;	<span class="comment">// 视觉空间顶点法向量</span></span><br><span class="line">out vec3 lightDir;	<span class="comment">// 指向光源的向量</span></span><br><span class="line">out vec3 halfVector;<span class="comment">// 角平分线向量 H</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	vec3 _vertPos;	<span class="comment">// 视觉空间中的顶点位置</span></span><br><span class="line">	<span class="comment">// 输出顶点位置、光照方向和法向量到光栅着色器进行插值</span></span><br><span class="line">	_vertPos = (mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	lightDir = light.position - _vertPos;</span><br><span class="line">	normals = (norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	halfVector = (lightDir + (-_vertPos)).xyz;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">in vec3 normals;</span><br><span class="line">in vec3 lightDir;</span><br><span class="line">in vec3 halfVector;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 归一化光照向量、法向量、视觉向量</span></span><br><span class="line">	vec3 L = <span class="built_in">normalize</span>(lightDir);</span><br><span class="line">	vec3 N = <span class="built_in">normalize</span>(normals);</span><br><span class="line">	vec3 H = <span class="built_in">normalize</span>(halfVector);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算光照与平面法向量间的角度</span></span><br><span class="line">	<span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">	<span class="comment">// 计算法向量 N 与角平分线向量 H 之间的角度</span></span><br><span class="line">	<span class="type">float</span> cosPhi = <span class="built_in">dot</span>(H, N);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 按像素计算 ADS 分量，合并构建输出颜色</span></span><br><span class="line">	vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">	vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(cosTheta, <span class="number">0.0</span>);</span><br><span class="line">	vec3 specular = light.specular.xyz * material.specular.xyz * <span class="built_in">pow</span>(<span class="built_in">max</span>(cosPhi, <span class="number">0.0</span>), material.shininess * <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">	fragColor = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<h3 id="结合光照和纹理">结合光照和纹理</h3>
<p>结合光照和纹理的方式取决于物体的特性及其纹理的目的：</p>
<ul>
<li>纹理图像很写实地反映了物体真实的表面外观；</li>
<li>物体同时具有材质和纹理；</li>
<li>材质包括阴影和反射信息；</li>
<li>有多种光或多个纹理</li>
</ul>
<p>当物体拥有一个简单的纹理，同时进行光照时，简单的方法是：</p>
<ol>
<li>在片段着色器中完全将材质特性去除；</li>
<li>使用纹理取样所得纹理颜色代替材质的 ADS 值。</li>
</ol>
<ul>
<li>对于闪亮表面：
<ul>
<li>纹理颜色影响了环境光和漫反射分量，而镜面反射颜色仅由光源决定。</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragColor = textureColor * (ambient + diffuse) + specular;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>对于非闪亮表面：
<ul>
<li>镜面高光部分应当包含物体表面颜色。</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragColor = textureColor * (ambient + diffuse + specular);</span><br></pre></td></tr></table></figure></div>
<ul>
<li>对于物体既有 ADS 材质，又有纹理图像，加权求和。</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">textureColor = <span class="built_in">texture</span>(samp, texCoord);</span><br><span class="line">lightColor = (ambLight * ambMaterial) + (diffLight * diffMaterial) + specLight;</span><br><span class="line">fragColor = <span class="number">0.5</span> * textureColor + <span class="number">0.5</span> * lightColor;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>结合了光照、材质、纹理，并能够扩展到多个光源、多种材质的情况。</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">texture1Color = <span class="built_in">texture</span>(sampler1, texCoord);</span><br><span class="line">texture2Color = <span class="built_in">texture</span>(sampler2, texCoord);</span><br><span class="line">light1Color = (ambLight1 * ambMaterial) + (diffLight1 * diffMaterial) + specLight1;</span><br><span class="line">light2Color = (ambLight2 * ambMaterial) + (diffLight2 * diffMaterial) + specLight2;</span><br><span class="line">fragColor = <span class="number">0.25</span> * texture1Color + </span><br><span class="line">            <span class="number">0.25</span> * texture2Color +</span><br><span class="line">            <span class="number">0.25</span> * light1Color +</span><br><span class="line">            <span class="number">0.25</span> * light2Color;</span><br></pre></td></tr></table></figure></div>
<p>稍作尝试的一个例子：</p>
<p><figure class="image-caption"><img src="https://fblog-1257020106.cos.ap-shanghai.myqcloud.com/imgs/OpenGL_movinglight.gif" alt="青铜材质、冰块纹理、移动光源下的恐龙"><figcaption>青铜材质、冰块纹理、移动光源下的恐龙</figcaption></figure></p>
<p>对于这个例子的代码（ImportedModel 类和 Util 类同之前）：</p>
<details><summary>main.cpp</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLEW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLFW 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="comment">// 导入 GLM 库</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Util.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Sphere.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Torus.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ImportedModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">GLuint renderProgram;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> numVAO = <span class="number">1</span>, numVBO = <span class="number">4</span>;</span><br><span class="line">GLuint vao[numVAO], vbo[numVBO];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> width, height;</span><br><span class="line"><span class="type">float</span> aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> cameraX, cameraY, cameraZ;</span><br><span class="line">GLuint mvLoc, projLoc, nLoc;</span><br><span class="line">GLuint textureID;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 光源属性</span></span><br><span class="line">GLuint globalAmbLoc, ambLoc, diffLoc, specLoc, posLoc;</span><br><span class="line"><span class="comment">// 材质属性</span></span><br><span class="line">GLuint mAmbLoc, mDifLoc, mSpecLoc, mShiLoc;</span><br><span class="line"></span><br><span class="line">glm::mat4 pMat, vMat, mMat, mvMat, invTrMat;</span><br><span class="line">glm::vec3 currentLightPos, lightPosV;	<span class="comment">// 模型和视觉空间中的光照位置</span></span><br><span class="line"><span class="type">float</span> lightPos[<span class="number">3</span>];	<span class="comment">// 光照位置的浮点数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化光照位置</span></span><br><span class="line">glm::vec3 initialLightLoc = glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白光特性</span></span><br><span class="line"><span class="type">float</span> globalAmbient[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightAmbient[<span class="number">4</span>] = &#123; <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightDiffuse[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"><span class="type">float</span> lightSpecular[<span class="number">4</span>] = &#123; <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> *matAmb = Util::<span class="built_in">bronzeAmbient</span>();</span><br><span class="line"><span class="type">float</span> *matDif = Util::<span class="built_in">bronzeDiffuse</span>();</span><br><span class="line"><span class="type">float</span> *matSpe = Util::<span class="built_in">bronzeSpecular</span>();</span><br><span class="line"><span class="type">float</span> matShi = Util::<span class="built_in">bronzeShininess</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sphere model(48);</span></span><br><span class="line"><span class="comment">//Torus model(48, 0.5f, 0.2f);</span></span><br><span class="line"><span class="comment">// 加载的模型还不能使用索引</span></span><br><span class="line"><span class="function">ImportedModel <span class="title">model</span><span class="params">(<span class="string">&quot;model/velociraptor.obj&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">windowSizeCallback</span><span class="params">(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	<span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">installLights</span><span class="params">(glm::mat4 vMatrix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 将光源位置转换为视图空间坐标，存入浮点数组</span></span><br><span class="line">	lightPosV = glm::<span class="built_in">vec3</span>(vMatrix * glm::<span class="built_in">vec4</span>(currentLightPos, <span class="number">1.0</span>));</span><br><span class="line">	lightPos[<span class="number">0</span>] = lightPosV.x;</span><br><span class="line">	lightPos[<span class="number">1</span>] = lightPosV.y * <span class="number">10.0f</span> * <span class="built_in">cos</span>(<span class="built_in">glfwGetTime</span>() * <span class="number">2.0f</span>);</span><br><span class="line">	lightPos[<span class="number">2</span>] = lightPosV.z;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在着色器获取光源位置和材质属性</span></span><br><span class="line">	globalAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;globalAmbient&quot;</span>);</span><br><span class="line">	ambLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.ambient&quot;</span>);</span><br><span class="line">	diffLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.diffuse&quot;</span>);</span><br><span class="line">	specLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.specular&quot;</span>);</span><br><span class="line">	posLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;light.position&quot;</span>);</span><br><span class="line">	mAmbLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.ambient&quot;</span>);</span><br><span class="line">	mDifLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.diffuse&quot;</span>);</span><br><span class="line">	mSpecLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.specular&quot;</span>);</span><br><span class="line">	mShiLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;material.shininess&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在着色器中为光源与材质统一变量赋值</span></span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, globalAmbLoc, <span class="number">1</span>, globalAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, ambLoc, <span class="number">1</span>, lightAmbient);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, diffLoc, <span class="number">1</span>, lightDiffuse);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, specLoc, <span class="number">1</span>, lightSpecular);</span><br><span class="line">	<span class="built_in">glProgramUniform3fv</span>(renderProgram, posLoc, <span class="number">1</span>, lightPos);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mAmbLoc, <span class="number">1</span>, matAmb);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mDifLoc, <span class="number">1</span>, matDif);</span><br><span class="line">	<span class="built_in">glProgramUniform4fv</span>(renderProgram, mSpecLoc, <span class="number">1</span>, matSpe);</span><br><span class="line">	<span class="built_in">glProgramUniform1f</span>(renderProgram, mShiLoc, matShi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeVertexArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//std::vector&lt;int&gt; ind = model.getIndices();</span></span><br><span class="line">	std::vector&lt;glm::vec3&gt; vert = model.<span class="built_in">getVertices</span>();</span><br><span class="line">	std::vector&lt;glm::vec2&gt; tex = model.<span class="built_in">getTexCoords</span>();</span><br><span class="line">	std::vector&lt;glm::vec3&gt; norm = model.<span class="built_in">getNormals</span>();</span><br><span class="line"></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; pvalues;	<span class="comment">// 顶点位置</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; tvalues;	<span class="comment">// 纹理坐标</span></span><br><span class="line">	std::vector&lt;<span class="type">float</span>&gt; nvalues;	<span class="comment">// 法向量</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; model.<span class="built_in">getNumVertices</span>(); ++ i)</span><br><span class="line">	&#123;</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].x);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].y);</span><br><span class="line">		pvalues.<span class="built_in">push_back</span>(vert[i].z);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].s);</span><br><span class="line">		tvalues.<span class="built_in">push_back</span>(tex[i].t);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].x);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].y);</span><br><span class="line">		nvalues.<span class="built_in">push_back</span>(norm[i].z);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenVertexArrays</span>(numVAO, vao);</span><br><span class="line">	<span class="built_in">glBindVertexArray</span>(vao[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glGenBuffers</span>(numVBO, vbo);</span><br><span class="line">	<span class="comment">// 顶点坐标放入缓冲区0</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * pvalues.<span class="built_in">size</span>(), &amp;pvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 纹理坐标放入缓冲区1</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * tvalues.<span class="built_in">size</span>(), &amp;tvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 法向量放入缓冲区2</span></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="number">4</span> * nvalues.<span class="built_in">size</span>(), &amp;nvalues[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line">	<span class="comment">// 顶点索引放入缓冲区3</span></span><br><span class="line">	<span class="comment">//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">	<span class="comment">//glBufferData(GL_ELEMENT_ARRAY_BUFFER, 4 * ind.size(), &amp;ind[0], GL_STATIC_DRAW);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	renderProgram = Util::<span class="built_in">createShadeProgram</span>(<span class="string">&quot;Phong/vertex.glsl&quot;</span>, <span class="string">&quot;Phong/fragment.glsl&quot;</span>);</span><br><span class="line">	cameraX = <span class="number">0.0f</span>, cameraY = <span class="number">0.0f</span>, cameraZ = <span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">	aspect = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(width) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(height);</span><br><span class="line">	pMat = glm::<span class="built_in">perspective</span>(<span class="number">1.0472f</span>, aspect, <span class="number">0.1f</span>, <span class="number">1000.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">makeVertexArray</span>();</span><br><span class="line"></span><br><span class="line">	textureID = Util::<span class="built_in">loadTexture</span>(<span class="string">&quot;textureImg/ice.jpg&quot;</span>);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(GLFWwindow *window, <span class="type">double</span> currentTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="built_in">glUseProgram</span>(renderProgram);</span><br><span class="line"></span><br><span class="line">	mvLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;mv_matrix&quot;</span>);</span><br><span class="line">	projLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;proj_matrix&quot;</span>);</span><br><span class="line">	nLoc = <span class="built_in">glGetUniformLocation</span>(renderProgram, <span class="string">&quot;norm_matrix&quot;</span>);</span><br><span class="line"></span><br><span class="line">	vMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(-cameraX, -cameraY, -cameraZ));</span><br><span class="line">	mMat = glm::<span class="built_in">translate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">-1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat = glm::<span class="built_in">rotate</span>(mMat, <span class="number">35.0f</span> * <span class="number">3.14159f</span> / <span class="number">180.0f</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	mMat *= glm::<span class="built_in">scale</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">5.0f</span>, <span class="number">5.0f</span>, <span class="number">5.0f</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 基于当前光源位置，初始化光照</span></span><br><span class="line">	currentLightPos = glm::<span class="built_in">vec3</span>(initialLightLoc.x, initialLightLoc.y, initialLightLoc.z);</span><br><span class="line">	<span class="built_in">installLights</span>(vMat);</span><br><span class="line"></span><br><span class="line">	mvMat = vMat * mMat;</span><br><span class="line">	<span class="comment">// 构建 MV 矩阵的逆转置矩阵，用于变换法向量</span></span><br><span class="line">	invTrMat = glm::<span class="built_in">transpose</span>(glm::<span class="built_in">inverse</span>(mvMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(projLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(pMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(mvLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(mvMat));</span><br><span class="line">	<span class="built_in">glUniformMatrix4fv</span>(nLoc, <span class="number">1</span>, GL_FALSE, glm::<span class="built_in">value_ptr</span>(invTrMat));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, vbo[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">glVertexAttribPointer</span>(<span class="number">2</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">glEnableVertexAttribArray</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">	<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, textureID);</span><br><span class="line">	<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</span><br><span class="line">	<span class="built_in">glGenerateMipmap</span>(GL_TEXTURE_2D);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewIsSupported</span>(<span class="string">&quot;GL_EXT_texture_filter_anisotropic&quot;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		GLfloat anisoSetting = <span class="number">0.0f</span>;</span><br><span class="line">		<span class="built_in">glGetFloatv</span>(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &amp;anisoSetting);</span><br><span class="line">		<span class="built_in">glTexParameterf</span>(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, anisoSetting);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">	<span class="built_in">glDepthFunc</span>(GL_LEQUAL);</span><br><span class="line">	<span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, model.<span class="built_in">getNumVertices</span>());</span><br><span class="line">	<span class="comment">// 利用索引 vbo3 来查找要绘制的顶点</span></span><br><span class="line">	<span class="comment">//glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, vbo[3]);</span></span><br><span class="line">	<span class="comment">//glDrawElements(GL_TRIANGLES, model.getNumIndices(), GL_UNSIGNED_INT, 0);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">6</span>);</span><br><span class="line">	GLFWwindow *window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Light&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">glewInit</span>() != GLEW_OK)	<span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">	<span class="built_in">glfwSwapInterval</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">glfwSetWindowSizeCallback</span>(window, windowSizeCallback);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">init</span>(window);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">display</span>(window, <span class="built_in">glfwGetTime</span>());</span><br><span class="line">		<span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">		<span class="built_in">glfwPollEvents</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">	<span class="built_in">glfwTerminate</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<details><summary>顶点着色器和片段着色器</summary>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vertex.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">0</span>) in vec3 vertPos;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">1</span>) in vec2 texCoord;</span><br><span class="line"><span class="built_in">layout</span>(location = <span class="number">2</span>) in vec3 vertNormal;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">uniform mat4 mv_matrix;</span><br><span class="line">uniform mat4 proj_matrix;</span><br><span class="line">uniform mat4 norm_matrix;	<span class="comment">// 用于变换法向量</span></span><br><span class="line">uniform PositionalLight light;</span><br><span class="line"></span><br><span class="line">out vec3 normals;	<span class="comment">// 视觉空间顶点法向量</span></span><br><span class="line">out vec3 lightDir;	<span class="comment">// 指向光源的向量</span></span><br><span class="line">out vec3 halfVector;<span class="comment">// 角平分线向量 H</span></span><br><span class="line">out vec2 tc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	vec3 _vertPos;	<span class="comment">// 视觉空间中的顶点位置</span></span><br><span class="line">	<span class="comment">// 输出顶点位置、光照方向和法向量到光栅着色器进行插值</span></span><br><span class="line">	_vertPos = (mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	lightDir = light.position - _vertPos;</span><br><span class="line">	normals = (norm_matrix * <span class="built_in">vec4</span>(vertNormal, <span class="number">1.0</span>)).xyz;</span><br><span class="line">	halfVector = (lightDir + (-_vertPos)).xyz;</span><br><span class="line">	gl_Position = proj_matrix * mv_matrix * <span class="built_in">vec4</span>(vertPos, <span class="number">1.0</span>);</span><br><span class="line">	tc = texCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fragment.glsl</span></span><br><span class="line"><span class="meta">#version 460 core</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PositionalLight</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	vec3 position;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Material</span></span><br><span class="line">&#123;</span><br><span class="line">	vec4 ambient;</span><br><span class="line">	vec4 diffuse;</span><br><span class="line">	vec4 specular;</span><br><span class="line">	<span class="type">float</span> shininess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">layout</span>(binding = <span class="number">0</span>) uniform sampler2D samp;</span><br><span class="line"></span><br><span class="line">uniform vec4 globalAmbient;</span><br><span class="line">uniform PositionalLight light;</span><br><span class="line">uniform Material material;</span><br><span class="line"></span><br><span class="line">in vec2 tc;</span><br><span class="line">in vec3 normals;</span><br><span class="line">in vec3 lightDir;</span><br><span class="line">in vec3 halfVector;</span><br><span class="line">out vec4 fragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 归一化光照向量、法向量、视觉向量</span></span><br><span class="line">	vec3 L = <span class="built_in">normalize</span>(lightDir);</span><br><span class="line">	vec3 N = <span class="built_in">normalize</span>(normals);</span><br><span class="line">	vec3 H = <span class="built_in">normalize</span>(halfVector);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算光照与平面法向量间的角度</span></span><br><span class="line">	<span class="type">float</span> cosTheta = <span class="built_in">dot</span>(L, N);</span><br><span class="line">	<span class="comment">// 计算法向量 N 与角平分线向量 H 之间的角度</span></span><br><span class="line">	<span class="type">float</span> cosPhi = <span class="built_in">dot</span>(H, N);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 按像素计算 ADS 分量，合并构建输出颜色</span></span><br><span class="line">	vec3 ambient = ((globalAmbient * material.ambient) + (light.ambient * material.ambient)).xyz;</span><br><span class="line">	vec3 diffuse = light.diffuse.xyz * material.diffuse.xyz * <span class="built_in">max</span>(cosTheta, <span class="number">0.0</span>);</span><br><span class="line">	vec3 specular = light.specular.xyz * material.specular.xyz * <span class="built_in">pow</span>(<span class="built_in">max</span>(cosPhi, <span class="number">0.0</span>), material.shininess * <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">	vec4 textureColor = <span class="built_in">texture</span>(samp, tc);</span><br><span class="line">	vec4 lightColor = light.ambient + light.diffuse + light.specular;</span><br><span class="line">	vec4 stripLightColor = <span class="built_in">vec4</span>(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">	fragColor = <span class="number">0.3</span> * textureColor + <span class="number">0.7</span> * stripLightColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</details>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> OpenGL图形学编程基础学习记录</li>
        <li><strong>作者:</strong> Fingsinz</li>
        <li><strong>创建于
                :</strong> 2024-01-09 15:00:00</li>
        
            <li>
                <strong>更新于
                    :</strong> 2024-01-25 22:20:05
            </li>
        
        <li>
            <strong>链接:</strong> https://fingsinz.space/2024/basicOpenGL/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            
            本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。
            

        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/C/">#C++</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/OpenGL/">#OpenGL</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                        rel="prev"
                        href="/2024/cppbasic/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">C++基础语法杂记</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                        rel="next"
                        href="/2024/basicOpenCV/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">OpenCV图像处理基础学习记录</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">OpenGL图形学编程基础学习记录</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-opengl%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-text">一、OpenGL安装与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E8%AE%A4%E8%AF%86opengl"><span class="nav-text">1.1 认识OpenGL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEopengl"><span class="nav-text">1.2 安装和配置OpenGL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E5%87%86%E5%A4%87opengl-glsl"><span class="nav-text">1.2.1 准备OpenGL&#x2F;GLSL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E5%87%86%E5%A4%87glfw"><span class="nav-text">1.2.2 准备GLFW</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-%E5%87%86%E5%A4%87glew"><span class="nav-text">1.2.3 准备GLEW</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-%E5%87%86%E5%A4%87glm"><span class="nav-text">1.2.4 准备GLM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-%E5%87%86%E5%A4%87soil2"><span class="nav-text">1.2.5 准备SOIL2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-6-%E5%87%86%E5%A4%87%E5%85%B1%E4%BA%AB%E7%9A%84lib%E5%92%8Cinclude"><span class="nav-text">1.2.6 准备共享的lib和include</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%9C%A8vs%E4%B8%AD%E9%85%8D%E7%BD%AEopengl%E9%A1%B9%E7%9B%AE"><span class="nav-text">1.3 在VS中配置OpenGL项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3"><span class="nav-text">1.4 创建一个窗口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-opengl%E5%9B%BE%E5%83%8F%E7%AE%A1%E7%BA%BF"><span class="nav-text">二、OpenGL图像管线</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%AE%A1%E7%BA%BF"><span class="nav-text">2.1 管线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E7%AC%AC%E4%B8%80%E4%B8%AAc-opengl%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-text">2.1.1 第一个C++&#x2F;OpenGL应用程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E5%92%8C%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8"><span class="nav-text">2.2 顶点着色器和片段着色器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-glsl%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5"><span class="nav-text">2.3 GLSL代码检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%AE%A9%E5%9B%BE%E5%83%8F%E5%8A%A8%E8%B5%B7%E6%9D%A5"><span class="nav-text">2.4 让图像动起来</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-opengl%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80"><span class="nav-text">三、OpenGL数学基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="nav-text">3.1 坐标系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E7%82%B9"><span class="nav-text">3.2 点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%90%91%E9%87%8F"><span class="nav-text">3.3 向量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E7%82%B9%E7%A7%AF%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">3.3.1 点积的应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E5%8F%89%E7%A7%AF%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">3.3.2 叉积的应用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E7%9F%A9%E9%98%B5"><span class="nav-text">3.4 矩阵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5"><span class="nav-text">3.5 变换矩阵</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-%E5%B9%B3%E7%A7%BB%E7%9F%A9%E9%98%B5"><span class="nav-text">3.5.1 平移矩阵</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-%E7%BC%A9%E6%94%BE%E7%9F%A9%E9%98%B5"><span class="nav-text">3.5.2 缩放矩阵</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-3-%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="nav-text">3.5.3 旋转矩阵</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E8%A7%86%E8%A7%89%E7%A9%BA%E9%97%B4%E5%92%8C%E5%90%88%E6%88%90%E7%9B%B8%E6%9C%BA"><span class="nav-text">3.6 视觉空间和合成相机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="nav-text">3.7 投影矩阵</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-1-%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="nav-text">3.7.1 透视投影矩阵</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-2-%E6%AD%A3%E5%B0%84%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="nav-text">3.7.2 正射投影矩阵</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-lookat%E7%9F%A9%E9%98%B5"><span class="nav-text">3.8 LookAt矩阵</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#opengl%E7%AE%A1%E7%90%863d%E5%9B%BE%E5%BD%A2%E6%95%B0%E6%8D%AE"><span class="nav-text">OpenGL管理3D图形数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7"><span class="nav-text">缓冲区和顶点属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%8F%98%E9%87%8F"><span class="nav-text">统一变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7%E6%8F%92%E5%80%BC"><span class="nav-text">顶点属性插值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mv-%E7%9F%A9%E9%98%B5%E5%92%8C%E9%80%8F%E8%A7%86%E7%9F%A9%E9%98%B5"><span class="nav-text">MV 矩阵和透视矩阵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA-3d-%E7%AB%8B%E6%96%B9%E4%BD%93"><span class="nav-text">构建一个 3D 立方体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%89%AF%E6%9C%AC"><span class="nav-text">渲染一个对象的多个副本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E4%B8%80%E5%9C%BA%E6%99%AF%E6%B8%B2%E6%9F%93%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="nav-text">同一场景渲染多个对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5%E6%A0%88"><span class="nav-text">矩阵栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E5%AF%B9-z%E5%86%B2%E7%AA%81-%E4%BC%AA%E5%BD%B1"><span class="nav-text">应对“Z冲突”伪影</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%9B%BE%E5%85%83"><span class="nav-text">其他图元</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E8%A7%92%E5%BD%A2%E5%9B%BE%E5%85%83"><span class="nav-text">三角形图元</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E5%9B%BE%E5%85%83"><span class="nav-text">线图元</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%82%B9%E5%9B%BE%E5%85%83"><span class="nav-text">点图元</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5%E4%B8%81%E5%9B%BE%E5%85%83"><span class="nav-text">补丁图元</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%85%88%E7%BC%96%E7%A8%8B"><span class="nav-text">性能优先编程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="nav-text">纹理贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E7%BA%B9%E7%90%86%E5%9B%BE%E5%83%8F%E6%96%87%E4%BB%B6"><span class="nav-text">加载纹理图像文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E5%9D%90%E6%A0%87"><span class="nav-text">纹理坐标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B8%A6%E7%BA%B9%E7%90%86%E7%9A%84%E5%9B%9B%E6%A3%B1%E9%94%A5"><span class="nav-text">构建一个带纹理的四棱锥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%A7%E6%B8%90%E8%BF%9C%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="nav-text">多级渐远纹理贴图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%84%E5%90%91%E5%BC%82%E6%80%A7%E8%BF%87%E6%BB%A4"><span class="nav-text">各向异性过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E7%BB%95%E5%92%8C%E5%B9%B3%E9%93%BA"><span class="nav-text">环绕和平铺</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E8%A7%86%E5%8F%98%E5%BD%A2"><span class="nav-text">透视变形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8%E7%9A%84%E6%9B%B4%E5%A4%9A%E7%BB%86%E8%8A%82"><span class="nav-text">材质的更多细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3d%E6%A8%A1%E5%9E%8B"><span class="nav-text">3D模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="nav-text">程序构建模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%90%83%E4%BD%93"><span class="nav-text">构建一个球体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%8E%AF%E9%9D%A2"><span class="nav-text">构建一个环面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%A4%96%E9%83%A8%E6%9E%84%E5%BB%BA%E7%9A%84%E6%A8%A1%E5%9E%8B"><span class="nav-text">加载外部构建的模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%89%E7%85%A7"><span class="nav-text">光照</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-text">光照模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%89%E6%BA%90"><span class="nav-text">光源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8"><span class="nav-text">材质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ads%E5%85%89%E7%85%A7%E8%AE%A1%E7%AE%97"><span class="nav-text">ADS光照计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0ads%E5%85%89%E7%85%A7"><span class="nav-text">实现ADS光照</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#gouraud-%E7%9D%80%E8%89%B2"><span class="nav-text">Gouraud 着色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#phong-%E7%9D%80%E8%89%B2"><span class="nav-text">Phong 着色</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E5%85%89%E7%85%A7%E5%92%8C%E7%BA%B9%E7%90%86"><span class="nav-text">结合光照和纹理</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-regular fa-computer-classic"></i>&nbsp;&nbsp;<a href="/">Fingsinz</a>
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>






    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
