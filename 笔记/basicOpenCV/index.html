<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Fingsinz">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://fingsinz.github.io/笔记/basicopencv/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="关键词：C++、OpenCV">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV基础入门教程">
<meta property="og:url" content="https://fingsinz.github.io/%E7%AC%94%E8%AE%B0/basicOpenCV/index.html">
<meta property="og:site_name" content="Fingsinz&#39;s space">
<meta property="og:description" content="关键词：C++、OpenCV">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_download.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run4.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run2.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run3.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run2.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run3.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run4.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run5.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_1.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_2.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_3.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run2.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run3.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run4.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b4_1.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b4_run1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_1.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_2.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_3.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_run.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run2.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run3.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run2.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run3.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run3_1.jpg">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_1.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_2.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_3.png">
<meta property="og:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_run.jpg">
<meta property="article:published_time" content="2024-01-07T15:16:59.000Z">
<meta property="article:modified_time" content="2024-01-07T15:21:46.950Z">
<meta property="article:author" content="Fingsinz">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="OpenCV">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_download.jpg">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/icon1.webp" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon1.webp">
    <meta name="theme-color" content="#93b5cf">
    <link rel="shortcut icon" href="/images/icon1.webp">
    <!--- Page Info-->
    
    <title>
        
            OpenCV基础入门教程 -
        
        Fingsinz&#39; Space
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fingsinz.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":true,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":false,"lazyload":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/3.webp","skip_dirs":[]}},"colors":{"primary":"#93b5cf","secondary":"#15559a"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":false,"site_pv":false,"site_uv":false,"post_pv":false},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/3.webp","dark":"/images/3.webp"},"title":"Fingsinz's Space","subtitle":{"text":null,"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"smart_backspace":true},"text_color":{"light":"#ffffff","dark":"#ffffff"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"email":"fingsinz@foxmail.com"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#815c94","transparency":35},"links":{"主页":{"path":"/","icon":"fa-regular fa-house"},"日常":{"path":"/categories/日常/","icon":"fa fa-calendar"},"分享":{"path":null,"icon":"fa fa-heartbeat","submenus":{"软件":"/categories/软件/","网页":"/categories/网页/","其他":"/categories/其他分享/"}},"笔记":{"path":"/notes","icon":"fa fa-circle-nodes"},"归档":{"path":"/archives","icon":"fa-regular fa-archive"},"关于":{"icon":"fa-regular fa-user","submenus":{"Me&Blog":"/about","Github部署(直连)":"https://fingsinz.space/","Gitee部署(备用)":"https://fingsinz.gitee.io/"}}},"search":{"enable":false,"preload":false}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"不忘初心，方得始终。","links":null},"article_date_format":"YYYY-MM-DD","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2023/5/28 12:00:00"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/icon1.webp">
                </a>
            
            <a class="logo-title" href="/">
                
                Fingsinz&#39; Space
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        主页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories/%E6%97%A5%E5%B8%B8/"  >
                                    
                                        
                                            <i class="fa fa-calendar"></i>
                                        
                                        日常
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa fa-heartbeat"></i>
                                        
                                        分享&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/categories/%E8%BD%AF%E4%BB%B6/">软件
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/categories/%E7%BD%91%E9%A1%B5/">网页
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E4%BA%AB/">其他
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/notes"  >
                                    
                                        
                                            <i class="fa fa-circle-nodes"></i>
                                        
                                        笔记
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME&amp;BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://fingsinz.space/">GITHUB部署(直连)
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://fingsinz.gitee.io/">GITEE部署(备用)
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                主页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories/%E6%97%A5%E5%B8%B8/"  >
                             
                                
                                    <i class="fa fa-calendar"></i>
                                
                                日常
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa fa-heartbeat"></i>
                                
                                分享&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E8%BD%AF%E4%BB%B6/">软件</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E7%BD%91%E9%A1%B5/">网页</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/categories/%E5%85%B6%E4%BB%96%E5%88%86%E4%BA%AB/">其他</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/notes"  >
                             
                                
                                    <i class="fa fa-circle-nodes"></i>
                                
                                笔记
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME&amp;BLOG</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://fingsinz.space/">GITHUB部署(直连)</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://fingsinz.gitee.io/">GITEE部署(备用)</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title">
            
                <h1 class="article-title-regular">OpenCV基础入门教程</h1>
            
            </div>
            
                    
        
        
            <div class="article-header flex flex-row gap-2 items-center">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/icon.webp">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Fingsinz</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-01-07 23:16:59</span>
        <span class="mobile">2024-01-07 23:16:59</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-01-07 23:21:46</span>
            <span class="mobile">2024-01-07 23:21:46</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/C/">C++</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/OpenCV/">OpenCV</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>21k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>101 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body">
            <p>关键词：C++、OpenCV</p>
<span id="more"></span>

<hr>
<h1 id="Visual-Studio2022配置OpencCV"><a href="#Visual-Studio2022配置OpencCV" class="headerlink" title="Visual Studio2022配置OpencCV"></a>Visual Studio2022配置OpencCV</h1><h2 id="下载OpenCV并安装"><a href="#下载OpenCV并安装" class="headerlink" title="下载OpenCV并安装"></a>下载OpenCV并安装</h2><p>可以直接前往<a class="link" target="_blank" rel="noopener" href="https://opencv.org/releases/">OpenCV官网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>进行下载资源。</p>
<p>有两种形式可以下载安装：</p>
<ol>
<li>Windows的exe可执行文件安装。</li>
</ol>
<p>exe文件安装后有OpenCV静态库和动态库文件，可以直接链接到VS使用，整体更方便。</p>
<ol start="2">
<li>Sources源码安装。</li>
</ol>
<p>下载源码后需要自己编译生成OpenCV的静态库和动态库。</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_download.jpg" alt="下载安装"><figcaption>下载安装</figcaption></figure></p>
<h2 id="VS中配置OpenCV"><a href="#VS中配置OpenCV" class="headerlink" title="VS中配置OpenCV"></a>VS中配置OpenCV</h2><p>我下载的OpenCV版本为4.5.2，目录在： <code>D:\opencv4.5.2</code></p>
<p>在VS中新建项目，右键项目点击属性，做以下操作：</p>
<ul>
<li><p>VC++ 目录 → 包含目录添加OpenCV的include目录。例如，我的操作是把 <code>D:\opencv4.5.2\build\include</code> 添加到包含目录。</p>
</li>
<li><p>VC++ 目录 → 库目录添加OpenCV的x64&#x2F;vc15&#x2F;lib目录。例如，我的操作是把 <code>D:\opencv4.5.2\build\x64\vc15\lib</code> 添加到库目录。</p>
</li>
<li><p>链接器 → 输入 → 附加依赖项添加OpenCV的动态库。例如，我的操作是：debug版本添加 <code>opencv_world452d.lib</code>，release版本添加 <code>opencv_world452.lib</code>。</p>
</li>
</ul>
<h2 id="测试OpenCV"><a href="#测试OpenCV" class="headerlink" title="测试OpenCV"></a>测试OpenCV</h2><p>新建Cpp文件，复制以下代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;a&quot;</span>, image);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>编译链接测试，若能运行，则说明配置正确。</p>
<h1 id="OpenCV的基本操作"><a href="#OpenCV的基本操作" class="headerlink" title="OpenCV的基本操作"></a>OpenCV的基本操作</h1><h2 id="读取、显示、写入图像"><a href="#读取、显示、写入图像" class="headerlink" title="读取、显示、写入图像"></a>读取、显示、写入图像</h2><h3 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="读取图像"><a href="#读取图像" class="headerlink" title="读取图像"></a>读取图像</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mat <span class="title">imread</span><span class="params">(<span class="type">const</span> String&amp; filename, <span class="type">int</span> flags = IMREAD_COLOR)</span></span></span><br></pre></td></tr></table></figure></div>

<p>第一参数为图像路径，第二参数为加载图像的形式（默认加载彩色图像）。</p>
<p>第二参数可选参数有三种：</p>
<ol>
<li><p><code>0</code> 或 <code>IMREAD_GRAYSCALE</code> ，表示加载灰度图像。</p>
</li>
<li><p><code>1</code> 或 <code>IMREAD_COLOR</code> ，表示加载彩色图像（默认）。</p>
</li>
<li><p><code>-1</code> 或 <code>IMREAD_UNCHANGED</code> ，表示加载包括alpha通道。</p>
</li>
</ol>
<h4 id="创建窗口"><a href="#创建窗口" class="headerlink" title="创建窗口"></a>创建窗口</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">namedWindow</span><span class="params">(<span class="type">const</span> String&amp; winname, <span class="type">int</span> flags = WINDOW_AUTOSIZE)</span></span></span><br></pre></td></tr></table></figure></div>

<p>第一参数为窗口名字，第二参数为窗口形式。</p>
<p>窗口形式常用有两种：</p>
<ol>
<li><p><code>WINDOW_AUTOSIZE</code> 表示固定大小（默认）。</p>
</li>
<li><p><code>WINDOW_NORMAL</code> 表示可调节大小。</p>
</li>
</ol>
<h4 id="显示图像"><a href="#显示图像" class="headerlink" title="显示图像"></a>显示图像</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">imshow</span><span class="params">(<span class="type">const</span> String&amp; winname, InputArray mat)</span></span></span><br></pre></td></tr></table></figure></div>

<p>第一参数为窗口名字，第二参数为图像对象名称。</p>
<h4 id="写入图像"><a href="#写入图像" class="headerlink" title="写入图像"></a>写入图像</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">imwrite</span><span class="params">( <span class="type">const</span> String&amp; filename, InputArray img, <span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; params = std::vector&lt;<span class="type">int</span>&gt;())</span></span></span><br></pre></td></tr></table></figure></div>

<p>第一参数为存储图像路径，第二参数为图像对象名称，其余参数不重要。</p>
<h4 id="等待延时"><a href="#等待延时" class="headerlink" title="等待延时"></a>等待延时</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">waitKey</span><span class="params">(<span class="type">int</span> delay = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数为延时的毫秒数，默认为0，即无限时等待键盘输入。</p>
<h4 id="窗口销毁"><a href="#窗口销毁" class="headerlink" title="窗口销毁"></a>窗口销毁</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroyWindow</span><span class="params">(<span class="type">const</span> String&amp; winname)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数为销毁的窗口名称，一般情况下系统会自动回收。</p>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 读取现有图像</span></span><br><span class="line">	cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 以png格式写入图像</span></span><br><span class="line">	cv::<span class="built_in">imwrite</span>(<span class="string">&quot;src/test.png&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建窗口并显示图像</span></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;test window&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;test window&quot;</span>, image);</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">	cv::<span class="built_in">destroyWindow</span>(<span class="string">&quot;test window&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run.jpg" alt="运行窗口"><figcaption>运行窗口</figcaption></figure></p>
<h2 id="读取、显示、写入视频"><a href="#读取、显示、写入视频" class="headerlink" title="读取、显示、写入视频"></a>读取、显示、写入视频</h2><h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><h4 id="VideoCapture类"><a href="#VideoCapture类" class="headerlink" title="VideoCapture类"></a>VideoCapture类</h4><p>VideoCapture类提供了有关视频的操作：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>创建VideoCapture实例，使用构造函数，传入参数0表示设备0。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isOpened</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></div>

<p>确认摄像头是否开启成功。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">grab</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></div>

<p>确认摄像头在运行中是否捕获到帧。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">read</span><span class="params">(OutputArray image)</span></span></span><br></pre></td></tr></table></figure></div>

<p>将视频捕获对象中捕获到的图像输出到image中。</p>
<h4 id="转化图像颜色通道"><a href="#转化图像颜色通道" class="headerlink" title="转化图像颜色通道"></a>转化图像颜色通道</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cvtColor</span><span class="params">(InputArray src, OutputArray dst, <span class="type">int</span> code, <span class="type">int</span> dstCn = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>第一参数是输入图像，第二参数是输出图像，第三参数是转化图像颜色通道代码，第四参数暂不管。</p>
<p>转化图像颜色通道代码有许多，通常用到：</p>
<ol>
<li><p><code>COLOR_BGR2GRAY</code> ：由OpenCV的BGR通道转为灰度通道。</p>
</li>
<li><p><code>COLOR_BGR2BGRA</code> ：由OpenCV的BGR通道添加了Alpha通道。</p>
</li>
</ol>
<h4 id="读取、显示视频"><a href="#读取、显示视频" class="headerlink" title="读取、显示视频"></a>读取、显示视频</h4><p>与使用摄像头的思路类似，将捕获设备改为捕获本地文件。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::VideoCapture <span class="title">cap</span><span class="params">(<span class="string">&quot;src/test.mp4&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>显示与使用摄像头的思路类似，捕获视频每一帧并展示图像对象。</p>
<h4 id="写入视频"><a href="#写入视频" class="headerlink" title="写入视频"></a>写入视频</h4><p>定义编解码器并创建VideoWriter对象进行保存。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> fourcc = cv::VideoWriter::<span class="built_in">fourcc</span>(<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;D&#x27;</span>);   <span class="comment">// 编解码器</span></span><br><span class="line"><span class="function">cv::VideoWriter <span class="title">out</span><span class="params">(<span class="string">&quot;output.avi&quot;</span>, fourcc, <span class="number">20.0</span>, cv::Size(<span class="number">640</span>, <span class="number">480</span>))</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>VideoWriter的其中一个构造函数原型如下：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">VideoWriter</span>(<span class="type">const</span> String&amp; filename, <span class="type">int</span> fourcc, <span class="type">double</span> fps, Size frameSize, <span class="type">bool</span> isColor = <span class="literal">true</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h3><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">cv::VideoCapture <span class="title">cap</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">	cv::Mat img;</span><br><span class="line">	<span class="type">int</span> fourcc = cv::VideoWriter::<span class="built_in">fourcc</span>(<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line">	<span class="function">cv::VideoWriter <span class="title">out</span><span class="params">(<span class="string">&quot;output.avi&quot;</span>, fourcc, <span class="number">20.0</span>, cv::Size(<span class="number">640</span>, <span class="number">480</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (cap.<span class="built_in">isOpened</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!cap.<span class="built_in">grab</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;摄像头错误&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		out.<span class="built_in">write</span>(img);</span><br><span class="line">		cap.<span class="built_in">read</span>(img);</span><br><span class="line">		cv::<span class="built_in">imshow</span>(<span class="string">&quot;video&quot;</span>, img);</span><br><span class="line">		<span class="keyword">if</span> (cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>)	<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cap.<span class="built_in">release</span>();  <span class="comment">// 释放视频捕获对象</span></span><br><span class="line">	out.<span class="built_in">release</span>();  <span class="comment">// 释放视频写入对象</span></span><br><span class="line">	cv::<span class="built_in">destroyWindow</span>(<span class="string">&quot;video&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="图像的基本处理"><a href="#图像的基本处理" class="headerlink" title="图像的基本处理"></a>图像的基本处理</h2><h3 id="创建空白图像"><a href="#创建空白图像" class="headerlink" title="创建空白图像"></a>创建空白图像</h3><p>使用 <code>Mat</code> 创建图像矩阵的常用形式：</p>
<ol>
<li>创建空图像，大小为0：</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::Mat image1;</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>指定矩阵大小，指定数据类型</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::Mat <span class="title">image2</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>, CV_8U)</span></span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>创建100行×100列的矩阵，数据类型为无符号8位int，即灰度图像。</p>
</li>
<li><p>还有一种常用的类型CV_8UC3，表示三通道无符号8位int。</p>
</li>
</ul>
<ol start="3">
<li>指定矩阵大小，指定数据类型，设置初始值</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::Mat <span class="title">image3</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>, CV_8U, <span class="number">100</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>创建100行×100列的矩阵，数据类型为无符号8位int灰度图像，灰度值为100。</p>
</li>
<li><p>对于三通道图像，应使用Scalar()：</p>
</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::Mat <span class="title">image</span><span class="params">(<span class="number">640</span>, <span class="number">640</span>, CV_8UC3, cv::Scalar(<span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>))</span></span>;</span><br></pre></td></tr></table></figure></div>

<h3 id="获取图像信息"><a href="#获取图像信息" class="headerlink" title="获取图像信息"></a>获取图像信息</h3><h4 id="获取行列数、通道数"><a href="#获取行列数、通道数" class="headerlink" title="获取行列数、通道数"></a>获取行列数、通道数</h4><p>直接访问Mat类成员rows、cols和函数channels()返回图像的行、列和通道数。可以通过通道数判断是灰度图像（通道为1）还是彩色图像（通道为3）。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; <span class="string">&quot;图像的行：&quot;</span> &lt;&lt; image.rows &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;图像的列：&quot;</span> &lt;&lt; image.cols &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;通道数：&quot;</span> &lt;&lt; image.<span class="built_in">channels</span>() &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure></div>

<h4 id="访问像素点的BGR值"><a href="#访问像素点的BGR值" class="headerlink" title="访问像素点的BGR值"></a>访问像素点的BGR值</h4><p>通过Vec3b数据类型访问返回像素点的BGR值，注意，前者是行数，后者是列数。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> blue = image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(<span class="number">100</span>, <span class="number">100</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 索引值0表示索引BGR值中的B，也就是蓝色通道的数值</span></span><br><span class="line"><span class="type">int</span> green = image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(<span class="number">100</span>, <span class="number">100</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> red = image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(<span class="number">100</span>, <span class="number">100</span>)[<span class="number">2</span>];</span><br></pre></td></tr></table></figure></div>

<p>同理进行修改：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(<span class="number">100</span>, <span class="number">100</span>)[<span class="number">0</span>] = <span class="number">201</span>;</span><br><span class="line"><span class="comment">// 将坐标(100, 100)的像素点蓝色数值改为201</span></span><br></pre></td></tr></table></figure></div>

<p>当然大面积的修改才会明显，通过循环进行：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++ i)</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; ++ j)</span><br><span class="line">		image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = <span class="number">100</span>;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run1.jpg" alt="更改像素点"><figcaption>更改像素点</figcaption></figure></p>
<p>如果修改BGR值，则组成Vec3b类型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++ i)</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; ++ j)</span><br><span class="line">		image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j) = cv::<span class="built_in">Vec3b</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>

<h3 id="标记区域"><a href="#标记区域" class="headerlink" title="标记区域"></a>标记区域</h3><p>创建tmp变量，获取图像行从200到1000，列从200到1000的区域。将图像行从1200到2000，列从1200到2000的区域变成tmp</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">cv::Mat tmp = <span class="built_in">image</span>(cv::<span class="built_in">Range</span>(<span class="number">100</span>, <span class="number">200</span>), cv::<span class="built_in">Range</span>(<span class="number">100</span>, <span class="number">200</span>));</span><br><span class="line">tmp.<span class="built_in">copyTo</span>(<span class="built_in">image</span>(cv::<span class="built_in">Range</span>(<span class="number">200</span>, <span class="number">300</span>), cv::<span class="built_in">Range</span>(<span class="number">200</span>, <span class="number">300</span>)));</span><br></pre></td></tr></table></figure></div>

<h3 id="遍历图像"><a href="#遍历图像" class="headerlink" title="遍历图像"></a>遍历图像</h3><h4 id="循环行和列遍历图像"><a href="#循环行和列遍历图像" class="headerlink" title="循环行和列遍历图像"></a>循环行和列遍历图像</h4><p>对于OpenCV的Mat，其顺序是行和列。与C++的二维数组类似，遍历：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++ i)</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; ++ j)</span><br><span class="line">		image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j) = cv::<span class="built_in">Vec3b</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="指针扫描"><a href="#指针扫描" class="headerlink" title="指针扫描"></a>指针扫描</h4><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat img = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat output_img;</span><br><span class="line">    output_img = cv::<span class="built_in">Mat</span>(img.<span class="built_in">size</span>(), img.<span class="built_in">type</span>());   <span class="comment">// 复制画布</span></span><br><span class="line">    output_img = img.<span class="built_in">clone</span>();    <span class="comment">// 克隆像素值</span></span><br><span class="line">    <span class="type">int</span> r = img.rows, c = img.cols, channels = img.<span class="built_in">channels</span>();</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; r; j ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> uchar *now = img.<span class="built_in">ptr</span>&lt;uchar&gt;(j);   <span class="comment">// 原图当前行指针</span></span><br><span class="line">        uchar *output = output_img.<span class="built_in">ptr</span>&lt;uchar&gt;(j);   <span class="comment">// 输出图像当前行指针</span></span><br><span class="line">        <span class="comment">// 实际上每一列都由通道数三个数据组成，所以实际上列数应该是通道数×列</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = channels; i &lt; c * channels; i ++)</span><br><span class="line">        &#123;</span><br><span class="line">            output[i] = cv::<span class="built_in">saturate_cast</span>&lt;uchar&gt;(<span class="number">5</span> * now[i]);</span><br><span class="line">			<span class="comment">// saturate_cast保证了计算结果仍在0~255之间</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, img);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, output_img);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    cv::<span class="built_in">destroyAllWindows</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run4.jpg" alt="结果展示"><figcaption>结果展示</figcaption></figure></p>
<h2 id="绘图入门"><a href="#绘图入门" class="headerlink" title="绘图入门"></a>绘图入门</h2><h3 id="静态绘制"><a href="#静态绘制" class="headerlink" title="静态绘制"></a>静态绘制</h3><h4 id="绘制线"><a href="#绘制线" class="headerlink" title="绘制线"></a>绘制线</h4><p>函数原型： </p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">line</span><span class="params">(InputOutputArray img, Point pt1, Point pt2, <span class="type">const</span> Scalar&amp; color,<span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">int</span> shift = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、始点坐标、终点坐标、颜色、线粗细、线类型……</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">line</span>(image, cv::<span class="built_in">Point</span>(<span class="number">0</span>, <span class="number">0</span>), cv::<span class="built_in">Point</span>(<span class="number">512</span>, <span class="number">512</span>), cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">5</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">rectangle</span><span class="params">(InputOutputArray img, Rect rec, <span class="type">const</span> Scalar&amp; color, <span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">int</span> shift = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、矩形框、颜色、边框线粗细、边框线类型……</p>
<p>矩形框的四个参数分别为：x坐标、y坐标、宽、高。</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">rectangle</span>(image, cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>), cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="绘制圆"><a href="#绘制圆" class="headerlink" title="绘制圆"></a>绘制圆</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">circle</span><span class="params">(InputOutputArray img, Point center, <span class="type">int</span> radius, <span class="type">const</span> Scalar&amp; color, <span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">int</span> shift = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、圆心、半径、颜色、边框线粗细、边框线类型……</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">circle</span>(image, cv::<span class="built_in">Point</span>(<span class="number">319</span>, <span class="number">319</span>), <span class="number">50</span>, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="绘制椭圆"><a href="#绘制椭圆" class="headerlink" title="绘制椭圆"></a>绘制椭圆</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ellipse</span><span class="params">(InputOutputArray img, Point center, Size axes, <span class="type">double</span> angle, <span class="type">double</span> startAngle, <span class="type">double</span> endAngle, <span class="type">const</span> Scalar&amp; color, <span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">int</span> shift = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、中心点、长短轴、初始旋转角度、椭圆开始角度、椭圆结束角度、颜色、边框线粗细、边框线类型……边框线粗细为-1表示内填充。</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">ellipse</span>(image, cv::<span class="built_in">Point</span>(<span class="number">319</span>, <span class="number">119</span>), cv::<span class="built_in">Size</span>(<span class="number">100</span>, <span class="number">50</span>), <span class="number">0</span>, <span class="number">180</span>, <span class="number">360</span>, <span class="number">255</span>, <span class="number">-1</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="绘制多边形"><a href="#绘制多边形" class="headerlink" title="绘制多边形"></a>绘制多边形</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">polylines</span><span class="params">(InputOutputArray img, <span class="type">const</span> Point* <span class="type">const</span>* pts, <span class="type">const</span> <span class="type">int</span>* npts, <span class="type">int</span> ncontours, <span class="type">bool</span> isClosed, <span class="type">const</span> Scalar&amp; color, <span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">int</span> shift = <span class="number">0</span> )</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、const修饰的指向多边形数组的指针、多边形顶点个数的数组名、绘制多边形的个数、是否闭合、颜色、边框粗细、边框线类型</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造多边形的端点形成的点类型数组。</span></span><br><span class="line">cv::Point pts[] = &#123; cv::<span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">5</span>), cv::<span class="built_in">Point</span>(<span class="number">20</span>, <span class="number">30</span>), cv::<span class="built_in">Point</span>(<span class="number">70</span>, <span class="number">20</span>), cv::<span class="built_in">Point</span>(<span class="number">50</span>, <span class="number">10</span>) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const修饰的多边形数组指针</span></span><br><span class="line"><span class="type">const</span> cv::Point *ppt[<span class="number">1</span>] = &#123; pts &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多边形顶点个数的数组名</span></span><br><span class="line"><span class="type">int</span> npt[] = &#123; <span class="number">4</span> &#125;;</span><br><span class="line">cv::<span class="built_in">polylines</span>(image, ppt, npt, <span class="number">1</span>, <span class="literal">true</span>, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br></pre></td></tr></table></figure></div>

<h4 id="添加文本"><a href="#添加文本" class="headerlink" title="添加文本"></a>添加文本</h4><p>函数原型：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">putText</span><span class="params">( InputOutputArray img, <span class="type">const</span> String&amp; text, Point org, <span class="type">int</span> fontFace, <span class="type">double</span> fontScale, Scalar color, <span class="type">int</span> thickness = <span class="number">1</span>, <span class="type">int</span> lineType = LINE_8, <span class="type">bool</span> bottomLeftOrigin = <span class="literal">false</span> )</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数分别为：图像对象、文本内容、文字在图像中的左下角坐标、字体、字体大小、字体颜色、字体粗细、描绘字体的线类型……</p>
<p>使用示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv::<span class="built_in">putText</span>(image, <span class="string">&quot;OpenCV&quot;</span>, cv::<span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">500</span>), cv::FONT_HERSHEY_SIMPLEX, <span class="number">4</span>, cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>, cv::LINE_AA);</span><br></pre></td></tr></table></figure></div>

<h4 id="整体绘制展示"><a href="#整体绘制展示" class="headerlink" title="整体绘制展示"></a>整体绘制展示</h4><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">image</span><span class="params">(<span class="number">640</span>, <span class="number">640</span>, CV_8UC3)</span></span>;</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">line</span>(image, cv::<span class="built_in">Point</span>(<span class="number">0</span>, <span class="number">0</span>), cv::<span class="built_in">Point</span>(<span class="number">512</span>, <span class="number">512</span>), cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">5</span>);</span><br><span class="line">	cv::<span class="built_in">rectangle</span>(image, cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>), cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br><span class="line">	cv::<span class="built_in">circle</span>(image, cv::<span class="built_in">Point</span>(<span class="number">319</span>, <span class="number">319</span>), <span class="number">50</span>, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br><span class="line">	cv::<span class="built_in">ellipse</span>(image, cv::<span class="built_in">Point</span>(<span class="number">319</span>, <span class="number">119</span>), cv::<span class="built_in">Size</span>(<span class="number">100</span>, <span class="number">50</span>), <span class="number">0</span>, <span class="number">180</span>, <span class="number">360</span>, <span class="number">255</span>, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">	cv::Point pts[] = &#123; cv::<span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">5</span>), cv::<span class="built_in">Point</span>(<span class="number">20</span>, <span class="number">30</span>), cv::<span class="built_in">Point</span>(<span class="number">70</span>, <span class="number">20</span>), cv::<span class="built_in">Point</span>(<span class="number">50</span>, <span class="number">10</span>) &#125;;</span><br><span class="line">	<span class="type">const</span> cv::Point *ppt[<span class="number">1</span>] = &#123; pts &#125;;</span><br><span class="line">	<span class="type">int</span> npt[] = &#123; <span class="number">4</span> &#125;;</span><br><span class="line">	cv::<span class="built_in">polylines</span>(image, ppt, npt, <span class="number">1</span>, <span class="literal">true</span>, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">	cv::<span class="built_in">putText</span>(image, <span class="string">&quot;OpenCV&quot;</span>, cv::<span class="built_in">Point</span>(<span class="number">10</span>, <span class="number">500</span>), cv::FONT_HERSHEY_SIMPLEX, <span class="number">4</span>, cv::<span class="built_in">Scalar</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>, cv::LINE_AA);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;img&quot;</span>, image);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run2.jpg" alt="整体展示"><figcaption>整体展示</figcaption></figure></p>
<h3 id="鼠标绘制"><a href="#鼠标绘制" class="headerlink" title="鼠标绘制"></a>鼠标绘制</h3><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">cv::Mat <span class="title">image</span><span class="params">(<span class="number">640</span>, <span class="number">640</span>, CV_8UC3)</span></span>;	<span class="comment">// 画布</span></span><br><span class="line"><span class="type">bool</span> drawing = <span class="literal">false</span>;	<span class="comment">// 是否绘画</span></span><br><span class="line"><span class="type">bool</span> mode = <span class="literal">true</span>;		<span class="comment">// 矩形绘制还是圆形绘制</span></span><br><span class="line"><span class="type">int</span> ix, iy = <span class="number">-1</span>;</span><br><span class="line"><span class="type">int</span> r, g, b, t = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘画函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> flags, <span class="type">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event == cv::EVENT_LBUTTONDOWN)	<span class="comment">// 当鼠标按下时</span></span><br><span class="line">    &#123;</span><br><span class="line">        drawing = <span class="literal">true</span>;		<span class="comment">// 启动绘画</span></span><br><span class="line">        ix = x;				<span class="comment">// 获取起点坐标</span></span><br><span class="line">        iy = y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event == cv::EVENT_MOUSEMOVE)	<span class="comment">// 当鼠标移动时</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (drawing)	<span class="comment">// 处于绘画状态</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (mode)	<span class="comment">// 矩形绘制时</span></span><br><span class="line">            &#123;</span><br><span class="line">                cv::<span class="built_in">rectangle</span>(image, cv::<span class="built_in">Point</span>(ix, iy), cv::<span class="built_in">Point</span>(x, y), cv::<span class="built_in">Scalar</span>(b, g, r), t * <span class="number">20</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>		<span class="comment">// 圆形绘制时</span></span><br><span class="line">            &#123;</span><br><span class="line">                cv::<span class="built_in">circle</span>(image, cv::<span class="built_in">Point</span>(x, y), <span class="number">5</span>, cv::<span class="built_in">Scalar</span>(b, g, r), t * <span class="number">20</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event == cv::EVENT_LBUTTONUP)	<span class="comment">// 当鼠标松开时</span></span><br><span class="line">    &#123;</span><br><span class="line">        drawing = <span class="literal">false</span>;	<span class="comment">// 关闭绘画</span></span><br><span class="line">        <span class="keyword">if</span> (mode)	<span class="comment">// 补上最后一笔， x和y是当前的坐标</span></span><br><span class="line">        &#123;</span><br><span class="line">            cv::<span class="built_in">rectangle</span>(image, cv::<span class="built_in">Point</span>(ix, iy), cv::<span class="built_in">Point</span>(x, y), cv::<span class="built_in">Scalar</span>(b, g, r), t * <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cv::<span class="built_in">circle</span>(image, cv::<span class="built_in">Point</span>(x, y), <span class="number">5</span>, cv::<span class="built_in">Scalar</span>(b, g, r), t * <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;image&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">setMouseCallback</span>(<span class="string">&quot;image&quot;</span>, draw);	<span class="comment">// 绑定画布和回调函数</span></span><br><span class="line">    cv::<span class="built_in">createTrackbar</span>(<span class="string">&quot;R&quot;</span>, <span class="string">&quot;image&quot;</span>, <span class="number">0</span>, <span class="number">255</span>);	<span class="comment">// 轨迹栏</span></span><br><span class="line">    cv::<span class="built_in">createTrackbar</span>(<span class="string">&quot;G&quot;</span>, <span class="string">&quot;image&quot;</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">    cv::<span class="built_in">createTrackbar</span>(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;image&quot;</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">    cv::<span class="built_in">createTrackbar</span>(<span class="string">&quot;Thickness&quot;</span>, <span class="string">&quot;image&quot;</span>, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::<span class="built_in">imshow</span>(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">        <span class="type">int</span> k = cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (k == <span class="string">&#x27;m&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mode = !mode;</span><br><span class="line">        &#125;</span><br><span class="line">        r = cv::<span class="built_in">getTrackbarPos</span>(<span class="string">&quot;R&quot;</span>, <span class="string">&quot;image&quot;</span>);	<span class="comment">// 刷新绘图属性</span></span><br><span class="line">        g = cv::<span class="built_in">getTrackbarPos</span>(<span class="string">&quot;G&quot;</span>, <span class="string">&quot;image&quot;</span>);</span><br><span class="line">        b = cv::<span class="built_in">getTrackbarPos</span>(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;image&quot;</span>);</span><br><span class="line">        t = cv::<span class="built_in">getTrackbarPos</span>(<span class="string">&quot;Thickness&quot;</span>, <span class="string">&quot;image&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cv::<span class="built_in">destroyAllWindows</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b1_run3.jpg" alt="鼠标绘制"><figcaption>鼠标绘制</figcaption></figure></p>
<h1 id="灰度变换"><a href="#灰度变换" class="headerlink" title="灰度变换"></a>灰度变换</h1><h2 id="灰度变换原理"><a href="#灰度变换原理" class="headerlink" title="灰度变换原理"></a>灰度变换原理</h2><p><strong>通过变换函数T将原图像像素灰度值r映射为灰度值s：</strong></p>
<p>$$<br>s &#x3D; T(r)<br>$$</p>
<h2 id="灰度反转"><a href="#灰度反转" class="headerlink" title="灰度反转"></a>灰度反转</h2><p><strong>灰度反转：将图像亮暗对调，可以增强图像中的暗色区域细节。</strong></p>
<p>$$<br>s &#x3D; T(r) &#x3D; L - 1 - r，其中L为图像灰度级，0~255灰度图像的灰度级为256<br>$$</p>
<p>进行$s &#x3D; T(r) &#x3D; 256 - 1 - r$ 代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat output_image, image_gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image_gray);</span><br><span class="line"></span><br><span class="line">    output_image = image_gray.<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image_gray.rows; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image_gray.cols; ++ j)</span><br><span class="line">            output_image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">255</span> - image_gray.<span class="built_in">at</span>&lt;uchar&gt;(i, j);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, output_image);</span><br><span class="line">    </span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run.jpg" alt="灰度反转效果展示"><figcaption>灰度反转效果展示</figcaption></figure></p>
<h2 id="对数变换"><a href="#对数变换" class="headerlink" title="对数变换"></a>对数变换</h2><p><strong>对数变换：扩展图像中的暗像素值，压缩高灰度值。</strong></p>
<p>$$<br>s &#x3D; T(r) &#x3D; c\log(1 + r)<br>$$</p>
<p>其中有一个图像归一化的过程，使用函数：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">normalize</span><span class="params">( InputArray src, InputOutputArray dst, <span class="type">double</span> alpha = <span class="number">1</span>, <span class="type">double</span> beta = <span class="number">0</span>, <span class="type">int</span> norm_type = NORM_L2, <span class="type">int</span> dtype = <span class="number">-1</span>, InputArray mask = noArray())</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：输入数组；</p>
</li>
<li><p>dst：与输入数组一样大的输出数组；</p>
</li>
<li><p>alpha：范数值，在范围归一化的情况下归一化到或较低的范围边界，即下限。</p>
</li>
<li><p>beta： 在范围归一化的情况下的上范围边界，即上限；它不用于范数归一化，只用于NORM_MINMAX中。</p>
</li>
<li><p>norm_type：规范化选择的公式类型类型。</p>
</li>
<li><p>dtype：如果为负，则输出在大小、深度、通道数都等于输入；否则，它具有与src相同的通道数，深度不同，深度&#x3D;CV_MAT_DEPTH。</p>
</li>
<li><p>mask：掩码。选择感兴趣区域，选定后只能对该区域进行操作。</p>
</li>
</ul>
<p>而归一化选择的数学公式（norm_type）有，设数组元素为$A_1，…，A_n$：</p>
<ol>
<li>NORM_L1</li>
</ol>
<p>$$<br>P &#x3D; \frac {A_i}{\sum A_i}\times alpha<br>$$</p>
<ol start="2">
<li>NORM_INF</li>
</ol>
<p>$$<br>P &#x3D; \frac {A_i}{\max A_i}\times alpha<br>$$</p>
<ol start="3">
<li>NORM_L2</li>
</ol>
<p>$$<br>P &#x3D; \frac {A_k}{\sqrt {A_i^2}}\times alpha<br>$$</p>
<ol start="4">
<li>NORM_MINMAX：$A_K\notin{\max A_i},\min A_i。当A_K等于\max A_i时，p&#x3D;1；当A_k等于\min A_i时，p&#x3D;0$</li>
</ol>
<p>$$<br>P &#x3D; \frac {A_k}{\max A_i - \min A_i}\times \vert{alpha - beta}\vert + min(alpha, beta)<br>$$</p>
<p><em>同时需要注意的是alpha和beta的取值顺序与归一化结果无关。即alpha&#x3D;255，beta&#x3D;0和alpha&#x3D;0，beta&#x3D;255最后的归一化结果是相同的。</em></p>
<p>与之相关还有一个函数，其常用于将CV_16S、CV_32F等其他类型的输出图像转变成CV_8U型的图像：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">convertScaleAbs</span><span class="params">(InputArray src, OutputArray dst, <span class="type">double</span> alpha = <span class="number">1</span>, <span class="type">double</span> beta = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：输入数组。</p>
</li>
<li><p>dst：输出数组。</p>
</li>
<li><p>alpha：可选比例系数。</p>
</li>
<li><p>beta：添加到缩放值的可选增量，即偏移量。</p>
</li>
</ul>
<p>该函数也可用于对整个图像数组中的每一个元素进图像增强等相关先行操作的快速运算：</p>
<p>$$<br>dst_i &#x3D; saturate_{uchar}(\vert alpha\times src_i + beta \vert)<br>$$</p>
<p>进行$s &#x3D; T(r) &#x3D; 4\log(1 + r)$ 的代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat output_image, image_gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image_gray);</span><br><span class="line"></span><br><span class="line">    output_image = image_gray.<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image_gray.rows; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image_gray.cols; ++ j)</span><br><span class="line">            output_image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">4</span> * <span class="built_in">log</span>((<span class="type">double</span>) image_gray.<span class="built_in">at</span>&lt;uchar&gt;(i, j)) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图像归一化，将数值变回0~255</span></span><br><span class="line">    cv::<span class="built_in">normalize</span>(output_image, output_image, <span class="number">0</span>, <span class="number">255</span>, cv::NORM_MINMAX);</span><br><span class="line">    <span class="comment">// 将数据类型变回CV_8U，似乎忽略此句也可</span></span><br><span class="line">    cv::<span class="built_in">convertScaleAbs</span>(output_image, output_image);</span><br><span class="line">    </span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, output_image); </span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run1.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h2 id="幂律（伽马变换）"><a href="#幂律（伽马变换）" class="headerlink" title="幂律（伽马变换）"></a>幂律（伽马变换）</h2><p><strong>伽马变换：与对数函数变换类似。</strong></p>
<p>$$<br>s &#x3D; T(r) &#x3D; c\times r^γ<br>$$</p>
<p>进行$s &#x3D; T(r) &#x3D; 4\times r^{0.9}$ 代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat output_image, image_gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image_gray);</span><br><span class="line"></span><br><span class="line">    output_image = image_gray.<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image_gray.rows; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image_gray.cols; ++ j)</span><br><span class="line">            output_image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">4</span> * <span class="built_in">pow</span>((<span class="type">double</span>)image_gray.<span class="built_in">at</span>&lt;uchar&gt;(i, j), <span class="number">0.9</span>);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">normalize</span>(output_image, output_image, <span class="number">0</span>, <span class="number">255</span>, cv::NORM_MINMAX);</span><br><span class="line">    cv::<span class="built_in">convertScaleAbs</span>(output_image, output_image);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, output_image);</span><br><span class="line">    </span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run2.jpg" alt="灰度反转效果展示"><figcaption>灰度反转效果展示</figcaption></figure></p>
<h1 id="直方图处理"><a href="#直方图处理" class="headerlink" title="直方图处理"></a>直方图处理</h1><h2 id="图像直方图"><a href="#图像直方图" class="headerlink" title="图像直方图"></a>图像直方图</h2><p>非归一化直方图：</p>
<p>$$<br>h(r_k) &#x3D; n_k，其中r_k为图像像素灰度值，n_k为图像中灰度值r_k对应的像素个数<br>$$</p>
<p>归一化直方图：</p>
<p>$$<br>p(r_k) &#x3D; \frac {n_k}{MN}，其中M和N为图像行数和列数。<br>$$</p>
<p>计算直方图与一些函数相关：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">calcHist</span><span class="params">( <span class="type">const</span> Mat* images, <span class="type">int</span> nimages, <span class="type">const</span> <span class="type">int</span>* channels, InputArray mask,  OutputArray hist, <span class="type">int</span> dims, <span class="type">const</span> <span class="type">int</span>* histSize, <span class="type">const</span> <span class="type">float</span>** ranges, <span class="type">bool</span> uniform = <span class="literal">true</span>, <span class="type">bool</span> accumulate = <span class="literal">false</span> )</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>images：源数组指针，它们都应该具有相同的深度，CV_8U, CV_16U或CV_32F，以及相同的大小。它们中的每一个都可以有任意数量的通道。</p>
</li>
<li><p>nimages：源图像的数量。</p>
</li>
<li><p>channels：需要统计直方图的第几通道。通道的数量必须与直方图的维度相匹配。第一个数组通道的编号从0到images[0].channels()-1，第二个数组通道的编号从images[0].channels()到images[0].channels() + images[1].channels()-1，以此类推。</p>
</li>
<li><p>mask：掩码。选择感兴趣区域，选定后只能对该区域进行操作。</p>
</li>
<li><p>hist：直方图计算的输出值。</p>
</li>
<li><p>dims：输出直方图的维度（由channels指定）。</p>
</li>
<li><p>histSize：直方图中每个dims维度需要分成多少个区间（直方图竖条的个数）。</p>
</li>
<li><p>ranges：统计像素值的区间。</p>
</li>
<li><p>uniform&#x3D;true：是否对得到的直方图进行归一化处理。</p>
</li>
<li><p>accumulate&#x3D;false：在多个图像时是否累计计算像素值的个数。</p>
</li>
</ul>
<p>获取图像的直方图代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat hist, image_gray;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img&quot;</span>, image_gray);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hsize = <span class="number">256</span>;    <span class="comment">// 直方图区间数</span></span><br><span class="line">    <span class="type">float</span> ranges[] = &#123; <span class="number">0</span>, <span class="number">256</span> &#125;;   <span class="comment">// 统计像素值的区间</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> *hRanges = &#123; ranges &#125;;</span><br><span class="line">    <span class="comment">// 计算直方图的输出值</span></span><br><span class="line">    cv::<span class="built_in">calcHist</span>(&amp;image_gray, <span class="number">1</span>, <span class="number">0</span>, cv::<span class="built_in">Mat</span>(), hist, <span class="number">1</span>, &amp;hsize, &amp;hRanges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hist_h = <span class="number">300</span>, hist_w = <span class="number">512</span>; <span class="comment">// 直方图图像高和宽</span></span><br><span class="line">    <span class="type">int</span> bin_w = hist_w / hsize; <span class="comment">// 区间</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 直方图图像</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">histImage</span><span class="params">(hist_h, hist_w, CV_8UC3, cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span></span>;</span><br><span class="line">    <span class="comment">// 直方图输出值归一化到0~255</span></span><br><span class="line">    cv::<span class="built_in">normalize</span>(hist, hist, <span class="number">0</span>, hist_h, cv::NORM_MINMAX, <span class="number">-1</span>, cv::<span class="built_in">Mat</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; hsize; i ++)</span><br><span class="line">        cv::<span class="built_in">line</span>(histImage, cv::<span class="built_in">Point</span>((i - <span class="number">1</span>) * bin_w, hist_h - <span class="built_in">cvRound</span>(hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i - <span class="number">1</span>))), cv::<span class="built_in">Point</span>((i) *bin_w, hist_h - <span class="built_in">cvRound</span>(hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i))), cv::<span class="built_in">Scalar</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;pic&quot;</span>, histImage);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run3.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h2 id="直方图均衡化"><a href="#直方图均衡化" class="headerlink" title="直方图均衡化"></a>直方图均衡化</h2><p><strong>通过均衡化处理可以使得图像的直方图分布变得较广较平均。</strong></p>
<p>经过公式：</p>
<p>$$<br>s_k &#x3D; (L - 1)\sum_{j&#x3D;0}^kP_r(r_j)，k &#x3D; 0,1…,L-1<br>$$</p>
<p>其中，$s_k$是变换后的灰度级，$P_r(r_j)$是灰度级为$r_j$的直方图值。</p>
<p>涉及一个函数：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">equalizeHist</span><span class="params">( InputArray src, OutputArray dst )</span></span></span><br></pre></td></tr></table></figure></div>

<p>该函数参数十分简单，只有输入图像矩阵和输出图像矩阵，即可进行图像直方图的均衡化。</p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat hist, hist1, image_gray, image_;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image, image_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img_before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img_after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img_before&quot;</span>, image_gray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直方图均衡化</span></span><br><span class="line">    cv::<span class="built_in">equalizeHist</span>(image_gray, image_);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img_after&quot;</span>, image_);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hsize = <span class="number">256</span>;    <span class="comment">// 直方图区间数</span></span><br><span class="line">    <span class="type">float</span> ranges[] = &#123; <span class="number">0</span>, <span class="number">256</span> &#125;;   <span class="comment">// 统计像素值的区间</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> *hRanges = &#123; ranges &#125;;</span><br><span class="line">    <span class="comment">// 计算直方图的输出值</span></span><br><span class="line">    cv::<span class="built_in">calcHist</span>(&amp;image_gray, <span class="number">1</span>, <span class="number">0</span>, cv::<span class="built_in">Mat</span>(), hist, <span class="number">1</span>, &amp;hsize, &amp;hRanges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    cv::<span class="built_in">calcHist</span>(&amp;image_, <span class="number">1</span>, <span class="number">0</span>, cv::<span class="built_in">Mat</span>(), hist1, <span class="number">1</span>, &amp;hsize, &amp;hRanges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> hist_h = <span class="number">300</span>, hist_w = <span class="number">512</span>; <span class="comment">// 直方图图像高和宽</span></span><br><span class="line">    <span class="type">int</span> bin_w = hist_w / hsize; <span class="comment">// 区间</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 直方图图像</span></span><br><span class="line">    <span class="function">cv::Mat <span class="title">histImage</span><span class="params">(hist_h, hist_w, CV_8UC3, cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">histImage1</span><span class="params">(hist_h, hist_w, CV_8UC3, cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直方图输出值归一化到0~255</span></span><br><span class="line">    cv::<span class="built_in">normalize</span>(hist, hist, <span class="number">0</span>, hist_h, cv::NORM_MINMAX, <span class="number">-1</span>, cv::<span class="built_in">Mat</span>());</span><br><span class="line">    cv::<span class="built_in">normalize</span>(hist1, hist1, <span class="number">0</span>, hist_h, cv::NORM_MINMAX, <span class="number">-1</span>, cv::<span class="built_in">Mat</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; hsize; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::<span class="built_in">line</span>(histImage, cv::<span class="built_in">Point</span>((i - <span class="number">1</span>) * bin_w, hist_h - <span class="built_in">cvRound</span>(hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i - <span class="number">1</span>))), cv::<span class="built_in">Point</span>((i) *bin_w, hist_h - <span class="built_in">cvRound</span>(hist.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i))), cv::<span class="built_in">Scalar</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">2</span>);</span><br><span class="line">        cv::<span class="built_in">line</span>(histImage1, cv::<span class="built_in">Point</span>((i - <span class="number">1</span>) * bin_w, hist_h - <span class="built_in">cvRound</span>(hist1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i - <span class="number">1</span>))), cv::<span class="built_in">Point</span>((i) *bin_w, hist_h - <span class="built_in">cvRound</span>(hist1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i))), cv::<span class="built_in">Scalar</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, histImage);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, histImage1);</span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run4.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h2 id="直方图匹配"><a href="#直方图匹配" class="headerlink" title="直方图匹配"></a>直方图匹配</h2><p><strong>将需要处理的图像匹配另一幅直方图形状。</strong></p>
<p>由于直方图均衡化映射函数T为单调递增，即变换后的直方图可以经过逆变换回到原直方图。</p>
<p>得到直方图匹配的步骤：</p>
<ol>
<li><p>计算输入图像的直方图 $P(r)$ ，并进行直方图均衡化，得到均衡化后的灰度 $s_k$ 。</p>
</li>
<li><p>根据公式计算 $G(z_q)$ 并存储。</p>
</li>
</ol>
<p>$$<br>G(z_q) &#x3D; (L - 1)\sum_{i &#x3D; 0}^qP_z(z_j)<br>$$</p>
<ol start="3">
<li><p>对 $s_k$ 的每个值，都找到 $z_q$ 对应的值，使得 $G(z_q)$ 最接近 $s_k$ ，并存储从s到z的映射。</p>
</li>
<li><p>从步骤3中找到映射，将 $s_k$ 的值映射到直方图指定图像中值为 $z_q$ 的对应像素，形成直方图。</p>
</li>
</ol>
<p>涉及映射Look up Table（LUT）函数：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">LUT</span><span class="params">(InputArray src, InputArray lut, OutputArray dst)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：表示输入图像。</p>
</li>
<li><p>lut：表示查找表。</p>
</li>
<li><p>dst：表示输出图像。</p>
</li>
</ul>
<p>代码：white.jpg为纯白图像</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image1 = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>), image2 = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/white.jpg&quot;</span>);</span><br><span class="line">    cv::Mat image1_gray, image2_gray, hist1, hist2, image_;</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image1, image1_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line">    cv::<span class="built_in">cvtColor</span>(image2, image2_gray, cv::COLOR_BGR2GRAY);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img1_gray&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;img2_gray&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img1_gray&quot;</span>, image1_gray);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;img2_gray&quot;</span>, image2_gray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图像1和图像2进行均衡化</span></span><br><span class="line">    cv::<span class="built_in">equalizeHist</span>(image1_gray, image1_gray);</span><br><span class="line">    cv::<span class="built_in">equalizeHist</span>(image2_gray, image2_gray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 求图像1和图像2均衡化后的直方图</span></span><br><span class="line">    <span class="type">int</span> hsize = <span class="number">256</span>;</span><br><span class="line">    <span class="type">float</span> ranges[] = &#123; <span class="number">0</span>, <span class="number">256</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> *hranges = &#123; ranges &#125;;</span><br><span class="line">    cv::<span class="built_in">calcHist</span>(&amp;image1_gray, <span class="number">1</span>, <span class="number">0</span>, cv::<span class="built_in">Mat</span>(), hist1, <span class="number">1</span>, &amp;hsize, &amp;hranges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    cv::<span class="built_in">calcHist</span>(&amp;image2_gray, <span class="number">1</span>, <span class="number">0</span>, cv::<span class="built_in">Mat</span>(), hist2, <span class="number">1</span>, &amp;hsize, &amp;hranges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算两个均衡化图像直方图的累积概率</span></span><br><span class="line">    <span class="type">float</span> hist1_rate[<span class="number">256</span>] = &#123; hist1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>) &#125;;</span><br><span class="line">    <span class="type">float</span> hist2_rate[<span class="number">256</span>] = &#123; hist2.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">0</span>) &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">256</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        hist1_rate[i] = (hist1_rate[i - <span class="number">1</span>] + hist1.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i));</span><br><span class="line">        hist2_rate[i] = (hist2_rate[i - <span class="number">1</span>] + hist2.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        hist1_rate[i] /= (image1_gray.rows * image1_gray.cols);</span><br><span class="line">        hist2_rate[i] /= (image2_gray.rows * image2_gray.cols);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 两个累计概率之间的差值，用于找到最接近的点</span></span><br><span class="line">    <span class="type">float</span> diff[<span class="number">256</span>][<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i ++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j ++)</span><br><span class="line">            diff[i][j] = <span class="built_in">fabs</span>(hist1_rate[i] - hist2_rate[j]);</span><br><span class="line"></span><br><span class="line">    <span class="function">cv::Mat <span class="title">lut</span><span class="params">(<span class="number">1</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 查找源灰度级为i的映射灰度和i的累积概率差最小(灰度接近)的规定化灰度</span></span><br><span class="line">        <span class="type">float</span> min = diff[i][<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(min &gt; diff[i][j])</span><br><span class="line">            &#123;</span><br><span class="line">                min = diff[i][j];</span><br><span class="line">                idx = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        lut.<span class="built_in">at</span>&lt;uchar&gt;(i) = idx;</span><br><span class="line">    &#125;</span><br><span class="line">    cv::<span class="built_in">LUT</span>(image1_gray, lut, image_);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;image_&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;image_&quot;</span>, image_);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b2_run5.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h1 id="空间滤波基础"><a href="#空间滤波基础" class="headerlink" title="空间滤波基础"></a>空间滤波基础</h1><p><strong>讨论使用空间滤波器进行图像处理。</strong></p>
<h2 id="线性空间滤波"><a href="#线性空间滤波" class="headerlink" title="线性空间滤波"></a>线性空间滤波</h2><p><strong>线性空间滤波器在图像f和滤波器核w之间执行乘积之和运算。</strong></p>
<p>滤波器核（或称核）是一个阵列，其大小定义了运算的邻域，其系数决定了该滤波器的性质。</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_1.png" alt="使用3×3核进行线性空间滤波原理"><figcaption>使用3×3核进行线性空间滤波原理</figcaption></figure></p>
<p>在上图的任何一点(x, y)处，滤波器的响应g(x, y)是核系数与核所覆盖图像像素的乘积之和：</p>
<p>$$<br>g(x,y) &#x3D; w(-1,-1)f(x-1,y-1)+w(-1,0)f(x-1,y)+…+w(1,1)f(x+1, y+1)<br>$$</p>
<p>坐标x和y变化时，核的中心逐个像素移动，并在移动过程中生成了滤波后的图像g。</p>
<p>核中心系数w(0,0)对其于(x,y)处的像素，当大小为m×n的核，假设m&#x3D;2a+1，n&#x3D;2b+1，a和b非负。这意味着这是两个坐标方向上奇数大小的核。</p>
<p>一般而言，大小为m×n的核对大小为M×N的图像的线性空间滤波可以表示为：</p>
<p>$$<br>g(x,y) &#x3D; \sum_{s&#x3D;-a}^a\sum_{t&#x3D;-b}^bw(s,t)f(x+s,y+t)<br>$$</p>
<p>在上式中，x和y发生变化时，核的原点可以访问图像的每个像素。当x和y不变时，上式即乘积之和，只适合任意奇数大小的核。</p>
<h2 id="空间相关与卷积"><a href="#空间相关与卷积" class="headerlink" title="空间相关与卷积"></a>空间相关与卷积</h2><p>对于式子：</p>
<p>$$<br>g(x,y) &#x3D; \sum_{s&#x3D;-a}^a\sum_{t&#x3D;-b}^bw(s,t)f(x+s,y+t)<br>$$</p>
<p>化简为一维讨论：</p>
<p>$$<br>g(x) &#x3D; \sum_{s&#x3D;-a}^aw(s)f(x+s)<br>$$</p>
<p>举一个一维例子：核w为 <code>1 2 4 2 8</code></p>
<p><strong>相关</strong> 是滤波器核相对于图像的位移的函数，即相关的第一个值对应于核的零位移，第二个值对应于核的1单位位移。</p>
<p><strong>卷积</strong> 是滤波器核先进行预旋转，再进行相对于图像位移的函数。</p>
<p>①该核大小为 $1\times 5$，那么有a&#x3D;2，b&#x3D;0。</p>
<p>②w中心系数要与f的原点重合。</p>
<p>③w的一部分在f之外，求和不能运算，所以进行零补充（零补充不是唯一选择）。如果核大小为1×m，那么在两侧都需要补 $(m-1)&#x2F;2$ 个0。</p>
<p>接下来根据移动和式计算：</p>
<p>$$<br>g(x) &#x3D; \sum_{s&#x3D;-a}^aw(s)f(x+s)\<br>g(0) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+0) &#x3D; 0\<br>g(1) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+1) &#x3D; 8\<br>g(2) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+2) &#x3D; 2\<br>g(3) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+3) &#x3D; 4\<br>g(4) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+4) &#x3D; 2\<br>g(5) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+5) &#x3D; 1\<br>g(6) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+6) &#x3D; 0\<br>g(7) &#x3D; \sum_{s&#x3D;-2}^2w(s)f(s+7) &#x3D; 0\<br>$$</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_2.png"></p>
<p>另外，把一个元素是1，其余元素是0的函数称为 <strong>离散单位冲激函数</strong>。而核与离散单位冲激函数进行 <strong>相关</strong> 时，会在这个冲激的位置产生核的旋转版本。</p>
<p>广泛地说，一个函数与一个冲激进行卷积时，在冲激所在的位置产生这个函数的副本。</p>
<p>将一维推广到二维图像，对于大小为m×n的核，需要在图像的顶部核底部至少补 $(m-1)&#x2F;2$ 行0，在左侧和右侧至少补 $(n-1)&#x2F;2$ 列0。</p>
<p>假设m和n都为3：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_3.png"></p>
<p>二维下的旋转180°等效于核关于其一个轴旋转，再关于另一个轴旋转。</p>
<p>回头再看冲激函数，其坐标 $(x_0,y_0)$ 处的离散冲激强度（振幅）A定义为：</p>
<p>$$<br>δ(x-x_0,y-y_0)&#x3D;\left{<br>\begin{matrix}<br>A,&amp;x_0&#x3D;x和y_0&#x3D;y\<br>0,&amp;其他<br>\end{matrix}<br>\right.<br>$$</p>
<p><strong>小结</strong></p>
<p><strong>大小为m×n的核w与图像f(x,y)的相关：</strong></p>
<p>$$<br>w☆f(x,y)&#x3D;(w☆f)(x,y)&#x3D;\sum_{s&#x3D;-a}^a\sum_{t&#x3D;-b}^bw(s,t)f(x+s,y+t)<br>$$</p>
<p><strong>大小为m×n的核w与图像f(x,y)的卷积：</strong></p>
<p>$$<br>w★f(x,y)&#x3D;(w★f)(x,y)&#x3D;\sum_{s&#x3D;-a}^a\sum_{t&#x3D;-b}^bw(s,t)f(x-s,y-t)<br>$$</p>
<p>当卷积其中的一个函数旋转180°后，减号对应其f和w的坐标，也可以完成乘积之和处理即线性空间滤波。</p>
<p><strong>相关和卷积运算满足的性质：</strong></p>
<table>
<thead>
<tr>
<th align="center">性质</th>
<th align="center">卷积</th>
<th align="center">相关</th>
</tr>
</thead>
<tbody><tr>
<td align="center">交换律</td>
<td align="center">f★g &#x3D; g★f</td>
<td align="center">不成立</td>
</tr>
<tr>
<td align="center">结合律</td>
<td align="center">f★(g★h) &#x3D; (f★g)★h</td>
<td align="center">不成立</td>
</tr>
<tr>
<td align="center">分配律</td>
<td align="center">f★(g+h)&#x3D;(f★g)+(f★h)</td>
<td align="center">f☆(g+h)&#x3D;(f☆g)+(f☆h)</td>
</tr>
</tbody></table>
<h2 id="平滑（低通）空间滤波器"><a href="#平滑（低通）空间滤波器" class="headerlink" title="平滑（低通）空间滤波器"></a>平滑（低通）空间滤波器</h2><h3 id="盒式滤波器、均值滤波器"><a href="#盒式滤波器、均值滤波器" class="headerlink" title="盒式滤波器、均值滤波器"></a>盒式滤波器、均值滤波器</h3><p><strong>均值滤波就是将区域内的像素灰度值的平均值作为中心像素的灰度值。</strong></p>
<p>一个3×3的均值滤波器核如：</p>
<p>$$<br>\qquad 1\qquad1\qquad1\<br>\frac 19\times 1\qquad 1\qquad1\<br>\qquad 1\qquad1\qquad1<br>$$</p>
<p>OpenCV提供了一个均值滤波（盒式滤波器）函数；</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">blur</span><span class="params">(InputArray src, OutputArray dst, Size ksize, Point anchor = Point(<span class="number">-1</span>,<span class="number">-1</span>), <span class="type">int</span> borderType = BORDER_DEFAULT)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：输入图像; 它可以有任意数量的通道，这些通道是独立处理的，但深度应该是CV_8U, CV_16U, CV_16S, CV_32F或CV_64F。</p>
</li>
<li><p>dst：输出与src相同大小和类型的图像。</p>
</li>
<li><p>ksize：核大小，cv::Size类型。</p>
</li>
<li><p>anchor：锚点，默认值Point(-1，-1)表示锚点位于内核中心。</p>
</li>
<li><p>borderType：int类型，用于推断图像外部像素的某种边界模式，一般不管。</p>
</li>
</ul>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动实现盒式均值滤波器</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter</span><span class="params">(<span class="type">int</span> filter_size, cv::Mat &amp;image_input, cv::Mat &amp;image_output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    image_output = image_input.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> k = (filter_size - <span class="number">1</span>) / <span class="number">2</span>;  <span class="comment">// 实现对齐核中心元素</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; image_input.rows - k; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = k; j &lt; image_input.cols - k; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;    <span class="comment">// 计算相关</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> m = -k; m &lt; k + <span class="number">1</span>; m ++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> n = -k; n &lt; k + <span class="number">1</span>; n ++)</span><br><span class="line">                    sum += image_input.<span class="built_in">at</span>&lt;uchar&gt;(i + m, j + n);</span><br><span class="line"></span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="built_in">round</span>(sum / (filter_size * filter_size));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    cv::Mat image_output, image_output2;</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CV自带的均值滤波器，核大小为7</span></span><br><span class="line">    cv::<span class="built_in">blur</span>(image, image_output, cv::<span class="built_in">Size</span>(<span class="number">7</span>, <span class="number">7</span>));</span><br><span class="line">    <span class="comment">// 自己实现的均值滤波器，核大小为7</span></span><br><span class="line">    <span class="built_in">filter</span>(<span class="number">7</span>, image, image_output2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对比CV自带的均值滤波器与自己实现的均值滤波器性能表现</span></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after1&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after1&quot;</span>, image_output);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after2&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after2&quot;</span>, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run1.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<p>也许上述效果不明显，可以进行彩色图像，增加杂波，再进行均值滤波器处理。</p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机将n个像素值变成白点，构成噪声</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Salt</span><span class="params">(cv::Mat image, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 生成随机数</span></span><br><span class="line">    std::default_random_engine generater;</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomRow</span>(<span class="number">0</span>, image.rows - <span class="number">1</span>);</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomCol</span>(<span class="number">0</span>, image.cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k ++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = <span class="built_in">randomRow</span>(generater);</span><br><span class="line">        j = <span class="built_in">randomCol</span>(generater);</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">1</span>)</span><br><span class="line">            image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动实现均值滤波器，BGR三通道都进行均值滤波</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter</span><span class="params">(<span class="type">int</span> filter_size, cv::Mat &amp;image_input, cv::Mat &amp;image_output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    image_output = image_input.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> k = (filter_size - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; image_input.rows - k; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = k; j &lt; image_input.cols - k; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sum1 = <span class="number">0</span>, sum2 = <span class="number">0</span>, sum3 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> m = -k; m &lt; k + <span class="number">1</span>; m ++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> n = -k; n &lt; k + <span class="number">1</span>; n ++)</span><br><span class="line">                &#123;</span><br><span class="line">                    sum1 += image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">0</span>];</span><br><span class="line">                    sum2 += image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">1</span>];</span><br><span class="line">                    sum3 += image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = <span class="built_in">round</span>(sum1 / (filter_size * filter_size));</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">1</span>] = <span class="built_in">round</span>(sum2 / (filter_size * filter_size));</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">2</span>] = <span class="built_in">round</span>(sum3 / (filter_size * filter_size));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat image_output, image_output2;</span><br><span class="line">    <span class="built_in">Salt</span>(image, <span class="number">100000</span>);    <span class="comment">// 随机生成10w个白点构成噪声</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">blur</span>(image, image_output, cv::<span class="built_in">Size</span>(<span class="number">7</span>, <span class="number">7</span>));</span><br><span class="line">    <span class="built_in">filter</span>(<span class="number">7</span>, image, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after1&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after1&quot;</span>, image_output);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after2&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after2&quot;</span>, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run2.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h3 id="高斯滤波器"><a href="#高斯滤波器" class="headerlink" title="高斯滤波器"></a>高斯滤波器</h3><p>在统计学与概率论中，高斯函数是正态分布（高斯分布）的密度函数。一维的高斯表达式如下：</p>
<p>$$<br>f(x)&#x3D;ae^{-\frac{(x-μ)^2}{2σ^2}}\<br>$$<br>其中a、μ、σ为实数常数，a&gt;0；a表示曲线的高度，μ表示曲线在x轴的中心，σ与半峰全宽有关。</p>
<p>而二维高斯表达式如下：</p>
<p>$$<br>G(x,y)&#x3D;\frac{1}{2\piσ^2}e^{-\frac{-(x^2+y^2)}{2σ^2}}<br>$$</p>
<p>故高斯核为：</p>
<p>$$<br>w(s,t)&#x3D;G(s,t)&#x3D;Ke^{-\frac{s^2+t^2}{2σ^2}}\<br>G(r)&#x3D;Ke^{-\frac{r^2}{2σ^2}}，当r&#x3D;(s^2+t^2)^{\frac 12}<br>$$</p>
<p>OpenCV提供了一个高斯滤波器函数；</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">GaussianBlur</span><span class="params">( InputArray src, OutputArray dst, Size ksize, <span class="type">double</span> sigmaX, <span class="type">double</span> sigmaY = <span class="number">0</span>, <span class="type">int</span> borderType = BORDER_DEFAULT )</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：输入图像; 它可以有任意数量的通道，这些通道是独立处理的，但深度应该是CV_8U, CV_16U, CV_16S, CV_32F或CV_64F。</p>
</li>
<li><p>dst：输出与src相同大小和类型的图像。</p>
</li>
<li><p>ksize：核大小，cv::Size类型。</p>
</li>
<li><p>sigmaX：高斯核函数在X方向上的标准偏差。</p>
</li>
<li><p>sigmaY：高斯核函数在Y方向上的标准偏差。如果sigmaY为0，则将其设为sigmaX；如果sigmaX核sigmaY都为0，则有ksize.width核ksize.height计算。</p>
</li>
<li><p>borderType：int类型，用于推断图像外部像素的某种边界模式，一般不管。</p>
</li>
</ul>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机将n个像素值变成白点，构成噪声</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Salt</span><span class="params">(cv::Mat image, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 生成随机数</span></span><br><span class="line">    std::default_random_engine generater;</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomRow</span>(<span class="number">0</span>, image.rows - <span class="number">1</span>);</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomCol</span>(<span class="number">0</span>, image.cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k ++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = <span class="built_in">randomRow</span>(generater);</span><br><span class="line">        j = <span class="built_in">randomCol</span>(generater);</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">1</span>)</span><br><span class="line">            image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动实现高斯滤波器，BGR三通道都进行高斯滤波</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter1</span><span class="params">(<span class="type">int</span> filter_size, cv::Mat &amp;image_input, cv::Mat &amp;image_output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    image_output = image_input.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> k = (filter_size - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; image_input.rows - k; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = k; j &lt; image_input.cols - k; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> sum1 = <span class="number">0.0</span>, sum2 = <span class="number">0.0</span>, sum3 = <span class="number">0.0</span>;</span><br><span class="line">            <span class="type">double</span> sum1_ = <span class="number">0.0</span>, sum2_ = <span class="number">0.0</span>, sum3_ = <span class="number">0.0</span>;</span><br><span class="line">            <span class="type">double</span> sigma = <span class="number">7</span>, g;   <span class="comment">// sigma可修改</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> m = -k; m &lt; k + <span class="number">1</span>; m ++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> n = -k; n &lt; k + <span class="number">1</span>; n ++)</span><br><span class="line">                &#123;</span><br><span class="line">                    g = <span class="built_in">exp</span>(-(m * m + n * n) / (<span class="number">2</span> * sigma * sigma));</span><br><span class="line">                    sum1 += g * image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">0</span>];</span><br><span class="line">                    sum1_ += g;</span><br><span class="line">                    sum2 += g * image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">1</span>];</span><br><span class="line">                    sum2_ += g;</span><br><span class="line">                    sum3 += g * image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n)[<span class="number">2</span>];</span><br><span class="line">                    sum3_ += g;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = (<span class="type">int</span>) <span class="built_in">round</span>(sum1 / sum1_);</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">1</span>] = (<span class="type">int</span>) <span class="built_in">round</span>(sum2 / sum2_);</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">2</span>] = (<span class="type">int</span>) <span class="built_in">round</span>(sum3 / sum3_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat image_output, image_output2;</span><br><span class="line">    <span class="built_in">Salt</span>(image, <span class="number">100000</span>);    <span class="comment">// 随机生成10w个白点构成噪声</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">GaussianBlur</span>(image, image_output, cv::<span class="built_in">Size</span>(<span class="number">7</span>, <span class="number">7</span>), <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">filter1</span>(<span class="number">7</span>, image, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after1&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after1&quot;</span>, image_output);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after2&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after2&quot;</span>, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run3.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h3 id="中值滤波"><a href="#中值滤波" class="headerlink" title="中值滤波"></a>中值滤波</h3><p><strong>中值滤波就是取周围邻域像素灰度值（或GRB值）的中值作为中心像素灰度值结果。</strong></p>
<p>OpenCV提供了一个中值滤波器函数；</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">medianBlur</span><span class="params">(InputArray src, OutputArray dst, <span class="type">int</span> ksize)</span></span></span><br></pre></td></tr></table></figure></div>

<p>参数如下：</p>
<ul>
<li><p>src：输入图像; 输入1、3或4通道图像，当ksize为3或5时，图像深度应该是CV_8U、CV_16U或CV_32F，对于更大的孔径尺寸，只能是CV_8U。</p>
</li>
<li><p>dst：输出与src相同大小和类型的图像。</p>
</li>
<li><p>ksize：核大小。</p>
</li>
</ul>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 随机将n个像素值变成白点，构成噪声</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Salt</span><span class="params">(cv::Mat image, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 生成随机数</span></span><br><span class="line">    std::default_random_engine generater;</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomRow</span>(<span class="number">0</span>, image.rows - <span class="number">1</span>);</span><br><span class="line">    std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">randomCol</span>(<span class="number">0</span>, image.cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k ++)</span><br><span class="line">    &#123;</span><br><span class="line">        i = <span class="built_in">randomRow</span>(generater);</span><br><span class="line">        j = <span class="built_in">randomCol</span>(generater);</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">1</span>)</span><br><span class="line">            image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">            image.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找中值</span></span><br><span class="line"><span class="function">cv::Vec3b <span class="title">MedianFinding</span><span class="params">(cv::Mat &amp;mat, <span class="type">int</span> filter_size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Vec3b tmp;</span><br><span class="line">    cv::Vec3b m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= filter_size - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= filter_size - i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j - <span class="number">1</span>)[<span class="number">0</span>] &gt; mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j)[<span class="number">0</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                tmp = mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j - <span class="number">1</span>);</span><br><span class="line">                mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j - <span class="number">1</span>) = mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j);</span><br><span class="line">                mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(j) = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m = mat.<span class="built_in">at</span>&lt;cv::Vec3b&gt;((filter_size + <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动实现中值滤波器，BGR三通道都进行中值滤波</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter2</span><span class="params">(<span class="type">int</span> filter_size, cv::Mat &amp;image_input, cv::Mat &amp;image_output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    image_output = image_input.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> k = (filter_size - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">arry</span><span class="params">(<span class="number">1</span>, filter_size * filter_size, CV_8UC3)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; image_input.rows - k; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = k; j &lt; image_input.cols - k; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> m = -k; m &lt; k + <span class="number">1</span>; m ++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> n = -k; n &lt; k + <span class="number">1</span>; n ++)</span><br><span class="line">                &#123;</span><br><span class="line">                    arry.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(mid) = image_input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i + m, j + n);</span><br><span class="line">                    mid ++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            image_output.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j) = <span class="built_in">MedianFinding</span>(arry, filter_size * filter_size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>);</span><br><span class="line">    cv::Mat image_output, image_output2;</span><br><span class="line">    <span class="built_in">Salt</span>(image, <span class="number">100000</span>);    <span class="comment">// 随机生成10w个白点构成噪声</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">medianBlur</span>(image, image_output, <span class="number">7</span>);</span><br><span class="line">    <span class="built_in">filter2</span>(<span class="number">7</span>, image, image_output2);   <span class="comment">// 个人体验速度较慢</span></span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after1&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after1&quot;</span>, image_output);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after2&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after2&quot;</span>, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b3_run4.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h2 id="锐化（高通）空间滤波器"><a href="#锐化（高通）空间滤波器" class="headerlink" title="锐化（高通）空间滤波器"></a>锐化（高通）空间滤波器</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p><strong>锐化的作用时突出灰度中的过渡。</strong></p>
<p>平滑可以类似为积分运算，那么锐化则可以类似为微分运算。图像模糊在空间域中可以通过平均（平滑）一个邻域中的像素实现。而图像微分将会增强边缘和其他不连续（如噪声）。</p>
<p>数字函数的导数是用差分定义，一阶导数的任何定义都要满足：</p>
<ol>
<li><p>恒定灰度区域的一阶导数必须为零。</p>
</li>
<li><p>灰度台阶或斜坡开始处的一阶导数必须非零。</p>
</li>
<li><p>灰度斜坡上的一阶导数必须非零。</p>
</li>
</ol>
<p>类似有二阶导数的任何定义都要满足：</p>
<ol>
<li><p>恒定灰度区域的二阶导数必须为零。</p>
</li>
<li><p>灰度台阶或斜坡的开始处和结束处的二阶导数必须非零。</p>
</li>
<li><p>灰度斜坡上的二阶导数必须为零。</p>
</li>
</ol>
<p>而处理图像时，变化发生的最短距离也就是像素间的距离。</p>
<p>一维函数 $f(x)$ 的一阶导数的一个基本定义是差分：</p>
<p>$$<br>\frac {\mathrm{d}f}{\mathrm{d}x}&#x3D;f(x+1)-f(x)<br>$$</p>
<p>二维函数 $f(x,y)$ 的二阶导数定义为差分：</p>
<p>$$<br>\frac {\partial^2 f}{\partial x^2}&#x3D;f(x+1)+f(x-1)-2f(x)<br>$$</p>
<p>先用一维函数举例：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b4_1.png"></p>
<p>一维函数导数满足上述性质，类比一维函数可知二维函数。数字图像的边缘在灰度上通常类似于斜坡过渡，图像的一阶导数会产生较宽的边缘；另外，二阶导数会产生宽度为1像素并由零分隔的双边缘。所以， <strong>与一阶导数相比，二阶导数可增强更精细的细节，而实现二阶导数所需的运算量也更少。</strong></p>
<h3 id="拉普拉斯锐化滤波"><a href="#拉普拉斯锐化滤波" class="headerlink" title="拉普拉斯锐化滤波"></a>拉普拉斯锐化滤波</h3><p><strong>最简单的各向同性导数算子（核）是拉普拉斯。</strong> 对于两个变量的函数 $f(x,y)$ ，定义为：</p>
<p>$$<br>\nabla^2f&#x3D;\frac {\partial^2f}{\partial x^2} + \frac {\partial^2f}{\partial y^2}<br>$$</p>
<p>拉普拉斯是线性算子。在x方向有：</p>
<p>$$<br>\frac{\partial^2f}{\partial x^2}&#x3D;f(x+1,y)+f(x-1,y)-2f(x,y)<br>$$</p>
<p>在y方向有：</p>
<p>$$<br>\frac{\partial^2f}{\partial x^2}&#x3D;f(x,y+1)+f(x,y-1)-2f(x,y)<br>$$</p>
<p>由上面三个式子可得两个变量的拉普拉斯是：</p>
<p>$$<br>\nabla^2f(x,y)&#x3D;f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)<br>$$</p>
<p>该公式可以使用卷积运算，上式的拉普拉斯核为：</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">-4</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p><em>(a)</em></p>
<p>这个也叫四邻域核，还有八邻域核：</p>
<table>
<thead>
<tr>
<th align="center">1</th>
<th align="center">1</th>
<th align="center">1</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">-8</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p><em>(b)</em></p>
<p>两个其他的核（系数反转）：</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">-1</th>
<th align="center">0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">-1</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p><em>(c)</em></p>
<table>
<thead>
<tr>
<th align="center">-1</th>
<th align="center">-1</th>
<th align="center">-1</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">-1</td>
</tr>
<tr>
<td align="center">-1</td>
<td align="center">-1</td>
<td align="center">-1</td>
</tr>
</tbody></table>
<p><em>(d)</em></p>
<p>但是不能直接使用拉普拉斯，它会突出图像中急剧灰度过渡，不强调缓慢变化的灰度区域，往往会产生具有灰色边缘线核其他不连续的图像。所以需要 <strong>将拉普拉斯图像和原图像相加恢复背景特征</strong>。</p>
<p>使用拉普拉斯锐化图像：</p>
<p>$$<br>g(x,y)&#x3D;f(x,y)+c[\nabla^2f(x,y)]<br>$$</p>
<p>f(x,y)为输入图像，g(x,y)为锐化后图像。若使用核(a)或核(b)，取c&#x3D;-1；若使用核(c)或核(d)，取c&#x3D;1。</p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 四邻域拉普拉斯核</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter_4</span><span class="params">(cv::Mat &amp;input, cv::Mat &amp;output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    output = input.<span class="built_in">clone</span>();</span><br><span class="line">	<span class="type">int</span> la;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; input.rows - <span class="number">1</span>; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; input.cols - <span class="number">1</span>; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">            la = input.<span class="built_in">at</span>&lt;uchar&gt;(i + <span class="number">1</span>, j) + input.<span class="built_in">at</span>&lt;uchar&gt;(i - <span class="number">1</span>, j)</span><br><span class="line">                + input.<span class="built_in">at</span>&lt;uchar&gt;(i, j + <span class="number">1</span>) + input.<span class="built_in">at</span>&lt;uchar&gt;(i, j - <span class="number">1</span>)</span><br><span class="line">                - <span class="number">4</span> * input.<span class="built_in">at</span>&lt;uchar&gt;(i, j);</span><br><span class="line">            output.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = cv::<span class="built_in">saturate_cast</span>&lt;uchar&gt;(output.<span class="built_in">at</span>&lt;uchar&gt;(i, j) - la);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 八邻域拉普拉斯核</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">filter_8</span><span class="params">(cv::Mat &amp;input, cv::Mat &amp;output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    output = input.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="type">int</span> la;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; input.rows - <span class="number">1</span>; i ++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; input.cols - <span class="number">1</span>; j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            la = input.<span class="built_in">at</span>&lt;uchar&gt;(i - <span class="number">1</span>, j - <span class="number">1</span>) + input.<span class="built_in">at</span>&lt;uchar&gt;(i - <span class="number">1</span>, j) +</span><br><span class="line">                input.<span class="built_in">at</span>&lt;uchar&gt;(i - <span class="number">1</span>, j + <span class="number">1</span>) + input.<span class="built_in">at</span>&lt;uchar&gt;(i, j - <span class="number">1</span>) +</span><br><span class="line">                input.<span class="built_in">at</span>&lt;uchar&gt;(i, j + <span class="number">1</span>) + input.<span class="built_in">at</span>&lt;uchar&gt;(i + <span class="number">1</span>, j - <span class="number">1</span>) +</span><br><span class="line">                input.<span class="built_in">at</span>&lt;uchar&gt;(i + <span class="number">1</span>, j) + input.<span class="built_in">at</span>&lt;uchar&gt;(i + <span class="number">1</span>, j + <span class="number">1</span>) -</span><br><span class="line">                <span class="number">8</span> * input.<span class="built_in">at</span>&lt;uchar&gt;(i, j);</span><br><span class="line">            output.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = cv::<span class="built_in">saturate_cast</span>&lt;uchar&gt;(output.<span class="built_in">at</span>&lt;uchar&gt;(i, j) - la);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    cv::Mat image_output, image_output2;</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">filter_4</span>(image, image_output);</span><br><span class="line">    <span class="built_in">filter_8</span>(image, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after1&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after1&quot;</span>, image_output);</span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after2&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;after2&quot;</span>, image_output2);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>拉普拉斯锐化滤波对于灰度图像的影响十分明显，但是对于彩色图像影响一般。如果想改为适用于彩色图像，只需将数据类型从 <code>uchar</code> 改为 <code>cv::Vec2b</code>。</p>
<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b4_run1.jpg" alt="效果展示"><figcaption>效果展示</figcaption></figure></p>
<h3 id="一阶导数锐化——梯度"><a href="#一阶导数锐化——梯度" class="headerlink" title="一阶导数锐化——梯度"></a>一阶导数锐化——梯度</h3><p>一阶导数是用梯度幅度实现。图像f在坐标(x,y)处的梯度定义为二维列向量：</p>
<p>$$<br>\nabla f\equiv grad(f)&#x3D;\left[\begin{matrix}g_x \ g_y\end{matrix}\right]&#x3D;\left[\begin{matrix}\partial f&#x2F;\partial x \ \partial f&#x2F;\partial y\end{matrix}\right]<br>$$</p>
<p>这个向量指向f的最大变化率方向。</p>
<p>向量 $\nabla f$ 的幅度（长度）表示为M(x,y)（有时候用 $\vert\vert\nabla f\vert\vert$ ），其中</p>
<p>$$<br>M(x,y)&#x3D;\vert\vert\nabla f\vert\vert&#x3D;mag(\nabla f)&#x3D;\sqrt{g_x^2+g_y^2}<br>$$</p>
<p>是梯度向量方向的变化率在(x,y)处的值，方向为：</p>
<p>$$<br>\alpha(x,y)&#x3D;\tan^{-1}\left[\begin{matrix}\frac{g_y(x,y)}{g_x(x,y)}\end{matrix}\right]<br>$$<br>而M(x,y)是与原图像大小相同的图像，也称为梯度图像。</p>
<p>梯度常用于检测边缘，在边缘检测会详细介绍。</p>
<h1 id="频率域滤波"><a href="#频率域滤波" class="headerlink" title="频率域滤波"></a>频率域滤波</h1><h2 id="傅里叶变换"><a href="#傅里叶变换" class="headerlink" title="傅里叶变换"></a>傅里叶变换</h2><h3 id="傅里叶级数"><a href="#傅里叶级数" class="headerlink" title="傅里叶级数"></a>傅里叶级数</h3><p><strong>傅里叶级数：任何周期函数都可表示为不同频率的正弦函数和或余弦函数和，其中每个正弦函数和或余弦函数和都有不同的系数。</strong></p>
<p>$$<br>f(t)&#x3D;\sum_{n&#x3D;-\infty}^\infty c_ne^{j\frac {2\pi n}{T}t}<br>$$</p>
<p>其中，</p>
<p>$$<br>c_n&#x3D;\frac 1T\int_{-T&#x2F;2}^{T&#x2F;2}f(t)e^{-j\frac {2\pi n}{T}t}dt,n&#x3D;0,\pm 1,\pm 2,…<br>$$</p>
<p>是系数。此篇j表示虚数单位： $j^2&#x3D;-1$ 。</p>
<h3 id="傅里叶变换-1"><a href="#傅里叶变换-1" class="headerlink" title="傅里叶变换"></a>傅里叶变换</h3><p><strong>傅里叶变换：（曲线下方面积有限的）非周期函数也能用正弦函数和&#x2F;或余弦函数乘以加权函数的积分来表示</strong></p>
<p>这表明用傅里叶级数或变换表示的函数可由逆过程完全重建（复原），而不丢失信息；允许我们工作在傅里叶域，然后返回到函数的原始域中，而不会丢失任何信息。</p>
<p>计算机慢慢出现了快速傅里叶变换算法（FFT），使用FFT进行频率域处理比不可分离核的空间域处理要快。</p>
<h3 id="冲激函数及其取样（筛选）性质"><a href="#冲激函数及其取样（筛选）性质" class="headerlink" title="冲激函数及其取样（筛选）性质"></a>冲激函数及其取样（筛选）性质</h3><p>连续变量t在t&#x3D;0处的单位冲激表示为 $\delta(t)$ ，其定义为：</p>
<p>$$<br>\delta(t)&#x3D;\begin{cases}<br>\infty,&amp;t&#x3D;0\<br>0, &amp;t\neq 0<br>\end{cases}<br>$$</p>
<p>该定义被限制满足：</p>
<p>$$<br>\int_{-\infty}^{\infty}\delta(t)dt&#x3D;1<br>$$</p>
<p>当t解释为时间时，冲激可视作幅度为无线、持续时间为0、具有单位面积的尖峰信号。</p>
<p>冲激具有关于积分的所谓 <strong>取样性质</strong> ：</p>
<p>$$<br>\int_{-\infty}^{\infty}f(t)\delta(t)dt&#x3D;f(0)<br>$$</p>
<p>对其一般化，任意一点 $t_0$ 的冲激表示为 $\delta(t-t_0)$ ，有：</p>
<p>$$<br>\int_{-\infty}^{\infty}f(t)\delta(t-t_0)dt&#x3D;f(t_0)<br>$$</p>
<p>举一个小例子，取 $f(t)&#x3D;\cos(t)$ ，则使用冲激 $\delta(t-\pi)$ 得到取样 $f(\pi)&#x3D;\cos(\pi)&#x3D;-1$ 。</p>
<p>冲激串则是无穷多个冲激 $\Delta T$ 单位的和：</p>
<p>$$<br>s_{\Delta T}(t)&#x3D;\sum_{k&#x3D;-\infty}^{\infty}\delta(t-k\Delta T)<br>$$</p>
<p>单位离散冲激 $\delta(x)$ 在离散系统的作用域处理连续变量时冲激 $\delta(t)$ 作用相同，定义为：</p>
<p>$$<br>\delta(x)&#x3D;\begin{cases}<br>1,&amp;x&#x3D;0\<br>0, &amp;x\neq 0<br>\end{cases}<br>$$</p>
<p>该定义被限制的离散等效形式为：</p>
<p>$$<br>\sum_{x&#x3D;-\infty}^{\infty}\delta(x) &#x3D; 1<br>$$</p>
<p>离散变量的取样性质的形式为：</p>
<p>$$<br>\sum_{x&#x3D;-\infty}^{\infty}f(x)\delta(x)&#x3D;f(0)<br>$$</p>
<p>一般式为：</p>
<p>$$<br>\sum_{x&#x3D;-\infty}^{\infty}f(x)\delta(x-x_0)&#x3D;f(x_0)<br>$$</p>
<p><strong>小结：</strong></p>
<table>
<thead>
<tr>
<th align="center">项</th>
<th align="center">连续变量t</th>
<th align="center">离散变量x</th>
</tr>
</thead>
<tbody><tr>
<td align="center">在0处的单位冲激</td>
<td align="center">$\delta(t)&#x3D;\begin{cases}\infty,&amp;t&#x3D;0\0, &amp;t\neq 0\end{cases}$</td>
<td align="center">$\delta(x)&#x3D;\begin{cases}1,&amp;x&#x3D;0\0, &amp;x\neq 0\end{cases}$</td>
</tr>
<tr>
<td align="center">单位冲激满足</td>
<td align="center">$\int_{-\infty}^{\infty}\delta(t)dt&#x3D;1$</td>
<td align="center">$\sum_{x&#x3D;-\infty}^{\infty}\delta(x) &#x3D; 1$</td>
</tr>
<tr>
<td align="center">取样性质</td>
<td align="center">$\int_{-\infty}^{\infty}f(t)\delta(t)dt&#x3D;f(0)$</td>
<td align="center">$\sum_{x&#x3D;-\infty}^{\infty}f(x)\delta(x)&#x3D;f(0)$</td>
</tr>
<tr>
<td align="center">取样性质一般化</td>
<td align="center">$\int_{-\infty}^{\infty}f(t)\delta(t-t_0)dt&#x3D;f(t_0)$</td>
<td align="center">$\sum_{x&#x3D;-\infty}^{\infty}f(x)\delta(x-x_0)&#x3D;f(x_0)$</td>
</tr>
</tbody></table>
<p>冲激串： </p>
<p>$$s_{\Delta T}(t)&#x3D;\sum_{k&#x3D;-\infty}^{\infty}\delta(t-k\Delta T)<br>$$</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_1.png"></p>
<h3 id="连续单变量函数的傅里叶变换"><a href="#连续单变量函数的傅里叶变换" class="headerlink" title="连续单变量函数的傅里叶变换"></a>连续单变量函数的傅里叶变换</h3><p>连续变量t的连续函数f(t)的傅里叶变换 $\Im{f(t)}$ 表示，它定义为：</p>
<p>$$<br>\Im{f(t)}&#x3D;\int_{-\infty}^{\infty}f(t)e^{-j2\pi \mu t}dt<br>$$</p>
<p>上式中， $\mu$ 为连续变量，积分变量为t，所以 $\Im{f(t)}$ 只是 $\mu$ 的函数，即 $\Im{f(t)}&#x3D;F(\mu)$ ，所以 $f(t)$ 的傅里叶变换也可以写为：</p>
<p>$$<br>F(\mu)&#x3D;\int_{-\infty}^{\infty}f(t)e^{-j2\pi \mu t}dt \quad ①<br>$$</p>
<p>相反，已知 $F(\mu)$ 是可以通过傅里叶反变换得到 $f(t)$ ，为：</p>
<p>$$<br>f(t)&#x3D;\int_{-\infty}^{\infty}F(\mu)e^{j2\pi \mu t}dt\quad ②<br>$$</p>
<p>称①式和②式共同构成傅里叶变换对，通常表示为 $f(t) \Leftrightarrow F(\mu)$ 。双箭头表明傅里叶正变换得到右侧表达式，而左侧表达式是取右侧表达式的傅里叶反变换得到。</p>
<p>利用欧拉公式 $e^{j\theta}&#x3D;\cos\theta+j\sin\theta$ ，将式①变成</p>
<p>$$<br>F(\mu)&#x3D;\int_{-\infty}^{\infty}f(t)[\cos(2\pi\mu t)-j\sin(2\pi\mu t)]dt<br>$$</p>
<p>可以看到，如果f(t)为实数，则变换通常是复数。傅里叶变换式f(t)乘以正弦函数的展开式，而其中正弦函数的频率由 $\mu$ 值决定。因此积分后留下的唯一变量是频率，故称傅里叶变换域是频率域。</p>
<p>讨论中， $t$ 可以表示任何连续变量，并且频率变量 $\mu$ 的单位取决于 $t$ 的单位。</p>
<p>举个例子：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_2.png" alt="简单连续函数的傅里叶变换"><figcaption>简单连续函数的傅里叶变换</figcaption></figure></p>
<p>对盒式函数进行傅里叶变换，有</p>
<p>$$<br>F(\mu)&#x3D;\int_{-\infty}^{\infty}f(t)e^{-j2\pi\mu t}dt&#x3D;\int_{-W&#x2F;2}^{W&#x2F;2}Ae^{-j2\pi\mu t}dt\<br>&#x3D;\frac {-A}{j2\pi\mu}\Big[e^{-j2\pi\mu t}\Big]^{W&#x2F;2}_{-W&#x2F;2}&#x3D;\frac {-A}{j2\pi\mu}\Big[e^{-j\pi\mu W}-e^{j\pi\mu W}\Big]\<br>&#x3D;\frac {A}{j2\pi\mu}\Big[e^{j\pi\mu W}-e^{-j\pi\mu W}\Big]&#x3D;AW\frac {\sin(\pi\mu W)}{\pi\mu W}<br>$$</p>
<p>上式用到了 $\sin\theta&#x3D;(e^{j\theta}-e^{-j\theta})&#x2F;2j$</p>
<p>傅里叶变换中包含复数项，这是为了显示变换的幅值（一个实量）的一种约定。这个幅值称为傅里叶频谱或频谱：</p>
<p>$$<br>\vert F(\mu)\vert&#x3D;AW\vert\frac{\sin(\pi\mu W)}{\pi\mu W}\vert<br>$$</p>
<p>$F(\mu)$ 与频率的关系曲线如下：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_3.png"></p>
<p>该曲线的关键性质：</p>
<ol>
<li><p>$F(\mu)$ 和 $\vert F(\mu)\vert$ 的零值都与盒式函数的宽度W成反比；</p>
</li>
<li><p>到原点的距离越大，旁瓣的高度随到原点的举例增加而减小；</p>
</li>
<li><p>函数向μ的正负方向无限扩展。</p>
</li>
</ol>
<p>再举一个冲激傅里叶变换的例子。</p>
<p>位于原点的单位冲激的傅里叶变换由上面式①得：</p>
<p>$$<br>\Im {\delta(t)}&#x3D;F(\mu)&#x3D;\int_{-\infty}^{\infty}f(t)e^{-j2\pi \mu t}dt&#x3D;\int_{\infty}^{\infty}\delta(t)e^{-j2\pi\mu t}dt&#x3D;e^{-j2\pi\mu_0}&#x3D;e^0&#x3D;1<br>$$</p>
<p>这就是空间域原点位置的一个冲激的傅里叶变换，在频率域中是一个常数。</p>
<p>当 $t&#x3D;t_0$ 处一个冲击傅里叶变换是：</p>
<p>$$<br>\Im {\delta(t)}&#x3D;F(\mu)&#x3D;\int_{\infty}^{\infty}\delta(t-t_0)e^{-j2\pi\mu t}dt&#x3D;\int_{-\infty}^{\infty}e^{-j2\pi\mu t}\delta(t-t_0)dt&#x3D;e^{-j2\pi\mu t_0}<br>$$</p>
<p>上式使用了取样一般化性质。 $e^{-j2\pi\mu t_0}$ 表示中心在复平面原点的一个单位圆。</p>
<p>观察式①式②</p>
<p>$$<br>F(\mu)&#x3D;\int_{-\infty}^{\infty}f(t)e^{-j2\pi \mu t}dt \<br>f(t)&#x3D;\int_{-\infty}^{\infty}F(\mu)e^{j2\pi \mu t}dt\quad<br>$$</p>
<p>发现只有指数符号不同。因此如果函数f(t)有傅里叶变换F(μ)，那么求该函数在点t的值F(t)时，一定有变换f(-μ)。利用这种对称性质，将冲激 $\delta(t-t_0)$ 的傅里叶变换 $e^{-j2\pi\mu t_0}$ 得到函数 $e^{-j2\pi\mu t_0}$ 的变换为 $\delta(-\mu-t_0)$ 。令 $-t_0&#x3D;a$ ，可得 $e^{j2\pi a t}$ 的变换是 $\delta(-\mu+a)&#x3D;\delta(\mu+a)$</p>
<p>冲激串 $s_{\Delta T}(t)$ 是周期为 $\Delta T$ 的周期函数：</p>
<p>$$<br>s_{\Delta T}(t)&#x3D;\sum_{k&#x3D;-\infty}^{\infty}\delta(t-k\Delta T)<br>$$</p>
<p>因此可以表示为傅里叶级数：</p>
<p>$$<br>s_{\Delta T}(t)&#x3D;\sum_{k&#x3D;-\infty}^{\infty}c_ne^{j\frac{2\pi n}{\Delta T}t},\<br>c_n&#x3D;\frac{1}{\Delta T}\int_{-\Delta T&#x2F;2}^{\Delta T&#x2F;2}S_{\Delta T}(t)e^{-j\frac{2\pi n}{\Delta T}t}dt<br>$$</p>
<p>由于区间 $\big[-\Delta T&#x2F;2,\Delta T&#x2F;2\big]$ 上积分仅包含原点的冲激，故上式简化为：</p>
<p>$$<br>c_n&#x3D;\frac{1}{\Delta T}\int_{-\Delta T&#x2F;2}^{\Delta T&#x2F;2}\delta(t)e^{-j\frac{2\pi n}{\Delta T}t}dt&#x3D;\frac{1}{\Delta T}e^0&#x3D;\frac{1}{\Delta T}<br>$$</p>
<p>于是傅里叶级数变成：</p>
<p>$$<br>s_{\Delta T}(t)&#x3D;\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}e^{j\frac{2\pi n}{\Delta T}t}<br>$$</p>
<p>由 $\Im {\delta(t-t_0)}&#x3D;e^{-j2\pi\mu t_0}$ ，得到：</p>
<p>$$<br>\Im {e^{j\frac{2\pi n}{\Delta T}t}}&#x3D;\delta(\mu-\frac{n}{\Delta T})<br>$$</p>
<p>再由于和的傅里叶变换等于各分量的傅里叶变换之和，所以周期冲激串的傅里叶变换 $S(\mu)$ 是：</p>
<p>$$<br>\tilde{S}(\mu)&#x3D;\Im{s_{\Delta T}(t)}&#x3D;\Im{\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}e^{j\frac{2\pi n}{\Delta T}t}}&#x3D;\frac{1}{\Delta T}\Im{\sum_{n&#x3D;-\infty}^{\infty}e^{j\frac{2\pi n}{\Delta T}t}}&#x3D;\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}\delta(\mu-\frac{n}{\Delta T})<br>$$</p>
<p>上述结果可得，周期为 $\Delta T$ 的冲激串的傅里叶变换仍然是冲激串，其周期变为 $1&#x2F;\Delta T$。 </p>
<h3 id="傅里叶变换与卷积"><a href="#傅里叶变换与卷积" class="headerlink" title="傅里叶变换与卷积"></a>傅里叶变换与卷积</h3><p><strong>卷积：空间域中两个函数的卷积的傅里叶变换，等于频率域中两个函数的傅里叶变换的乘积。</strong></p>
<p>设f(t)和h(t)为两个连续函数，F(t)和H(t)为f(t)和h(t)的傅里叶变换，则有：</p>
<p>$$<br>(f★h)(t)\Leftrightarrow(H\cdot F)(\mu)\<br>(f\cdot h)(t)\Leftrightarrow(H★F)(\mu)<br>$$</p>
<h3 id="取样和取样函数的傅里叶变换"><a href="#取样和取样函数的傅里叶变换" class="headerlink" title="取样和取样函数的傅里叶变换"></a>取样和取样函数的傅里叶变换</h3><p><strong>取样：对连续函数转换为一系列的离散值。</strong></p>
<p>$$<br>\tilde{f}(t)&#x3D;f(t)s_{\Delta T}(t)&#x3D;\sum_{n&#x3D;-\infty}^{\infty}f(t)\delta(t-n\Delta T)<br>$$</p>
<p>$$<br>f_k&#x3D;\int_{-\infty}^{\infty}f(t)\delta(t-k\Delta T)dt&#x3D;f(k\Delta T)<br>$$</p>
<p>对取样后的函数 $\tilde{f}(t)$ 的傅里叶变换 $\tilde{F}(\mu)$ 是：</p>
<p>$$<br>\tilde{F}(\mu)&#x3D;\Im{\tilde{f}(t)}&#x3D;\Im{f(t)s_{\Delta T}(t)}&#x3D;(F★S)(\mu)<br>$$</p>
<p>其中， $S(\mu)$ 是冲激串的傅里叶变换：</p>
<p>$$<br>S(\mu)&#x3D;\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}\delta(\mu-\frac{n}{\Delta T})<br>$$</p>
<p>直接得 $F(\mu)$ 和 $S(\mu)$ 的卷积：</p>
<p>$$<br>\tilde{F}(\mu)&#x3D;(F★S)(\mu)&#x3D;\int_{-\infty}^{\infty}F(\tau)S(\mu-\tau)d\tau\<br>&#x3D;\frac{1}{\Delta T}\int_{-\infty}^{\infty}F(\tau)\sum_{n&#x3D;-\infty}^{\infty}\delta\big(\mu-\tau-\frac{n}{\Delta T}\big)d\tau\<br>&#x3D;\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}\int_{-\infty}^{\infty}F(\tau)\delta\big(\mu-\tau-\frac{n}{\Delta T}\big)d\tau\<br>&#x3D;\frac{1}{\Delta T}\sum_{n&#x3D;-\infty}^{\infty}F(\mu-\frac{n}{\Delta T})<br>$$</p>
<h3 id="单变量离散傅里叶变换DFT"><a href="#单变量离散傅里叶变换DFT" class="headerlink" title="单变量离散傅里叶变换DFT"></a>单变量离散傅里叶变换DFT</h3><p><strong>一维离散傅里叶变换：</strong></p>
<p>$$<br>F_m&#x3D;\sum_{n&#x3D;0}^{M-1}f_ne^{-j2\pi mn&#x2F;M},m&#x3D;0,1,2…,M-1<br>$$</p>
<p><strong>一维离散傅里叶逆变换：</strong></p>
<p>$$<br>f_n&#x3D;\frac{1}{M}\sum_{m&#x3D;0}^{M-1}F_me^{j2\pi mn&#x2F;M},n&#x3D;0,1,2…,M-1<br>$$</p>
<h3 id="二变量离散傅里叶变换"><a href="#二变量离散傅里叶变换" class="headerlink" title="二变量离散傅里叶变换"></a>二变量离散傅里叶变换</h3><p><strong>二维离散傅里叶变换：</strong></p>
<p>$$<br>F(\mu,\nu)&#x3D;\sum_{x&#x3D;0}^{M-1}\sum_{y&#x3D;0}^{N-1}f(x,y)e^{-j2\pi(\mu x&#x2F;M+\nu y&#x2F;N)}<br>$$</p>
<p><strong>二维离散傅里叶逆变换：</strong></p>
<p>$$<br>f(x,y)&#x3D;\frac{1}{MN}\sum_{x&#x3D;0}^{M-1}\sum_{y&#x3D;0}^{N-1}F(\mu,\nu)e^{j2\pi(\mu x&#x2F;M+\nu y&#x2F;N)}<br>$$</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>先了解以下函数：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getOptimalDFTSize</span><span class="params">(<span class="type">int</span> vecsize)</span></span></span><br></pre></td></tr></table></figure></div>

<p>vecsize为向量尺寸大小，该函数用于返回给定向量尺寸经过DFT变换后结果的最优尺寸大小。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyMakeBorder</span><span class="params">(InputArray src, OutputArray dst, <span class="type">int</span> top, <span class="type">int</span> bottom, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> borderType, <span class="type">const</span> Scalar&amp; value = Scalar())</span></span></span><br></pre></td></tr></table></figure></div>

<p>该函数用于扩充图像边界，参数如下：</p>
<ul>
<li><p>src：输入图像；</p>
</li>
<li><p>dst：输出与输入图像相同类型图像；</p>
</li>
<li><p>top、bottom、left、right：在图像的四个方向上扩充像素值；</p>
</li>
<li><p>borderType：边界类型，常见取值为BORDER_CONSTANT；</p>
</li>
<li><p>value：边界类型为BORDER_CONSTANT时表示边界值。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dft</span><span class="params">(InputArray src, OutputArray dst, <span class="type">int</span> flags = <span class="number">0</span>, <span class="type">int</span> nonzeroRows = <span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure></div>

<p>该函数为OpenCV提供的傅里叶变换函数，参数如下：</p>
<ul>
<li><p>src：输入图像；</p>
</li>
<li><p>dst：输出图像；</p>
</li>
<li><p>flags：转换标识符，默认为0。也有以下取值，DFT_INVERSE（用一维或二维逆变换取代默认的正向变换）、DFT_SCALE（缩放比例标识符，根据数据元素个数平均求出缩放结果）、DFT_ROWS（对输入矩阵的每行进行正向或反向傅里叶变换）、DFT_COMPLEX_OUTPUT（对一维或二维实数数组进行正向变换，结果是复数阵列，是默认）、DFT_REAL_OUTPUT（对一维或二维复数数组进行逆向变换）；</p>
</li>
<li><p>nonzeroRows：当其不为0时函数会假设输入数组（没有设置DFT_INVERSE）的第一行或第一个输出数组（设置了DFT_INVERSE）包含非零值。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">magnitude</span><span class="params">(InputArray x, InputArray y, OutputArray magnitude)</span></span></span><br></pre></td></tr></table></figure></div>

<p>该函数用于计算二维矢量的幅值，参数如下：</p>
<ul>
<li><p>x：浮点型数组的x坐标矢量，即实部；</p>
</li>
<li><p>y：浮点型数组的y坐标矢量，必须和x尺寸相同；</p>
</li>
<li><p>magnitude：与x类型和尺寸相同的输出数组；</p>
</li>
</ul>
<p>其计算公式为：</p>
<p>$$<br>dst(I)&#x3D;\sqrt{x(I)^2+y(I)^2}<br>$$</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_img)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 拓展图像矩阵，为2，3，5的倍数时运算速度快</span></span><br><span class="line">    <span class="type">int</span> m = cv::<span class="built_in">getOptimalDFTSize</span>(input.rows);</span><br><span class="line">    <span class="type">int</span> n = cv::<span class="built_in">getOptimalDFTSize</span>(input.cols);</span><br><span class="line">    cv::<span class="built_in">copyMakeBorder</span>(input, input, <span class="number">0</span>, m - input.rows, <span class="number">0</span>, n - input.cols, cv::BORDER_CONSTANT, cv::Scalar::<span class="built_in">all</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建planes存储复数的实部和虚部</span></span><br><span class="line">    cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(input), cv::Mat::<span class="built_in">zeros</span>(input.<span class="built_in">size</span>(),CV_32F) &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从多个单通道数组中创建一个多通道数组trf_img。</span></span><br><span class="line">    <span class="comment">// 函数Merge将几个数组合并为一个多通道阵列，即输出数组的每个元素将是输入数组元素的级联</span></span><br><span class="line">    cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_img);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进行傅里叶变换</span></span><br><span class="line">    cv::<span class="built_in">dft</span>(trf_img, trf_img);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将trf_img拆分到planes数组</span></span><br><span class="line">    cv::<span class="built_in">split</span>(trf_img, planes);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算复数的幅值，即频谱图，保存在output</span></span><br><span class="line">    cv::<span class="built_in">magnitude</span>(planes[<span class="number">0</span>], planes[<span class="number">1</span>], output);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 赋值计算过大，进行处理</span></span><br><span class="line">    output += cv::<span class="built_in">Scalar</span>(<span class="number">1</span>);    <span class="comment">//像素加一防止log(0)</span></span><br><span class="line">    <span class="built_in">log</span>(output, output);    <span class="comment">// 进行对数运算</span></span><br><span class="line">    cv::<span class="built_in">normalize</span>(output, output, <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);   <span class="comment">// 归一化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 剪切和重分布幅度图像限</span></span><br><span class="line">    output = <span class="built_in">output</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, output.cols &amp; <span class="number">-2</span>, output.rows &amp; <span class="number">-2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新排列傅里叶图像中的象限，使原点位于图像中心</span></span><br><span class="line">    <span class="type">int</span> cx = output.cols / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> cy = output.rows / <span class="number">2</span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">q0</span><span class="params">(output, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">q1</span><span class="params">(output, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">q2</span><span class="params">(output, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;</span><br><span class="line">    <span class="function">cv::Mat <span class="title">q3</span><span class="params">(output, cv::Rect(cx, cy, cx, cy))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 交换象限中心化</span></span><br><span class="line">    cv::Mat tmp;</span><br><span class="line">    q0.<span class="built_in">copyTo</span>(tmp); q3.<span class="built_in">copyTo</span>(q0); tmp.<span class="built_in">copyTo</span>(q3);</span><br><span class="line">    q1.<span class="built_in">copyTo</span>(tmp); q2.<span class="built_in">copyTo</span>(q1); tmp.<span class="built_in">copyTo</span>(q2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cv::Mat image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    cv::Mat image_output, image_trf;</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;灰度图&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;灰度图&quot;</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DFT</span>(image, image_output, image_trf);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;频谱图&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">    cv::<span class="built_in">imshow</span>(<span class="string">&quot;频谱图&quot;</span>, image_output);</span><br><span class="line"></span><br><span class="line">    cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b5_run.jpg"></p>
<h2 id="频谱图"><a href="#频谱图" class="headerlink" title="频谱图"></a>频谱图</h2><p>频谱图有以下规律：</p>
<ol>
<li><p>频谱图从中心点到四周，频率越来越大；</p>
</li>
<li><p>频谱图中心点一般最亮，与原图像平均亮度相关；</p>
</li>
<li><p>频率域滤波就是改变频谱图中高频率或者低频率的值.</p>
</li>
<li><p>频谱图中的点关于中心点对称，对称的两点表示某个频率的波。</p>
</li>
<li><p>两个对称点离中心点的距离代表频率的高低，离中心点越远代表的频率越高。</p>
</li>
<li><p>两个对称点的亮度表示波的幅值，越亮幅值越大。</p>
</li>
<li><p>图像中，低频率代表灰度变化缓慢的信息；高频率代表变化剧烈的信息，如边缘及噪声等。在6中，低频区越亮代表变化缓慢的区域较多，高频区越亮代表图像细节很多。</p>
</li>
<li><p>对称点所在直线的方向为波的方向，与原图中对应的线性信息垂直。如下图，图中有一组平行的线，在频谱图垂直方向也有一条较亮的线（可用于方向滤波，增强或者滤除某个方向的线性特征）。</p>
</li>
</ol>
<h2 id="频率域滤波之低通滤波"><a href="#频率域滤波之低通滤波" class="headerlink" title="频率域滤波之低通滤波"></a>频率域滤波之低通滤波</h2><h3 id="理想低通滤波"><a href="#理想低通滤波" class="headerlink" title="理想低通滤波"></a>理想低通滤波</h3><p><strong>通过设置频率半径，半径内的频率大小不变，半径外的频率置为0，保留了低频区，滤除了高频区。</strong></p>
<p>传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;<br>\begin{cases}<br>1,\quad D(u,v)\leq D_0\<br>0, \quad D(u,v)&gt;D_0<br>\end{cases}<br>$$</p>
<p>其中， $D_0$ 是一个正常数， $D(u,v)$ 是频率域中点(u,v)到P×Q频率矩形中心的距离， $D(u,v)&#x3D;[(u-P&#x2F;2)^2+(v-Q&#x2F;2)^2]^{1&#x2F;2}$ 。</p>
<p>理想低通滤波器由于进行傅里叶变换和傅里叶逆变换时的差异，会导致振铃效应，一般很少使用。</p>
<p><em>振铃效应：指输出图像的灰度剧烈变化处产生的震荡，就好像钟被敲击后产生的空气震荡</em></p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">Salt</span>(image, <span class="number">100000</span>);	<span class="comment">// 添加100k个噪点</span></span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 理想低通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">120</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">			<span class="keyword">if</span> ((i - cx) * (i - cx) + (j - cy) * (j - cy) &gt; r * r)</span><br><span class="line">			&#123;</span><br><span class="line">				trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="number">0</span>;</span><br><span class="line">				trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>为了更好的效果，手动添加噪声：</p>
<div class="highlight-container" data-rel="H"><figure class="iseeu highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Salt.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Salt</span><span class="params">(cv::Mat input, <span class="type">int</span> n)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 噪声文件Salt.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Salt</span><span class="params">(cv::Mat input, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::default_random_engine generator;</span><br><span class="line">	std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">row</span>(<span class="number">0</span>, input.rows - <span class="number">1</span>);</span><br><span class="line">	std::uniform_int_distribution&lt;<span class="type">int</span>&gt;<span class="built_in">col</span>(<span class="number">0</span>, input.cols - <span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k ++)</span><br><span class="line">	&#123;</span><br><span class="line">		i = <span class="built_in">row</span>(generator);</span><br><span class="line">		j = <span class="built_in">col</span>(generator);</span><br><span class="line">		<span class="keyword">if</span> (input.<span class="built_in">channels</span>() == <span class="number">1</span>)</span><br><span class="line">			input.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (input.<span class="built_in">channels</span>() == <span class="number">3</span>)</span><br><span class="line">			input.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(i, j) = cv::<span class="built_in">Vec3b</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>对图像傅里叶变换：</p>
<div class="highlight-container" data-rel="H"><figure class="iseeu highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 扩展图像，优化速度</span></span><br><span class="line">	<span class="type">int</span> n = cv::<span class="built_in">getOptimalDFTSize</span>(input.rows);</span><br><span class="line">	<span class="type">int</span> m = cv::<span class="built_in">getOptimalDFTSize</span>(input.cols);</span><br><span class="line">	cv::<span class="built_in">copyMakeBorder</span>(input, input, <span class="number">0</span>, n - input.rows, <span class="number">0</span>, m - input.cols, cv::BORDER_CONSTANT, cv::Scalar::<span class="built_in">all</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用于存储傅里叶变换的实部和虚部</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(input), cv::Mat::<span class="built_in">zeros</span>(input.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">dft</span>(trf_arr, trf_arr);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_arr, planes);</span><br><span class="line">	cv::Mat trf_img_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_img_imag = planes[<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 计算复数的幅值，保存在output中</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(planes[<span class="number">0</span>], planes[<span class="number">1</span>], output);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 优化幅值大小</span></span><br><span class="line">	output += cv::<span class="built_in">Scalar</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">log</span>(output, output);</span><br><span class="line">	cv::<span class="built_in">normalize</span>(output, output, <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	output = <span class="built_in">output</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, output.cols &amp; <span class="number">-2</span>, output.rows &amp; <span class="number">-2</span>));</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = output.cols / <span class="number">2</span>, cy = output.rows / <span class="number">2</span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q0</span><span class="params">(output, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span>, <span class="title">q1</span><span class="params">(output, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q2</span><span class="params">(output, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span>, <span class="title">q3</span><span class="params">(output, cv::Rect(cx, cy, cx, cy))</span></span>;</span><br><span class="line">	cv::Mat tmp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 交换区域使得原点位于中心</span></span><br><span class="line">	q0.<span class="built_in">copyTo</span>(tmp); q3.<span class="built_in">copyTo</span>(q0); tmp.<span class="built_in">copyTo</span>(q3);</span><br><span class="line">	q1.<span class="built_in">copyTo</span>(tmp); q2.<span class="built_in">copyTo</span>(q1); tmp.<span class="built_in">copyTo</span>(q2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的实数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q00</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q01</span><span class="params">(trf_img_real, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q02</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q03</span><span class="params">(trf_img_real, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q00.<span class="built_in">copyTo</span>(tmp); q03.<span class="built_in">copyTo</span>(q00); tmp.<span class="built_in">copyTo</span>(q03);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q01.<span class="built_in">copyTo</span>(tmp); q02.<span class="built_in">copyTo</span>(q01); tmp.<span class="built_in">copyTo</span>(q02);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的虚数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q10</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q11</span><span class="params">(trf_img_imag, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q12</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q13</span><span class="params">(trf_img_imag, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q10.<span class="built_in">copyTo</span>(tmp); q13.<span class="built_in">copyTo</span>(q10); tmp.<span class="built_in">copyTo</span>(q13);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q11.<span class="built_in">copyTo</span>(tmp); q12.<span class="built_in">copyTo</span>(q11); tmp.<span class="built_in">copyTo</span>(q12);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_img_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_img_imag;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);	<span class="comment">// 将傅里叶变换的复数结果保存在trf_arr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run.jpg" alt="r=120"><figcaption>r=120</figcaption></figure></p>
<h3 id="高斯低通滤波"><a href="#高斯低通滤波" class="headerlink" title="高斯低通滤波"></a>高斯低通滤波</h3><p>高斯低通滤波器的传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;e^{-D^2(u,v)&#x2F;2\sigma^2}<br>$$</p>
<p>其中， $D(u,v)$ 是P×Q频率矩形中心到矩形中包含的任意一点(u,v)的距离，令 $\sigma&#x3D;D_0$ ，</p>
<p>$$<br>H(u,v)&#x3D;e^{-D^2(u,v)&#x2F;2D_0^2}<br>$$</p>
<p>那么 $D_0$ 是截止频率（设置半径）。当 $D(u,v)&#x3D;D_0$ 时，高斯低通滤波器传递函数下降到其最大值1.0的0.607。</p>
<p>由于高斯函数的傅里叶变换还是高斯函数，所以高斯低通滤波器没有振铃效应。</p>
<p>代码：</p>
<p><code>DFT.h</code>、<code>DFT.cpp</code>、<code>Salt.h</code>、<code>Salt.cpp</code>同上。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">Salt</span>(image, <span class="number">100000</span>);	<span class="comment">// 添加100k个噪点</span></span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 高斯低通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">80</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	<span class="type">float</span> h;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			h = <span class="built_in">exp</span>(-((i - cx) * (i - cx) + (j - cy) * (j - cy)) / (<span class="number">2.0</span> * r * r));</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run2.jpg" alt="r=80"><figcaption>r=80</figcaption></figure></p>
<h3 id="巴特沃斯低通滤波"><a href="#巴特沃斯低通滤波" class="headerlink" title="巴特沃斯低通滤波"></a>巴特沃斯低通滤波</h3><p>巴特沃斯低通滤波器的传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;\frac {1}{1+[D(u,v)&#x2F;D_0]^{2n}}<br>$$</p>
<p>其中， $D(u,v)$ 是P×Q频率矩形中心到矩形中包含的任意一点(u,v)的距离， $D_0$ 是截止频率（设置半径）， $n$ 是巴特沃斯滤波器的阶数。</p>
<p>1阶巴特沃斯滤波器既没有振铃效应也没有负值；2阶巴特沃斯滤波器有轻微振铃效应和较小的负值，但比理想低通滤波器好；高阶巴特沃斯滤波器具有非常明显的振铃效应。2阶和3阶的巴特沃斯滤波器较为合适。</p>
<p>代码：</p>
<p><code>DFT.h</code>、<code>DFT.cpp</code>、<code>Salt.h</code>、<code>Salt.cpp</code>同上。</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">Salt</span>(image, <span class="number">100000</span>);	<span class="comment">// 添加100k个噪点</span></span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 巴特沃斯低通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">120</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	<span class="type">float</span> h;</span><br><span class="line">	<span class="type">float</span> n = <span class="number">3</span>;	<span class="comment">// 巴特沃斯滤波器阶数</span></span><br><span class="line">	<span class="type">float</span> d;		<span class="comment">// 任意点到中心的距离</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">			h = <span class="number">1.0</span> / (<span class="number">1</span> + <span class="built_in">pow</span>((d / (r * r)), <span class="number">2</span> * n));</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b6_run3.jpg" alt="r=120,n=3"><figcaption>r=120,n=3</figcaption></figure></p>
<h2 id="频率域滤波之高通滤波"><a href="#频率域滤波之高通滤波" class="headerlink" title="频率域滤波之高通滤波"></a>频率域滤波之高通滤波</h2><h3 id="理想高通滤波"><a href="#理想高通滤波" class="headerlink" title="理想高通滤波"></a>理想高通滤波</h3><p><strong>通过设置频率半径，半径外的频率大小不变，半径内的频率置为0，保留了高频区，滤除了低频区。</strong></p>
<p>而边缘和其他灰度的急剧变化与高频分量有关，故高通滤波器可以实现边缘锐化。</p>
<p>传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;<br>\begin{cases}<br>0,\quad D(u,v)\leq D_0\<br>1, \quad D(u,v)&gt;D_0<br>\end{cases}<br>$$</p>
<p>其中， $D_0$ 是一个正常数， $D(u,v)$ 是频率域中点(u,v)到P×Q频率矩形中心的距离， $D(u,v)&#x3D;[(u-P&#x2F;2)^2+(v-Q&#x2F;2)^2]^{1&#x2F;2}$ 。</p>
<p>代码（DFT代码文件见最后）：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 理想高通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">120</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">			<span class="keyword">if</span> ((i - cx) * (i - cx) + (j - cy) * (j - cy) &lt; r * r)</span><br><span class="line">			&#123;</span><br><span class="line">				trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="number">0</span>;</span><br><span class="line">				trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run.jpg" alt="r=120"><figcaption>r=120</figcaption></figure></p>
<h3 id="高斯高通滤波"><a href="#高斯高通滤波" class="headerlink" title="高斯高通滤波"></a>高斯高通滤波</h3><p>高斯低通滤波器的传递函数为：</p>
<p>$$<br>H_{LP}(u,v)&#x3D;e^{-D^2(u,v)&#x2F;2\sigma^2}<br>$$</p>
<p>则高斯高通滤波器传递函数为： </p>
<p>$$<br>H_{HP}&#x3D;1-H_{LP}(u,v)&#x3D;1-e^{-D^2(u,v)&#x2F;2D_0^2}<br>$$</p>
<p>其中， $D(u,v)$ 为中心点到任一点的距离， $D_0$ 为设置半径。</p>
<p>代码（DFT代码文件见最后）：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 高斯高通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">120</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	<span class="type">float</span> h, d;		<span class="comment">// h 为计算量，d 为到中心点的距离</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">			h = <span class="number">1</span> - <span class="built_in">exp</span>(-d / (<span class="number">2.0</span> * r * r));</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run1.jpg" alt="r=120"><figcaption>r=120</figcaption></figure></p>
<h3 id="巴特沃斯高通滤波"><a href="#巴特沃斯高通滤波" class="headerlink" title="巴特沃斯高通滤波"></a>巴特沃斯高通滤波</h3><p>巴特沃斯高铁滤波器的传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;\frac {1}{1+[D_0&#x2F;D(u,v)]^{2n}}<br>$$</p>
<p>其中， $D(u,v)$ 是P×Q频率矩形中心到矩形中包含的任意一点(u,v)的距离， $D_0$ 是截止频率（设置半径）， $n$ 是巴特沃斯滤波器的阶数。</p>
<p>代码（DFT代码文件见最后）：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 巴特沃斯高通滤波</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">120</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	<span class="type">float</span> h, d;		<span class="comment">// h 为计算量，d为到中心点的距离</span></span><br><span class="line">	<span class="type">float</span> n = <span class="number">3</span>;	<span class="comment">// 巴特沃斯滤波器阶数</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">			h = <span class="number">1.0</span> / (<span class="number">1</span> + <span class="built_in">pow</span>(((r * r) / d), <span class="number">2</span> * n));</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run2.jpg" alt="r=120,n=3"><figcaption>r=120,n=3</figcaption></figure></p>
<h3 id="拉普拉斯滤波"><a href="#拉普拉斯滤波" class="headerlink" title="拉普拉斯滤波"></a>拉普拉斯滤波</h3><p>频率域中拉普拉斯滤波传递函数为：</p>
<p>$$<br>H(u,v)&#x3D;-4\pi^2(u^2+v^2)&#x3D;-4\pi^2[(u-P&#x2F;2)^2+(v-Q&#x2F;2)^2]&#x3D;-4\pi^2D^2(u,v)<br>$$</p>
<p>其中， $D(u,v)$ 为中心点到任一点的距离。</p>
<p>具体增强实现：</p>
<p>$$<br>g(x,y)&#x3D;f(x,y)+c\nabla^2f(x,y),\nabla^2f(x,y)&#x3D;\Im^{-1}[H(u,v)F(u,v)]<br>$$</p>
<p>其中， $F(u,v)$ 是 $f(x,y)$ 的傅里叶变换。</p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*————————————————————————————拉普拉斯滤波————————————————————————————*/</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">float</span> h, d;		<span class="comment">// h 为计算量，d为到中心点的距离</span></span><br><span class="line">	<span class="type">float</span> pi = <span class="number">3.1415926</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">			h = <span class="number">-4</span> * pi * pi * d;</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*————————————————————————————标记，实现g(x,y)————————————————————————————*/</span></span><br><span class="line">	iDft[<span class="number">0</span>].<span class="built_in">convertTo</span>(iDft[<span class="number">0</span>], CV_8U, <span class="number">255</span> / <span class="number">1.0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="function">cv::Mat <span class="title">result</span><span class="params">(iDft[<span class="number">0</span>].size(), CV_8U)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; iDft[<span class="number">0</span>].rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; iDft[<span class="number">0</span>].cols; j ++)</span><br><span class="line">			result.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = cv::<span class="built_in">saturate_cast</span>&lt;uchar&gt;(image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) + iDft[<span class="number">0</span>].<span class="built_in">at</span>&lt;uchar&gt;(i, j));</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;result&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;result&quot;</span>, result);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run3.jpg"></p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b7_run3_1.jpg" alt="标定到原图，即g(x,y)"><figcaption>标定到原图，即g(x,y)</figcaption></figure></p>
<h3 id="高频强调滤波器"><a href="#高频强调滤波器" class="headerlink" title="高频强调滤波器"></a>高频强调滤波器</h3><p>还可以设置可调参数，进行调整影响。高频强调滤波的通用公式是：</p>
<p>$$<br>g(x,y)&#x3D;\Im^{-1}\bigg{\big[k_1+k_2H_{HP}\big]F(u,v)\bigg}<br>$$</p>
<p>其中， $k_1\geq0$ 偏移传递函数的值，以便使直流项不为零， $k_2&gt;0$ 控制高频的贡献， $H_{HP}$ 为高通滤波器传递函数， $F(u,v)$ 为图像 $f(u,v)$ 的傅里叶变换。 </p>
<p>部分代码示例：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">	&#123;</span><br><span class="line">		d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">		<span class="comment">// 高斯高频强调滤波器</span></span><br><span class="line">		h = <span class="number">0.5</span> + <span class="number">0.75</span> * (<span class="number">1</span> - <span class="built_in">exp</span>(-d / (<span class="number">2.0</span> * r * r)));</span><br><span class="line">		trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<hr>
<p><strong>附DFT代码</strong></p>
<div class="highlight-container" data-rel="H"><figure class="iseeu highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 扩展图像，优化速度</span></span><br><span class="line">	<span class="type">int</span> n = cv::<span class="built_in">getOptimalDFTSize</span>(input.rows);</span><br><span class="line">	<span class="type">int</span> m = cv::<span class="built_in">getOptimalDFTSize</span>(input.cols);</span><br><span class="line">	cv::<span class="built_in">copyMakeBorder</span>(input, input, <span class="number">0</span>, n - input.rows, <span class="number">0</span>, m - input.cols, cv::BORDER_CONSTANT, cv::Scalar::<span class="built_in">all</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用于存储傅里叶变换的实部和虚部</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(input), cv::Mat::<span class="built_in">zeros</span>(input.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">dft</span>(trf_arr, trf_arr);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_arr, planes);</span><br><span class="line">	cv::Mat trf_img_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_img_imag = planes[<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 计算复数的幅值，保存在output中</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(planes[<span class="number">0</span>], planes[<span class="number">1</span>], output);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 优化幅值大小</span></span><br><span class="line">	output += cv::<span class="built_in">Scalar</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">log</span>(output, output);</span><br><span class="line">	cv::<span class="built_in">normalize</span>(output, output, <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	output = <span class="built_in">output</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, output.cols &amp; <span class="number">-2</span>, output.rows &amp; <span class="number">-2</span>));</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = output.cols / <span class="number">2</span>, cy = output.rows / <span class="number">2</span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q0</span><span class="params">(output, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span>, <span class="title">q1</span><span class="params">(output, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q2</span><span class="params">(output, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span>, <span class="title">q3</span><span class="params">(output, cv::Rect(cx, cy, cx, cy))</span></span>;</span><br><span class="line">	cv::Mat tmp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 交换区域使得原点位于中心</span></span><br><span class="line">	q0.<span class="built_in">copyTo</span>(tmp); q3.<span class="built_in">copyTo</span>(q0); tmp.<span class="built_in">copyTo</span>(q3);</span><br><span class="line">	q1.<span class="built_in">copyTo</span>(tmp); q2.<span class="built_in">copyTo</span>(q1); tmp.<span class="built_in">copyTo</span>(q2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的实数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q00</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q01</span><span class="params">(trf_img_real, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q02</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q03</span><span class="params">(trf_img_real, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q00.<span class="built_in">copyTo</span>(tmp); q03.<span class="built_in">copyTo</span>(q00); tmp.<span class="built_in">copyTo</span>(q03);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q01.<span class="built_in">copyTo</span>(tmp); q02.<span class="built_in">copyTo</span>(q01); tmp.<span class="built_in">copyTo</span>(q02);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的虚数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q10</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q11</span><span class="params">(trf_img_imag, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q12</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q13</span><span class="params">(trf_img_imag, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q10.<span class="built_in">copyTo</span>(tmp); q13.<span class="built_in">copyTo</span>(q10); tmp.<span class="built_in">copyTo</span>(q13);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q11.<span class="built_in">copyTo</span>(tmp); q12.<span class="built_in">copyTo</span>(q11); tmp.<span class="built_in">copyTo</span>(q12);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_img_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_img_imag;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);	<span class="comment">// 将傅里叶变换的复数结果保存在trf_arr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="同态滤波"><a href="#同态滤波" class="headerlink" title="同态滤波"></a>同态滤波</h2><p><strong>通过一个滤波器传递函数H(u,v)，使用不同可控方法影响低频分量和高频分量。</strong></p>
<h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p><strong>图像f(x,y)可以表示为其照射分量i(x,y)和反射分量r(x,y)的乘积。</strong></p>
<p><strong>图像中，认为低频分量与照射分量相联系，高频分量与反射分量相联系。</strong></p>
<p>$$<br>f(x,y)&#x3D;i(x,y)r(x,y)<br>$$</p>
<p><strong>乘积的傅里叶变换不是傅里叶变换的乘积。</strong></p>
<p>$$<br>\Im [f(x,y)] \neq \Im[i(x,y)]\Im[r(x,y)]<br>$$</p>
<p>故令 $z(x,y)&#x3D;\ln f(x,y)&#x3D;\ln i(x,y)+\ln r(x,y)$ ，有</p>
<p>$$<br>\Im[z(x,y)]&#x3D;\Im[\ln f(x,y)]&#x3D;\Im[\ln i(x,y)]+\Im[\ln r(x,y)]<br>$$</p>
<p>$$<br>Z(u,v)&#x3D;F_i(u,v)+F_r(u,v)<br>$$</p>
<p>其中， $F_i(u,v)$ 和 $F_r(x,y)$ 分别是 $\ln i(x,y)$ 和 $\ln r(x,y)$ 的傅里叶变换。</p>
<p>使用滤波器传递函数 $H(u,v)$ 对 $Z(u,v)$ 滤波，有</p>
<p>$$<br>S(u,v)&#x3D;H(u,v)Z(u,v)&#x3D;H(u,v)F_i(u,v)+H(u,v)F_r(u,v)<br>$$</p>
<p>空间域中滤波后的图像是</p>
<p>$$<br>s(x,y)&#x3D;\Im^{-1}[S(u,v)]&#x3D;\Im^{-1}[H(u,v)F_i(u,v)]+\Im^{-1}[H(u,v)F_r(u,v)]<br>$$</p>
<p>最后通过取滤波后的结果的指数形成输出图像</p>
<p>$$<br>g(x,y)&#x3D;e^{s(x,y)}&#x3D;e^{\Im^{-1}[H(u,v)F_i(u,v)]}e^{\Im^{-1}[H(u,v)F_r(u,v)]}<br>$$</p>
<p>记 </p>
<p>$$<br>i_0(x,y)&#x3D;e^{i’(x,y)}&#x3D;e^{\Im^{-1}[H(u,v)F_i(u,v)]}<br>$$</p>
<p>为输出图像的照射分量，</p>
<p>记<br>$$<br>r_0(x,y)&#x3D;e^{r’(x,y)}&#x3D;e^{\Im^{-1}[H(u,v)F_r(u,v)]}<br>$$</p>
<p>为输出图像的反射分量。</p>
<p>上述滤波方法过程如下图：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_1.png" alt="同态滤波步骤"><figcaption>同态滤波步骤</figcaption></figure></p>
<h3 id="以高斯高通滤波器举例"><a href="#以高斯高通滤波器举例" class="headerlink" title="以高斯高通滤波器举例"></a>以高斯高通滤波器举例</h3><p>一般高斯高通滤波器函数：</p>
<p>$$<br>H(u,v)&#x3D;1-e^{-D^2(u,v)&#x2F;2D^2_0}<br>$$</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_2.png" alt="函数图像"><figcaption>函数图像</figcaption></figure></p>
<p>使用稍微变化的GHPF（Gaussian high-pass filter）：</p>
<p>$$<br>H(u,v)&#x3D;(\gamma_H-\gamma_L)\big[1-e^{-cD^2(u,v)&#x2F;D_0^2}\big]+\gamma_L<br>$$</p>
<p>其中，$D(u,v)$ 为中心点到任一点的距离， $D_0$ 为设置半径， $\gamma_L$ 和 $\gamma_H$ 为规定频率范围，常数c控制函数的偏斜度，类似于高频强调函数。</p>
<p>变化后的GHPF图像如下：</p>
<p><figure class="image-caption"><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_3.png" alt="函数图像"><figcaption>函数图像</figcaption></figure></p>
<p>明显地，减少了低频分量的影响，增加了高频分量的影响。</p>
<p>代码：</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cv::Mat image, output, trf;</span><br><span class="line">	image = cv::<span class="built_in">imread</span>(<span class="string">&quot;src/test.jpg&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;before&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;before&quot;</span>, image);	<span class="comment">// 显示原图</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ——————————对数变换—————————— */</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">image_</span><span class="params">(image.size(), CV_32F)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image.cols; j ++)</span><br><span class="line">			image_.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) = <span class="built_in">log</span>(image.<span class="built_in">at</span>&lt;uchar&gt;(i, j) + <span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">DFT</span>(image_, output, trf);	<span class="comment">// 对图像进行傅里叶变换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* ——————————滤波—————————— */</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">split</span>(trf, planes);	<span class="comment">//分离通道，获取实部虚部</span></span><br><span class="line"></span><br><span class="line">	cv::Mat trf_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_imag = planes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = trf_real.rows / <span class="number">2</span>;	<span class="comment">// 求中心坐标x</span></span><br><span class="line">	<span class="type">int</span> cy = trf_real.cols / <span class="number">2</span>;	<span class="comment">// 求中心坐标y</span></span><br><span class="line">	<span class="type">int</span> r = <span class="number">10</span>;	<span class="comment">// 滤波半径</span></span><br><span class="line">	<span class="type">float</span> h, d;		<span class="comment">// h 为计算量，d 为到中心点的距离</span></span><br><span class="line">	<span class="type">float</span> rh = <span class="number">3</span>, rl = <span class="number">0.5</span>, c = <span class="number">5</span>;	<span class="comment">// 高频点、低频点、c值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; trf_real.rows; i ++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; trf_real.cols; j ++)</span><br><span class="line">		&#123;</span><br><span class="line">			d = (i - cx) * (i - cx) + (j - cy) * (j - cy);</span><br><span class="line">			h = (rh - rl) * (<span class="number">1</span> - <span class="built_in">exp</span>(-c * d / (r * r))) + rl;</span><br><span class="line">			trf_real.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">			trf_imag.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(i, j) *= h;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_imag;</span><br><span class="line">	cv::Mat trf_ilpf;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_ilpf);</span><br><span class="line"></span><br><span class="line">	cv::Mat iDft[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(output), cv::Mat::<span class="built_in">zeros</span>(output.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line">	cv::<span class="built_in">idft</span>(trf_ilpf, trf_ilpf);	<span class="comment">// 傅里叶逆变换</span></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_ilpf, iDft);		<span class="comment">// 分离通道</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(iDft[<span class="number">0</span>], iDft[<span class="number">1</span>], iDft[<span class="number">0</span>]);	<span class="comment">//计算复数的幅值，保存在iDft[0]</span></span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* ——————————指数恢复数值并归一化—————————— */</span></span><br><span class="line">	cv::<span class="built_in">exp</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">normalize</span>(iDft[<span class="number">0</span>], iDft[<span class="number">0</span>], <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	iDft[<span class="number">0</span>].<span class="built_in">convertTo</span>(iDft[<span class="number">0</span>], CV_8U, <span class="number">255</span> / <span class="number">1.0</span>, <span class="number">0</span>);</span><br><span class="line">	cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;after&quot;</span>, cv::WINDOW_NORMAL);</span><br><span class="line">	cv::<span class="built_in">imshow</span>(<span class="string">&quot;after&quot;</span>, iDft[<span class="number">0</span>]);</span><br><span class="line">	cv::<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>效果展示：</p>
<p><img src="https://fblog-img.oss-cn-hangzhou.aliyuncs.com/blog/opencv_b8_run.jpg"></p>
<hr>
<div class="highlight-container" data-rel="H"><figure class="iseeu highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DFT.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFT.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(cv::Mat input, cv::Mat&amp; output, cv::Mat&amp; trf_arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 扩展图像，优化速度</span></span><br><span class="line">	<span class="type">int</span> n = cv::<span class="built_in">getOptimalDFTSize</span>(input.rows);</span><br><span class="line">	<span class="type">int</span> m = cv::<span class="built_in">getOptimalDFTSize</span>(input.cols);</span><br><span class="line">	cv::<span class="built_in">copyMakeBorder</span>(input, input, <span class="number">0</span>, n - input.rows, <span class="number">0</span>, m - input.cols, cv::BORDER_CONSTANT, cv::Scalar::<span class="built_in">all</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用于存储傅里叶变换的实部和虚部</span></span><br><span class="line">	cv::Mat planes[] = &#123; cv::<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(input), cv::Mat::<span class="built_in">zeros</span>(input.<span class="built_in">size</span>(), CV_32F) &#125;;</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);</span><br><span class="line">	</span><br><span class="line">	cv::<span class="built_in">dft</span>(trf_arr, trf_arr);</span><br><span class="line"></span><br><span class="line">	cv::<span class="built_in">split</span>(trf_arr, planes);</span><br><span class="line">	cv::Mat trf_img_real = planes[<span class="number">0</span>];</span><br><span class="line">	cv::Mat trf_img_imag = planes[<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 计算复数的幅值，保存在output中</span></span><br><span class="line">	cv::<span class="built_in">magnitude</span>(planes[<span class="number">0</span>], planes[<span class="number">1</span>], output);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 优化幅值大小</span></span><br><span class="line">	output += cv::<span class="built_in">Scalar</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">log</span>(output, output);</span><br><span class="line">	cv::<span class="built_in">normalize</span>(output, output, <span class="number">0</span>, <span class="number">1</span>, cv::NORM_MINMAX);</span><br><span class="line"></span><br><span class="line">	output = <span class="built_in">output</span>(cv::<span class="built_in">Rect</span>(<span class="number">0</span>, <span class="number">0</span>, output.cols &amp; <span class="number">-2</span>, output.rows &amp; <span class="number">-2</span>));</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cx = output.cols / <span class="number">2</span>, cy = output.rows / <span class="number">2</span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q0</span><span class="params">(output, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span>, <span class="title">q1</span><span class="params">(output, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;</span><br><span class="line">	<span class="function">cv::Mat <span class="title">q2</span><span class="params">(output, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span>, <span class="title">q3</span><span class="params">(output, cv::Rect(cx, cy, cx, cy))</span></span>;</span><br><span class="line">	cv::Mat tmp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 交换区域使得原点位于中心</span></span><br><span class="line">	q0.<span class="built_in">copyTo</span>(tmp); q3.<span class="built_in">copyTo</span>(q0); tmp.<span class="built_in">copyTo</span>(q3);</span><br><span class="line">	q1.<span class="built_in">copyTo</span>(tmp); q2.<span class="built_in">copyTo</span>(q1); tmp.<span class="built_in">copyTo</span>(q2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的实数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q00</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q01</span><span class="params">(trf_img_real, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q02</span><span class="params">(trf_img_real, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q03</span><span class="params">(trf_img_real, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q00.<span class="built_in">copyTo</span>(tmp); q03.<span class="built_in">copyTo</span>(q00); tmp.<span class="built_in">copyTo</span>(q03);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q01.<span class="built_in">copyTo</span>(tmp); q02.<span class="built_in">copyTo</span>(q01); tmp.<span class="built_in">copyTo</span>(q02);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 复数的虚数部分交换</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q10</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 左上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q11</span><span class="params">(trf_img_imag, cv::Rect(cx, <span class="number">0</span>, cx, cy))</span></span>;		<span class="comment">// 右上区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q12</span><span class="params">(trf_img_imag, cv::Rect(<span class="number">0</span>, cy, cx, cy))</span></span>;		<span class="comment">// 左下区域</span></span><br><span class="line">	<span class="function">cv::Mat <span class="title">q13</span><span class="params">(trf_img_imag, cv::Rect(cx, cy, cx, cy))</span></span>;	<span class="comment">// 右下区域</span></span><br><span class="line">	q10.<span class="built_in">copyTo</span>(tmp); q13.<span class="built_in">copyTo</span>(q10); tmp.<span class="built_in">copyTo</span>(q13);		<span class="comment">//左上与右下进行交换</span></span><br><span class="line">	q11.<span class="built_in">copyTo</span>(tmp); q12.<span class="built_in">copyTo</span>(q11); tmp.<span class="built_in">copyTo</span>(q12);		<span class="comment">//右上与左下进行交换</span></span><br><span class="line"></span><br><span class="line">	planes[<span class="number">0</span>] = trf_img_real;</span><br><span class="line">	planes[<span class="number">1</span>] = trf_img_imag;</span><br><span class="line">	cv::<span class="built_in">merge</span>(planes, <span class="number">2</span>, trf_arr);	<span class="comment">// 将傅里叶变换的复数结果保存在trf_arr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/C/">#C++</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/OpenCV/">#OpenCV</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                        rel="next"
                        href="/%E7%BB%8F%E9%AA%8C%E4%B9%8B%E8%B0%88/cpproad/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">个人整理的C++学习路线</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">OpenCV基础入门教程</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Visual-Studio2022%E9%85%8D%E7%BD%AEOpencCV"><span class="nav-text">Visual Studio2022配置OpencCV</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDOpenCV%E5%B9%B6%E5%AE%89%E8%A3%85"><span class="nav-text">下载OpenCV并安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VS%E4%B8%AD%E9%85%8D%E7%BD%AEOpenCV"><span class="nav-text">VS中配置OpenCV</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95OpenCV"><span class="nav-text">测试OpenCV</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenCV%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">OpenCV的基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E3%80%81%E6%98%BE%E7%A4%BA%E3%80%81%E5%86%99%E5%85%A5%E5%9B%BE%E5%83%8F"><span class="nav-text">读取、显示、写入图像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="nav-text">相关函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E3%80%81%E6%98%BE%E7%A4%BA%E3%80%81%E5%86%99%E5%85%A5%E8%A7%86%E9%A2%91"><span class="nav-text">读取、显示、写入视频</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="nav-text">相关概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%A4%84%E7%90%86"><span class="nav-text">图像的基本处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%A9%BA%E7%99%BD%E5%9B%BE%E5%83%8F"><span class="nav-text">创建空白图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%83%8F%E4%BF%A1%E6%81%AF"><span class="nav-text">获取图像信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E8%AE%B0%E5%8C%BA%E5%9F%9F"><span class="nav-text">标记区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E5%9B%BE%E5%83%8F"><span class="nav-text">遍历图像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%9B%BE%E5%85%A5%E9%97%A8"><span class="nav-text">绘图入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BB%98%E5%88%B6"><span class="nav-text">静态绘制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BC%A0%E6%A0%87%E7%BB%98%E5%88%B6"><span class="nav-text">鼠标绘制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%81%B0%E5%BA%A6%E5%8F%98%E6%8D%A2"><span class="nav-text">灰度变换</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%81%B0%E5%BA%A6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86"><span class="nav-text">灰度变换原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%81%B0%E5%BA%A6%E5%8F%8D%E8%BD%AC"><span class="nav-text">灰度反转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%95%B0%E5%8F%98%E6%8D%A2"><span class="nav-text">对数变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%82%E5%BE%8B%EF%BC%88%E4%BC%BD%E9%A9%AC%E5%8F%98%E6%8D%A2%EF%BC%89"><span class="nav-text">幂律（伽马变换）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%A4%84%E7%90%86"><span class="nav-text">直方图处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E7%9B%B4%E6%96%B9%E5%9B%BE"><span class="nav-text">图像直方图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96"><span class="nav-text">直方图均衡化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%8C%B9%E9%85%8D"><span class="nav-text">直方图匹配</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2%E5%9F%BA%E7%A1%80"><span class="nav-text">空间滤波基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2"><span class="nav-text">线性空间滤波</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E7%9B%B8%E5%85%B3%E4%B8%8E%E5%8D%B7%E7%A7%AF"><span class="nav-text">空间相关与卷积</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E6%BB%91%EF%BC%88%E4%BD%8E%E9%80%9A%EF%BC%89%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-text">平滑（低通）空间滤波器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%92%E5%BC%8F%E6%BB%A4%E6%B3%A2%E5%99%A8%E3%80%81%E5%9D%87%E5%80%BC%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-text">盒式滤波器、均值滤波器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-text">高斯滤波器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E5%80%BC%E6%BB%A4%E6%B3%A2"><span class="nav-text">中值滤波</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%90%E5%8C%96%EF%BC%88%E9%AB%98%E9%80%9A%EF%BC%89%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-text">锐化（高通）空间滤波器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-text">基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E9%94%90%E5%8C%96%E6%BB%A4%E6%B3%A2"><span class="nav-text">拉普拉斯锐化滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E9%98%B6%E5%AF%BC%E6%95%B0%E9%94%90%E5%8C%96%E2%80%94%E2%80%94%E6%A2%AF%E5%BA%A6"><span class="nav-text">一阶导数锐化——梯度</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A2%91%E7%8E%87%E5%9F%9F%E6%BB%A4%E6%B3%A2"><span class="nav-text">频率域滤波</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="nav-text">傅里叶变换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0"><span class="nav-text">傅里叶级数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2-1"><span class="nav-text">傅里叶变换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%B2%E6%BF%80%E5%87%BD%E6%95%B0%E5%8F%8A%E5%85%B6%E5%8F%96%E6%A0%B7%EF%BC%88%E7%AD%9B%E9%80%89%EF%BC%89%E6%80%A7%E8%B4%A8"><span class="nav-text">冲激函数及其取样（筛选）性质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E7%BB%AD%E5%8D%95%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="nav-text">连续单变量函数的傅里叶变换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E4%B8%8E%E5%8D%B7%E7%A7%AF"><span class="nav-text">傅里叶变换与卷积</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%A0%B7%E5%92%8C%E5%8F%96%E6%A0%B7%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="nav-text">取样和取样函数的傅里叶变换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%8F%98%E9%87%8F%E7%A6%BB%E6%95%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2DFT"><span class="nav-text">单变量离散傅里叶变换DFT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E5%8F%98%E9%87%8F%E7%A6%BB%E6%95%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="nav-text">二变量离散傅里叶变换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E8%B0%B1%E5%9B%BE"><span class="nav-text">频谱图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E7%8E%87%E5%9F%9F%E6%BB%A4%E6%B3%A2%E4%B9%8B%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">频率域滤波之低通滤波</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E6%83%B3%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">理想低通滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">高斯低通滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B4%E7%89%B9%E6%B2%83%E6%96%AF%E4%BD%8E%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">巴特沃斯低通滤波</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%91%E7%8E%87%E5%9F%9F%E6%BB%A4%E6%B3%A2%E4%B9%8B%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">频率域滤波之高通滤波</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E6%83%B3%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">理想高通滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">高斯高通滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B4%E7%89%B9%E6%B2%83%E6%96%AF%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2"><span class="nav-text">巴特沃斯高通滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E6%BB%A4%E6%B3%A2"><span class="nav-text">拉普拉斯滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E5%BC%BA%E8%B0%83%E6%BB%A4%E6%B3%A2%E5%99%A8"><span class="nav-text">高频强调滤波器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%80%81%E6%BB%A4%E6%B3%A2"><span class="nav-text">同态滤波</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-text">基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E9%AB%98%E6%96%AF%E9%AB%98%E9%80%9A%E6%BB%A4%E6%B3%A2%E5%99%A8%E4%B8%BE%E4%BE%8B"><span class="nav-text">以高斯高通滤波器举例</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-regular fa-computer-classic"></i>&nbsp;&nbsp;<a href="/">Fingsinz</a>
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>






    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
