<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-loading-bar.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fingsinz.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="计算机网络：网络层">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-网络层">
<meta property="og:url" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="Fingsinz&#39;s space">
<meta property="og:description" content="计算机网络：网络层">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E5%90%84%E7%B1%BBIP%E5%9C%B0%E5%9D%80.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8C%BA%E5%88%AB.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E9%A6%96%E9%83%A8%E6%A3%80%E9%AA%8C%E5%92%8C%E8%AE%A1%E7%AE%97.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E4%BE%8B%E5%AD%90.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/ICMP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/ICMP%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%9F%BA%E6%9C%AC%E9%A6%96%E9%83%A8.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E7%9A%84%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E6%96%B0%E6%97%A7%E7%89%88%E6%9C%AC%E7%9A%84%E7%BD%91%E7%BB%9C%E5%B1%82.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/RIP2%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/OSPF%E5%88%86%E7%BB%84%E7%94%A8IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E4%BC%A0%E9%80%81.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/OSPF%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/BGP%E6%8A%A5%E6%96%87%E9%80%9A%E7%94%A8%E9%A6%96%E9%83%A8.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/D%E7%B1%BBIP%E5%9C%B0%E5%9D%80%E4%B8%8E%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%A4%9A%E6%92%AD%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0VPN.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/NAT%E8%B7%AF%E7%94%B1%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/MPLS%E5%8D%8F%E8%AE%AE%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.jpg">
<meta property="og:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/MPLS%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.jpg">
<meta property="article:published_time" content="2023-06-07T03:20:46.000Z">
<meta property="article:modified_time" content="2023-06-09T14:04:08.501Z">
<meta property="article:author" content="Fingsinz">
<meta property="article:tag" content="网络层">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1.jpg">


<link rel="canonical" href="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/","path":"计算机网络-网络层/","title":"计算机网络-网络层"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>计算机网络-网络层 | Fingsinz's space</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Fingsinz's space</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">风信梓的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-主页home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页Home</a></li><li class="menu-item menu-item-日常daily"><a href="/daily/" rel="section"><i class="fa fa-calendar fa-fw"></i>日常Daily</a></li><li class="menu-item menu-item-笔记notes"><a href="/notes/" rel="section"><i class="fa fa-circle-nodes fa-fw"></i>笔记Notes</a></li><li class="menu-item menu-item-好物分享share"><a href="/share/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>好物分享Share</a></li><li class="menu-item menu-item-归档archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档Archives</a></li><li class="menu-item menu-item-关于about"><a href="/about/" rel="section"><i class="fa fa-person fa-fw"></i>关于About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">网络层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.1.</span> <span class="nav-text">网络层的几个重要概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.1.1.</span> <span class="nav-text">网络层提供的两种服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.2.</span> <span class="nav-text">网际协议IP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.1.</span> <span class="nav-text">虚拟互连网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.2.</span> <span class="nav-text">分类的IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.3.</span> <span class="nav-text">IP地址与硬件地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.4.</span> <span class="nav-text">地址解析协议ARP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.2.5.</span> <span class="nav-text">IP数据报的格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.3.</span> <span class="nav-text">划分子网和构造超网</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.3.1.</span> <span class="nav-text">划分子网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.3.2.</span> <span class="nav-text">无分类编址CIDR（构造超网）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.4.</span> <span class="nav-text">IP层转发分组的过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.1.</span> <span class="nav-text">基于终点的转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.2.</span> <span class="nav-text">最长前缀匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.4.3.</span> <span class="nav-text">使用二叉线索查找转发表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.5.</span> <span class="nav-text">网际控制报文协议ICMP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.5.1.</span> <span class="nav-text">ICMP报文格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.5.2.</span> <span class="nav-text">ICMP报文的种类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.5.3.</span> <span class="nav-text">ICMP的应用举例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.6.</span> <span class="nav-text">IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.6.1.</span> <span class="nav-text">IPv6的基本首部</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.6.2.</span> <span class="nav-text">IPv6的地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.6.3.</span> <span class="nav-text">从IPv4向IPv6过渡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.6.4.</span> <span class="nav-text">ICMPv6</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.7.</span> <span class="nav-text">互联网的路由选择协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.1.</span> <span class="nav-text">有关路由选择协议的几个基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.2.</span> <span class="nav-text">内部网关协议RIP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.3.</span> <span class="nav-text">内部网关协议OSPF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.4.</span> <span class="nav-text">外部网关协议BGP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.7.5.</span> <span class="nav-text">路由器的构成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.8.</span> <span class="nav-text">IP多播</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.1.</span> <span class="nav-text">IP多播的基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.2.</span> <span class="nav-text">在局域网上进行硬件多播</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.8.3.</span> <span class="nav-text">网际组管理协议IGMP和多播路由选择协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.9.</span> <span class="nav-text">虚拟专用网VPN和网络地址转换NAT</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.9.1.</span> <span class="nav-text">虚拟专用网VPN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.9.2.</span> <span class="nav-text">网络地址转换NAT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.10.</span> <span class="nav-text">多协议标签交换MPLS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.10.1.</span> <span class="nav-text">MPLS的工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.10.2.</span> <span class="nav-text">MPLS首部的位置与格式</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Fingsinz"
      src="/images/favicon.png">
  <p class="site-author-name" itemprop="name">Fingsinz</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:fingsinz@foxmail.com" title="E-Mail → mailto:fingsinz@foxmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fingsinz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.png">
      <meta itemprop="name" content="Fingsinz">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fingsinz's space">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="计算机网络-网络层 | Fingsinz's space">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计算机网络-网络层
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-07 11:20:46" itemprop="dateCreated datePublished" datetime="2023-06-07T11:20:46+08:00">2023-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-09 22:04:08" itemprop="dateModified" datetime="2023-06-09T22:04:08+08:00">2023-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>31k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>56 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>计算机网络：网络层</p>
<span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%B1%82">网络层</a><ul>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5">网络层的几个重要概念</a><ul>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1">网络层提供的两种服务</a><ul>
<li><a href="#%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1">虚电路服务</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1">数据报服务</a></li>
<li><a href="#%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E6%AF%94">虚电路服务与数据报服务的对比</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AEip">网际协议IP</a><ul>
<li><a href="#%E8%99%9A%E6%8B%9F%E4%BA%92%E8%BF%9E%E7%BD%91%E7%BB%9C">虚拟互连网络</a></li>
<li><a href="#%E5%88%86%E7%B1%BB%E7%9A%84ip%E5%9C%B0%E5%9D%80">分类的IP地址</a><ul>
<li><a href="#ip%E5%9C%B0%E5%9D%80%E5%8F%8A%E5%85%B6%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95">IP地址及其表示方法</a></li>
<li><a href="#ip%E5%9C%B0%E5%9D%80%E7%9A%84%E7%BC%96%E5%9D%80%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB%E7%9A%84ip%E5%9C%B0%E5%9D%80-%E5%AD%90%E7%BD%91%E7%9A%84%E5%88%92%E5%88%86-%E6%9E%84%E9%80%A0%E8%B6%85%E7%BD%91">IP地址的编址方法：分类的IP地址、子网的划分、构造超网</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%88%AB%E7%9A%84ip%E5%9C%B0%E5%9D%80">常用的三种类别的IP地址</a></li>
<li><a href="#ip%E5%9C%B0%E5%9D%80%E7%9A%84%E9%87%8D%E8%A6%81%E7%89%B9%E7%82%B9">IP地址的重要特点</a></li>
</ul>
</li>
<li><a href="#ip%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80">IP地址与硬件地址</a></li>
<li><a href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AEarp">地址解析协议ARP</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8arp%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%85%B8%E5%9E%8B%E6%83%85%E5%86%B5">使用ARP的四种典型情况</a></li>
</ul>
</li>
<li><a href="#ip%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E6%A0%BC%E5%BC%8F">IP数据报的格式</a><ul>
<li><a href="#ip%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%9B%BA%E5%AE%9A%E9%83%A8%E5%88%86%E7%9A%84%E5%AD%97%E6%AE%B5">IP数据报固定部分的字段</a></li>
<li><a href="#ip%E6%95%B0%E6%8D%AE%E6%8A%A5%E9%A6%96%E9%83%A8%E7%9A%84%E5%8F%AF%E5%8F%98%E9%83%A8%E5%88%86">IP数据报首部的可变部分</a></li>
<li><a href="#ip%E5%B1%82%E8%BD%AC%E5%8F%91%E5%88%86%E7%BB%84%E7%9A%84%E6%B5%81%E7%A8%8B">IP层转发分组的流程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E5%92%8C%E6%9E%84%E9%80%A0%E8%B6%85%E7%BD%91">划分子网和构造超网</a><ul>
<li><a href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91">划分子网</a><ul>
<li><a href="#%E4%BB%8E%E4%B8%A4%E7%BA%A7ip%E5%9C%B0%E5%9D%80%E5%88%B0%E4%B8%89%E7%BA%A7ip%E5%9C%B0%E5%9D%80">从两级IP地址到三级IP地址</a></li>
<li><a href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E7%9A%84%E5%8E%9F%E7%90%86%E5%92%8C%E6%96%B9%E6%B3%95">子网划分的原理和方法</a></li>
<li><a href="#%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81">子网掩码</a><ul>
<li><a href="#%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95">计算方法</a></li>
</ul>
</li>
<li><a href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9">子网划分的优缺点</a></li>
<li><a href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">子网划分的实际应用场景</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%AD%90%E7%BD%91%E6%97%B6%E5%88%86%E7%BB%84%E7%9A%84%E8%BD%AC%E5%8F%91">使用子网时分组的转发</a><ul>
<li><a href="#%E5%9C%A8%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E8%B7%AF%E7%94%B1%E5%99%A8%E8%BD%AC%E5%8F%91%E5%88%86%E7%BB%84%E7%9A%84%E7%AE%97%E6%B3%95">在划分子网的情况下路由器转发分组的算法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80cidr%E6%9E%84%E9%80%A0%E8%B6%85%E7%BD%91">无分类编址CIDR（构造超网）</a><ul>
<li><a href="#cidr%E5%9C%B0%E5%9D%80%E5%9D%97">CIDR地址块</a><ul>
<li><a href="#%E7%9B%B8%E5%85%B3%E8%AE%A1%E7%AE%97">相关计算</a></li>
</ul>
</li>
<li><a href="#%E8%B6%85%E7%BD%91%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%9C%E7%94%A8">超网的概念和作用</a></li>
<li><a href="#%E8%B6%85%E7%BD%91%E7%9A%84%E6%9E%84%E9%80%A0%E5%8E%9F%E7%90%86%E5%92%8C%E6%96%B9%E6%B3%95">超网的构造原理和方法</a><ul>
<li><a href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">构造方法</a></li>
</ul>
</li>
<li><a href="#%E8%B6%85%E7%BD%91%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9">超网的优缺点</a></li>
<li><a href="#%E8%B6%85%E7%BD%91%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">超网的实际应用场景</a></li>
<li><a href="#%E8%B6%85%E7%BD%91%E7%9A%84%E7%AE%A1%E7%90%86%E5%92%8C%E7%BB%B4%E6%8A%A4%E6%96%B9%E6%B3%95">超网的管理和维护方法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ip%E5%B1%82%E8%BD%AC%E5%8F%91%E5%88%86%E7%BB%84%E7%9A%84%E8%BF%87%E7%A8%8B">IP层转发分组的过程</a><ul>
<li><a href="#%E5%9F%BA%E4%BA%8E%E7%BB%88%E7%82%B9%E7%9A%84%E8%BD%AC%E5%8F%91">基于终点的转发</a></li>
<li><a href="#%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D">最长前缀匹配</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E4%BA%8C%E5%8F%89%E7%BA%BF%E7%B4%A2%E6%9F%A5%E6%89%BE%E8%BD%AC%E5%8F%91%E8%A1%A8">使用二叉线索查找转发表</a></li>
</ul>
</li>
<li><a href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AEicmp">网际控制报文协议ICMP</a><ul>
<li><a href="#icmp%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F">ICMP报文格式</a></li>
<li><a href="#icmp%E6%8A%A5%E6%96%87%E7%9A%84%E7%A7%8D%E7%B1%BB">ICMP报文的种类</a><ul>
<li><a href="#icmp%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87">ICMP差错报告报文</a></li>
<li><a href="#icmp%E8%AF%A2%E9%97%AE%E6%8A%A5%E6%96%87">ICMP询问报文</a></li>
</ul>
</li>
<li><a href="#icmp%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B">ICMP的应用举例</a></li>
</ul>
</li>
<li><a href="#ipv6">IPv6</a><ul>
<li><a href="#ipv6%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%A6%96%E9%83%A8">IPv6的基本首部</a><ul>
<li><a href="#%E7%89%B9%E6%AE%8A%E9%A6%96%E9%83%A8">特殊首部</a></li>
</ul>
</li>
<li><a href="#ipv6%E7%9A%84%E5%9C%B0%E5%9D%80">IPv6的地址</a><ul>
<li><a href="#ipv6%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB">IPv6地址分类</a></li>
</ul>
</li>
<li><a href="#%E4%BB%8Eipv4%E5%90%91ipv6%E8%BF%87%E6%B8%A1">从IPv4向IPv6过渡</a><ul>
<li><a href="#%E5%8F%8C%E5%8D%8F%E8%AE%AE%E6%A0%88">双协议栈</a></li>
<li><a href="#%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF">隧道技术</a></li>
</ul>
</li>
<li><a href="#icmpv6">ICMPv6</a></li>
</ul>
</li>
<li><a href="#%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE">互联网的路由选择协议</a><ul>
<li><a href="#%E6%9C%89%E5%85%B3%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">有关路由选择协议的几个基本概念</a><ul>
<li><a href="#%E7%90%86%E6%83%B3%E7%9A%84%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95">理想的路由算法</a></li>
<li><a href="#%E5%88%86%E5%B1%82%E6%AC%A1%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE">分层次的路由选择协议</a><ul>
<li><a href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9Fas">自治系统AS</a></li>
<li><a href="#%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE-1">互联网的路由选择协议</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AErip">内部网关协议RIP</a><ul>
<li><a href="#%E8%B7%AF%E7%94%B1%E8%A1%A8%E7%9A%84%E5%BB%BA%E7%AB%8B">路由表的建立</a></li>
<li><a href="#%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E7%AE%97%E6%B3%95">距离向量算法</a></li>
<li><a href="#rip2%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F">RIP2协议的报文格式</a></li>
</ul>
</li>
<li><a href="#%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AEospf">内部网关协议OSPF</a><ul>
<li><a href="#ospf%E5%88%86%E7%BB%84%E9%A6%96%E9%83%A8">OSPF分组首部</a></li>
<li><a href="#ospf%E7%9A%84%E4%BA%94%E7%A7%8D%E5%88%86%E7%BB%84%E7%B1%BB%E5%9E%8B">OSPF的五种分组类型</a></li>
<li><a href="#opsf%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">OPSF的基本操作</a></li>
</ul>
</li>
<li><a href="#%E5%A4%96%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AEbgp">外部网关协议BGP</a></li>
<li><a href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E6%9E%84%E6%88%90">路由器的构成</a><ul>
<li><a href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%93%E6%9E%84">路由器结构</a></li>
<li><a href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E9%83%A8%E5%88%86">路由选择部分</a></li>
<li><a href="#%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91%E9%83%A8%E5%88%86">分组转发部分</a></li>
<li><a href="#%E4%BA%A4%E6%8D%A2%E7%B3%BB%E7%BB%9F">交换系统</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ip%E5%A4%9A%E6%92%AD">IP多播</a><ul>
<li><a href="#ip%E5%A4%9A%E6%92%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">IP多播的基本概念</a><ul>
<li><a href="#%E5%A4%9A%E6%92%ADip%E5%9C%B0%E5%9D%80">多播IP地址</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E5%B1%80%E5%9F%9F%E7%BD%91%E4%B8%8A%E8%BF%9B%E8%A1%8C%E7%A1%AC%E4%BB%B6%E5%A4%9A%E6%92%AD">在局域网上进行硬件多播</a></li>
<li><a href="#%E7%BD%91%E9%99%85%E7%BB%84%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AEigmp%E5%92%8C%E5%A4%9A%E6%92%AD%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE">网际组管理协议IGMP和多播路由选择协议</a><ul>
<li><a href="#%E7%BD%91%E9%99%85%E7%BB%84%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE">网际组管理协议</a></li>
<li><a href="#%E5%A4%9A%E6%92%AD%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE">多播路由选择协议</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91vpn%E5%92%8C%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2nat">虚拟专用网VPN和网络地址转换NAT</a><ul>
<li><a href="#%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91vpn">虚拟专用网VPN</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2nat">网络地址转换NAT</a></li>
</ul>
</li>
<li><a href="#%E5%A4%9A%E5%8D%8F%E8%AE%AE%E6%A0%87%E7%AD%BE%E4%BA%A4%E6%8D%A2mpls">多协议标签交换MPLS</a><ul>
<li><a href="#mpls%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">MPLS的工作原理</a></li>
<li><a href="#mpls%E9%A6%96%E9%83%A8%E7%9A%84%E4%BD%8D%E7%BD%AE%E4%B8%8E%E6%A0%BC%E5%BC%8F">MPLS首部的位置与格式</a><ul>
<li><a href="#mpls%E9%A6%96%E9%83%A8%E7%9A%84%E4%BD%8D%E7%BD%AE">MPLS首部的位置</a></li>
<li><a href="#mpls%E9%A6%96%E9%83%A8%E7%9A%84%E6%A0%BC%E5%BC%8F">MPLS首部的格式</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="网络层">网络层</span></h1><h2><span id="网络层的几个重要概念">网络层的几个重要概念</span></h2><h3><span id="网络层提供的两种服务">网络层提供的两种服务</span></h3><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1.jpg"></p>
<h4><span id="虚电路服务">虚电路服务</span></h4><ul>
<li>虚电路服务是指一种在网络层提供的服务，它类似于有连接的服务，但是与之不同的是，在传输数据前并不需要建立一个专门的连接。相反，当数据包传输时，网络会根据事先建立的虚电路来进行数据包的传输。</li>
</ul>
<p>在使用虚电路服务时，源节点首先向目标节点发送一条请求信息，该请求信息包含了通信所需的一些参数，例如虚电路的编号、端口号等等。然后目标节点接收到该请求信息后，会回复一条确认信息，同时也会在网络中建立一个虚电路。在这个过程中，每个经过的节点都会记录下该虚电路的相关信息，以方便后续数据包的传输。之后，当源节点要向目标节点传输数据时，它就会将数据包发送到网络中，并加上虚电路编号和端口号等信息。经过路由器的转发后，数据包最终到达目标节点。在这个过程中，每个节点都可以使用先前记录的虚电路信息来确保数据的正确传输。</p>
<p>与无连接服务相比，虚电路服务在传输中会更可靠，因为在建立虚电路时已经预留了一定的网络资源，包括路由器的缓存、带宽等。这样一来，传输数据时就可以更加高效地利用这些资源，提高数据传输效率。但与有连接服务相比，虚电路服务的建立和维护过程需要更多的网络开销。</p>
<p>虚电路服务常见的应用场景包括视频会议、远程桌面等要求顺序传输和时延控制的实时应用场景。</p>
<h4><span id="数据报服务">数据报服务</span></h4><ul>
<li>简单灵活的、无连接的、尽最大努力交付的数据包服务。</li>
</ul>
<p><strong>网络不提供端到端的可靠传输服务</strong>。这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）。</p>
<p>如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的<strong>主机中的运输层负责可靠交付（包括差错处理、流量控制等）</strong>。</p>
<p>采用这种设计思路的好处是：网络的造价大大降低，运行方式灵活，能够适应多种应用。</p>
<h4><span id="虚电路服务与数据报服务的对比">虚电路服务与数据报服务的对比</span></h4><table>
<thead>
<tr>
<th align="center">对比的方面</th>
<th align="center">虚电路服务</th>
<th align="center">数据报服务</th>
</tr>
</thead>
<tbody><tr>
<td align="center">思路</td>
<td align="center">可靠通信应当由网络来保证</td>
<td align="center">可靠通信应当由用户主机来保证</td>
</tr>
<tr>
<td align="center">连接的建立</td>
<td align="center">必须有</td>
<td align="center">不需要</td>
</tr>
<tr>
<td align="center">终点地址</td>
<td align="center">尽在连接建立阶段使用，每个分组使用短的虚电路号</td>
<td align="center">每个分组都有终点的完整地址</td>
</tr>
<tr>
<td align="center">分组的转发</td>
<td align="center">属于同一条虚电路的分组均按照统一路由进行转发</td>
<td align="center">每个分组独立选择路由进行转发</td>
</tr>
<tr>
<td align="center">当节点出故障时</td>
<td align="center">所有通过出故障的结点的虚电路均不能工作</td>
<td align="center">出故障的结点可能会丢失分组，一些路由可能会发生变化</td>
</tr>
<tr>
<td align="center">分组的顺序</td>
<td align="center">总是按发送顺序到达终点</td>
<td align="center">到达终点的时间不一定按发送顺序</td>
</tr>
<tr>
<td align="center">端到端的差错处理和流量控制</td>
<td align="center">可以由网络负责，也可以由用户主机负责</td>
<td align="center">由用户主机负责</td>
</tr>
</tbody></table>
<h2><span id="网际协议ip">网际协议IP</span></h2><ul>
<li><p>网际协议 IP是 TCP&#x2F;IP 体系中两个最主要的协议之一。</p>
</li>
<li><p>与IP协议配套使用的还有三个协议：**地址解析协议ARP(Address Resolution Protocol)<strong>、</strong>网际控制报文协议ICMP(Internet Control Message Protocol)<strong>、</strong>网际组管理协议IGMP(Internet Group Management Protocol)**。</p>
</li>
</ul>
<h3><span id="虚拟互连网络">虚拟互连网络</span></h3><ul>
<li><p>没有一种单一的网络能够适应所有用户的需求。</p>
</li>
<li><p>所谓虚拟互连网络也就是逻辑互连网络，它的意思就是互连起来的各种物理网络的异构性本来是客观存在的，但是利用IP协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络。</p>
</li>
<li><p>互联网可以由多种异构网络互连组成。将网络互相连接起来要使用一些中间设备。</p>
</li>
</ul>
<p>物理层使用的中间设备叫做转发器（repeater）；数据链路层使用的中间设备叫做网桥或桥接器（bride）；网络层使用的中间设备叫做路由器（router）；在网络层以上使用的中间设备叫做网关（gateway），用网关连接两个不兼容的系统需要在高层进行协议的转换。</p>
<ul>
<li><p>使用IP协议的<strong>虚拟互连网络</strong>可简称为IP网。</p>
</li>
<li><p><strong>使用虚拟互连网络的好处是：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。</strong></p>
</li>
</ul>
<h3><span id="分类的ip地址">分类的IP地址</span></h3><h4><span id="ip地址及其表示方法">IP地址及其表示方法</span></h4><ul>
<li>IP地址就是给每个连接在互联网上的主机（或路由器）分配一个在全世界范围<strong>唯一的32位的标识符</strong>。</li>
</ul>
<p>为了提高可读性，常常每8位插入一个空格，便于阅读。</p>
<ul>
<li><p>IP地址由互联网名字和数字分配机构进行分配。</p>
</li>
<li><p>点分十进制记法：机器中存放的IP地址是32位二进制代码，每8位为一组，转化为十进制数。</p>
</li>
</ul>
<h4><span id="ip地址的编址方法分类的ip地址-子网的划分-构造超网">IP地址的编址方法：分类的IP地址、子网的划分、构造超网</span></h4><ul>
<li>分类的IP地址，最基本的编址方法。</li>
</ul>
<p>将IP地址划分为若干个固定类。每一类地址都由两个固定长度的字段组成，其中一个字段是<strong>网络号net-id</strong>，它标志主机（或路由器）所连接到的网络，而另一个字段则是<strong>主机号host-id</strong>，它标志该主机（或路由器）。主机号在它前面的网络号所指明的网络范围内必须是唯一的。由此可见，一个IP地址在整个互联网范围内是唯一的。</p>
<p>这种两级的IP地址可以记为：<code>IP地址::=&#123;&lt;网络号&gt;,&lt;主机号&gt;&#125;</code>，<code>::=</code>表示“定义为”。</p>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E5%90%84%E7%B1%BBIP%E5%9C%B0%E5%9D%80.jpg"></p>
<ul>
<li><p>A类、B类、C类地址都是单播地址（一对一通信），他们的网络号字段分别为1、2、3个字节长，网络号字段最前面有类别为，数值分别规定为0、10、110，主机号字段分别为3、2、1个字节长。</p>
</li>
<li><p>D类地址用于多播（一对多通信）。</p>
</li>
<li><p>E类地址保留为今后使用。</p>
</li>
</ul>
<h4><span id="常用的三种类别的ip地址">常用的三种类别的IP地址</span></h4><table>
<thead>
<tr>
<th align="center">网络类别</th>
<th align="center">最大可指派的网络数</th>
<th align="center">第一个可指派的网络号</th>
<th align="center">最后一个可指派的网络号</th>
<th align="center">每个网络中最大主机数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">A</td>
<td align="center">126($2^7-2$)</td>
<td align="center">1</td>
<td align="center">126</td>
<td align="center">16777214</td>
</tr>
<tr>
<td align="center">B</td>
<td align="center">16384($2^{14}$)</td>
<td align="center">128.0</td>
<td align="center">191.255</td>
<td align="center">65534</td>
</tr>
<tr>
<td align="center">C</td>
<td align="center">2087152($2^{21}$)</td>
<td align="center">192.0.0</td>
<td align="center">223.255.255</td>
<td align="center">254</td>
</tr>
</tbody></table>
<ul>
<li>一般不适用的特殊IP地址</li>
</ul>
<table>
<thead>
<tr>
<th align="center">网络号</th>
<th align="center">主机号</th>
<th align="center">源地址使用</th>
<th align="center">目的地址使用</th>
<th align="center">代表意思</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">可以</td>
<td align="center">不可</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">host-id</td>
<td align="center">可以</td>
<td align="center">不可</td>
<td align="center">在本网络的某台主机host-id</td>
</tr>
<tr>
<td align="center">全1</td>
<td align="center">全1</td>
<td align="center">不可</td>
<td align="center">可以</td>
<td align="center">只有本网络上进行广播（各路由器均不转发）</td>
</tr>
<tr>
<td align="center">net-id</td>
<td align="center">全1</td>
<td align="center">不可</td>
<td align="center">可以</td>
<td align="center">对net-id上的所有主机进行广播</td>
</tr>
<tr>
<td align="center">127</td>
<td align="center">非全0或全1的任何数</td>
<td align="center">可以</td>
<td align="center">可以</td>
<td align="center">用作本地软件环回测试</td>
</tr>
</tbody></table>
<h4><span id="ip地址的重要特点">IP地址的重要特点</span></h4><ol>
<li>IP地址是一种分等级的地址结构。</li>
</ol>
<p>分两个等级的好处是：</p>
<p>第一，IP地址管理机构在分配IP地址时只分配网络号，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了IP地址的管理</p>
<p>第二，路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间。</p>
<ol start="2">
<li>实际上IP地址是标志一个主机（或路由器）和一条链路的接口。</li>
</ol>
<p>当一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的IP地址，其网络号net-id 必须是不同的。这种主机称为多归属主机(multihomed host)。</p>
<p>由于一个路由器至少应当连接到两个网络（这样它才能将IP数据报从一个网络转发到另一个网络），因此一个路由器至少应当有两个不同的IP地址。</p>
<ol start="3">
<li><p>用转发器或网桥连接起来的若干个局域网仍为一个网络，因而具有同样的网络号net-id。</p>
</li>
<li><p>平等，互联网同等对待每一个IP地址。</p>
</li>
</ol>
<h3><span id="ip地址与硬件地址">IP地址与硬件地址</span></h3><ul>
<li><p>网络层及以上使用IP地址；链路层及以下使用硬件地址。</p>
</li>
<li><p>IP地址放在IP数据报的首部，而硬件地址则放在MAC帧的首部。</p>
</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8C%BA%E5%88%AB.jpg"></p>
<ul>
<li><p>在IP层抽象的互联网上只能看到IP数据报。</p>
</li>
<li><p>路由器只根据目的站的IP地址的网络号进行路由选择。</p>
</li>
<li><p>在局域网的链路层，只能看到MAC帧。</p>
</li>
<li><p>IP层抽象的互联网却屏蔽了下层这些很复杂的细节。只要在网络层上讨论问题，就能够使用统一的、抽象的IP地址研究主机和主机或路由器之间的通信。</p>
</li>
</ul>
<h3><span id="地址解析协议arp">地址解析协议ARP</span></h3><ul>
<li><p>ARP（Address Resolution Protocol）即地址解析协议，是计算机网络中常用的一种协议，用于将IP地址转换为MAC地址。在互联网协议中，每个设备都需要拥有一个唯一的IP地址，但是在局域网内，不同设备之间通信需要使用MAC地址，因此通过ARP协议可以解决这种IP地址和MAC地址之间的映射问题。</p>
</li>
<li><p>下面简要介绍ARP协议的工作原理：</p>
</li>
</ul>
<ol>
<li><p>当主机A需要与目标主机B通信时，首先需要知道目标主机的MAC地址。</p>
</li>
<li><p>主机A会检查自己的ARP缓存表是否有目标主机的IP地址对应的MAC地址记录，如果有，则直接使用该MAC地址进行通信。</p>
</li>
<li><p>如果ARP缓存表中没有对应的记录，主机A会发送一个ARP请求广播，询问局域网中哪个设备拥有该IP地址。该请求包含了源主机A的MAC地址、目标主机B的IP地址等信息。</p>
</li>
<li><p>收到ARP请求广播的设备，会检查自己的ARP缓存表来判断是否是目标主机B。如果是，该设备会将自己的MAC地址发送给主机A。</p>
</li>
<li><p>主机A收到回复后，会将目标主机B的IP地址和MAC地址记录在ARP缓存表中，并使用该MAC地址进行通信。</p>
</li>
</ol>
<ul>
<li><p>由于ARP请求广播是以广播方式发送的，因此所有设备都能够收到该消息。同时，为了防止网络中发生ARP欺骗攻击等安全问题，主机需要对更新ARP缓存表进行限制和验证。</p>
</li>
<li><p>通信时使用了IP地址（网络层地址）和MAC地址（数据链路层地址）</p>
</li>
<li><p>ARP解决<strong>同一个局域网上</strong>主机或路由器的IP地址和硬件地址的映射问题。</p>
</li>
</ul>
<h4><span id="使用arp的四种典型情况">使用ARP的四种典型情况</span></h4><ul>
<li><p>发送方是主机，要把IP数据报发送到本网络上的另一个主机。这时用ARP找到目的主机的硬件地址。</p>
</li>
<li><p>发送方是主机，要把IP数据报发送到另一个网络上的一个主机。这时用ARP找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。</p>
</li>
<li><p>发送方是路由器，要把IP数据报转发到本网络上的一个主机。这时用ARP找到目的主机的硬件地址。</p>
</li>
<li><p>发送方是路由器，要把IP数据报转发到另一个网络上的一个主机。这时用ARP找到本网络上另一个路由器的硬件地址。剩下的工作由这个路由器来完成。</p>
</li>
</ul>
<h3><span id="ip数据报的格式">IP数据报的格式</span></h3><ul>
<li><p>一个IP数据报由首部和数据两部分组成。</p>
</li>
<li><p>首部的前一部分是固定长度，共20字节，是所有IP数据报必须具有的。</p>
</li>
<li><p>在首部的固定部分的后面是一些可选字段，其长度是可变的。</p>
</li>
</ul>
<h4><span id="ip数据报固定部分的字段">IP数据报固定部分的字段</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.jpg"></p>
<ol>
<li><p>版本号（Version）：4位二进制数，用于表示IP协议的版本号，目前主要有IPv4和IPv6两种版本。</p>
</li>
<li><p>首部长度（Header Length）：4位二进制数，用于表示IP数据报头部的长度，以4字节为单位，因此最大值为15，即最大头部长度为60字节。</p>
</li>
<li><p>区分服务（Type of Service）：8位二进制数，用于标识IP数据报的服务类型和优先级，包括了TOS、ECN和DSCP三个子字段，主要用于QoS服务质量控制。</p>
</li>
<li><p>总长度（Total Length）：16位二进制数，用于表示整个IP数据报的长度，包括头部和数据两部分，以字节为单位，最大值为65535字节。</p>
</li>
<li><p>标识（Identification）：16位二进制数，用于标识同一个数据流中的不同数据报，主要用于分片和重新组装。</p>
</li>
<li><p>标志（Flags）：3位二进制数，用于标记IP数据报是否可以分片和是否为最后一个分片，其中第1位保留，第2位表示不分片标记（DF），第3位表示最后一个分片标记（MF）。</p>
</li>
<li><p>片偏移（Fragment Offset）：13位二进制数，用于标识当前IP数据报在原始数据报中的位置和大小，以8字节为单位，因此最大值为8191。</p>
</li>
<li><p>生存时间——占8位，TTL（Time to Live）：8位二进制数，用于保证IP数据报在网络中不会永久存在，可防止数据报在网络中无限循环，每经过一个路由器或网关，该值减1，当它减至0时，数据报将被丢弃。</p>
</li>
</ol>
<p>如今TTL字段的功能改为“跳数限制”，路由器每次转发数据报之前就把TTL值减1，直到TTL减小到零就丢弃这个数据报，TTL的单位从秒改为跳数。数据报能在互联网中经过的路由器最大跳数位255。若TTL为1，则表示这个数据报只能在本局域网中传送。</p>
<ol start="9">
<li>协议（Protocol）：8位二进制数，用于标识IP数据报中携带的协议类型，如ICMP、TCP、UDP等。</li>
</ol>
<table>
<thead>
<tr>
<th align="center">协议名</th>
<th align="center">ICMP</th>
<th align="center">IGMP</th>
<th align="center">IP</th>
<th align="center">TCP</th>
<th align="center">EGP</th>
<th align="center">IGP</th>
<th align="center">UDP</th>
<th align="center">IPv6</th>
<th align="center">ESP</th>
<th align="center">OSPF</th>
</tr>
</thead>
<tbody><tr>
<td align="center">协议字段值</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">6</td>
<td align="center">8</td>
<td align="center">9</td>
<td align="center">17</td>
<td align="center">41</td>
<td align="center">50</td>
<td align="center">89</td>
</tr>
</tbody></table>
<ol start="10">
<li>首部检验和（Header Checksum）：16位二进制数，用于检查IP数据报头部在传输过程中是否损坏，可以保证数据的完整性。</li>
</ol>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E9%A6%96%E9%83%A8%E6%A3%80%E9%AA%8C%E5%92%8C%E8%AE%A1%E7%AE%97.jpg"></p>
<ol start="11">
<li><p>源地址（Source Address）：32位二进制数，用于标识IP数据报的源地址，即哪个主机发出了该数据报。</p>
</li>
<li><p>目的地址（Destination Address）：32位二进制数，用于标识IP数据报的目的地址，即该数据报要被传输到哪个主机。</p>
</li>
<li><p>填充字段（Fill field）：填充0使得可变部分和填充字段的字节是4的整数倍。</p>
</li>
</ol>
<h4><span id="ip数据报首部的可变部分">IP数据报首部的可变部分</span></h4><ul>
<li><p>IP首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富。</p>
</li>
<li><p>选项字段的长度可变，从1个字节到40个字节不等，取决于所选择的项目。</p>
</li>
<li><p>增加首部的可变部分是为了增加IP数据报的功能，但这同时也使得IP数据报的首部长度成为可变的。这就增加了每一个路由器处理数据报的开销。</p>
</li>
</ul>
<h4><span id="ip层转发分组的流程">IP层转发分组的流程</span></h4><ul>
<li>路由器分组转发算法</li>
</ul>
<ol>
<li><p>从数据报的首部提取目的主机的IP地址D，得出目的网络地址为N。</p>
</li>
<li><p>若网络N与此路由器直接相连，则把数据报直接交付目的主机D；否则是间接交付，执行3。</p>
</li>
<li><p>若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行4。</p>
</li>
<li><p>若路由表中有到达网络N的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行5。</p>
</li>
<li><p>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行6。</p>
</li>
<li><p>报告转发分组出错。</p>
</li>
</ol>
<h2><span id="划分子网和构造超网">划分子网和构造超网</span></h2><h3><span id="划分子网">划分子网</span></h3><h4><span id="从两级ip地址到三级ip地址">从两级IP地址到三级IP地址</span></h4><ul>
<li><p>IP地址的空间利用率有时很低；给每个物理网络分配一个网络号会使路由表变得太大因而网络性能变坏；两级IP地址不够灵活。</p>
</li>
<li><p>划分子网的基本思路</p>
</li>
</ul>
<ol>
<li><p>一个拥有许多物理网络的单位，可将所属的物理网络划分为若干个子网（subnet）。划分子网纯属是一个单位内部的事情。本单位以外的网络看不见这个网络有多少个子网组成，对外表现为一个网络。</p>
</li>
<li><p>划分子网的方法是从网络的主机号借用若干位作为子网号（subnet-id），主机号相应减少了位数。于是二级IP地址在本单位内部就变为三级IP地址：网络、子网号和主机号，表示为<code>IP地址::=&#123;&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;&#125;</code>。</p>
</li>
<li><p>凡是从其他网络发送给本单位某台主机的IP数据报，仍然是根据IP数据报的目的网络号找到连接在本单位网络上的路由器。但此路由器在收到IP数据报后，再按目的网络号和子网号找到目的子网，把IP数据报交付目的主机。</p>
</li>
</ol>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E4%BE%8B%E5%AD%90.jpg"></p>
<h4><span id="子网划分的原理和方法">子网划分的原理和方法</span></h4><ul>
<li><p>子网划分是将一个大的网络地址划分为多个小的子网。子网划分的原理是将网络地址的主机位部分拆分为多个子网的主机位和子网位，使每个子网拥有自己的网络地址和主机地址。</p>
</li>
<li><p>子网划分的方法有两种，一种是固定子网划分，另一种是可变子网划分。</p>
</li>
</ul>
<h4><span id="子网掩码">子网掩码</span></h4><ul>
<li>子网掩码是一个用于划分网络地址和主机地址的二进制数字。它通常由32个位组成，其中以连续的1表示网络地址，剩下的以0表示主机地址。子网掩码的长度根据实际需要而定，例如常用的子网掩码有255.255.255.0、255.255.0.0等。</li>
</ul>
<p>A类地址的默认子网掩码是255.0.0.0，B类地址的默认子网掩码是255.255.0.0，C类地址的默认子网掩码是255.255.255.0。</p>
<ul>
<li><p>子网掩码的作用是通过将IP地址分组，从而实现更高效的数据传输和更有效的网络管理。通过划分子网，可以将大型网络划分为多个较小的子网，并给每个子网分配唯一的网络地址。这样，每个子网就可以独立运行和管理，而且跨子网的数据传输也会更加快速和高效。</p>
</li>
<li><p>通过IP地址和子网掩码求网络地址。</p>
</li>
</ul>
<p>求网络地址，需要对IP地址和子网掩码进行与运算。将IP地址和子网掩码转换成二进制后，对应位进行与运算，得到的结果即为网络地址。</p>
<p>以IPv4为例，假设IP地址为192.168.1.100，子网掩码为255.255.255.0（&#x2F;24前缀），则可以按照以下步骤计算出网络地址：将IP地址和子网掩码转换为二进制数字：IP地址二进制表示为11000000.10101000.00000001.01100100，子网掩码的二进制表示为11111111.11111111.11111111.00000000。对位进行与运算，得到网络地址的二进制表示为11000000.10101000.00000001.00000000。将二进制网络地址转换为点分十进制格式，即192.168.1.0。因此，该IP地址所在的网络地址为192.168.1.0。</p>
<h5><span id="计算方法">计算方法</span></h5><ul>
<li>计算子网掩码的方法是先确定需要划分的网络地址，然后根据需要划分的子网数目计算掩码长度。</li>
</ul>
<ol>
<li>固定子网划分的子网掩码计算方法</li>
</ol>
<p>假设给定一个网络地址和要划分的子网数，可以按照以下步骤计算子网掩码：</p>
<ul>
<li><p>确定网络地址的类别，根据类别确定默认子网掩码；</p>
</li>
<li><p>根据要划分的子网数计算需要多少位来表示子网，可以用2^n ≥ 子网数来计算需要的位数n；</p>
</li>
<li><p>用32减去网络地址的默认子网掩码的位数（即主机位数），得到剩余的位数，用来表示子网的位数；</p>
</li>
<li><p>将剩余的位数分配给子网，每个子网的位数相同；</p>
</li>
<li><p>将所有的位数相加，得到新的子网掩码。</p>
</li>
</ul>
<p>例如，假设有一个网络地址为192.168.1.0&#x2F;24，要划分成4个子网，按照上述步骤计算新的子网掩码：</p>
<ul>
<li><p>默认子网掩码为255.255.255.0；</p>
</li>
<li><p>2^2 ≥ 4，因此需要用2位来表示子网，剩余的6位表示主机；</p>
</li>
<li><p>每个子网将剩下6位共享，最大容纳主机数为2^6-2&#x3D;62；</p>
</li>
<li><p>每个子网的子网掩码是255.255.255.192（&#x2F;26）。</p>
</li>
</ul>
<ol start="2">
<li>可变子网划分的子网掩码计算方法 <font color="red"><strong>未解决</strong>!</font></li>
</ol>
<p>假设给定一个网络地址和每个子网所需的主机数，可以按照以下步骤计算子网掩码：</p>
<ul>
<li><p>确定网络地址的类别，根据类别确定默认子网掩码；</p>
</li>
<li><p>根据每个子网所需的主机数计算需要多少位来表示主机，可以用2^n ≥ 主机数+2来计算需要的位数n（加2是因为每个子网需要一个网络地址和一个广播地址）；</p>
</li>
<li><p>用32减去网络地址默认子网掩码的位数，得到剩余的位数，用来表示主机的位数；</p>
</li>
<li><p>将剩余的位数分配给主机，每个子网的主机位数不同；</p>
</li>
<li><p>将所有的位数相加，得到新的子网掩码。</p>
</li>
</ul>
<p>例如，假设有一个网络地址为192.168.1.0&#x2F;24，每个子网需要20个主机，按照上述步骤计算新的子网掩码：</p>
<ul>
<li><p>默认子网掩码为255.255.255.0；</p>
</li>
<li><p>2^5 ≥ 20+2，因此需要用5位来表示主机，剩余的3位表示子网；</p>
</li>
<li><p>将3位按比例分配给各个子网，假设划分成4个子网，则每个子网的主机位数分别为5、4、4、4；</p>
</li>
<li><p>每个子网的子网掩码分别是255.255.255.248（&#x2F;29）、255.255.255.240（&#x2F;28）、255.255.255.240（&#x2F;28）、255.255.255.240（&#x2F;28）。</p>
</li>
</ul>
<h4><span id="子网划分的优缺点">子网划分的优缺点</span></h4><ul>
<li><p>子网划分的优点是可以提高网络的安全性、灵活性和管理效率，同时可以减少网络冲突。</p>
</li>
<li><p>缺点是可能会浪费IP地址，因为每个子网都需要分配一定数量的IP地址。</p>
</li>
</ul>
<h4><span id="子网划分的实际应用场景">子网划分的实际应用场景</span></h4><ul>
<li>子网划分可以应用于各种规模的网络，特别是大型企业和机构网络。在企业网络中，可以根据部门和功能对网络进行划分，从而实现更好的管理和安全性。</li>
</ul>
<h4><span id="使用子网时分组的转发">使用子网时分组的转发</span></h4><h5><span id="在划分子网的情况下路由器转发分组的算法">在划分子网的情况下路由器转发分组的算法</span></h5><ol>
<li><p>从收到的分组的首部提取目的IP地址D。</p>
</li>
<li><p>先用各网络的子网掩码和D逐位相“与”，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行3。</p>
</li>
<li><p>若路由表中有目的地址为D的特定主机路由，则将分组传送给指明的下一跳路由器；否则，执行4。</p>
</li>
<li><p>对路由表中的每一行，将子网掩码和D逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行5。</p>
</li>
<li><p>若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器；否则，执行6。</p>
</li>
<li><p>报告转发分组出错。</p>
</li>
</ol>
<h3><span id="无分类编址cidr构造超网">无分类编址CIDR（构造超网）</span></h3><ul>
<li><p>无分类编址CIDR（Classless Inter-Domain Routing）是一种IP地址分配和路由选择的技术，与传统的基于IP地址分类的编址方式不同。</p>
</li>
<li><p>CIDR采用可变长度子网掩码，可以更加灵活地分配IP地址，而不必受到传统IP地址分类的限制。</p>
</li>
</ul>
<p>传统的IP地址分类是基于IP地址的第一个字节进行分类，将IP地址分为A、B、C、D、E五类。每一类地址都有固定的网络地址长度和主机地址长度。这种编址方式存在很多问题，比如浪费IP地址、网络划分不够灵活、路由表过大等。CIDR技术的出现解决了这些问题。</p>
<ul>
<li>CIDR技术采用可变长度子网掩码，可以更加灵活地分配IP地址，而不必受到传统IP地址分类的限制。CIDR技术允许将一个IP地址空间划分为多个子网，每个子网的掩码长度可以不同，这样可以更加高效地利用IP地址。CIDR技术还可以将多个小的IP地址空间合并成一个大的IP地址空间，这样可以减少路由器的负担，提高网络性能。总之，CIDR技术是一种更加灵活、高效的IP地址分配和路由选择技术，已经被广泛应用于互联网和企业网络中。</li>
</ul>
<h4><span id="cidr地址块">CIDR地址块</span></h4><ul>
<li>CIDR地址块是一个用来表示网络地址空间的标准格式，它由一个IP地址和一个掩码组成，用斜线符号分隔。采用记法：<code>IP地址::=&#123;&lt;网络前缀&gt;,&lt;主机号&gt;&#125;</code>；也采用“斜线记法”，或称为CIDR记法，即在IP地址后面加上斜线“&#x2F;”，然后写上网络前缀所占的位数。</li>
</ul>
<p>CIDR使用32位的地址掩码，地址掩码1的个数就是网络前缀的长度。CIDR使用的地址掩码可继续称为子网掩码。如192.168.0.0&#x2F;16的表示格式。其中”&#x2F;16”表示地址的前缀长度，即网络部分所占的位数。在这个例子中，前16位为网络号，后16位为主机号。CIDR地址块通常是连续的IP地址范围，可以是一个或多个地址段。</p>
<ul>
<li><p>CIDR地址块的格式是根据网络地址和子网掩码的二进制位数来确定的，比如CIDR地址块192.168.1.0&#x2F;24表示该地址块的网络地址是192.168.1.0，子网掩码是255.255.255.0，即该地址块可以容纳256个主机。</p>
</li>
<li><p>CIDR地址块的优点在于可以将多个地址块聚合成一个更大的地址块，从而减少路由表的数量和路由器之间的交换信息量，提高网络的路由效率和性能。同时，CIDR地址块也可以灵活地分配IP地址，根据需要进行网络和子网的划分，使得地址使用更加高效和灵活。</p>
</li>
<li><p>CIDR地址块用于表示IP地址空间的聚合和路由选择。</p>
</li>
<li><p>在实际应用中，CIDR地址块被广泛应用于互联网中的路由器、防火墙、VPN等设备中，以便更好地管理和维护网络地址空间。同时，CIDR地址块也是网络工程师和管理员进行网络规划和配置时必须了解和掌握的重要技术。</p>
</li>
</ul>
<h5><span id="相关计算">相关计算</span></h5><ol>
<li>确定地址块的网络地址和掩码</li>
</ol>
<p>在CIDR地址块中，网络地址和掩码是通过斜线符号分隔的，在计算CIDR地址块时，需要确定网络地址和子网掩码的二进制位数，并将它们转换成十进制数表示。</p>
<ul>
<li>假设有一个CIDR地址块为192.168.1.0&#x2F;24，要求确定它的网络地址和子网掩码。</li>
</ul>
<p>CIDR地址块中斜线符号后面的数字24表示该地址块的子网掩码有24位为1，因此子网掩码的二进制表示为11111111.11111111.11111111.00000000，转换成十进制表示为255.255.255.0。网络地址为192.168.1.0，因此该CIDR地址块的网络地址为192.168.1.0，子网掩码为255.255.255.0。</p>
<ol start="2">
<li>确定地址块的主机数量</li>
</ol>
<p>CIDR地址块的主机数量取决于子网掩码的位数，在计算CIDR地址块时，可以根据子网掩码的位数来确定地址块的主机数量。</p>
<ul>
<li>假设有一个CIDR地址块为192.168.1.0&#x2F;24，要求确定它的主机数量。</li>
</ul>
<p>子网掩码为255.255.255.0，有24位为1，因此该CIDR地址块的主机数量为2^8-2&#x3D;254个，其中2个表示网络地址和广播地址，不可用于主机。</p>
<ol start="3">
<li>确定地址块的可用地址范围</li>
</ol>
<p>CIDR地址块的可用地址范围取决于网络地址和子网掩码的二进制位数，在计算CIDR地址块时，可以根据网络地址和子网掩码的位数来确定可用地址范围。</p>
<ul>
<li>假设有一个CIDR地址块为192.168.1.0&#x2F;24，要求确定它的可用地址范围。</li>
</ul>
<p>子网掩码为255.255.255.0，有24位为1，因此该CIDR地址块的可用地址范围是192.168.1.1~192.168.1.254，其中192.168.1.0为网络地址，192.168.1.255为广播地址，不可用于主机。</p>
<h4><span id="超网的概念和作用">超网的概念和作用</span></h4><ul>
<li><p>超网是将多个相邻的小网络合并成一个大网络。</p>
</li>
<li><p>超网的作用是可以减少路由表的数量和路由器的负担，提高网络性能。</p>
</li>
</ul>
<h4><span id="超网的构造原理和方法">超网的构造原理和方法</span></h4><ul>
<li><p>超网的构造原理是将多个相邻的小网络合并成一个大网络，并将它们的网络地址连续排列在一起，形成一个更大的网络地址。</p>
</li>
<li><p>超网的构造方法有两种，一种是手动配置，另一种是使用CIDR技术自动构造。</p>
</li>
</ul>
<h5><span id="构造方法">构造方法</span></h5><p>超网是将多个连续的网络地址空间聚合成一个更大的网络地址空间的过程，以减少路由表的数量和路由器之间的交换信息量。</p>
<ol>
<li>基于CIDR地址构造：前缀聚合</li>
</ol>
<p>前缀聚合是将多个网络地址空间的前缀部分相同的地址聚合成一个更大的网络地址，以减少路由表中的条目数。具体步骤如下：</p>
<ul>
<li><p>按照前缀部分相同的原则，将需要聚合的网络地址空间进行分组；</p>
</li>
<li><p>对每组地址进行前缀压缩，即将相同的前缀部分保留，不同的部分用一个较短的掩码表示；</p>
</li>
<li><p>将压缩后的地址作为超网地址，并在路由器中配置该地址和相应的掩码，实现路由聚合。</p>
</li>
</ul>
<ol start="2">
<li>基于变长子网掩码（Variable Length Subnet Mask）地址构造：子网划分聚合</li>
</ol>
<p>子网划分聚合是将多个子网划分后的地址聚合成一个更大的网络地址，以减少路由表中的条目数。具体步骤如下：</p>
<ul>
<li><p>将需要聚合的子网按照相同的前缀部分进行分组；</p>
</li>
<li><p>对每组子网进行子网划分，使得每个子网的主机数量相同；</p>
</li>
<li><p>将划分后的子网聚合成一个更大的网络地址，并在路由器中配置该地址和相应的掩码，实现路由聚合。</p>
</li>
</ul>
<p>需要注意的是，在进行超网构造时，需要保证聚合后的地址仍然可以满足网络的需求，即不能出现地址冲突或主机数量不足的情况。同时，超网的构造需要考虑网络的规模和复杂程度，以便在减少路由表的数量的同时，保证网络的稳定性和可靠性。</p>
<ul>
<li>如将212.56.132.0&#x2F;24、212.56.133.0&#x2F;24、212.56.134.0&#x2F;24、212.56.135.0&#x2F;24四个C类网络聚合。</li>
</ul>
<p>比较四个地址的最长前缀，发现为22位，故聚合为212.26.132.0&#x2F;22。</p>
<h4><span id="超网的优缺点">超网的优缺点</span></h4><ul>
<li><p>超网的优点是可以减少路由器的负担，提高网络性能；同时可以减少路由表的数量，降低网络管理的复杂度。</p>
</li>
<li><p>缺点是可能会浪费IP地址，因为超网的子网数量比较少，每个子网需要分配更多的IP地址。</p>
</li>
</ul>
<h4><span id="超网的实际应用场景">超网的实际应用场景</span></h4><ul>
<li>超网可以应用于各种规模的网络，特别是在ISP网络中，可以将多个用户网络合并成一个大网络，提高网络性能和管理效率。</li>
</ul>
<h4><span id="超网的管理和维护方法">超网的管理和维护方法</span></h4><ul>
<li>超网需要进行定期的管理和维护，包括路由器配置、路由表管理、地址分配等方面。在超网的管理过程中，需要注意网络安全和地址分配的合理性。</li>
</ul>
<h2><span id="ip层转发分组的过程">IP层转发分组的过程</span></h2><h3><span id="基于终点的转发">基于终点的转发</span></h3><ul>
<li><p>基于终点转发的方法是一种比较常见的路由选择算法。其基本思路是根据目的地址来选择下一跳路由器，直接将分组从源节点转发到目标节点。</p>
</li>
<li><p>具体的流程如下：源主机发送分组到目标主机的IP地址；当分组经过每个路由器时，路由器将查找路由表以确定下一跳路由器；路由器将分组转发到下一跳路由器，直到最终目标主机被找到。</p>
</li>
</ul>
<p>例如，当数据包从A出发到达R1时，R1会检查路由表，发现需要将数据包转发到R2。R1会将数据包发往R2，R2再根据路由表将数据包转发到R3，最终到达目标主机B。</p>
<h3><span id="最长前缀匹配">最长前缀匹配</span></h3><ul>
<li><p>最长前缀匹配（Longest Prefix Match）是一种路由选择算法，用于在路由表中查找与给定目的IP地址最匹配的路由。在最长前缀匹配中，路由表中的每一条路由都有一个IP地址前缀和一个与之对应的下一跳地址，当路由器收到一个数据包时，它会根据数据包的目的IP地址查找路由表，并选择与之最匹配的路由，将数据包转发到对应的下一跳地址。</p>
</li>
<li><p>最长前缀匹配的匹配过程是从路由表中的最长前缀开始匹配，如果目的IP地址与某个路由的前缀匹配，则选择该路由；否则，继续匹配下一个最长前缀，直到找到匹配的路由或者匹配失败。</p>
</li>
</ul>
<p>例如，假设路由表中有以下两条路由：192.168.1.0&#x2F;24，下一跳地址为10.0.0.1；192.168.1.128&#x2F;25，下一跳地址为10.0.0.2。</p>
<p>当路由器接收到一个目的IP地址为192.168.1.130的数据包时，它会先用192.168.1.130与第一条路由192.168.1.0&#x2F;24进行匹配，发现不匹配；然后用192.168.1.130与第二条路由192.168.1.128&#x2F;25进行匹配，发现匹配成功。因此，路由器会选择第二条路由，并将数据包转发到下一跳地址10.0.0.2。</p>
<ul>
<li>最长前缀匹配算法能够快速准确地确定数据包的路由路径，提高网络转发效率和安全性。在实际网络应用中，最长前缀匹配算法被广泛应用于路由器、防火墙等网络设备中。</li>
</ul>
<h3><span id="使用二叉线索查找转发表">使用二叉线索查找转发表</span></h3><ul>
<li><p>二叉线索查找通常是把无分类编址的路由表存放在二叉树中，然后自上而下按层次进行查找。</p>
</li>
<li><p>使用二叉线索查找转发表的具体方法如下：将所有的转发表条目按照IP地址从左到右的顺序构造成一个二叉线索；对于每个查询的IP地址，按照从左到右的顺序依次比较它的每个二进制位。如果该位为0，则向左走，如果该位为1，则向右走。直到到达二叉线索的叶子节点，即找到了匹配的转发表项。</p>
</li>
</ul>
<p>假设有三个IP地址，分别为110.15.14.3、110.15.10.2和110.16.11.1。构造二叉线索的过程如下：</p>
<p>创建根节点，将IP地址的第一位作为判断依据。于是，将110.15.14.3插入左子树，将110.15.10.2插入右子树。此时，根节点的左子节点包含了一个指针和一个左孩子标志，右子节点包含了一个指针和一个右孩子标志。</p>
<p>对于110.15.14.3，继续向左走，将第二位为1的110.15.10.2插入右子树。此时，根节点的右子节点包含了一个指针和一个右孩子标志，右子节点的左子节点包含了一个指针和一个左孩子标志。</p>
<p>对于110.16.11.1，继续向右走，创建新的叶子节点。</p>
<p>二叉线索构造完成后，对于任何查询IP地址的请求，都可以通过遍历二叉线索来快速查找到匹配的转发表项。</p>
<h2><span id="网际控制报文协议icmp">网际控制报文协议ICMP</span></h2><ul>
<li><p>ICMP（Internet Control Message Protocol）是互联网的标准协议，是IP层协议，允许主机或路由器报告差错情况和提供有关异常情况的报告。</p>
</li>
<li><p>为了提高IP数据包交付成功的机会，在网际层使用了网际控制报文协议。ICMP在IP之上，用来测试网络层有没有故障。使用最多的命令是<code>ping</code>。</p>
</li>
<li><p>ICMP报文件为IP层数据报的数据加上数据报的首部，组成IP数据报发送出去。</p>
</li>
</ul>
<h3><span id="icmp报文格式">ICMP报文格式</span></h3><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/ICMP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg"></p>
<ul>
<li><p>类型(Type)：表示ICMP报文的类型，占用1个字节（8位），共定义了13种类型。</p>
</li>
<li><p>代码(Code)：表示具体的ICMP操作，通常与类型一起使用，占用1个字节，共定义了很多种不同的值。</p>
</li>
<li><p>校验和(Checksum)：用于校验ICMP报文头和数据部分，占用2个字节。</p>
</li>
<li><p>其他(Header&#x2F;Rest of header)：是指ICMP报文头的剩余部分，长度不固定。</p>
</li>
</ul>
<h3><span id="icmp报文的种类">ICMP报文的种类</span></h3><ul>
<li>ICMP差错报告报文和ICMP询问报文</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ICMP报文种类</th>
<th align="center">类型的值</th>
<th align="center">ICMP报文的类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">差错报告报文</td>
<td align="center">3</td>
<td align="center">重点不可达</td>
</tr>
<tr>
<td align="center">差错报告报文</td>
<td align="center">11</td>
<td align="center">时间超过</td>
</tr>
<tr>
<td align="center">差错报告报文</td>
<td align="center">12</td>
<td align="center">参数问题</td>
</tr>
<tr>
<td align="center">差错报告报文</td>
<td align="center">5</td>
<td align="center">改变路由（Redirect）</td>
</tr>
<tr>
<td align="center">询问报文</td>
<td align="center">8或0</td>
<td align="center">回送（Echo）轻裘或回答</td>
</tr>
<tr>
<td align="center">询问报文</td>
<td align="center">13或14</td>
<td align="center">时间戳（Timestamp）请求或回答</td>
</tr>
</tbody></table>
<h4><span id="icmp差错报告报文">ICMP差错报告报文</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/ICMP%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg"></p>
<ul>
<li>ICMP差错报告报文共分为4种类型。</li>
</ul>
<ol>
<li><p>终点不可达(Destination Unreachable)：目的主机无法到达，可能是因为主机正在关闭、主机被拒绝，或者网络无法访问等原因。</p>
</li>
<li><p>时间超时(Time Exceeded)：报告数据包在传输过程中经过的路由器数量超过了规定的时间限制，可能是因为路由表中的路由异常或网络拓扑发生变化等原因。</p>
</li>
<li><p>参数问题(Parameter Problem)：用于指示数据包中存在的参数不可接受，可能是由于数据包格式不正确或路由异常造成的。</p>
</li>
<li><p>改变路由(Redirect)：提示主机使用更优的路径转发数据包，通常是由路由器向源主机发送的。</p>
</li>
</ol>
<ul>
<li>不应发送ICMP差错报告报文的几种情况。</li>
</ul>
<ol>
<li><p>对ICMP差错报文，不再发送ICMP差错报告报文。</p>
</li>
<li><p>对第一个分片的数据报片的所有后续数据报片，都不发送ICMP差错报告报文。</p>
</li>
<li><p>对具有多播地址的数据报，都不发送ICMP差错报文。</p>
</li>
<li><p>对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报，不发送ICMP差错报告报文。</p>
</li>
</ol>
<h4><span id="icmp询问报文">ICMP询问报文</span></h4><ul>
<li>ICMP询问报文有2种类型。</li>
</ul>
<ol>
<li><p>回送请求和回答：ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问；收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。</p>
</li>
<li><p>时间戳请求和回答：ICMP时间戳请求报文是请某台主机或路由器回答当前的日期和时间；在ICMP时间戳回答报文中有一个32位的字段，其写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。</p>
</li>
</ol>
<h3><span id="icmp的应用举例">ICMP的应用举例</span></h3><ul>
<li><p>PING用来测试两个主机之间的连通性</p>
</li>
<li><p>Traceroute</p>
</li>
</ul>
<h2><span id="ipv6">IPv6</span></h2><h3><span id="ipv6的基本首部">IPv6的基本首部</span></h3><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5.jpg"></p>
<ul>
<li>与IPv4相比，IPv6对首部中的某些字段进行了修改：</li>
</ul>
<ol>
<li><p>取消了首部长度字段，因为它的首部长度是固定的（40字节）。</p>
</li>
<li><p>取消了服务类型字段，因为优先级和流标号字段实现了服务类型字段的功能。</p>
</li>
<li><p>取消了总长度字段，改用有效载荷长度字段。</p>
</li>
<li><p>取消了标识、标志和片偏移字段，因为这些功能已包含在分片扩展首部中。</p>
</li>
<li><p>把TTL字段改称为跳数限制字段，但作用是一样的（名称与作用更加一致）。</p>
</li>
<li><p>取消了协议字段，改用下一个首部字段。</p>
</li>
<li><p>取消了检验和字段，这样就加快了路由器处理数据报的速度。我们知道，在数据路层对检测出有差错的帧就丢弃。在运输层，当使用 UDP时，若检测出有差错用户数据报就丢弃。当使用 TCP 时，对检测出有差错的报文段就重传，直到正传送到目的进程为止。因此在网络层的差错检测可以精简掉。</p>
</li>
<li><p>取消了选项字段，而用扩展首部来实现选项功能。</p>
</li>
</ol>
<ul>
<li>基本首部字段组成：</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%9F%BA%E6%9C%AC%E9%A6%96%E9%83%A8.jpg"></p>
<ol>
<li><p>版本号version（4位）：指定IPv6的版本号，固定为6。</p>
</li>
<li><p>流量类别traffic class（8位）：指定数据包的流量类别，包括优先级和流量类型，用于QoS（服务质量）控制。</p>
</li>
<li><p>流量标记flow label（20位）：指定数据包的流标记，用于标识数据包所属的流。</p>
</li>
<li><p>负载长度payload length（16位）：指定IPv6数据报的有效载荷长度，不包括IPv6首部。</p>
</li>
<li><p>下一个首部next header（8位）：指定下一个首部的类型，用于指示封装在IPv6包中的上层协议类型。</p>
</li>
<li><p>跳数限制top limit（8位）：与IPv4中的TTL（生存时间）类似，指定数据包在网络中最多可以经过的路由器数目。</p>
</li>
<li><p>源地址（128位）：指定数据包的源地址，用于标识数据包的发送者。</p>
</li>
<li><p>目的地址（128位）：指定数据包的目的地址，用于标识数据包的接收者。</p>
</li>
</ol>
<ul>
<li>主要变化</li>
</ul>
<ol>
<li><p>更大的地址空间：32位增大到128位；</p>
</li>
<li><p>扩展的地址层次结构；</p>
</li>
<li><p>灵活的首部格式；</p>
</li>
<li><p>改进的选项；</p>
</li>
<li><p>允许协议继续扩充；</p>
</li>
<li><p>支持即插即用（自动配置）；</p>
</li>
<li><p>支持资源的预分配；</p>
</li>
<li><p>IPv6首部改为8字节对齐。</p>
</li>
</ol>
<ul>
<li>IPv6数据报的一般形式：基本首部和有效载荷。</li>
</ul>
<h4><span id="特殊首部">特殊首部</span></h4><ul>
<li>IPv6的首部总长度为40字节，比IPv4的首部长度多出很多。其中有一些特殊的首部：</li>
</ul>
<ol>
<li><p>路由首部：该首部用于记录IPv6数据包在传输过程中的路由信息，可以使路由器在转发数据包时根据路由表选择最优的路径，从而提高网络性能。该首部共8字节长。</p>
</li>
<li><p>分段首部（Fragmentation Header）：IPv6和IPv4不同的是，IPv6规定了数据包只能在源节点进行分段操作，这意味着在中间路由器上不会产生数据包分片。然而，如果数据包超过了MTU（Maximum Transmission Unit），则需要将其进行分段，以保证传输的可靠性。分段首部用于记录数据包的分段情况，由于IPv6的负载部分可能很大，因此该首部需要16个字节长。</p>
</li>
<li><p>身份识别首部（Authentication Header）：该首部与安全相关，用于在保护模式下验证IPv6数据包的真实性和完整性，避免遭受攻击和窃听等安全威胁。该首部长度不定，最大值为64个字节。</p>
</li>
<li><p>加密首部（Encapsulating Security Payload）：该首部与身份识别首部类似，也是用于保证IPv6数据包的安全性，但它采用的是加密算法来对数据进行保护，使得数据在传输过程中无法被窃取或篡改。该首部长度不定。</p>
</li>
</ol>
<h3><span id="ipv6的地址">IPv6的地址</span></h3><ul>
<li><p>IPv6数据报的目的地址有三种基本类型：单播、多播、任播（任播的目的站是一组计算机，但数据报交付时只交付其中一个，通常是最近的一个）。</p>
</li>
<li><p>IPv6采用冒号十六进制记法指的是IPv6地址表示方法中使用冒号将128位（16个字节）地址分为8组，每组用四位十六进制数表示。由于IPv6地址比IPv4地址更长，使用冒号十六进制记法可以使IPv6地址更为简洁，易于记忆和书写。同时IPv6支持零压缩。</p>
</li>
</ul>
<p>例如，IPv6地址2001:0db8:85a3:0000:0000:8a2e:0370:7334可以简写为2001:db8:85a3::8a2e:370:7334，在这里双冒号“::”表示一连串的0。</p>
<ul>
<li>IPv6依然支持CIDR的斜线表示法。</li>
</ul>
<h4><span id="ipv6地址分类">IPv6地址分类</span></h4><table>
<thead>
<tr>
<th align="center">地址类型</th>
<th align="center">二进制前缀</th>
</tr>
</thead>
<tbody><tr>
<td align="center">未指明地址</td>
<td align="center">00…0（128位），可记为::&#x2F;128</td>
</tr>
<tr>
<td align="center">环回地址</td>
<td align="center">00…1（128位），可记为::1&#x2F;128</td>
</tr>
<tr>
<td align="center">多播地址</td>
<td align="center">11111111（8位），可记为::1&#x2F;128</td>
</tr>
<tr>
<td align="center">本地链路单播地址</td>
<td align="center">1111111010（10位），可记为FE80::&#x2F;10</td>
</tr>
<tr>
<td align="center">全球单播地址</td>
<td align="center">除上述四种外其他的二进制前缀</td>
</tr>
</tbody></table>
<ul>
<li>未指明地址</li>
</ul>
<p>这是16 字节的全0地址，可缩写为两个冒号“::”。这个地址不能用作目的地址，而只能为某台主机当作源地址使用，条件是这台主机还没有配置到一个标准的P地址。这类地址仅此一个。</p>
<ul>
<li>环回地址</li>
</ul>
<p>IPv6 的环回地址是 0:0:0:0:0:0:0:1，可缩写为::1。它的作用和IPv4的环回地址一样。这类地址也是仅此一个。</p>
<ul>
<li>多播地址</li>
</ul>
<p>功能和IPv4的一样。这类地址占IPv6地址总数的1&#x2F;256。</p>
<ul>
<li>本地链路单播地址（Link-Local Unicast Address）</li>
</ul>
<p>有些单位的网络使用TCP&#x2F;IP协议，但并没有连接到互联网上。连接在这样的网络上的主机都可以使用这种本地地址进行通信，但不能和互联网上的其他主机通信。这类地址占IPv6地址总数的1&#x2F;1024。</p>
<ul>
<li>全球单播地址</li>
</ul>
<p>IPv6的这一类单播地址是使用得最多的一类。曾提出过多种方案来进一步划分这128位的单播地址。根据2006年发布的草案标准RFC4291 的建议，IPv6单播地址的划分方法非常灵活，可以如图所示的任何一种。这就是说，可把整个的128比特都作为一个结点（主机）的地址。也可用n比特作为子网前缀，用剩下的(128-n）比特作为接口标识符（相当于 IPv4的主机号)。当然也可以划分为三级，用n比特作为全球路由选择前缀，用m比特作为子网前缀，而用剩下的(128-n-m)比特作为接口标识符。</p>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/IPv6%E7%9A%84%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86.jpg"></p>
<h3><span id="从ipv4向ipv6过渡">从IPv4向IPv6过渡</span></h3><ul>
<li>向IPv6过渡只能采用逐步演进的办法，同时保证新安装的IPv6系统能够向后兼容。</li>
</ul>
<h4><span id="双协议栈">双协议栈</span></h4><ul>
<li>双协议栈（Dual Stack）是指在同一设备上同时实现IPv4和IPv6两种协议栈，从而可以在IPv4和IPv6网络之间进行无缝转换。</li>
</ul>
<p>采用双协议栈的设备可以通过IPv4和IPv6两种协议来与网络中的其他设备进行通信，从而避免了IPv4地址不足和IPv6未普及等问题。</p>
<p>在双协议栈中，每个网络接口都有一个IPv4地址和一个IPv6地址，不同协议的数据包可以使用各自的协议栈进行处理，并在需要时通过网关或路由器进行互联。在Linux系统中，可以使用ifconfig命令查看设备的IPv4和IPv6地址，也可以使用ip addr命令来查看。</p>
<p>双协议栈技术的广泛应用可以使得IPv6网络逐渐普及，而不必担心IPv4地址短缺和网络地址转换等问题。然而，在实际应用中，也存在着双协议栈对网络性能的影响、安全性问题和IPv4&#x2F;IPv6之间的互通性等挑战，需要进行适当的优化和调整。</p>
<h4><span id="隧道技术">隧道技术</span></h4><ul>
<li>隧道技术（Tunneling）是一种在一个网络中传递另一个网络协议的方法。它通过在封装的数据包中添加一个新的头部，将这些数据包重新封装，并发送到目标节点，从而实现不同网络协议之间的通信。隧道技术可以用于连接两个独立的网络（例如不同的局域网），也可用于通过互联网连接两个远程网络。</li>
</ul>
<p>隧道技术常用的协议有多种，包括比较常见的有GRE、L2TP、PPTP等。其中，GRE协议（Generic Routing Encapsulation）是最常用的隧道技术之一。它可以将不同的IP数据包封装到GRE帧中，形成新的GRE数据包进行传输。使用GRE隧道技术可以构建虚拟专有网络（VPN），并向外扩展网络，提高网络安全性和数据传输效率。</p>
<p>在实际应用中，隧道技术被广泛用于跨越不同网络或者VPN之间的数据传输，在企业内部或者跨地区之间实现安全可靠的数据传输。但同时，隧道技术也会增加一定的链路开销和网络负担，需要在实际应用中进行合理选择和使用。</p>
<h3><span id="icmpv6">ICMPv6</span></h3><ul>
<li>ICMPv6（Internet Control Message Protocol version 6）是IPv6网络层协议中的一个重要组成部分，用于在IP数据包传输过程中提供控制和错误报告功能。它可以帮助网络管理员诊断网络问题，例如路由器是否可达、连通性、MTU大小等。</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E6%96%B0%E6%97%A7%E7%89%88%E6%9C%AC%E7%9A%84%E7%BD%91%E7%BB%9C%E5%B1%82.jpg"></p>
<ul>
<li><p>ICMPv6报文分为：差错报文、信息报文、邻站发现报文、组成员关系报文。</p>
</li>
<li><p>ICMPv6与IPv4版本中的ICMP有一些不同之处。下面是一些ICMPv6的特点：</p>
</li>
</ul>
<ol>
<li><p>ICMPv6支持更多的消息类型：ICMPv6支持新的消息类型，如邻居请求（Neighbor Solicitation）、邻居通告（Neighbor Advertisement）、路由器请求（Router Solicitation）、路由器通告（Router Advertisement）等，这些消息类型在IPv6网络中具有重要的作用。</p>
</li>
<li><p>ICMPv6支持数据报文片段：IPv6协议要求每个中间路由器所能转发的最大数据包长度（MTU）必须大于1280字节，但由于各种原因，可能会出现MTU小于1280字节的情况。为了解决这个问题，ICMPv6引入了数据报文片段和Path MTU发现机制，以支持更大的IPv6数据报文的传输。</p>
</li>
<li><p>ICMPv6是强制性的：在IPv6协议中，ICMPv6的实现是强制性的，所有IPv6设备必须实现ICMPv6协议，这使得ICMPv6在IPv6网络中具有重要的作用。</p>
</li>
</ol>
<h2><span id="互联网的路由选择协议">互联网的路由选择协议</span></h2><h3><span id="有关路由选择协议的几个基本概念">有关路由选择协议的几个基本概念</span></h3><h4><span id="理想的路由算法">理想的路由算法</span></h4><ul>
<li>一个理想的路由算法应满足以下特点</li>
</ul>
<ol>
<li><p>算法必须是正确的和完整的。</p>
</li>
<li><p>算法在计算上应简单。</p>
</li>
<li><p>算法应能适应通信量和网络拓扑的变化，有自适应性（鲁棒性，robustness）。</p>
</li>
</ol>
<p>静态路由选择策略——非自适应性路由选择</p>
<p>动态路由选择策略——自适应性路由选择</p>
<ol start="4">
<li><p>算法应具有稳定性。</p>
</li>
<li><p>算法应是公平的。</p>
</li>
<li><p>算法应是最佳的。</p>
</li>
</ol>
<ul>
<li>换种说法，也可满足以下特点：</li>
</ul>
<ol>
<li><p>最短路径：理想的路由算法应该能够找到最短的路径。这样可以减少数据包传输的时间和网络负载。</p>
</li>
<li><p>快速收敛：路由算法应该能够快速地适应网络拓扑变化，重新计算路径并更新路由表，以便在最短的时间内将数据包送达目的地。</p>
</li>
<li><p>无环：理想的路由算法应该能够保证不存在环路。如果存在环路，数据包可能会一直在网络中循环，导致网络阻塞。</p>
</li>
<li><p>可靠性：路由算法应该能够保证网络的可靠性，即在网络中发生故障时仍能够正常运行。</p>
</li>
<li><p>负载均衡：理想的路由算法还应该能够实现负载均衡，即将数据包分配到多个路径上，使得网络负载分布均匀。</p>
</li>
<li><p>可扩展性：路由算法应该能够适应网络规模的增长，支持更多的网络节点和路由器。</p>
</li>
<li><p>安全性：路由算法应该能够保证网络的安全性，防止黑客入侵和攻击。</p>
</li>
</ol>
<h4><span id="分层次的路由选择协议">分层次的路由选择协议</span></h4><h5><span id="自治系统as">自治系统AS</span></h5><ul>
<li>自制系统AS（Autonomous System）是指企业或组织自己搭建和管理的互联网组网系统。</li>
</ul>
<p>它是一个自治的网络系统，具有统一的管理和控制，可以进行独立的路由选择和运营。</p>
<ul>
<li><p>自制系统AS通常由多个网络设备和路由器组成，这些设备可以连接到不同的ISP（Internet Service Provider）网络，也可以连接到其他自制系统AS。自制系统AS通过BGP（Border Gateway Protocol）协议与其他AS交换路由信息，实现互联互通。</p>
</li>
<li><p>自制系统AS的优点包括：</p>
</li>
</ul>
<ol>
<li><p>可以独立控制和管理网络，不受ISP的限制和影响。</p>
</li>
<li><p>可以根据需求定制网络拓扑结构和路由选择策略，提高网络效率和可靠性。</p>
</li>
<li><p>可以实现多条路径的负载平衡和路由聚合，减少网络拥塞和延迟。</p>
</li>
<li><p>可以提高网络安全性，实现访问控制、流量过滤等功能。</p>
</li>
<li><p>可以降低网络成本，避免ISP的高昂收费。</p>
</li>
</ol>
<ul>
<li>自制系统AS的缺点包括：</li>
</ul>
<ol>
<li><p>需要投入大量的人力、物力和财力，进行网络设计、搭建和运维。</p>
</li>
<li><p>需要具备一定的技术水平和经验，以便有效地管理和维护网络。</p>
</li>
<li><p>需要购买和维护网络设备和软件，增加了成本和风险。</p>
</li>
<li><p>自制系统AS无法避免Internet中出现的一些问题，如黑客攻击、网络故障等。</p>
</li>
</ol>
<h5><span id="互联网的路由选择协议">互联网的路由选择协议</span></h5><ul>
<li><p>内部网关协议IGP（Interior Gateway Protocol）：RIP和OSPF</p>
</li>
<li><p>外部网关协议EGP（External Gateway Protocol）：BGP</p>
</li>
<li><p>自治系统之间的路由选择也叫做域间路由选择，在自治系统内部的路由选择叫作域内路由选择。</p>
</li>
</ul>
<h3><span id="内部网关协议rip">内部网关协议RIP</span></h3><ul>
<li><p>RIP（Routing Information Protocol）：是一种分布式的、基于距离向量的协议，用于在小型网络中进行路由选择。</p>
</li>
<li><p>RIP将路由器之间的距离（最短距离）表示为跳数，即经过的路由器数量。</p>
</li>
</ul>
<p>RIP要求网络中每个路由器都要维护从它自己到其他每一个目的网络的距离记录，即距离向量，具体定义距离如下：从一个路由器到直接连接的网络的距离为1，到非直接连接的网络的距离则定义为所经过的路由器数+1。例如，路由器R1与网1直接相连，路由器R1到网1的距离是1；但到不直接相连的网2的距离是所经过的路由器数+1。</p>
<p>RIP允许一条路径最多只能包含15个路由器。“距离”的最大值为16时即相对于不可达，所以适用于小型网络。</p>
<p>当网络中出现环路时，可能会导致路由收敛失败，即路由不断地振荡，无法收敛。此时需要借助于拓扑改进，如Split-Horizon、Route-Poisoning等技术来解决。此处“收敛”就是在自治系统AS中所有的结点都得到正确的路由选择信息的过程。</p>
<ul>
<li><p>RIP认为一个好的路由就是它通过的路由器的数目少，即“距离短”。</p>
</li>
<li><p>RIP协议的三个特点</p>
</li>
</ul>
<ol>
<li><p>仅和相邻路由器交换信息；</p>
</li>
<li><p>交换的信息是当前本路由器所知道的全部信息，即自己的路由表；</p>
</li>
<li><p>按固定的时间间隔交换路由信息。如RIP每30秒发送一次路由更新信息，以保持网络拓扑的最新状态。</p>
</li>
</ol>
<ul>
<li>RIP“好消息”传得快，“坏消息”传得慢，当出现故障时，更新时间的收敛时间较长，传播信息时间往往花费较多。</li>
</ul>
<h4><span id="路由表的建立">路由表的建立</span></h4><ol>
<li>邻居发现</li>
</ol>
<p>在建立路由表之前，路由器首先要发现相邻的路由器，以便向它们传递路由信息。这个过程叫做邻居发现。</p>
<p>路由器在刚刚开始工作时，只知道到直接连接的网络的距离（此距离定义为1)。它的路由表是空的。</p>
<p>路由器可以通过以下两种方式来发现相邻的路由器：静态配置：手动在路由器上进行配置。这种方法适用于小型网络，但当网络规模扩大时，手动配置就变得繁琐且容易出错。<br>动态发现：路由器之间通过路由协议（如OSPF、BGP、RIP等）进行交互，自动发现邻居。</p>
<ol start="2">
<li>路由计算</li>
</ol>
<p>当路由器发现相邻的路由器后，需要开始路由计算，计算出最佳的路径和下一跳信息。路由计算根据不同的路由选择协议有不同的计算方法和指标。常用的指标有：距离（Metric）：比如RIP协议中的跳数；带宽（Bandwidth）：比如OSPF协议中的链路带宽；延迟（Delay）：比如OSPF协议中的链路延迟；可靠性（Reliability）：比如EIGRP协议中的链路可靠性。</p>
<p>在路由计算中，路由器首先需要确定到达目标网络的可能路径，然后通过路由选择协议计算每条路径的指标值，最后选择指标最优的路径作为最终路径，并将该路径和下一跳信息加入到路由表中。</p>
<p>以后，每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。</p>
<ul>
<li><p>经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。</p>
</li>
<li><p>RIP 协议的收敛(convergence）过程较快。</p>
</li>
</ul>
<h4><span id="距离向量算法">距离向量算法</span></h4><ul>
<li><p>距离向量算法的基础就是Bellman-Ford算法（或Ford-Fulkerson算法）。</p>
</li>
<li><p>路由器收到相邻路由器（其地址为X）的一个RIP报文：</p>
</li>
</ul>
<ol>
<li><p>先修改此RIP报文中的所有项目：把“下一跳”字段中的地址都改为X，并把所有的“距离”字段的值加1。</p>
</li>
<li><p>对修改后的RIP报文中的每一个项目，重复以下步骤：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">若项目中的目的网络不在路由表中</span><br><span class="line">    则把该项目加到路由表中。</span><br><span class="line">否则</span><br><span class="line">    若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。</span><br><span class="line">否则</span><br><span class="line">    若收到项目中的距离小于路由表中的距离，则进行更新，</span><br><span class="line">否则</span><br><span class="line">    什么也不做。</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>若3分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为16（表示不可达）。</p>
</li>
<li><p>返回。</p>
</li>
</ol>
<h4><span id="rip2协议的报文格式">RIP2协议的报文格式</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/RIP2%E7%9A%84%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg"></p>
<ul>
<li>RIP2消息头：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">长度（字节）</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">命令</td>
<td align="center">1</td>
<td align="center">请求（1）&#x2F;响应（2）</td>
</tr>
<tr>
<td align="center">版本</td>
<td align="center">1</td>
<td align="center">RIP2协议版本（2）</td>
</tr>
<tr>
<td align="center">保留</td>
<td align="center">2</td>
<td align="center">保留字段，必须为0</td>
</tr>
</tbody></table>
<ul>
<li>RIP2路由项：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">长度（字节）</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">地址族</td>
<td align="center">2</td>
<td align="center">地址族，IPv4（2）</td>
</tr>
<tr>
<td align="center">标记</td>
<td align="center">2</td>
<td align="center">路由标记，必须为0</td>
</tr>
<tr>
<td align="center">IPv4地址</td>
<td align="center">4</td>
<td align="center">目的网络的IPv4地址</td>
</tr>
<tr>
<td align="center">子网掩码</td>
<td align="center">4</td>
<td align="center">目的网络的子网掩码</td>
</tr>
<tr>
<td align="center">下一跳</td>
<td align="center">4</td>
<td align="center">下一跳的IPv4地址</td>
</tr>
<tr>
<td align="center">距离</td>
<td align="center">4</td>
<td align="center">路由距离，最大为15</td>
</tr>
<tr>
<td align="center">标签</td>
<td align="center">4</td>
<td align="center">路由标签，可选项</td>
</tr>
</tbody></table>
<p>RIP2协议的报文格式与RIP1协议的报文格式类似，但RIP2协议支持VLSM（可变长度子网掩码）和CIDR（无类域间路由），可以在同一个网络上使用不同的子网掩码。同时，RIP2协议还支持多播路由，可以将多个路由项封装在同一个消息中发送。</p>
<ul>
<li>一个RIP报文最多可包括25个路由，因而RIP报文最大长度是$4+20×25&#x3D;504$字节。</li>
</ul>
<h3><span id="内部网关协议ospf">内部网关协议OSPF</span></h3><ul>
<li><p>OSPF（Open Shortest Path First）：OSPF是一种链路状态协议，用于在大规模网络中进行路由选择，具有更快的收敛性、更佳的稳定性和更广泛的可扩展性。</p>
</li>
<li><p>OSPF通过交换链路状态信息来计算最短路径。OSPF使用Dijkstra算法来计算最短路径。OSPF还支持分层网络结构和多个路由器之间的负载平衡。</p>
</li>
<li><p>OSPF通过在路由器之间通告网络接口的状态来建立链路状态数据库（LSDB），生成最短路径树，并由每个OSPF路由器使用这些最短路径构造它的路由表。主要特点如下：使用分布式的链路状态协议；支持类别路由和可变长度子网掩码（VLSM）；支持多种类型的服务和路由器类型；支持大型网络的可扩展性。</p>
</li>
<li><p>OSPF协议中，所有的路由器都知道网络的全局拓扑结构，且具备向其它路由器传递链路状态信息的能力。当出现路由变化时，只需要把改变的信息通告给整个网络，让每个路由器根据链路状态更新与之相关的信息即可。这样，整个网络只需数秒或数十秒即可完成从原最短路径到新最短路径的转移，从而实现网络的快速收敛。</p>
</li>
<li><p>OSPF支持基于区域的设计，可以将整个网络划分成若干个区域，每个区域内部使用独立的SPF计算，从而降低计算负担并提高网络的可扩展性。同时，OSPF支持路由器的多线接口和多地址，可以自动发现邻居路由器并建立邻居关系，实现更加灵活的网络设计。</p>
</li>
<li><p>OSPF还具有下列的一些特点：</p>
</li>
</ul>
<ol>
<li><p>OSPF 允许管理员给每条路由指派不同的代价。例如，高带宽的卫星链路对于非实时的业务可设置为较低的代价，但对于时延敏感的业务就可设置为非常高的代价。因此，OSPF对于不同类型的业务可计算出不同的路由。链路的代价可以是1至65535中的任何一个无量纲的数，因此十分灵活。商用的网络在使用OSPF时，通常根据链路带宽来计算链路的代价。这种灵活性是RIP所没有的。</p>
</li>
<li><p>如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这叫做多路径间的负载平衡(load balancing)。在代价相同的多条路径上分配通信量是通信量工程中的简单形式。RIP只能找出到某个网络的一条路径。</p>
</li>
<li><p>所有在OSPF 路由器之间交换的分组（例如，链路状态更新分组）都具有鉴别的功能，因而保证了仅在可信赖的路由器之间交换链路状态信息。</p>
</li>
<li><p>OSPF 支持可变长度的子网划分和无分类的编址CIDR。</p>
</li>
<li><p>由于网络中的链路状态可能经常发生变化，因此OSPF让每一个链路状态都带上一个32位的序号，序号越大状态就越新。OSPF 规定，链路状态序号增长的速率不得超过每5秒钟1 次。这样，全部序号空间在600年内不会产生重复号。</p>
</li>
</ol>
<h4><span id="ospf分组首部">OSPF分组首部</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/OSPF%E5%88%86%E7%BB%84%E7%94%A8IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E4%BC%A0%E9%80%81.jpg"></p>
<ol>
<li><p>版本号：表示OSPF协议的版本，通常为2；</p>
</li>
<li><p>分组类型：表示该分组是Hello、DDP（Database Description Packets）、LSR（Link-state Request）、LSU（Link-state Update）还是LSAck（Link-state Acknowledgment）中的哪一种；</p>
</li>
<li><p>分组长度：表示该OSPF分组的总长度，以字节为单位；</p>
</li>
<li><p>路由器ID：表示发送该分组的OSPF路由器的ID；</p>
</li>
<li><p>区域ID：表示发送该分组的OSPF路由器所在的区域的ID；</p>
</li>
<li><p>分组检验和：校验整个OSPF分组是否出错或损坏。</p>
</li>
<li><p>鉴别类型：0（不用）和1（口令）；</p>
</li>
<li><p>鉴别：鉴别类型为60时填入0，鉴别类型为1则填入8个字符的口令。</p>
</li>
</ol>
<h4><span id="ospf的五种分组类型">OSPF的五种分组类型</span></h4><ol>
<li>Hello报文，问候分组</li>
</ol>
<p>Hello报文是OSPF中最基本的报文类型，用于邻居关系的建立和维护。通过发送Hello报文，路由器之间可以确认是否处于同一网络，以及确定对方的IP地址和路由器ID等信息。</p>
<ol start="2">
<li><p>DDP（Database Description Packet）报文，数据库描述分组</p>
</li>
<li><p>LSR（Link State Request）报文，链路状态请求分组</p>
</li>
</ol>
<p>LSR报文用于请求邻居路由器的链路状态信息。当某个路由器需要更新自己的LSDB时，会向邻居路由器发送LSR报文，请求其链路状态信息。</p>
<ol start="4">
<li>LSU（Link State Update）报文，链路状态更新分组</li>
</ol>
<p>LSU报文用于向邻居路由器通告本地路由器的链路状态信息。当某个路由器更新了自己的LSDB，并生成新的链路状态信息时，会向邻居路由器发送LSU报文，通告其链路状态信息。</p>
<ol start="5">
<li>LSAck（Link State Acknowledgment）报文，链路状态确认分组</li>
</ol>
<p>LSAck报文用于确认收到LSU报文或LSR报文。当某个路由器接收到LSU或LSR报文后，会向对方发送LSAck报文，表示已经正确接收到了对方发来的报文。</p>
<h4><span id="opsf的基本操作">OPSF的基本操作</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/OSPF%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C.jpg"></p>
<ul>
<li>工作流程</li>
</ul>
<ol>
<li><p>发现邻居：当OSPF路由器与相邻路由器建立连接时，会向对方发送Hello分组。如果对方回复了Hello分组，则可以建立邻居关系，否则说明有故障发生。</p>
</li>
<li><p>同步LSDB：当邻居之间建立连接后，它们会通过DDP（Database Description Packets）分组交换各自的LSDB（Link State Database）摘要信息，并比对更新对方的LSDB，使得两边的LSDB相同。</p>
</li>
<li><p>计算最短路径：在LSDB同步完成后，每个路由器都会计算出网络的最短路径。具体地，每个路由器将自身所在的区域视为一个独立的自治系统，进行SPF（Shortest Path First）算法运算，选出到达目标网段的最短路径，并保存在路由表中。</p>
</li>
<li><p>分发路由：每个路由器将自己的路由表发送给它的邻居，以便邻居更新自己的路由表。这个过程中，会以LSU（Link-state Update）分组的形式将更新的部分发送给所有邻居，并通过LSAck（Link-state Acknowledgment）分组确认收到的数据。</p>
</li>
<li><p>监控网络：OSPF协议能够动态地感知网络拓扑的变化，如果路由器发现某个邻居失效，则它会重新计算网络的最短路径，并将更新的信息发送给其他邻居，保证网络的连通性。</p>
</li>
</ol>
<ul>
<li>可靠的洪泛法保证LSA信息在网络中可靠传输的方法</li>
</ul>
<ol>
<li><p>链路状态更新数据的可靠性: OSPF协议确保可靠地通过持续的发送和接收确认报文来保障链路状态数据库的最新状态。当一个路由器将自己的LSA信息广播出去后，其他路由器会发送LSAck确认报文，表明已经收到该LSA信息。</p>
</li>
<li><p>序列号机制: OSPF中，每个LSA信息都有一个唯一的序列号。当某个LSA信息需要更新时，其序列号也必须更新。这样，在广播LSA信息时，接收方可以通过比对序列号来判断是否需要更新自己的LSDB。</p>
</li>
<li><p>路由器发现邻居的可靠性: OSPF协议通过Hello消息实现邻居关系的发现，并在每个LSA信息中加入“源路由器”字段，表明该LSA信息的来源路由器。这样，当某个路由器发现邻居失效时，它可以更新自己的LSDB并广播LSA信息，以保证整个网络拓扑的正确性。</p>
</li>
</ol>
<h3><span id="外部网关协议bgp">外部网关协议BGP</span></h3><ul>
<li><p>BGP（Border Gateway Protocol）：BGP是一种路径矢量协议，用于在互联网中进行路由选择。</p>
</li>
<li><p>BGP用于在不同自治系统之间交换路由信息。BGP使用路径属性来选择最佳路径。BGP还支持策略控制和路由聚合。</p>
</li>
<li><p>BGP协议特点</p>
</li>
<li><p>BGP-4共使用四种报文</p>
</li>
</ul>
<ol>
<li><p>打开（OPEN）报文，用来与相邻的另一个BGP发言人建立关系。</p>
</li>
<li><p>更新（UPDATE）报文，用来发送某一路由的信息，以及列出要撤消的多条路由。</p>
</li>
<li><p>保活（KEEPALIVE）报文，用来确认打开报文和周期性地证实邻站关系。</p>
</li>
<li><p>通知（NOTIFICATION）报文，用来发送检测到的差错。</p>
</li>
</ol>
<ul>
<li>BGP报文具有通用首部</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/BGP%E6%8A%A5%E6%96%87%E9%80%9A%E7%94%A8%E9%A6%96%E9%83%A8.jpg"></p>
<p>Marker（16字节）：用于同步BGP邻居之间的连接状态，由16个全为1的字节构成。Marker字段的存在是为了在连接建立时确保BGP邻居之间的状态同步，以及在连接中断后重新建立连接时，能够快速恢复连接状态。</p>
<p>Length（2字节）：表示整个BGP消息的长度，包括报文首部和消息体。</p>
<p>Type（1字节）：表示BGP消息的类型，包括OPEN、UPDATE、NOTIFICATION和KEEPALIVE四种类型。</p>
<h3><span id="路由器的构成">路由器的构成</span></h3><ul>
<li><p>路由器是一种典型的网络层设备，是互联网中的关键设备，是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。也就是说，将路由器某个输入端口收到的分组，按照分组要去的目的地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。</p>
</li>
<li><p>路由器的主要作用是：连通不同的网络。选择信息传送的线路。选择通畅快捷的近路，能大大提高通信速度，减轻网络系统通信负荷，节约网络系统资源，提高网络系统畅通率，从而让网络系统发挥出更大的效益来。</p>
</li>
</ul>
<h4><span id="路由器结构">路由器结构</span></h4><ul>
<li><p>路由器的转发分组正是网络层的主要工作。</p>
</li>
<li><p>整个路由器结构可分为：路由选择部分和分组转发部分。</p>
</li>
</ul>
<h4><span id="路由选择部分">路由选择部分</span></h4><ul>
<li>路由选择部分是路由器最核心的部分，它的任务是根据路由选择协议（例如OSPF或BGP）选择一条最佳的路径进行数据包转发。在这个过程中，路由器需要维护一个路由表，其中包含了网络中每个节点的地址和相互之间的距离等信息。路由器会根据路由表进行查找，以确定数据包应该被转发到哪个下一跳路由器。</li>
</ul>
<h4><span id="分组转发部分">分组转发部分</span></h4><ul>
<li>分组转发部分是路由器中负责处理接收到的数据包，并将其转发到正确的下一跳路由器的部分。在转发数据包之前，交换结构会对数据包进行一些处理，例如去除冗余数据、修改目的地址等。</li>
</ul>
<h4><span id="交换系统">交换系统</span></h4><ul>
<li>交换系统是路由器中用于数据包转发的硬件设备，它包括一组输入端口和一组输出端口。输入端口用于接收输入数据包，而输出端口用于发送输出数据包。交换结构本身也可以看作是一种网络，因此交换系统可以被视为“在路由器中的网络”。</li>
</ul>
<h2><span id="ip多播">IP多播</span></h2><h3><span id="ip多播的基本概念">IP多播的基本概念</span></h3><ul>
<li>IP多播是指一种在互联网中，将数据报文发送给一组目的地址的通信方式。</li>
</ul>
<p>IP多播为了更好地支持一对多通信（一个源点发送到许多个终点）。适用于需要向多个主机传输相同数据的应用程序，如视频&#x2F;音频流媒体、在线游戏、IP电话等。</p>
<p>与单播和广播不同，单播是一对一的通信方式，广播是一对多的通信方式，IP多播是一对多或一对多个的通信方式。</p>
<h4><span id="多播ip地址">多播IP地址</span></h4><ul>
<li>在IP多播中，发送方使用一个专门的IP地址（称为多播组地址）标识多个接收方。接收方可以通过加入相应的多播组地址来参与到IP多播中。当一个数据包发送到某个多播组地址时，所有加入该组的主机都可以接收到该数据包。这样就可以节省带宽，减少网络拥塞问题。</li>
</ul>
<h3><span id="在局域网上进行硬件多播">在局域网上进行硬件多播</span></h3><ul>
<li>D类IP地址与以太网多播地址的映射关系</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/D%E7%B1%BBIP%E5%9C%B0%E5%9D%80%E4%B8%8E%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%A4%9A%E6%92%AD%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84.jpg"></p>
<h3><span id="网际组管理协议igmp和多播路由选择协议">网际组管理协议IGMP和多播路由选择协议</span></h3><ul>
<li>IP多播需要两种协议：IGMP协议和多播路由选择协议。</li>
</ul>
<h4><span id="网际组管理协议">网际组管理协议</span></h4><ul>
<li><p>网际组管理协议（Internet Group Management Protocol，简称IGMP）用于在IP网络中通知路由器主机加入或离开特定的多播组。IGMP 工作在 IP 协议的高层，是一种基于主机组的协议，旨在允许主机通告加入或离开一个多播组。</p>
</li>
<li><p>IGMP 协议通过如下三种类型的报文实现通信：</p>
</li>
</ul>
<ol>
<li><p>成员查询报文（Membership Query Messages）：用于询问某个多播组是否有主机成员参与。IGMP 规范定义了两种成员查询报文，包括通用查询报文（General Query Messages）和特定查询报文（Group-Specific Query Messages）。</p>
</li>
<li><p>成员报告报文（Membership Report Messages）：用于向路由器通报加入了哪个多播组。</p>
</li>
<li><p>离开组报文（Leave Group Messages）：用于通知路由器成员已经离开。</p>
</li>
</ol>
<ul>
<li>IGMP工作流程如下：</li>
</ul>
<ol>
<li><p>主机加入多播组：主机要加入某个多播组时，会向路由器发送成员报告报文（Membership Report Messages），报文中包括了主机的 IP 地址和加入的多播组地址。</p>
</li>
<li><p>路由器处理请求：当路由器收到主机发送的成员报告报文后，就会判断该多播组是否已经存在于缓存中。如果不存在，则将该组添加到缓存中，并加入到相应的树状结构中。</p>
</li>
<li><p>路由器通告：路由器会向网络中其他主机广播成员查询报文（Membership Query Messages），以确定哪些主机加入了该多播组。</p>
</li>
<li><p>主机回复：当其他主机得到成员查询报文后，如果其也加入了该多播组，就会通过成员报告报文回复路由器，否则，不做出任何回应。</p>
</li>
<li><p>路由器维护缓存：路由器在接收到成员报告报文时，会更新相应的缓存记录，并通过发送查询报文来维护多播组的状态。对于长时间没有回应的主机，路由器会将其从缓存中删除。</p>
</li>
<li><p>主机离开多播组：当主机要离开多播组时，会发送离开组报文（Leave Group Messages），路由器收到报文后将该主机从多播组中删除，并更新缓存记录。</p>
</li>
</ol>
<h4><span id="多播路由选择协议">多播路由选择协议</span></h4><ul>
<li><p>多播路由选择协议（Multicast Routing Protocol）是一种用于在网络中进行多播数据传输的协议。它主要用于将一个多播组的数据包从源节点传输到所有接收该组信息的目的节点。</p>
</li>
<li><p>多播路由选择协议在转发多播数据报时使用的方法：</p>
</li>
</ul>
<ol>
<li>洪泛与剪除</li>
</ol>
<p>洪泛是一种简单而可靠的多播路由选择协议，其中路由器在收到多播数据包后，会将该数据包广播到所有邻居路由器。这样做的问题是可能会导致网络流量过大，并且数据包很可能会被多次重复传输。为了解决这个问题，洪泛与剪除技术被提出，它使用了一些优化策略来减少冗余的数据包传输。例如，每个路由器只发送一份数据包，而不是向所有邻居广播；并在不需要转发数据包的路由器上进行剪除操作，以减少网络流量。</p>
<ol start="2">
<li>隧道技术</li>
</ol>
<p>隧道技术是一种将多播数据包封装在单播数据包中进行传输的方法。在使用隧道技术时，源节点先把多播数据包封装在一个单播数据包中，并将其发送给特定目标地址的路由器。然后，目标路由器根据多播数据包的目的地址将其解包，并将其转发到所需的网络中。隧道技术可以在网络间安全地传输多播数据包，同时可以实现跨越无法直接连接的子网的多播传输。</p>
<ol start="3">
<li>基于核心的发现技术</li>
</ol>
<p>基于核心的发现技术是一种基于网络拓扑结构的多播路由选择协议。该协议使用核心路由器来维护多播路由信息，而不是每个路由器都存储完整的多播路由表。核心路由器是一个专用的路由器，它对多播数据包进行缓存和转发，并负责将数据包发送到正确的目标节点。基于核心的发现技术可以减少存储和计算开销，并且具有更高的可靠性和可扩展性。</p>
<ul>
<li>建议使用的多播路由选择协议：</li>
</ul>
<ol>
<li><p>DVMRP（Distance Vector Multicast Routing Protocol）：DVMRP是一种基于距离向量的多播路由选择协议。它使用类似于RIP（Routing Information Protocol）的算法来选择最佳路径。在DVMRP中，每个路由器会定期广播其到达其他路由器的距离向量信息。通过这种方式，每个路由器都能了解到整个网络的拓扑结构和距离，并选择最短路径来转发多播数据包。DVMRP适用于小型网络。</p>
</li>
<li><p>PIM-DM（Protocol Independent Multicast-Dense Mode）：PIM-DM是一种密集模式的多播路由选择协议。在PIM-DM中，路由器会向所有邻居广播多播数据包。然后，每个路由器会选择最短路径将数据包转发到目标网络。PIM-DM适用于网络密度较高的场景。</p>
</li>
<li><p>PIM-SM（Protocol Independent Multicast-Sparse Mode）：PIM-SM是一种稀疏模式的多播路由选择协议。在PIM-SM中，路由器只会将数据包发送到属于多播组的主机所在的网络。PIM-SM使用Rendezvous Point（RP）来确定多播组的根源和主机所在的网络。当有新的主机加入多播组时，它会向RP发送请求，RP会将其加入到多播组中。然后，PIM-SM会使用最短路径算法选择最佳路径将数据包转发到目标网络。PIM-SM适用于网络稀疏的场景。</p>
</li>
<li><p>MOSPF（Multicast OSPF）：MOSPF是一种基于OSPF（Open Shortest Path First）的多播路由选择协议。在MOSPF中，路由器会使用OSPF算法来计算网络的拓扑结构和距离，并选择最短路径将数据包转发到目标网络。MOSPF适用于大型网络。</p>
</li>
<li><p>CBT（Core Based Tree）：CBT也是基于构建点对节点树来进行多播转发的路由协议，属于核心支持型路由协议。</p>
</li>
</ol>
<h2><span id="虚拟专用网vpn和网络地址转换nat">虚拟专用网VPN和网络地址转换NAT</span></h2><h3><span id="虚拟专用网vpn">虚拟专用网VPN</span></h3><ul>
<li><p>虚拟专用网（Virtual Private Network，VPN）是一种通过公共网络建立安全连接的加密隧道。它可以在不同的地理位置之间建立一个私有网络，让用户相互之间可以安全、便捷地分享数据和资源。</p>
</li>
<li><p>VPN使用隧道技术，通过公共网络（如Internet）将通信数据封装成加密数据包，以保护数据的隐私性。当远程客户端连接到VPN服务器时，客户端和服务端之间建立一条虚拟链路，构成通向目标网络的加密隧道，这些数据被加密后通过公共网络进行传输，其中采用了多重认证和加密方法来确保私密数据的保密性，安全性。</p>
</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0VPN.jpg"></p>
<ul>
<li>常见的VPN协议包括PPTP（Point-to-Point Tunneling Protocol）、L2TP（Layer Two Tunneling Protocol）、SSTP、IPSec（Internet Protocol Security）等。其中，PPTP和L2TP是较为简单的协议，通常用于家庭和小型企业；而SSTP和IPSec是较为复杂和安全的协议，通常用于大型企业和政府机构。</li>
</ul>
<h3><span id="网络地址转换nat">网络地址转换NAT</span></h3><ul>
<li><p>网络地址转换（Network Address Translation，NAT）是一种将私有IP地址映射为公共IP地址的技术。当企业或组织网络内部使用私有IP地址时，需要通过网络地址转换功能来实现与公网连接通信，以使本地设备可以访问公网或被公网访问。</p>
</li>
<li><p>NAT技术的实现基于一个称为NAT路由器的设备，这个设备拥有一个公共IP地址和一个内部的私有IP地址。当内部主机向公共网络发送数据包时，NAT路由器会自动扫描数据包的源IP地址，并将其替换成NAT路由器的公共IP地址。相反，当外部主机回复该数据包时，NAT路由器会将公共IP地址还原回原始内部主机的私有IP地址。</p>
</li>
</ul>
<p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/NAT%E8%B7%AF%E7%94%B1%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg" alt="NAT路由器工作原理"></p>
<ul>
<li>常见的NAT类型包括以下四种：</li>
</ul>
<ol>
<li><p>静态NAT：静态NAT固定分配一个公网IP地址到内部网络的特定主机或服务，从而使对应的服务在互联网上可达。</p>
</li>
<li><p>动态NAT：动态NAT是动态分配公网IP地址，在内网用户向Internet提交请求时临时出现，提高了安全性同时也保持了网络的稳定性。</p>
</li>
<li><p>端口映射（Port Mapping，PAT）：用于多个主机共享同一个公网IP地址的方式，通过将不同端口的访问映射到不同内部主机和服务上，从而使得内网用户可以同时使用公网地址进行访问。</p>
</li>
<li><p>双重NAT：双重NAT是在一个NAT路由器后面再次添加另外一个NAT路由器。这种方法能够防范暴力攻击、嗅探、端口扫描等危险活动，并提高了局域网内部设备与互联网之间的安全性，但也可能导致信号延迟、数据传输速度下降等问题。</p>
</li>
</ol>
<ul>
<li>NAT技术也会导致一些问题，例如：</li>
</ul>
<ol>
<li><p>NAT使得局域网内的多个设备共享同一个公共IP地址，因此不便于协议和端口的过滤等安全控制。</p>
</li>
<li><p>NAT会影响通信质量和可靠性，因为它增加了路由器的负载并可能丢失或重排数据包。</p>
</li>
<li><p>在某些应用程序中，如IP电话、视频会议、P2P等，NAT可能会对数据传输造成影响，导致无法正常连接或者丢失数据。</p>
</li>
</ol>
<h2><span id="多协议标签交换mpls">多协议标签交换MPLS</span></h2><ul>
<li><p>多协议标记交换（Multiprotocol Label Switching，MPLS）是一种用于建立高效路由的技术，它可以在传输数据包时，根据数据包的标记直接转发数据包，而不需要重复地进行IP地址查找。MPLS技术在网络中将数据分成以标记（Label）为基础的流进行转发和处理，可以实现高效的数据传输和负载均衡，提高了网络的性能和可靠性。</p>
</li>
<li><p>MPLS技术的优点如下：</p>
</li>
</ul>
<ol>
<li><p>高效的转发机制：由于MPLS是基于标记进行转发，避免了重复查找IP地址和路由信息的过程，使得网络转发效率更高。</p>
</li>
<li><p>灵活的QoS保证：MPLS可以基于标记进行数据流分类和服务质量保证，支持多种差别化服务的实现。</p>
</li>
<li><p>网络可扩展性好：由于MPLS是基于标记而不是IP地址进行数据转发，因此避免了IP地址的诸多限制，使网络架构更加灵活和可扩展。</p>
</li>
<li><p>安全性高：在MPLS网络中，数据流只能沿着预定的路径传输，从而增强了数据传输的安全性。</p>
</li>
</ol>
<h3><span id="mpls的工作原理">MPLS的工作原理</span></h3><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/MPLS%E5%8D%8F%E8%AE%AE%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.jpg"></p>
<ul>
<li>在MPLS中，数据包被分为两个部分：标签和数据。标签用于确定数据包的转发路径或服务质量，而数据则代表着应用程序所要求传输的数据。MPLS由以下组成部分：</li>
</ul>
<ol>
<li><p>标签：标识数据包的路径、转发端口和服务质量等信息。</p>
</li>
<li><p>路由器：采用MPLS技术的网络设备，包括核心路由器和边缘路由器。</p>
</li>
<li><p>LSR（Label Switch Router）：即标签交换路由器，主要完成标记的交换转发和路径选择等操作。</p>
</li>
<li><p>LSP（Label Switch Path）：根据标签串联在一起的一条数据包转发路径，LSP可以是一个单独的物理链路、也可以是多条链路的组合形式。</p>
</li>
<li><p>FEC（Forwarding Equivalence Class）：表示一组具有相同路由逻辑规则和处理代码的数据流，通常映射为固定字段头和有效载荷的特定组合，对应着应用层中的各种协议和业务流量。</p>
</li>
</ol>
<p>FEC就是路由器按照同样方式对待的IP数据包集合。例如，在一个企业网络中有两个部门A和B，每个部门都需要使用不同的服务质量QoS优先级来传输流量。此时可以将部门A和B各自的流量划分到不同的FEC中，并为它们分别指定唯一的标签（Label）值来进行标记。接着，在路由器上配置FEC信息和转发策略，使得传输该FEC的数据流能够按照相应的FEC进行标记和转发，从而实现不同服务质量的保障。</p>
<ul>
<li>MPLS的工作原理是在数据包头部加入短标签（20位左右），该标签唯一地标识了这个流量的路径，并将数据包传输到下一个MPLS节点。转发节点仅需要根据标签来决定下一跳地址和出口端口即可快速转发数据，并将标记替换成下一个节点的标记。</li>
</ul>
<ol>
<li><p>标记分类：在发送端的边界路由器上，根据不同的VPN、服务质量等分类标记，对数据进行标记。</p>
</li>
<li><p>标记交换：在标记交换路由器（LSR）上，根据标记进行转发决策，并且可以根据标记对数据包进行QoS管理。</p>
</li>
<li><p>标记删除：在接收端的边界路由器上，将标记从数据包中去除，并将数据包交付到相应的目的地。</p>
</li>
</ol>
<h3><span id="mpls首部的位置与格式">MPLS首部的位置与格式</span></h3><h4><span id="mpls首部的位置">MPLS首部的位置</span></h4><ul>
<li>MPLS首部位于数据包头部，紧接着IPv4或IPv6首部。在数据包传输过程中，MPLS首部会一直跟随数据包，直到数据包到达目的地。MPLS首部位于网络层和数据链路层之间</li>
</ul>
<table>
<thead>
<tr>
<th align="center">网络层</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center">MPLS首部</td>
<td align="center">←插入</td>
</tr>
<tr>
<td align="center">数据链路层</td>
<td align="center"></td>
</tr>
</tbody></table>
<h4><span id="mpls首部的格式">MPLS首部的格式</span></h4><p><img src="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/MPLS%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.jpg"></p>
<ul>
<li>MPLS首部包含四个字段，分别为标签（Label）、实验位（Experimental）、堆叠位（Stack）、时间戳（TTL）。</li>
</ul>
<ol>
<li><p>标签（Label）：通常是20位长。MPLS首部中最重要的字段，用于唯一标识一个特定的FEC。标签是MPLS路由器进行数据包路由的依据，也可以用于提供服务质量保证以及安全性保护。</p>
</li>
<li><p>试验位（Experimental）：通常为3位长，用于提供服务质量的相关信息，例如优先级、延迟等。实验位可以支持8个不同的优先级，用于实现差别化服务，提高网络的性能和可靠性。</p>
</li>
<li><p>堆叠位（Stack）：1位长，用来指示MPLS路由器是否需要将当前标签压入一个新的MPLS头部中，并在数据包中添加一个新的标签。当堆叠位为0时，表示当前标签是最后一个标签，数据包将被转发到目的地，否则会根据新的标签进行继续路由。</p>
</li>
<li><p>时间戳（TTL）：8位长，与IPv4和IPv6首部的TTL作用类似，用于控制数据包在网络中的生存周期，防止数据包无限循环。每经过一个MPLS路由器，TTL值减少1，当TTL值为0时，数据包将被自动丢弃。</p>
</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C%E5%B1%82/" rel="tag"><i class="fa fa-tag"></i> 网络层</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" rel="prev" title="计算机网络-数据链路层">
                  <i class="fa fa-chevron-left"></i> 计算机网络-数据链路层
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%BF%90%E8%BE%93%E5%B1%82/" rel="next" title="计算机网络-运输层">
                  计算机网络-运输层 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fingsinz</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">136k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:07</span>
  </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.11/pdfobject.min.js","integrity":"sha256-N6JtCNwaYm6kizuG92UtOOXamRHPwu+V1yF10g3bu/c="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
